{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///cornerstone.min.js","webpack:///webpack/bootstrap 76fd0302f31f151c9ae9","webpack:///./enabledElements.js","webpack:///./internal/now.js","webpack:///./triggerEvent.js","webpack:///./setToPixelCoordinateSystem.js","webpack:///./updateImage.js","webpack:///./internal/drawImage.js","webpack:///./internal/getDefaultViewport.js","webpack:///./colors/index.js","webpack:///./rendering/renderColorImage.js","webpack:///./internal/getTransform.js","webpack:///./rendering/initializeRenderCanvas.js","webpack:///./rendering/saveLastRendered.js","webpack:///./rendering/doesImageNeedToBeRendered.js","webpack:///./webgl/index.js","webpack:///./events.js","webpack:///./rendering/renderGrayscaleImage.js","webpack:///./internal/generateLut.js","webpack:///./internal/getModalityLUT.js","webpack:///./internal/getVOILut.js","webpack:///./internal/getStoredValue.js","webpack:///./internal/requestAnimationFrame.js","webpack:///./internal/storedPixelDataToCanvasImageData.js","webpack:///./internal/storedColorPixelDataToCanvasImageData.js","webpack:///./internal/storedPixelDataToCanvasImageDataColorLUT.js","webpack:///./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js","webpack:///./internal/calculateTransform.js","webpack:///./rendering/renderLabelMapImage.js","webpack:///./rendering/renderPseudoColorImage.js","webpack:///./layers.js","webpack:///./internal/autoWindow.js","webpack:///./internal/getMinMax.js","webpack:///./colors/colormap.js","webpack:///./colors/lookupTable.js","webpack:///./internal/storedPixelDataToCanvasImageDataRGBA.js","webpack:///./internal/transform.js","webpack:///./rendering/getLut.js","webpack:///./webgl/textureCache.js","webpack:///./webgl/createProgramFromString.js","webpack:///./rendering/renderWebImage.js","webpack:///./resize.js","webpack:///./fitToWindow.js","webpack:///./getStoredPixels.js","webpack:///./imageCache.js","webpack:///./pixelDataToFalseColorData.js","webpack:///./index.js","webpack:///./internal/index.js","webpack:///./rendering/lutMatches.js","webpack:///./internal/generateColorLut.js","webpack:///./internal/storedRGBAPixelDataToCanvasImageData.js","webpack:///./webgl/renderer.js","webpack:///./webgl/shaders/index.js","webpack:///./webgl/shaders/int16.js","webpack:///./webgl/shaders/int8.js","webpack:///./webgl/shaders/rgb.js","webpack:///./webgl/shaders/uint16.js","webpack:///./webgl/shaders/uint8.js","webpack:///./webgl/vertexShader.js","webpack:///./canvasToPixel.js","webpack:///./disable.js","webpack:///./displayImage.js","webpack:///./internal/guid.js","webpack:///./draw.js","webpack:///./drawInvalidated.js","webpack:///./enable.js","webpack:///./internal/drawImageSync.js","webpack:///./internal/drawCompositeImage.js","webpack:///./enabledElementData.js","webpack:///./getDefaultViewportForImage.js","webpack:///./getImage.js","webpack:///./getPixels.js","webpack:///./getViewport.js","webpack:///./imageLoader.js","webpack:///./invalidate.js","webpack:///./invalidateImageId.js","webpack:///./pageToPixel.js","webpack:///./pixelToCanvas.js","webpack:///./reset.js","webpack:///./setViewport.js","webpack:///./rendering/index.js","webpack:///./metaData.js","webpack:///./falseColorMapping.js"],"names":["root","factory","exports","module","define","amd","self","this","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","getEnabledElement","element","undefined","Error","enabledElements","length","addEnabledElement","enabledElement","push","getEnabledElementsByImageId","imageId","ees","forEach","image","getEnabledElements","value","default","window","performance","now","Date","triggerEvent","el","type","detail","arguments","event","CustomEvent","cancelable","document","createEvent","initCustomEvent","dispatchEvent","context","scale","transform","_calculateTransform2","setTransform","_calculateTransform","obj","invalidated","_enabledElements","layers","_drawImage2","_drawImage","needsRedraw","invalid","canvas","translation","x","y","voi","windowWidth","windowCenter","invert","pixelReplication","rotation","hflip","vflip","modalityLUT","voiLUT","colormap","labelmap","displayedArea","tlhc","brhc","rowPixelSpacing","columnPixelSpacing","presentationSizeMode","verticalScale","height","rows","horizontalScale","width","columns","Math","min","Boolean","_colormap","_lookupTable","_lookupTable2","getColormap","getColormapsList","LookupTable","_interopRequireDefault","getLut","viewport","cachedLut","lutArray","_generateColorLut2","getRenderCanvas","renderingTools","renderCanvas","createElement","getCanvas","_doesImageNeedToBeRendered2","_initializeRenderCanvas2","start","_now2","colorLut","stats","lastLutGenerateTime","renderCanvasData","renderCanvasContext","rgba","_storedRGBAPixelDataToCanvasImageData2","data","_storedColorPixelDataToCanvasImageData2","putImageData","lastPutImageDataTime","renderColorImage","getContext","fillStyle","fillRect","imageSmoothingEnabled","mozImageSmoothingEnabled","_setToPixelCoordinateSystem2","options","renderer","toLowerCase","_index2","render","sx","sy","drawImage","_saveLastRendered2","addColorLayer","layer","_now","_generateColorLut","_storedColorPixelDataToCanvasImageData","_storedRGBAPixelDataToCanvasImageData","_setToPixelCoordinateSystem","_index","_doesImageNeedToBeRendered","_initializeRenderCanvas","_saveLastRendered","canvasContext","getImageData","lastRenderedImageId","lastRenderedViewport","_renderer","_createProgramFromString","_createProgramFromString2","_textureCache","_textureCache2","mod","createProgramFromString","initRenderer","isWebGLAvailable","textureCache","isWebGLInitialized","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","writable","key","protoProps","staticProps","EventTarget","listeners","callback","stack","splice","defaultPrevented","events","useAlphaChannel","lut","_getLut2","_storedPixelDataToCanvasImageData2","_storedPixelDataToCanvasImageDataRGBA2","renderGrayscaleImage","addGrayscaleLayer","_storedPixelDataToCanvasImageData","_storedPixelDataToCanvasImageDataRGBA","_getLut","_autoWindow2","photometricInterpretation","maxPixelValue","minPixelValue","offset","Uint8ClampedArray","mlutfn","_getModalityLUT2","slope","intercept","vlutfn","_getVOILut2","storedValue","_getModalityLUT","_getVOILut","_autoWindow","generateLinearModalityLUT","storedPixelValue","generateNonLinearModalityLUT","minValue","maxValue","maxValueMapped","firstValueMapped","_toConsumableArray","arr","Array","isArray","arr2","from","generateLinearVOILUT","modalityLutValue","generateNonLinearVOILUT","bitsPerEntry","max","apply","toString","shift","index","pixelData","requestFrame","setTimeout","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","canvasImageDataData","getPixelData","lastGetPixelDataTime","shouldShift","pixelRepresentation","bitsStored","numPixels","canvasImageDataIndex","storedPixelDataIndex","Int16Array","_getStoredValue2","Uint16Array","lastStoredPixelDataToCanvasImageDataTime","_getStoredValue","storedPixelDataToCanvasImageDataColorLUT","clut","Table","storedPixelDataToCanvasImageDataPseudocolorLUT","grayscaleLut","grayscale","_transform","Transform","translate","angle","rotate","PI","widthScale","heightScale","colormapId","getId","createLookupTable","_storedPixelDataToCanvasImageDataColorLUT2","renderLabelMapImage","addLabelMapLayer","_storedPixelDataToCanvasImageDataColorLUT","setNumberOfColors","_storedPixelDataToCanvasImageDataPseudocolorLUT2","renderPseudoColorImage","addPseudoColorLayer","_storedPixelDataToCanvasImageDataPseudocolorLUT","eventName","layerId","eventData","_triggerEvent2","rescaleImage","baseLayer","targetLayer","baseImage","targetImage","colRelative","viewportRatio","addLayer","_guid2","_getDefaultViewport2","assign","syncViewports","newLayer","setActiveLayer","removeLayer","findIndex","activeLayerId","getLayer","find","getLayers","getVisibleLayers","filter","visible","opacity","_updateImage2","setLayerImage","getActiveLayer","defaultViewport","_guid","_getDefaultViewport","_updateImage","_triggerEvent","hasModalityLUT","hasVoiLUT","minMax","_getMinMax2","map","sv","abs","_getMinMax","pixel","linspace","a","b","increment","vector","getRank","array","elem","left","right","mid","floor","midElem","searchSorted","inputArray","values","indexes","len","sort","makeMappingArray","N","gamma","y0","y1","xLinSpace","pow","xLinSpaceIndexes","colorPercent","colorDelta","createLinearSegmentedColormap","segmentedData","redLut","red","greenLut","green","blueLut","blue","round","colormaps","keys","colormapsData","id","aName","bName","colormapData","colors","numColors","getColorSchemeName","setColorSchemeName","getNumberOfColors","COLOR_TRANSPARENT","getColor","isValidIndex","getColorRepeating","setColor","addColor","insertColor","removeColor","clearColors","buildLookupTable","setNumberOfTableValues","setTableValue","hotIron","numOfColors","pet","hotMetalBlue","pet20Step","gray","jet","hsv","hot","cool","spring","summer","autumn","winter","bone","copper","spectral","coolwarm","blues","HSVToRGB","hue","sat","val","rgb","hueCase","frac","lx","ly","lz","linearIndexLookupMain","v","dIndex","Range","MaxIndex","BELOW_RANGE_COLOR_INDEX","ABOVE_RANGE_COLOR_INDEX","Shift","Scale","NumberOfColors","Ramp","TableRange","HueRange","SaturationRange","ValueRange","AlphaRange","NaNColor","BelowRangeColor","UseBelowRangeColor","AboveRangeColor","UseAboveRangeColor","InputRange","number","ramp","end","scalar","mapValue","force","maxIndex","hinc","sinc","vinc","ainc","alpha","c_rgba","cos","sqrt","buildSpecialColors","numberOfColors","belowRangeColorIndex","aboveRangeColorIndex","nanColorIndex","getIndex","Number","MAX_VALUE","isNaN","slice","pixelValue","reset","matrix","m11","m12","m21","m22","dx","dy","m0","m1","m2","m3","m4","m5","rad","sin","px","py","_lutMatches2","_generateLut2","_lutMatches","_generateLut","getCacheInfo","maximumSizeInBytes","cacheSizeInBytes","numberOfImagesCached","cachedImages","purgeCacheIfNecessary","compare","timeStamp","lastCachedImage","sizeInBytes","imageCache","pop","_events2","cacheInfo","setMaximumSizeBytes","numBytes","toFixed","putImageTexture","imageTexture","cachedImage","getImageTexture","removeImageTexture","indexOf","purgeCache","removedCachedImage","_events","compileShader","gl","shaderSource","shaderType","shader","createShader","getShaderParameter","COMPILE_STATUS","isContextLost","infoLog","getShaderInfoLog","console","error","createProgram","vertexShader","fragmentShader","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","vertexShaderSrc","fragShaderSrc","VERTEX_SHADER","FRAGMENT_SHADER","renderWebImage","getImage","_renderColorImage","setCanvasSize","clientWidth","style","clientHeight","fitViewportToWindow","_fitToWindow2","_fitToWindow","getImageSize","imageSize","storedPixels","row","column","spIndex","removeImageLoadObject","putImageLoadObject","imageLoadObject","promise","imageCacheDict","cancelFn","loaded","sharedCacheKey","then","eventDetails","action","getImageLoadObject","decache","imagePromise","changeImageIdCacheSize","newCacheSize","cacheEntry","cacheSizeDifference","lookupTable","color","falseColor","origPixelData","storedColorPixelData","Uint8Array","sp","mapped","build","_requestAnimationFrame","_renderLabelMapImage","_renderPseudoColorImage","_renderGrayscaleImage","_renderWebImage","_canvasToPixel","_disable","_displayImage","_draw","_drawInvalidated","_enable","_enabledElementData","getElementData","removeElementData","_layers","_getDefaultViewportForImage","_getImage","_getPixels","_getStoredPixels","_getViewport","_imageLoader","loadImage","loadAndCacheImage","registerImageLoader","registerUnknownImageLoader","_invalidate","_invalidateImageId","_pageToPixel","_pixelToCanvas","_reset","_resize","_setViewport","_pixelDataToFalseColorData","_imageCache","_metaData","_index3","_index4","_falseColorMapping","convertImageToFalseColorImage","convertToFalseColorImage","restoreImage","_requestAnimationFrame2","_getTransform","_getTransform2","generateLut","getDefaultViewport","storedPixelDataToCanvasImageData","storedPixelDataToCanvasImageDataRGBA","storedColorPixelDataToCanvasImageData","getTransform","calculateTransform","initShaders","shaders","attributes","uniforms","vert","_vertexShader","frag","texCoordLocation","getAttribLocation","enableVertexAttribArray","positionLocation","resolutionLocation","getUniformLocation","initWebGL","initBuffers","updateRectangle","bufferData","ARRAY_BUFFER","Float32Array","STATIC_DRAW","handleLostContext","preventDefault","warn","handleRestoredContext","preserveDrawingBuffer","removeEventListener","addEventListener","getImageDataType","datatype","getShaderProgram","generateTexture","TEXTURE_FORMAT","uint8","LUMINANCE","int8","LUMINANCE_ALPHA","uint16","int16","RGB","TEXTURE_BYTES","imageDataType","format","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","pixelStorei","UNPACK_ALIGNMENT","imageData","dataUtilities","storedPixelDataToImageData","texImage2D","UNSIGNED_BYTE","positionBuffer","createBuffer","bindBuffer","texCoordBuffer","renderQuad","parameters","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","useProgram","vertexAttribPointer","FLOAT","uniformLocation","uniform","uniform1i","uniform1f","uniform2f","activeTexture","TEXTURE0","drawArrays","TRIANGLE_STRIP","getModalityLUTFunction","getVoiLUTFunction","u_resolution","wc","ww","failIfMajorPerformanceCaveat","WebGLRenderingContext","e","_int","_int2","_rgb","_uint","_uint2","int16Shader","int16DataUtilities","int8Shader","int8DataUtilities","numStoredPixels","numOutputPixels","storedPixelData","rgbShader","rgbDataUtilities","uint16Shader","uint16DataUtilities","uint8Shader","uint8DataUtilities","pt","transformPoint","removeChild","oldImage","attrname","frameRate","lastImageTimeStamp","newImageEventData","s4","random","substring","ee","hasImageOrLayers","draw","timestamp","_drawImageSync2","appendChild","_resize2","_drawImageSync","lastRenderTime","_drawCompositeImage2","renderTimeInMs","_drawCompositeImage","getViewportRatio","baseLayerId","targetLayerId","originalViewportScale","activeLayer","renderLayers","save","isInvalid","globalAlpha","restore","allLayers","visibleLayers","resynced","lastSyncViewportsState","dataType","_getStoredPixels2","loadImageFromImageLoader","colonIndex","scheme","loader","imageLoaders","unknownImageLoader","errorObject","imageLoader","oldImageLoader","pageX","pageY","rect","getBoundingClientRect","clientX","pageXOffset","clientY","top","pageYOffset","MIN_WINDOW_WIDTH","MIN_VIEWPORT_SCALE","colorImage","grayscaleImage","webImage","addProvider","provider","priority","providers","removeProvider","getMetaData","result","getPixelValues","MIN_VALUE","getRestoreImageMethod","ensuresColormap","setTableRange","_pixelDataToFalseColorData2","pixelValues"],"mappings":"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AAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAC9E,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAC9E,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAC9E,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAC9E,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAC9E,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAAO,GAAI,EAAG,EAAG,MAC9E,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MACnF,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,EAAG,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACrF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAC1F,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAC7F,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAC7F,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,GAAI,MAC9F,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACtG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,OAGpBmB,KACEzY,KAAM,MACNuX,UAAW,IACXD,SACG,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MACzE,EAAG,GAAI,EAAG,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAClF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MAAO,EAAG,GAAI,GAAI,MACnF,EAAG,IAAK,GAAI,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAC5F,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAC7F,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAC7F,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,EAAG,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAC9F,GAAI,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAClG,GAAI,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAAO,GAAI,IAAK,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAChG,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAC9F,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAChG,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAC7F,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAC/F,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAClG,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAChG,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAC7F,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAC/F,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAC7F,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACrG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,OAGpBoB,cACE1Y,KAAM,iBACNuX,UAAW,IACXD,SACG,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MACzE,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,GAAI,MAC9E,EAAG,EAAG,GAAI,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAClF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MACnF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MACnF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MACnF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MACnF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MACnF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MACnF,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,EAAG,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACpF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACxF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACxF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACxF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACxF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACxF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MACxF,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,GAAI,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAAO,IAAK,EAAG,IAAK,MAC1F,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,IAAK,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAChG,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAC7F,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAC7F,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAC7F,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAAO,IAAK,GAAI,GAAI,MAC7F,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MACxF,IAAK,GAAI,EAAG,MAAO,IAAK,GAAI,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,GAAI,MAC5F,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,IAAK,MACnG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,OAGpBqB,WACE3Y,KAAM,cACNuX,UAAW,IACXD,SACG,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MACzE,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MACzE,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAC7E,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MACnF,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MAAO,GAAI,EAAG,GAAI,MACnF,GAAI,EAAG,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MACvF,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MACxF,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,IAAK,MACzF,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAC7F,GAAI,GAAI,IAAK,MAAO,GAAI,GAAI,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACnG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MACvG,IAAK,IAAK,IAAK,MAAO,IAAK,IAAK,IAAK,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAC9F,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MACxF,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MAAO,GAAI,GAAI,GAAI,MACxF,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAC7F,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,GAAI,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAC/F,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAClG,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,GAAI,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAC/F,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAAK,IAAK,EAAG,MAAO,IAA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","file":"cornerstone.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstone-core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstone-core\"] = factory();\n\telse\n\t\troot[\"cornerstone\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","/*! cornerstone-core - 2.0.0 - 2018-01-21 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstone-core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstone-core\"] = factory();\n\telse\n\t\troot[\"cornerstone\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 44);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getEnabledElement = getEnabledElement;\nexports.addEnabledElement = addEnabledElement;\nexports.getEnabledElementsByImageId = getEnabledElementsByImageId;\nexports.getEnabledElements = getEnabledElements;\nvar enabledElements = [];\n\n/**\n * A two-dimensional vector\n *\n * @typedef {Object} vec2\n * @param {Number} x - The x distance\n * @param {Number} y - The y distance\n */\n\n/**\n * VOI\n *\n * @typedef {Object} VOI\n * @param {Number} windowWidth - Window Width for display\n * @param {Number} windowCenter - Window Center for display\n */\n\n/**\n * Lookup Table Array\n *\n * @typedef {Object} LUT\n * @property {Number} firstValueMapped\n * @property {Number} numBitsPerEntry\n * @property {Array} lut\n */\n\n/**\n * Image Statistics Object\n *\n * @typedef {Object} ImageStats\n *\n * @property {Number} [lastGetPixelDataTime] The time in ms taken to retrieve stored pixels required to draw the image\n * @property {Number} [lastStoredPixelDataToCanvasImageDataTime] The time in ms taken to map from stored pixel array to canvas pixel array\n * @property {Number} [lastPutImageDataTime] The time in ms taken for putImageData to put the canvas pixel data into the canvas context\n * @property {Number} [lastRenderTime] The total time in ms taken for the entire rendering function to run\n * @property {Number} [lastLutGenerateTime] The time in ms taken to generate the lookup table for the image\n */\n\n/**\n * An Image Object in Cornerstone\n *\n * @typedef {Object} Image\n *\n * @property {string} imageId - The imageId associated with this image object\n * @property {Number} minPixelValue - the minimum stored pixel value in the image\n * @property {Number} maxPixelValue - the maximum stored pixel value in the image\n * @property {Number} slope - the rescale slope to convert stored pixel values to modality pixel values or 1 if not specified\n * @property {Number} intercept - the rescale intercept used to convert stored pixel values to modality values or 0 if not specified\n * @property {Number} windowCenter - the default windowCenter to apply to the image\n * @property {Number} windowWidth - the default windowWidth to apply to the image\n * @property {function} getPixelData - a function that returns the underlying pixel data. An array of integers for grayscale and an array of RGBA for color\n * @property {function} getImageData - a function that returns a canvas imageData object for the image. This is only needed for color images\n * @property {function} getCanvas - a function that returns a canvas element with the image loaded into it. This is only needed for color images.\n * @property {function} getImage - a function that returns a JavaScript Image object with the image data. This is optional and typically used for images encoded in standard web JPEG and PNG formats\n * @property {Number} rows - number of rows in the image. This is the same as height but duplicated for convenience\n * @property {Number} columns - number of columns in the image. This is the same as width but duplicated for convenience\n * @property {Number} height - the height of the image. This is the same as rows but duplicated for convenience\n * @property {Number} width - the width of the image. This is the same as columns but duplicated for convenience\n * @property {Boolean} color - true if pixel data is RGB, false if grayscale\n * @property {Object} lut - The Lookup Table\n * @property {Boolean} rgba - Is the color pixel data stored in RGBA?\n * @property {Number} columnPixelSpacing - horizontal distance between the middle of each pixel (or width of each pixel) in mm or undefined if not known\n * @property {Number} rowPixelSpacing - vertical distance between the middle of each pixel (or heigh of each pixel) in mm or undefined if not known\n * @property {Boolean} invert - true if the the image should initially be displayed be inverted, false if not. This is here mainly to support DICOM images with a photometric interpretation of MONOCHROME1\n * @property {Number} sizeInBytes - the number of bytes used to store the pixels for this image.\n * @property {Boolean} [falseColor=false] - Whether or not the image has undergone false color mapping\n * @property {Array} [origPixelData] - Original pixel data for an image after it has undergone false color mapping\n * @property {ImageStats} [stats] - Statistics for the last redraw of the image\n * @property {Object} cachedLut - Cached Lookup Table for this image.\n * @property {String|Colormap} [colormap] - an optional colormap ID or colormap object (from colors/colormap.js). This will be applied during rendering to convert the image to pseudocolor\n * @property {Boolean} [labelmap=false] - whether or not to render this image as a label map (i.e. skip modality and VOI LUT pipelines and use only a color lookup table)\n */\n\n/**\n * A Viewport Settings Object Cornerstone\n *\n * @typedef {Object} Viewport\n *\n * @property {Number} [scale=1.0] - The scale applied to the image. A scale of 1.0 will display no zoom (one image pixel takes up one screen pixel). A scale of 2.0 will be double zoom and a scale of .5 will be zoomed out by 2x\n * @param {vec2} [translation] - An object with properties x and y which describe the translation to apply in the pixel coordinate system. Note that the image is initially displayed centered in the enabled element with a x and y translation of 0 and 0 respectively.\n * @param {VOI} [voi] - an object with properties windowWidth and windowCenter.\n * @property {boolean} [invert=false] - Whether or not the image is inverted.\n * @property {boolean} [pixelReplication=false] - true if the image smooth / interpolation should be used when zoomed in on the image or false if pixel replication should be used.\n * @property {boolean} [hflip=false] - true if the image is flipped horizontally. Default is false\n * @property {boolean} [vflip=false] - true if the image is flipped vertically. Default is false\n * @property {Number} [rotation=0] - the rotation of the image (90 degree increments). Default is 0\n * @property {LUT} [modalityLUT] - the modality LUT to apply or undefined if none\n * @property {LUT} [voiLUT] - the modality LUT to apply or undefined if none\n * @property {String|Colormap} [colormap] - an optional colormap ID or colormap object (from colors/colormap.js). This will be applied during rendering to convert the image to pseudocolor\n * @property {Boolean} [labelmap=false] - whether or not to render this image as a label map (i.e. skip modality and VOI LUT pipelines and use only a color lookup table)\n */\n\n/**\n * An Enabled Element in Cornerstone\n *\n * @typedef {Object} EnabledElement\n *\n * @property {HTMLElement} element - The DOM element which has been enabled for use by Cornerstone\n * @property {Image} [image] - The image currently displayed in the enabledElement\n * @property {Viewport} [viewport] - The current viewport settings of the enabledElement\n * @property {HTMLCanvasElement} [canvas] - The current canvas for this enabledElement\n * @property {Boolean} invalid - Whether or not the image pixel data underlying the enabledElement has been changed, necessitating a redraw\n * @property {Boolean} needsRedraw - A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid\n * @property {EnabledElementLayer[]} [layers] - The layers that have been added to the enabledElement\n * @property {Boolean} [syncViewports] - Whether or not to synchronize the viewport parameters\n * for each of the enabled element's layers\n * @property {Boolean} [lastSyncViewportsState] - The previous state for the sync viewport boolean\n */\n\n/**\n * An Enabled Element Layer in Cornerstone\n *\n * @typedef {Object} EnabledElementLayer\n *\n * @property {HTMLElement} element - The DOM element which has been enabled for use by Cornerstone\n * @property {Image} [image] - The image currently displayed in the enabledElement\n * @property {Viewport} [viewport] - The current viewport settings of the enabledElement\n * @property {HTMLCanvasElement} [canvas] - The current canvas for this enabledElement\n * @property {Object} [options] - Layer drawing options\n * @property {Boolean} invalid - Whether or not the image pixel data underlying the enabledElement has been changed, necessitating a redraw\n * @property {Boolean} needsRedraw - A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid\n */\n\n/**\n * An Image Load Object\n *\n * @typedef {Object} ImageLoadObject\n *\n * @property {Promise} promise - The Promise tracking the loading of this image\n * @property {Function|undefined} cancelFn - A function to cancel the image load request\n */\n\n/**\n * Retrieves a Cornerstone Enabled Element object\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n *\n * @returns {EnabledElement} A Cornerstone Enabled Element\n */\nfunction getEnabledElement(element) {\n  if (element === undefined) {\n    throw new Error('getEnabledElement: parameter element must not be undefined');\n  }\n  for (var i = 0; i < enabledElements.length; i++) {\n    if (enabledElements[i].element === element) {\n      return enabledElements[i];\n    }\n  }\n\n  throw new Error('element not enabled');\n}\n\n/**\n * Adds a Cornerstone Enabled Element object to the central store of enabledElements\n *\n * @param {EnabledElement} enabledElement A Cornerstone enabledElement Object\n * @returns {void}\n */\nfunction addEnabledElement(enabledElement) {\n  if (enabledElement === undefined) {\n    throw new Error('getEnabledElement: enabledElement element must not be undefined');\n  }\n\n  enabledElements.push(enabledElement);\n}\n\n/**\n * Adds a Cornerstone Enabled Element object to the central store of enabledElements\n *\n * @param {string} imageId A Cornerstone Image ID\n * @returns {EnabledElement[]} An Array of Cornerstone enabledElement Objects\n */\nfunction getEnabledElementsByImageId(imageId) {\n  var ees = [];\n\n  enabledElements.forEach(function (enabledElement) {\n    if (enabledElement.image && enabledElement.image.imageId === imageId) {\n      ees.push(enabledElement);\n    }\n  });\n\n  return ees;\n}\n\n/**\n * Retrieve all of the currently enabled Cornerstone elements\n *\n * @return {EnabledElement[]} An Array of Cornerstone enabledElement Objects\n */\nfunction getEnabledElements() {\n  return enabledElements;\n}\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  if (window.performance) {\n    return performance.now();\n  }\n\n  return Date.now();\n};\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = triggerEvent;\n/**\n * Trigger a CustomEvent\n *\n * @param {EventTarget} el The element or EventTarget to trigger the event upon\n * @param {String} type The event type name\n * @param {Object|null} detail=null The event data to be sent\n * @returns {Boolean} The return value is false if at least one event listener called preventDefault(). Otherwise it returns true.\n */\nfunction triggerEvent(el, type) {\n  var detail = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  var event = void 0;\n\n  // This check is needed to polyfill CustomEvent on IE11-\n  if (typeof window.CustomEvent === 'function') {\n    event = new CustomEvent(type, {\n      detail: detail,\n      cancelable: true\n    });\n  } else {\n    event = document.createEvent('CustomEvent');\n    event.initCustomEvent(type, true, true, detail);\n  }\n\n  return el.dispatchEvent(event);\n}\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement, context, scale) {\n  if (enabledElement === undefined) {\n    throw new Error('setToPixelCoordinateSystem: parameter enabledElement must not be undefined');\n  }\n  if (context === undefined) {\n    throw new Error('setToPixelCoordinateSystem: parameter context must not be undefined');\n  }\n\n  var transform = (0, _calculateTransform2.default)(enabledElement, scale);\n\n  context.setTransform(transform.m[0], transform.m[1], transform.m[2], transform.m[3], transform.m[4], transform.m[5]);\n};\n\nvar _calculateTransform = __webpack_require__(25);\n\nvar _calculateTransform2 = _interopRequireDefault(_calculateTransform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var invalidated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  if (enabledElement.image === undefined && !enabledElement.layers.length) {\n    throw new Error('updateImage: image has not been loaded yet');\n  }\n\n  (0, _drawImage2.default)(enabledElement, invalidated);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _drawImage = __webpack_require__(5);\n\nvar _drawImage2 = _interopRequireDefault(_drawImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement) {\n  var invalidated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  enabledElement.needsRedraw = true;\n  if (invalidated) {\n    enabledElement.invalid = true;\n  }\n};\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (canvas, image) {\n  if (canvas === undefined) {\n    throw new Error('getDefaultViewport: parameter canvas must not be undefined');\n  }\n\n  if (image === undefined) {\n    return {\n      scale: 1,\n      translation: {\n        x: 0,\n        y: 0\n      },\n      voi: {\n        windowWidth: undefined,\n        windowCenter: undefined\n      },\n      invert: false,\n      pixelReplication: false,\n      rotation: 0,\n      hflip: false,\n      vflip: false,\n      modalityLUT: undefined,\n      voiLUT: undefined,\n      colormap: undefined,\n      labelmap: false,\n      displayedArea: {\n        tlhc: {\n          x: 1,\n          y: 1\n        },\n        brhc: {\n          x: 1,\n          y: 1\n        },\n        rowPixelSpacing: 1,\n        columnPixelSpacing: 1,\n        presentationSizeMode: 'SCALE TO FIT'\n      }\n    };\n  }\n\n  // Fit image to window\n  var verticalScale = canvas.height / image.rows;\n  var horizontalScale = canvas.width / image.columns;\n  var scale = Math.min(horizontalScale, verticalScale);\n\n  return {\n    scale: scale,\n    translation: {\n      x: 0,\n      y: 0\n    },\n    voi: {\n      windowWidth: image.windowWidth,\n      windowCenter: image.windowCenter\n    },\n    invert: image.invert,\n    pixelReplication: false,\n    rotation: 0,\n    hflip: false,\n    vflip: false,\n    modalityLUT: image.modalityLUT,\n    voiLUT: image.voiLUT,\n    colormap: image.colormap,\n    labelmap: Boolean(image.labelmap),\n    displayedArea: {\n      tlhc: {\n        x: 1,\n        y: 1\n      },\n      brhc: {\n        x: image.columns + 1,\n        y: image.rows + 1\n      },\n      rowPixelSpacing: image.rowPixelSpacing !== undefined ? image.rowPixelSpacing : 1,\n      columnPixelSpacing: image.columnPixelSpacing !== undefined ? image.columnPixelSpacing : 1,\n      presentationSizeMode: 'SCALE TO FIT'\n    }\n  };\n};\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _colormap = __webpack_require__(31);\n\nvar _lookupTable = __webpack_require__(32);\n\nvar _lookupTable2 = _interopRequireDefault(_lookupTable);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = {\n  getColormap: _colormap.getColormap,\n  getColormapsList: _colormap.getColormapsList,\n  LookupTable: _lookupTable2.default\n};\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.renderColorImage = renderColorImage;\nexports.addColorLayer = addColorLayer;\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _generateColorLut = __webpack_require__(47);\n\nvar _generateColorLut2 = _interopRequireDefault(_generateColorLut);\n\nvar _storedColorPixelDataToCanvasImageData = __webpack_require__(22);\n\nvar _storedColorPixelDataToCanvasImageData2 = _interopRequireDefault(_storedColorPixelDataToCanvasImageData);\n\nvar _storedRGBAPixelDataToCanvasImageData = __webpack_require__(48);\n\nvar _storedRGBAPixelDataToCanvasImageData2 = _interopRequireDefault(_storedRGBAPixelDataToCanvasImageData);\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nvar _setToPixelCoordinateSystem2 = _interopRequireDefault(_setToPixelCoordinateSystem);\n\nvar _index = __webpack_require__(13);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _doesImageNeedToBeRendered = __webpack_require__(12);\n\nvar _doesImageNeedToBeRendered2 = _interopRequireDefault(_doesImageNeedToBeRendered);\n\nvar _initializeRenderCanvas = __webpack_require__(10);\n\nvar _initializeRenderCanvas2 = _interopRequireDefault(_initializeRenderCanvas);\n\nvar _saveLastRendered = __webpack_require__(11);\n\nvar _saveLastRendered2 = _interopRequireDefault(_saveLastRendered);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getLut(image, viewport) {\n  // If we have a cached lut and it has the right values, return it immediately\n  if (image.cachedLut !== undefined && image.cachedLut.windowCenter === viewport.voi.windowCenter && image.cachedLut.windowWidth === viewport.voi.windowWidth && image.cachedLut.invert === viewport.invert) {\n    return image.cachedLut.lutArray;\n  }\n\n  // Lut is invalid or not present, regenerate it and cache it\n  (0, _generateColorLut2.default)(image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert);\n  image.cachedLut.windowWidth = viewport.voi.windowWidth;\n  image.cachedLut.windowCenter = viewport.voi.windowCenter;\n  image.cachedLut.invert = viewport.invert;\n\n  return image.cachedLut.lutArray;\n} /**\n   * This module is responsible for drawing an image to an enabled elements canvas element\n   */\n\n\nfunction getRenderCanvas(enabledElement, image, invalidated) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  var renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // The ww/wc is identity and not inverted - get a canvas with the image rendered into it for\n  // Fast drawing\n  if (enabledElement.viewport.voi.windowWidth === 255 && enabledElement.viewport.voi.windowCenter === 128 && enabledElement.viewport.invert === false && image.getCanvas && image.getCanvas()) {\n    return image.getCanvas();\n  }\n\n  // Apply the lut to the stored pixel data onto the render canvas\n  if ((0, _doesImageNeedToBeRendered2.default)(enabledElement, image) === false && invalidated !== true) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    (0, _initializeRenderCanvas2.default)(enabledElement, image);\n  }\n\n  // Get the lut to use\n  var start = (0, _now2.default)();\n  var colorLut = getLut(image, enabledElement.viewport);\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = (0, _now2.default)() - start;\n\n  var renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  // The color image voi/invert has been modified - apply the lut to the underlying\n  // Pixel data and put it into the renderCanvas\n  if (image.rgba) {\n    (0, _storedRGBAPixelDataToCanvasImageData2.default)(image, colorLut, renderCanvasData.data);\n  } else {\n    (0, _storedColorPixelDataToCanvasImageData2.default)(image, colorLut, renderCanvasData.data);\n  }\n\n  start = (0, _now2.default)();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = (0, _now2.default)() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to render a color image to an enabled element\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nfunction renderColorImage(enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('renderColorImage: enabledElement parameter must not be undefined');\n  }\n\n  var image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('renderColorImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  var context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  (0, _setToPixelCoordinateSystem2.default)(enabledElement, context);\n\n  var renderCanvas = void 0;\n\n  if (enabledElement.options && enabledElement.options.renderer && enabledElement.options.renderer.toLowerCase() === 'webgl') {\n    // If this enabled element has the option set for WebGL, we should\n    // User it as our renderer.\n    renderCanvas = _index2.default.renderer.render(enabledElement);\n  } else {\n    // If no options are set we will retrieve the renderCanvas through the\n    // Normal Canvas rendering path\n    renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n  }\n\n  var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  var width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  var height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = (0, _saveLastRendered2.default)(enabledElement);\n}\n\nfunction addColorLayer(layer, invalidated) {\n  if (layer === undefined) {\n    throw new Error('addColorLayer: layer parameter must not be undefined');\n  }\n\n  var image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addColorLayer: image must be loaded before it can be drawn');\n  }\n\n  // All multi-layer images should include the alpha value\n  image.rgba = true;\n  layer.canvas = getRenderCanvas(layer, image, invalidated);\n\n  var context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = (0, _saveLastRendered2.default)(layer);\n}\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement) {\n  // For now we will calculate it every time it is requested.\n  // In the future, we may want to cache it in the enabled element to speed things up.\n  return (0, _calculateTransform2.default)(enabledElement);\n};\n\nvar _calculateTransform = __webpack_require__(25);\n\nvar _calculateTransform2 = _interopRequireDefault(_calculateTransform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement, image) {\n  var renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // Resize the canvas\n  renderCanvas.width = image.width;\n  renderCanvas.height = image.height;\n\n  var canvasContext = renderCanvas.getContext('2d');\n\n  // NOTE - we need to fill the render canvas with white pixels since we\n  // control the luminance using the alpha channel to improve rendering performance.\n  canvasContext.fillStyle = 'white';\n  canvasContext.fillRect(0, 0, renderCanvas.width, renderCanvas.height);\n\n  var renderCanvasData = canvasContext.getImageData(0, 0, image.width, image.height);\n\n  enabledElement.renderingTools.renderCanvasContext = canvasContext;\n  enabledElement.renderingTools.renderCanvasData = renderCanvasData;\n};\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement) {\n  var imageId = enabledElement.image.imageId;\n  var viewport = enabledElement.viewport;\n\n  enabledElement.renderingTools.lastRenderedImageId = imageId;\n  enabledElement.renderingTools.lastRenderedViewport = {\n    windowCenter: viewport.voi.windowCenter,\n    windowWidth: viewport.voi.windowWidth,\n    invert: viewport.invert,\n    rotation: viewport.rotation,\n    hflip: viewport.hflip,\n    vflip: viewport.vflip,\n    modalityLUT: viewport.modalityLUT,\n    voiLUT: viewport.voiLUT,\n    colormap: viewport.colormap\n  };\n\n  return enabledElement.renderingTools;\n};\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement, image) {\n  var lastRenderedImageId = enabledElement.renderingTools.lastRenderedImageId;\n  var lastRenderedViewport = enabledElement.renderingTools.lastRenderedViewport;\n\n  return image.imageId !== lastRenderedImageId || !lastRenderedViewport || lastRenderedViewport.windowCenter !== enabledElement.viewport.voi.windowCenter || lastRenderedViewport.windowWidth !== enabledElement.viewport.voi.windowWidth || lastRenderedViewport.invert !== enabledElement.viewport.invert || lastRenderedViewport.rotation !== enabledElement.viewport.rotation || lastRenderedViewport.hflip !== enabledElement.viewport.hflip || lastRenderedViewport.vflip !== enabledElement.viewport.vflip || lastRenderedViewport.modalityLUT !== enabledElement.viewport.modalityLUT || lastRenderedViewport.voiLUT !== enabledElement.viewport.voiLUT || lastRenderedViewport.colormap !== enabledElement.viewport.colormap;\n};\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderer = __webpack_require__(49);\n\nvar _createProgramFromString = __webpack_require__(37);\n\nvar _createProgramFromString2 = _interopRequireDefault(_createProgramFromString);\n\nvar _textureCache = __webpack_require__(36);\n\nvar _textureCache2 = _interopRequireDefault(_textureCache);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar mod = {\n  createProgramFromString: _createProgramFromString2.default,\n  renderer: {\n    render: _renderer.render,\n    initRenderer: _renderer.initRenderer,\n    getRenderCanvas: _renderer.getRenderCanvas,\n    isWebGLAvailable: _renderer.isWebGLAvailable\n  },\n  textureCache: _textureCache2.default\n};\n\nObject.defineProperty(mod, 'isWebGLInitialized', {\n  enumerable: true,\n  configurable: false,\n  get: function get() {\n    return _renderer.isWebGLInitialized;\n  }\n});\n\nexports.default = mod;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar EventTarget = function () {\n  function EventTarget() {\n    _classCallCheck(this, EventTarget);\n\n    this.listeners = {};\n  }\n\n  _createClass(EventTarget, [{\n    key: \"addEventListener\",\n    value: function addEventListener(type, callback) {\n      if (!(type in this.listeners)) {\n        this.listeners[type] = [];\n      }\n\n      this.listeners[type].push(callback);\n    }\n  }, {\n    key: \"removeEventListener\",\n    value: function removeEventListener(type, callback) {\n      if (!(type in this.listeners)) {\n        return;\n      }\n\n      var stack = this.listeners[type];\n\n      for (var i = 0, l = stack.length; i < l; i++) {\n        if (stack[i] === callback) {\n          stack.splice(i, 1);\n\n          return;\n        }\n      }\n    }\n  }, {\n    key: \"dispatchEvent\",\n    value: function dispatchEvent(event) {\n      if (!(event.type in this.listeners)) {\n        return true;\n      }\n\n      var stack = this.listeners[event.type];\n\n      for (var i = 0, l = stack.length; i < l; i++) {\n        stack[i].call(this, event);\n      }\n\n      return !event.defaultPrevented;\n    }\n  }]);\n\n  return EventTarget;\n}();\n\nvar events = new EventTarget();\n\nexports.default = events;\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.renderGrayscaleImage = renderGrayscaleImage;\nexports.addGrayscaleLayer = addGrayscaleLayer;\n\nvar _storedPixelDataToCanvasImageData = __webpack_require__(21);\n\nvar _storedPixelDataToCanvasImageData2 = _interopRequireDefault(_storedPixelDataToCanvasImageData);\n\nvar _storedPixelDataToCanvasImageDataRGBA = __webpack_require__(33);\n\nvar _storedPixelDataToCanvasImageDataRGBA2 = _interopRequireDefault(_storedPixelDataToCanvasImageDataRGBA);\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nvar _setToPixelCoordinateSystem2 = _interopRequireDefault(_setToPixelCoordinateSystem);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _index = __webpack_require__(13);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _getLut = __webpack_require__(35);\n\nvar _getLut2 = _interopRequireDefault(_getLut);\n\nvar _doesImageNeedToBeRendered = __webpack_require__(12);\n\nvar _doesImageNeedToBeRendered2 = _interopRequireDefault(_doesImageNeedToBeRendered);\n\nvar _initializeRenderCanvas = __webpack_require__(10);\n\nvar _initializeRenderCanvas2 = _interopRequireDefault(_initializeRenderCanvas);\n\nvar _saveLastRendered = __webpack_require__(11);\n\nvar _saveLastRendered2 = _interopRequireDefault(_saveLastRendered);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRenderCanvas(enabledElement, image, invalidated) {\n  var useAlphaChannel = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  var renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  if ((0, _doesImageNeedToBeRendered2.default)(enabledElement, image) === false && invalidated !== true) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    (0, _initializeRenderCanvas2.default)(enabledElement, image);\n  }\n\n  // Get the lut to use\n  var start = (0, _now2.default)();\n  var lut = (0, _getLut2.default)(image, enabledElement.viewport, invalidated);\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = (0, _now2.default)() - start;\n\n  var renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  // Gray scale image - apply the lut and put the resulting image onto the render canvas\n  if (useAlphaChannel) {\n    (0, _storedPixelDataToCanvasImageData2.default)(image, lut, renderCanvasData.data);\n  } else {\n    (0, _storedPixelDataToCanvasImageDataRGBA2.default)(image, lut, renderCanvasData.data);\n  }\n\n  start = (0, _now2.default)();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = (0, _now2.default)() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to draw a grayscale image to a given enabledElement\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nfunction renderGrayscaleImage(enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('drawImage: enabledElement parameter must not be undefined');\n  }\n\n  var image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('drawImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  var context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  (0, _setToPixelCoordinateSystem2.default)(enabledElement, context);\n\n  var renderCanvas = void 0;\n\n  if (enabledElement.options && enabledElement.options.renderer && enabledElement.options.renderer.toLowerCase() === 'webgl') {\n    // If this enabled element has the option set for WebGL, we should\n    // User it as our renderer.\n    renderCanvas = _index2.default.renderer.render(enabledElement);\n  } else {\n    // If no options are set we will retrieve the renderCanvas through the\n    // Normal Canvas rendering path\n    renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n  }\n\n  var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  var width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  var height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = (0, _saveLastRendered2.default)(enabledElement);\n}\n\n/**\n * API function to draw a grayscale image to a given layer\n *\n * @param {EnabledElementLayer} layer The layer that the image will be added to\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @param {Boolean} [useAlphaChannel] - Whether or not to render the grayscale image using only the alpha channel.\n                                        This does not work if this layer is not the first layer in the enabledElement.\n * @returns {void}\n */\nfunction addGrayscaleLayer(layer, invalidated) {\n  var useAlphaChannel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (layer === undefined) {\n    throw new Error('addGrayscaleLayer: layer parameter must not be undefined');\n  }\n\n  var image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addGrayscaleLayer: image must be loaded before it can be drawn');\n  }\n\n  layer.canvas = getRenderCanvas(layer, image, invalidated, useAlphaChannel);\n\n  var context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = (0, _saveLastRendered2.default)(layer);\n}\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, viewport) {\n  //Auto window\n  (0, _autoWindow2.default)(image, viewport);\n\n  var modalityLUT = viewport.modalityLUT;\n  var voiLUT = viewport.voiLUT;\n  var windowWidth = viewport.voi.windowWidth;\n  var windowCenter = viewport.voi.windowCenter;\n  var invert = viewport.invert || image.photometricInterpretation === 'MONOCHROME1';\n\n  var maxPixelValue = image.maxPixelValue;\n  var minPixelValue = image.minPixelValue;\n  var offset = Math.min(minPixelValue, 0);\n\n  if (image.cachedLut === undefined) {\n    var length = maxPixelValue - offset + 1;\n\n    image.cachedLut = {};\n    image.cachedLut.lutArray = new Uint8ClampedArray(length);\n  }\n\n  var lut = image.cachedLut.lutArray;\n  var mlutfn = (0, _getModalityLUT2.default)(image.slope, image.intercept, modalityLUT);\n  var vlutfn = (0, _getVOILut2.default)(windowWidth, windowCenter, voiLUT);\n\n  if (invert === true) {\n    for (var storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {\n      lut[storedValue + -offset] = 255 - vlutfn(mlutfn(storedValue));\n    }\n  } else {\n    for (var _storedValue = minPixelValue; _storedValue <= maxPixelValue; _storedValue++) {\n      lut[_storedValue + -offset] = vlutfn(mlutfn(_storedValue));\n    }\n  }\n\n  return lut;\n};\n\nvar _getModalityLUT = __webpack_require__(17);\n\nvar _getModalityLUT2 = _interopRequireDefault(_getModalityLUT);\n\nvar _getVOILut = __webpack_require__(18);\n\nvar _getVOILut2 = _interopRequireDefault(_getVOILut);\n\nvar _autoWindow = __webpack_require__(29);\n\nvar _autoWindow2 = _interopRequireDefault(_autoWindow);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (slope, intercept, modalityLUT) {\n  if (modalityLUT) {\n    return generateNonLinearModalityLUT(modalityLUT);\n  }\n\n  return generateLinearModalityLUT(slope, intercept);\n};\n\n/**\n * Generates a linear modality transformation function\n *\n * See DICOM PS3.3 C.11.1 Modality LUT Module\n *\n * http://dicom.nema.org/medical/Dicom/current/output/chtml/part03/sect_C.11.html\n *\n * @param {Number} slope m in the equation specified by Rescale Intercept (0028,1052).\n * @param {Number} intercept The value b in relationship between stored values (SV) and the output units specified in Rescale Type (0028,1054).\n\n Output units = m*SV + b.\n * @return {function(*): *} A linear modality LUT function. Given a stored pixel it returns the modality pixel value\n */\nfunction generateLinearModalityLUT(slope, intercept) {\n  return function (storedPixelValue) {\n    return storedPixelValue * slope + intercept;\n  };\n}\n\nfunction generateNonLinearModalityLUT(modalityLUT) {\n  var minValue = modalityLUT.lut[0];\n  var maxValue = modalityLUT.lut[modalityLUT.lut.length - 1];\n  var maxValueMapped = modalityLUT.firstValueMapped + modalityLUT.lut.length;\n\n  return function (storedPixelValue) {\n    if (storedPixelValue < modalityLUT.firstValueMapped) {\n      return minValue;\n    } else if (storedPixelValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return modalityLUT.lut[storedPixelValue];\n  };\n}\n\n/**\n * Get the appropriate Modality LUT for the current situation.\n *\n * @param {Number} [slope] m in the equation specified by Rescale Intercept (0028,1052).\n * @param {Number} [intercept] The value b in relationship between stored values (SV) and the output units specified in Rescale Type (0028,1054).\n * @param {Function} [modalityLUT] A modality LUT function. Given a stored pixel it returns the modality pixel value.\n *\n * @return {function(*): *} A modality LUT function. Given a stored pixel it returns the modality pixel value.\n */\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (windowWidth, windowCenter, voiLUT) {\n  if (voiLUT) {\n    return generateNonLinearVOILUT(voiLUT);\n  }\n\n  return generateLinearVOILUT(windowWidth, windowCenter);\n};\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/* eslint no-bitwise: 0 */\n\n/**\n * Volume of Interest Lookup Table Function\n *\n * @typedef {Function} VOILUTFunction\n *\n * @param {Number} modalityLutValue\n * @returns {Number} transformed value\n */\n\n/**\n *\n * @param {Number} windowWidth Window Width\n * @param {Number} windowCenter Window Center\n * @returns {VOILUTFunction} VOI LUT mapping function\n */\nfunction generateLinearVOILUT(windowWidth, windowCenter) {\n  return function (modalityLutValue) {\n    return ((modalityLutValue - windowCenter) / windowWidth + 0.5) * 255.0;\n  };\n}\n\n/**\n * Generate a non-linear volume of interest lookup table\n *\n * @param {LUT} voiLUT Volume of Interest Lookup Table Object\n *\n * @returns {VOILUTFunction} VOI LUT mapping function\n */\nfunction generateNonLinearVOILUT(voiLUT) {\n  // We don't trust the voiLUT.numBitsPerEntry, mainly thanks to Agfa!\n  var bitsPerEntry = Math.max.apply(Math, _toConsumableArray(voiLUT.lut)).toString(2).length;\n  var shift = bitsPerEntry - 8;\n  var minValue = voiLUT.lut[0] >> shift;\n  var maxValue = voiLUT.lut[voiLUT.lut.length - 1] >> shift;\n  var maxValueMapped = voiLUT.firstValueMapped + voiLUT.lut.length - 1;\n\n  return function (modalityLutValue) {\n    if (modalityLutValue < voiLUT.firstValueMapped) {\n      return minValue;\n    } else if (modalityLutValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return voiLUT.lut[modalityLutValue - voiLUT.firstValueMapped] >> shift;\n  };\n}\n\n/**\n * Retrieve a VOI LUT mapping function given the current windowing settings\n * and the VOI LUT for the image\n *\n * @param {Number} windowWidth Window Width\n * @param {Number} windowCenter Window Center\n * @param {LUT} [voiLUT] Volume of Interest Lookup Table Object\n *\n * @return {VOILUTFunction} VOI LUT mapping function\n */\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (index, pixelData, shift) {\n  if (shift !== undefined) {\n    return pixelData[index] << shift >> shift;\n  } else {\n    return pixelData[index];\n  }\n};\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (callback) {\n  return window.requestAnimationFrame(callback) || window.webkitRequestAnimationFrame(callback) || window.mozRequestAnimationFrame(callback) || window.oRequestAnimationFrame(callback) || window.msRequestAnimationFrame(callback) || requestFrame(callback);\n};\n\nfunction requestFrame(callback) {\n  window.setTimeout(callback, 1000 / 60);\n}\n\n/**\n * Polyfills requestAnimationFrame for older browsers.\n *\n * @param {Function} callback A parameter specifying a function to call when it's time to update your animation for the next repaint. The callback has one single argument, a DOMHighResTimeStamp, which indicates the current time (the time returned from performance.now() ) for when requestAnimationFrame starts to fire callbacks.\n *\n * @return {Number} A long integer value, the request id, that uniquely identifies the entry in the callback list. This is a non-zero value, but you may not make any other assumptions about its value. You can pass this value to window.cancelAnimationFrame() to cancel the refresh callback request.\n */\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, lut, canvasImageDataData) {\n  var start = (0, _now2.default)();\n  var pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = (0, _now2.default)() - start;\n  var shouldShift = image.pixelRepresentation !== undefined && image.pixelRepresentation === 1;\n  var shift = shouldShift && image.bitsStored !== undefined ? 32 - image.bitsStored : undefined;\n  var numPixels = pixelData.length;\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 3;\n  var storedPixelDataIndex = 0;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n\n  // Added two paths (Int16Array, Uint16Array) to avoid polymorphic deoptimization in chrome.\n  start = (0, _now2.default)();\n  if (pixelData instanceof Int16Array) {\n    if (minPixelValue < 0) {\n      while (storedPixelDataIndex < numPixels) {\n        canvasImageDataData[canvasImageDataIndex] = lut[(0, _getStoredValue2.default)(storedPixelDataIndex++, pixelData, shift) + -minPixelValue]; // Alpha\n        canvasImageDataIndex += 4;\n      }\n    } else {\n      while (storedPixelDataIndex < numPixels) {\n        canvasImageDataData[canvasImageDataIndex] = lut[(0, _getStoredValue2.default)(storedPixelDataIndex++, pixelData, shift)]; // Alpha\n        canvasImageDataIndex += 4;\n      }\n    }\n  } else if (pixelData instanceof Uint16Array) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex] = lut[(0, _getStoredValue2.default)(storedPixelDataIndex++, pixelData, shift)]; // Alpha\n      canvasImageDataIndex += 4;\n    }\n  } else if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex] = lut[(0, _getStoredValue2.default)(storedPixelDataIndex++, pixelData, shift) + -minPixelValue]; // Alpha\n      canvasImageDataIndex += 4;\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex] = lut[(0, _getStoredValue2.default)(storedPixelDataIndex++, pixelData, shift)]; // Alpha\n      canvasImageDataIndex += 4;\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = (0, _now2.default)() - start;\n};\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _getStoredValue = __webpack_require__(19);\n\nvar _getStoredValue2 = _interopRequireDefault(_getStoredValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, lut, canvasImageDataData) {\n\n  var start = (0, _now2.default)();\n  var pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = (0, _now2.default)() - start;\n\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  var numPixels = pixelData.length;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n  start = (0, _now2.default)();\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Green\n      canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex] + -minPixelValue]; // Blue\n      storedPixelDataIndex += 2;\n      canvasImageDataIndex += 2;\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Green\n      canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex]]; // Blue\n      storedPixelDataIndex += 2;\n      canvasImageDataIndex += 2;\n    }\n  }\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = (0, _now2.default)() - start;\n};\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _index = __webpack_require__(7);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {LookupTable|Array} colorLut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nfunction storedPixelDataToCanvasImageDataColorLUT(image, colorLut, canvasImageDataData) {\n  var start = (0, _now2.default)();\n  var pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = (0, _now2.default)() - start;\n\n  var numPixels = pixelData.length;\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  var rgba = void 0;\n  var clut = void 0;\n\n  start = (0, _now2.default)();\n\n  if (colorLut instanceof _index2.default.LookupTable) {\n    clut = colorLut.Table;\n  } else {\n    clut = colorLut;\n  }\n\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      rgba = clut[pixelData[storedPixelDataIndex++] + -minPixelValue];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      rgba = clut[pixelData[storedPixelDataIndex++]];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = (0, _now2.default)() - start;\n}\n\nexports.default = storedPixelDataToCanvasImageDataColorLUT;\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _index = __webpack_require__(7);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} grayscaleLut Lookup table array\n * @param {LookupTable|Array} colorLut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nfunction storedPixelDataToCanvasImageDataPseudocolorLUT(image, grayscaleLut, colorLut, canvasImageDataData) {\n  var start = (0, _now2.default)();\n  var pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = (0, _now2.default)() - start;\n\n  var numPixels = pixelData.length;\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  var grayscale = void 0;\n  var rgba = void 0;\n  var clut = void 0;\n\n  start = (0, _now2.default)();\n\n  if (colorLut instanceof _index2.default.LookupTable) {\n    clut = colorLut.Table;\n  } else {\n    clut = colorLut;\n  }\n\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      grayscale = grayscaleLut[pixelData[storedPixelDataIndex++] + -minPixelValue];\n      rgba = clut[grayscale];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      grayscale = grayscaleLut[pixelData[storedPixelDataIndex++]];\n      rgba = clut[grayscale];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = (0, _now2.default)() - start;\n}\n\nexports.default = storedPixelDataToCanvasImageDataPseudocolorLUT;\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement, scale) {\n\n  var transform = new _transform.Transform();\n\n  //Move to center of canvas\n  transform.translate(enabledElement.canvas.width / 2, enabledElement.canvas.height / 2);\n\n  // Apply the rotation before scaling for non square pixels\n  var angle = enabledElement.viewport.rotation;\n\n  if (angle !== 0) {\n    transform.rotate(angle * Math.PI / 180);\n  }\n\n  // Apply the scale\n  var widthScale = enabledElement.viewport.scale;\n  var heightScale = enabledElement.viewport.scale;\n\n  if (enabledElement.viewport.displayedArea.rowPixelSpacing < enabledElement.viewport.displayedArea.columnPixelSpacing) {\n    widthScale *= enabledElement.viewport.displayedArea.columnPixelSpacing / enabledElement.viewport.displayedArea.rowPixelSpacing;\n  } else if (enabledElement.viewport.displayedArea.columnPixelSpacing < enabledElement.viewport.displayedArea.rowPixelSpacing) {\n    heightScale *= enabledElement.viewport.displayedArea.rowPixelSpacing / enabledElement.viewport.displayedArea.columnPixelSpacing;\n  }\n\n  transform.scale(widthScale, heightScale);\n\n  // Unrotate to so we can translate unrotated\n  if (angle !== 0) {\n    transform.rotate(-angle * Math.PI / 180);\n  }\n\n  // Apply the pan offset\n  transform.translate(enabledElement.viewport.translation.x, enabledElement.viewport.translation.y);\n\n  // Rotate again so we can apply general scale\n  if (angle !== 0) {\n    transform.rotate(angle * Math.PI / 180);\n  }\n\n  if (scale !== undefined) {\n    // Apply the font scale\n    transform.scale(scale, scale);\n  }\n\n  // Apply Flip if required\n  if (enabledElement.viewport.hflip) {\n    transform.scale(-1, 1);\n  }\n\n  if (enabledElement.viewport.vflip) {\n    transform.scale(1, -1);\n  }\n\n  //Move back from center of image\n  var width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  var height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n  transform.translate(-width / 2, -height / 2);\n\n  return transform;\n};\n\nvar _transform = __webpack_require__(34);\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.renderLabelMapImage = renderLabelMapImage;\nexports.addLabelMapLayer = addLabelMapLayer;\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nvar _setToPixelCoordinateSystem2 = _interopRequireDefault(_setToPixelCoordinateSystem);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _initializeRenderCanvas = __webpack_require__(10);\n\nvar _initializeRenderCanvas2 = _interopRequireDefault(_initializeRenderCanvas);\n\nvar _saveLastRendered = __webpack_require__(11);\n\nvar _saveLastRendered2 = _interopRequireDefault(_saveLastRendered);\n\nvar _doesImageNeedToBeRendered = __webpack_require__(12);\n\nvar _doesImageNeedToBeRendered2 = _interopRequireDefault(_doesImageNeedToBeRendered);\n\nvar _storedPixelDataToCanvasImageDataColorLUT = __webpack_require__(23);\n\nvar _storedPixelDataToCanvasImageDataColorLUT2 = _interopRequireDefault(_storedPixelDataToCanvasImageDataColorLUT);\n\nvar _index = __webpack_require__(7);\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRenderCanvas(enabledElement, image, invalidated) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  var renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // TODO: Deprecate enabledElement.options.colormap\n  var colormap = enabledElement.viewport.colormap || enabledElement.options.colormap;\n\n  if (colormap && typeof colormap === 'string') {\n    colormap = _index2.default.getColormap(colormap);\n  }\n\n  if (!colormap) {\n    throw new Error('renderLabelMapImage: colormap not found.');\n  }\n\n  var colormapId = colormap.getId();\n\n  if ((0, _doesImageNeedToBeRendered2.default)(enabledElement, image) === false && invalidated !== true && enabledElement.renderingTools.colormapId === colormapId) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    (0, _initializeRenderCanvas2.default)(enabledElement, image);\n  }\n\n  // Get the lut to use\n  var start = (0, _now2.default)();\n\n  if (!enabledElement.renderingTools.colorLut || invalidated || enabledElement.renderingTools.colormapId !== colormapId) {\n    enabledElement.renderingTools.colorLut = colormap.createLookupTable();\n    enabledElement.renderingTools.colormapId = colormapId;\n  }\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = (0, _now2.default)() - start;\n\n  var colorLut = enabledElement.renderingTools.colorLut;\n  var renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  (0, _storedPixelDataToCanvasImageDataColorLUT2.default)(image, colorLut, renderCanvasData.data);\n\n  start = (0, _now2.default)();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = (0, _now2.default)() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to draw a label map image to a given enabledElement\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nfunction renderLabelMapImage(enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('renderLabelMapImage: enabledElement parameter must not be undefined');\n  }\n\n  var image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('renderLabelMapImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  var context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  (0, _setToPixelCoordinateSystem2.default)(enabledElement, context);\n\n  // If no options are set we will retrieve the renderCanvas through the\n  // Normal Canvas rendering path\n  // TODO: Add WebGL support for label map pipeline\n  var renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n\n  var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  var width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  var height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = (0, _saveLastRendered2.default)(enabledElement);\n}\n\n/**\n * API function to draw a pseudo-color image to a given layer\n *\n * @param {EnabledElementLayer} layer The layer that the image will be added to\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nfunction addLabelMapLayer(layer, invalidated) {\n  if (layer === undefined) {\n    throw new Error('addLabelMapLayer: layer parameter must not be undefined');\n  }\n\n  var image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addLabelMapLayer: image must be loaded before it can be drawn');\n  }\n\n  layer.canvas = getRenderCanvas(layer, image, invalidated);\n\n  var context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = (0, _saveLastRendered2.default)(layer);\n}\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.renderPseudoColorImage = renderPseudoColorImage;\nexports.addPseudoColorLayer = addPseudoColorLayer;\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nvar _setToPixelCoordinateSystem2 = _interopRequireDefault(_setToPixelCoordinateSystem);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _initializeRenderCanvas = __webpack_require__(10);\n\nvar _initializeRenderCanvas2 = _interopRequireDefault(_initializeRenderCanvas);\n\nvar _getLut = __webpack_require__(35);\n\nvar _getLut2 = _interopRequireDefault(_getLut);\n\nvar _saveLastRendered = __webpack_require__(11);\n\nvar _saveLastRendered2 = _interopRequireDefault(_saveLastRendered);\n\nvar _doesImageNeedToBeRendered = __webpack_require__(12);\n\nvar _doesImageNeedToBeRendered2 = _interopRequireDefault(_doesImageNeedToBeRendered);\n\nvar _storedPixelDataToCanvasImageDataPseudocolorLUT = __webpack_require__(24);\n\nvar _storedPixelDataToCanvasImageDataPseudocolorLUT2 = _interopRequireDefault(_storedPixelDataToCanvasImageDataPseudocolorLUT);\n\nvar _index = __webpack_require__(7);\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRenderCanvas(enabledElement, image, invalidated) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  var renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // TODO: Deprecate enabledElement.options.colormap\n  var colormap = enabledElement.viewport.colormap || enabledElement.options.colormap;\n\n  if (colormap && typeof colormap === 'string') {\n    colormap = _index2.default.getColormap(colormap);\n  }\n\n  if (!colormap) {\n    throw new Error('renderPseudoColorImage: colormap not found.');\n  }\n\n  var colormapId = colormap.getId();\n\n  if ((0, _doesImageNeedToBeRendered2.default)(enabledElement, image) === false && invalidated !== true && enabledElement.renderingTools.colormapId === colormapId) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    (0, _initializeRenderCanvas2.default)(enabledElement, image);\n  }\n\n  // Get the lut to use\n  var start = (0, _now2.default)();\n\n  if (!enabledElement.renderingTools.colorLut || invalidated || enabledElement.renderingTools.colormapId !== colormapId) {\n    colormap.setNumberOfColors(256);\n    enabledElement.renderingTools.colorLut = colormap.createLookupTable();\n    enabledElement.renderingTools.colormapId = colormapId;\n  }\n\n  var lut = (0, _getLut2.default)(image, enabledElement.viewport, invalidated);\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = (0, _now2.default)() - start;\n\n  var colorLut = enabledElement.renderingTools.colorLut;\n  var renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  (0, _storedPixelDataToCanvasImageDataPseudocolorLUT2.default)(image, lut, colorLut, renderCanvasData.data);\n\n  start = (0, _now2.default)();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = (0, _now2.default)() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to draw a pseudo-color image to a given enabledElement\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nfunction renderPseudoColorImage(enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('drawImage: enabledElement parameter must not be undefined');\n  }\n\n  var image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('drawImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  var context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  (0, _setToPixelCoordinateSystem2.default)(enabledElement, context);\n\n  // If no options are set we will retrieve the renderCanvas through the\n  // Normal Canvas rendering path\n  // TODO: Add WebGL support for pseudocolor pipeline\n  var renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n\n  var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  var width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  var height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = (0, _saveLastRendered2.default)(enabledElement);\n}\n\n/**\n * API function to draw a pseudo-color image to a given layer\n *\n * @param {EnabledElementLayer} layer The layer that the image will be added to\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nfunction addPseudoColorLayer(layer, invalidated) {\n  if (layer === undefined) {\n    throw new Error('addPseudoColorLayer: layer parameter must not be undefined');\n  }\n\n  var image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addPseudoColorLayer: image must be loaded before it can be drawn');\n  }\n\n  layer.canvas = getRenderCanvas(layer, image, invalidated);\n\n  var context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = (0, _saveLastRendered2.default)(layer);\n}\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.rescaleImage = rescaleImage;\nexports.addLayer = addLayer;\nexports.removeLayer = removeLayer;\nexports.getLayer = getLayer;\nexports.getLayers = getLayers;\nexports.getVisibleLayers = getVisibleLayers;\nexports.setActiveLayer = setActiveLayer;\nexports.setLayerImage = setLayerImage;\nexports.getActiveLayer = getActiveLayer;\n\nvar _guid = __webpack_require__(60);\n\nvar _guid2 = _interopRequireDefault(_guid);\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getDefaultViewport = __webpack_require__(6);\n\nvar _getDefaultViewport2 = _interopRequireDefault(_getDefaultViewport);\n\nvar _updateImage = __webpack_require__(4);\n\nvar _updateImage2 = _interopRequireDefault(_updateImage);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Helper function to trigger an event on a Cornerstone element with\n * a specific layerId\n *\n * @param {String} eventName The event name (e.g. CornerstoneLayerAdded)\n * @param {EnabledElement} enabledElement The Cornerstone enabled element\n * @param {String} layerId The layer's unique identifier\n * @returns {void}\n */\nfunction triggerEvent(eventName, enabledElement, layerId) {\n  var element = enabledElement.element;\n  var eventData = {\n    viewport: enabledElement.viewport,\n    element: enabledElement.element,\n    image: enabledElement.image,\n    enabledElement: enabledElement,\n    layerId: layerId\n  };\n\n  (0, _triggerEvent2.default)(element, eventName, eventData);\n}\n\n/**\n * Rescale the target layer to the base layer based on the\n * relative size of each image and their pixel dimensions.\n *\n * This function will update the Viewport parameters of the\n * target layer to a new scale.\n *\n * @param {EnabledElementLayer} baseLayer The base layer\n * @param {EnabledElementLayer} targetLayer The target layer to rescale\n * @returns {void}\n */\nfunction rescaleImage(baseLayer, targetLayer) {\n  if (baseLayer.layerId === targetLayer.layerId) {\n    throw new Error('rescaleImage: both arguments represent the same layer');\n  }\n\n  var baseImage = baseLayer.image;\n  var targetImage = targetLayer.image;\n\n  // Return if these images don't have an imageId (e.g. for dynamic images)\n  if (!baseImage.imageId || !targetImage.imageId) {\n    return;\n  }\n\n  // Column pixel spacing need to be considered when calculating the\n  // ratio between the layer added and base layer images\n  var colRelative = targetLayer.viewport.displayedArea.columnPixelSpacing * targetImage.width / (baseLayer.viewport.displayedArea.columnPixelSpacing * baseImage.width);\n  var viewportRatio = targetLayer.viewport.scale / baseLayer.viewport.scale * colRelative;\n\n  targetLayer.viewport.scale = baseLayer.viewport.scale * viewportRatio;\n}\n\n/**\n * Add a layer to a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Image} image A Cornerstone Image object to add as a new layer\n * @param {Object} options Options for the layer\n *\n * @returns {String} layerId The new layer's unique identifier\n */\nfunction addLayer(element, image, options) {\n  var layerId = (0, _guid2.default)();\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var layers = enabledElement.layers;\n  var viewport = void 0;\n\n  if (image) {\n    viewport = (0, _getDefaultViewport2.default)(enabledElement.canvas, image);\n\n    // Override the defaults if any optional viewport settings\n    // have been specified\n    if (options && options.viewport) {\n      viewport = Object.assign(viewport, options.viewport);\n    }\n  }\n\n  // Set syncViewports to true by default when a new layer is added\n  if (enabledElement.syncViewports !== false) {\n    enabledElement.syncViewports = true;\n  }\n\n  var newLayer = {\n    image: image,\n    layerId: layerId,\n    viewport: viewport,\n    options: options || {},\n    renderingTools: {}\n  };\n\n  // Rescale the new layer based on the base layer to make sure\n  // they will have a proportional size (pixel spacing)\n  if (layers.length && image) {\n    rescaleImage(layers[0], newLayer);\n  }\n\n  layers.push(newLayer);\n\n  triggerEvent('cornerstonelayeradded', enabledElement, layerId);\n\n  // Set the layer as active if it's the first layer added\n  if (layers.length === 1 && image) {\n    setActiveLayer(element, layerId);\n  }\n\n  return layerId;\n}\n\n/**\n * Remove a layer from a Cornerstone element given a layer ID\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {String} layerId The unique identifier for the layer\n * @returns {void}\n */\nfunction removeLayer(element, layerId) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var layers = enabledElement.layers;\n  var index = enabledElement.layers.findIndex(function (layer) {\n    return layer.layerId === layerId;\n  });\n\n  if (index !== -1) {\n    layers.splice(index, 1);\n\n    // If the current layer is active, and we have other layers,\n    // switch to the first layer that remains in the array\n    if (layerId === enabledElement.activeLayerId && layers.length) {\n      setActiveLayer(element, layers[0].layerId);\n    }\n\n    triggerEvent('cornerstonelayerremoved', enabledElement, layerId);\n  }\n}\n\n/**\n * Retrieve a layer from a Cornerstone element given a layer ID\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {String} layerId The unique identifier for the layer\n * @return {EnabledElementLayer} The layer\n */\nfunction getLayer(element, layerId) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return enabledElement.layers.find(function (layer) {\n    return layer.layerId === layerId;\n  });\n}\n\n/**\n * Retrieve all layers for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n *\n * @return {EnabledElementLayer[]} An array of layers\n */\nfunction getLayers(element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return enabledElement.layers;\n}\n\n/**\n * Retrieve all visible layers for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n *\n * @return {EnabledElementLayer[]} An array of layers\n */\nfunction getVisibleLayers(element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return enabledElement.layers.filter(function (layer) {\n    return layer.options && layer.options.visible !== false && layer.options.opacity !== 0;\n  });\n}\n\n/**\n * Set the active layer for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {String} layerId The unique identifier for the layer\n * @returns {void}\n */\nfunction setActiveLayer(element, layerId) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  // Stop here if this layer is already active\n  if (enabledElement.activeLayerId === layerId) {\n    return;\n  }\n\n  var index = enabledElement.layers.findIndex(function (layer) {\n    return layer.layerId === layerId;\n  });\n\n  if (index === -1) {\n    throw new Error('setActiveLayer: layer not found in layers array');\n  }\n\n  var layer = enabledElement.layers[index];\n\n  if (!layer.image) {\n    throw new Error('setActiveLayer: layer with undefined image cannot be set as active.');\n  }\n\n  enabledElement.activeLayerId = layerId;\n  enabledElement.image = layer.image;\n  enabledElement.viewport = layer.viewport;\n\n  (0, _updateImage2.default)(element);\n  triggerEvent('cornerstoneactivelayerchanged', enabledElement, layerId);\n}\n\n/**\n * Set a new image for a specific layerId\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Image} image The image to be displayed in this layer\n * @param {String} [layerId] The unique identifier for the layer\n * @returns {void}\n */\nfunction setLayerImage(element, image, layerId) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var baseLayer = enabledElement.layers[0];\n\n  var layer = void 0;\n\n  if (layerId) {\n    layer = getLayer(element, layerId);\n  } else {\n    layer = getActiveLayer(element);\n  }\n\n  if (!layer) {\n    throw new Error('setLayerImage: Layer not found');\n  }\n\n  layer.image = image;\n\n  if (!image) {\n    layer.viewport = undefined;\n\n    return;\n  }\n\n  if (!layer.viewport) {\n    var defaultViewport = (0, _getDefaultViewport2.default)(enabledElement.canvas, image);\n\n    // Override the defaults if any optional viewport settings\n    // have been specified\n    if (layer.options && layer.options.viewport) {\n      layer.viewport = Object.assign(defaultViewport, layer.options.viewport);\n    }\n\n    if (baseLayer.layerId !== layerId) {\n      rescaleImage(baseLayer, layer);\n    }\n  }\n}\n\n/**\n * Retrieve the currently active layer for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @return {EnabledElementLayer} The currently active layer\n */\nfunction getActiveLayer(element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return enabledElement.layers.find(function (layer) {\n    return layer.layerId === enabledElement.activeLayerId;\n  });\n}\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, viewport) {\n  if (image.minPixelValue === undefined || image.maxPixelValue === undefined) {\n    var shouldShift = image.pixelRepresentation !== undefined && image.pixelRepresentation === 1;\n    var shift = shouldShift && image.bitsStored !== undefined ? 32 - image.bitsStored : undefined;\n    var minMax = void 0;\n\n    if (shouldShift && shift !== undefined) {\n      var pixelData = image.getPixelData();\n      minMax = (0, _getMinMax2.default)(pixelData.map(function (sv, i) {\n        return (0, _getStoredValue2.default)(i, pixelData, shift);\n      }));\n    } else {\n      minMax = (0, _getMinMax2.default)(image.getPixelData());\n    }\n\n    image.minPixelValue = minMax.min;\n    image.maxPixelValue = minMax.max;\n  }\n\n  //Setup min max of the VOI since these output values can change what WebGL shader is required\n  if (hasVoiLUT(viewport)) {\n    var _minMax = (0, _getMinMax2.default)(viewport.voiLUT.lut);\n    viewport.voi.minMax = _minMax;\n    viewport.voiLUT.minMax = _minMax;\n  } else if (hasModalityLUT(viewport)) {\n    var _minMax2 = (0, _getMinMax2.default)(viewport.modalityLUT.lut);\n    viewport.modalityLUT.minMax = _minMax2;\n    viewport.voi.minMax = _minMax2;\n  }\n\n  if (viewport.voi.windowWidth === undefined || viewport.voi.windowCenter === undefined) {\n    var min = image.minPixelValue;\n    var max = image.maxPixelValue;\n\n    if (viewport.voiLUT) {\n      min = viewport.voiLUT.minMax.min;\n      max = viewport.voiLUT.minMax.max;\n    } else if (viewport.modalityLUT) {\n      min = viewport.modalityLUT.minMax.min;\n      max = viewport.modalityLUT.minMax.max;\n    }\n\n    viewport.voi.windowCenter = (min + max + 1) / 2 * image.slope + image.intercept;\n    viewport.voi.windowWidth = Math.abs((min + 1 - max) * image.slope);\n  }\n};\n\nvar _getMinMax = __webpack_require__(30);\n\nvar _getMinMax2 = _interopRequireDefault(_getMinMax);\n\nvar _getStoredValue = __webpack_require__(19);\n\nvar _getStoredValue2 = _interopRequireDefault(_getStoredValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction hasModalityLUT(viewport) {\n  return viewport.modalityLUT && viewport.modalityLUT.lut && viewport.modalityLUT.lut.length > 0;\n}\n\nfunction hasVoiLUT(viewport) {\n  return viewport.voiLUT && viewport.voiLUT.lut && viewport.voiLUT.lut.length > 0;\n}\n\n/**\n * Calculate the min & max pixel values for an image and setup windows\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Viewport} image A Cornerstone Viewport Object\n */\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (pixelData) {\n  var min = pixelData[0];\n  var max = pixelData[0];\n  var pixel = void 0;\n  var numPixels = pixelData.length;\n\n  for (var index = 0; index < numPixels; index++) {\n    pixel = pixelData[index];\n    min = Math.min(min, pixel);\n    max = Math.max(max, pixel);\n  }\n\n  return {\n    min: min,\n    max: max\n  };\n};\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getColormapsList = getColormapsList;\nexports.getColormap = getColormap;\n\nvar _lookupTable = __webpack_require__(32);\n\nvar _lookupTable2 = _interopRequireDefault(_lookupTable);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar COLOR_TRANSPARENT = [0, 0, 0, 0];\n\n// Colormaps\n//\n// Hot Iron, PET, Hot Metal Blue and PET 20 Step are color palattes\n// Defined by the DICOM standard\n// http://dicom.nema.org/dicom/2013/output/chtml/part06/chapter_B.html\n//\n// All Linear Segmented Colormaps were copied from matplotlib\n// https://github.com/stefanv/matplotlib/blob/master/lib/matplotlib/_cm.py\n\nvar colormapsData = {\n  hotIron: {\n    name: 'Hot Iron',\n    numOfColors: 256,\n    colors: [[0, 0, 0, 255], [2, 0, 0, 255], [4, 0, 0, 255], [6, 0, 0, 255], [8, 0, 0, 255], [10, 0, 0, 255], [12, 0, 0, 255], [14, 0, 0, 255], [16, 0, 0, 255], [18, 0, 0, 255], [20, 0, 0, 255], [22, 0, 0, 255], [24, 0, 0, 255], [26, 0, 0, 255], [28, 0, 0, 255], [30, 0, 0, 255], [32, 0, 0, 255], [34, 0, 0, 255], [36, 0, 0, 255], [38, 0, 0, 255], [40, 0, 0, 255], [42, 0, 0, 255], [44, 0, 0, 255], [46, 0, 0, 255], [48, 0, 0, 255], [50, 0, 0, 255], [52, 0, 0, 255], [54, 0, 0, 255], [56, 0, 0, 255], [58, 0, 0, 255], [60, 0, 0, 255], [62, 0, 0, 255], [64, 0, 0, 255], [66, 0, 0, 255], [68, 0, 0, 255], [70, 0, 0, 255], [72, 0, 0, 255], [74, 0, 0, 255], [76, 0, 0, 255], [78, 0, 0, 255], [80, 0, 0, 255], [82, 0, 0, 255], [84, 0, 0, 255], [86, 0, 0, 255], [88, 0, 0, 255], [90, 0, 0, 255], [92, 0, 0, 255], [94, 0, 0, 255], [96, 0, 0, 255], [98, 0, 0, 255], [100, 0, 0, 255], [102, 0, 0, 255], [104, 0, 0, 255], [106, 0, 0, 255], [108, 0, 0, 255], [110, 0, 0, 255], [112, 0, 0, 255], [114, 0, 0, 255], [116, 0, 0, 255], [118, 0, 0, 255], [120, 0, 0, 255], [122, 0, 0, 255], [124, 0, 0, 255], [126, 0, 0, 255], [128, 0, 0, 255], [130, 0, 0, 255], [132, 0, 0, 255], [134, 0, 0, 255], [136, 0, 0, 255], [138, 0, 0, 255], [140, 0, 0, 255], [142, 0, 0, 255], [144, 0, 0, 255], [146, 0, 0, 255], [148, 0, 0, 255], [150, 0, 0, 255], [152, 0, 0, 255], [154, 0, 0, 255], [156, 0, 0, 255], [158, 0, 0, 255], [160, 0, 0, 255], [162, 0, 0, 255], [164, 0, 0, 255], [166, 0, 0, 255], [168, 0, 0, 255], [170, 0, 0, 255], [172, 0, 0, 255], [174, 0, 0, 255], [176, 0, 0, 255], [178, 0, 0, 255], [180, 0, 0, 255], [182, 0, 0, 255], [184, 0, 0, 255], [186, 0, 0, 255], [188, 0, 0, 255], [190, 0, 0, 255], [192, 0, 0, 255], [194, 0, 0, 255], [196, 0, 0, 255], [198, 0, 0, 255], [200, 0, 0, 255], [202, 0, 0, 255], [204, 0, 0, 255], [206, 0, 0, 255], [208, 0, 0, 255], [210, 0, 0, 255], [212, 0, 0, 255], [214, 0, 0, 255], [216, 0, 0, 255], [218, 0, 0, 255], [220, 0, 0, 255], [222, 0, 0, 255], [224, 0, 0, 255], [226, 0, 0, 255], [228, 0, 0, 255], [230, 0, 0, 255], [232, 0, 0, 255], [234, 0, 0, 255], [236, 0, 0, 255], [238, 0, 0, 255], [240, 0, 0, 255], [242, 0, 0, 255], [244, 0, 0, 255], [246, 0, 0, 255], [248, 0, 0, 255], [250, 0, 0, 255], [252, 0, 0, 255], [254, 0, 0, 255], [255, 0, 0, 255], [255, 2, 0, 255], [255, 4, 0, 255], [255, 6, 0, 255], [255, 8, 0, 255], [255, 10, 0, 255], [255, 12, 0, 255], [255, 14, 0, 255], [255, 16, 0, 255], [255, 18, 0, 255], [255, 20, 0, 255], [255, 22, 0, 255], [255, 24, 0, 255], [255, 26, 0, 255], [255, 28, 0, 255], [255, 30, 0, 255], [255, 32, 0, 255], [255, 34, 0, 255], [255, 36, 0, 255], [255, 38, 0, 255], [255, 40, 0, 255], [255, 42, 0, 255], [255, 44, 0, 255], [255, 46, 0, 255], [255, 48, 0, 255], [255, 50, 0, 255], [255, 52, 0, 255], [255, 54, 0, 255], [255, 56, 0, 255], [255, 58, 0, 255], [255, 60, 0, 255], [255, 62, 0, 255], [255, 64, 0, 255], [255, 66, 0, 255], [255, 68, 0, 255], [255, 70, 0, 255], [255, 72, 0, 255], [255, 74, 0, 255], [255, 76, 0, 255], [255, 78, 0, 255], [255, 80, 0, 255], [255, 82, 0, 255], [255, 84, 0, 255], [255, 86, 0, 255], [255, 88, 0, 255], [255, 90, 0, 255], [255, 92, 0, 255], [255, 94, 0, 255], [255, 96, 0, 255], [255, 98, 0, 255], [255, 100, 0, 255], [255, 102, 0, 255], [255, 104, 0, 255], [255, 106, 0, 255], [255, 108, 0, 255], [255, 110, 0, 255], [255, 112, 0, 255], [255, 114, 0, 255], [255, 116, 0, 255], [255, 118, 0, 255], [255, 120, 0, 255], [255, 122, 0, 255], [255, 124, 0, 255], [255, 126, 0, 255], [255, 128, 4, 255], [255, 130, 8, 255], [255, 132, 12, 255], [255, 134, 16, 255], [255, 136, 20, 255], [255, 138, 24, 255], [255, 140, 28, 255], [255, 142, 32, 255], [255, 144, 36, 255], [255, 146, 40, 255], [255, 148, 44, 255], [255, 150, 48, 255], [255, 152, 52, 255], [255, 154, 56, 255], [255, 156, 60, 255], [255, 158, 64, 255], [255, 160, 68, 255], [255, 162, 72, 255], [255, 164, 76, 255], [255, 166, 80, 255], [255, 168, 84, 255], [255, 170, 88, 255], [255, 172, 92, 255], [255, 174, 96, 255], [255, 176, 100, 255], [255, 178, 104, 255], [255, 180, 108, 255], [255, 182, 112, 255], [255, 184, 116, 255], [255, 186, 120, 255], [255, 188, 124, 255], [255, 190, 128, 255], [255, 192, 132, 255], [255, 194, 136, 255], [255, 196, 140, 255], [255, 198, 144, 255], [255, 200, 148, 255], [255, 202, 152, 255], [255, 204, 156, 255], [255, 206, 160, 255], [255, 208, 164, 255], [255, 210, 168, 255], [255, 212, 172, 255], [255, 214, 176, 255], [255, 216, 180, 255], [255, 218, 184, 255], [255, 220, 188, 255], [255, 222, 192, 255], [255, 224, 196, 255], [255, 226, 200, 255], [255, 228, 204, 255], [255, 230, 208, 255], [255, 232, 212, 255], [255, 234, 216, 255], [255, 236, 220, 255], [255, 238, 224, 255], [255, 240, 228, 255], [255, 242, 232, 255], [255, 244, 236, 255], [255, 246, 240, 255], [255, 248, 244, 255], [255, 250, 248, 255], [255, 252, 252, 255], [255, 255, 255, 255]]\n  },\n  pet: {\n    name: 'PET',\n    numColors: 256,\n    colors: [[0, 0, 0, 255], [0, 2, 1, 255], [0, 4, 3, 255], [0, 6, 5, 255], [0, 8, 7, 255], [0, 10, 9, 255], [0, 12, 11, 255], [0, 14, 13, 255], [0, 16, 15, 255], [0, 18, 17, 255], [0, 20, 19, 255], [0, 22, 21, 255], [0, 24, 23, 255], [0, 26, 25, 255], [0, 28, 27, 255], [0, 30, 29, 255], [0, 32, 31, 255], [0, 34, 33, 255], [0, 36, 35, 255], [0, 38, 37, 255], [0, 40, 39, 255], [0, 42, 41, 255], [0, 44, 43, 255], [0, 46, 45, 255], [0, 48, 47, 255], [0, 50, 49, 255], [0, 52, 51, 255], [0, 54, 53, 255], [0, 56, 55, 255], [0, 58, 57, 255], [0, 60, 59, 255], [0, 62, 61, 255], [0, 65, 63, 255], [0, 67, 65, 255], [0, 69, 67, 255], [0, 71, 69, 255], [0, 73, 71, 255], [0, 75, 73, 255], [0, 77, 75, 255], [0, 79, 77, 255], [0, 81, 79, 255], [0, 83, 81, 255], [0, 85, 83, 255], [0, 87, 85, 255], [0, 89, 87, 255], [0, 91, 89, 255], [0, 93, 91, 255], [0, 95, 93, 255], [0, 97, 95, 255], [0, 99, 97, 255], [0, 101, 99, 255], [0, 103, 101, 255], [0, 105, 103, 255], [0, 107, 105, 255], [0, 109, 107, 255], [0, 111, 109, 255], [0, 113, 111, 255], [0, 115, 113, 255], [0, 117, 115, 255], [0, 119, 117, 255], [0, 121, 119, 255], [0, 123, 121, 255], [0, 125, 123, 255], [0, 128, 125, 255], [1, 126, 127, 255], [3, 124, 129, 255], [5, 122, 131, 255], [7, 120, 133, 255], [9, 118, 135, 255], [11, 116, 137, 255], [13, 114, 139, 255], [15, 112, 141, 255], [17, 110, 143, 255], [19, 108, 145, 255], [21, 106, 147, 255], [23, 104, 149, 255], [25, 102, 151, 255], [27, 100, 153, 255], [29, 98, 155, 255], [31, 96, 157, 255], [33, 94, 159, 255], [35, 92, 161, 255], [37, 90, 163, 255], [39, 88, 165, 255], [41, 86, 167, 255], [43, 84, 169, 255], [45, 82, 171, 255], [47, 80, 173, 255], [49, 78, 175, 255], [51, 76, 177, 255], [53, 74, 179, 255], [55, 72, 181, 255], [57, 70, 183, 255], [59, 68, 185, 255], [61, 66, 187, 255], [63, 64, 189, 255], [65, 63, 191, 255], [67, 61, 193, 255], [69, 59, 195, 255], [71, 57, 197, 255], [73, 55, 199, 255], [75, 53, 201, 255], [77, 51, 203, 255], [79, 49, 205, 255], [81, 47, 207, 255], [83, 45, 209, 255], [85, 43, 211, 255], [86, 41, 213, 255], [88, 39, 215, 255], [90, 37, 217, 255], [92, 35, 219, 255], [94, 33, 221, 255], [96, 31, 223, 255], [98, 29, 225, 255], [100, 27, 227, 255], [102, 25, 229, 255], [104, 23, 231, 255], [106, 21, 233, 255], [108, 19, 235, 255], [110, 17, 237, 255], [112, 15, 239, 255], [114, 13, 241, 255], [116, 11, 243, 255], [118, 9, 245, 255], [120, 7, 247, 255], [122, 5, 249, 255], [124, 3, 251, 255], [126, 1, 253, 255], [128, 0, 255, 255], [130, 2, 252, 255], [132, 4, 248, 255], [134, 6, 244, 255], [136, 8, 240, 255], [138, 10, 236, 255], [140, 12, 232, 255], [142, 14, 228, 255], [144, 16, 224, 255], [146, 18, 220, 255], [148, 20, 216, 255], [150, 22, 212, 255], [152, 24, 208, 255], [154, 26, 204, 255], [156, 28, 200, 255], [158, 30, 196, 255], [160, 32, 192, 255], [162, 34, 188, 255], [164, 36, 184, 255], [166, 38, 180, 255], [168, 40, 176, 255], [170, 42, 172, 255], [171, 44, 168, 255], [173, 46, 164, 255], [175, 48, 160, 255], [177, 50, 156, 255], [179, 52, 152, 255], [181, 54, 148, 255], [183, 56, 144, 255], [185, 58, 140, 255], [187, 60, 136, 255], [189, 62, 132, 255], [191, 64, 128, 255], [193, 66, 124, 255], [195, 68, 120, 255], [197, 70, 116, 255], [199, 72, 112, 255], [201, 74, 108, 255], [203, 76, 104, 255], [205, 78, 100, 255], [207, 80, 96, 255], [209, 82, 92, 255], [211, 84, 88, 255], [213, 86, 84, 255], [215, 88, 80, 255], [217, 90, 76, 255], [219, 92, 72, 255], [221, 94, 68, 255], [223, 96, 64, 255], [225, 98, 60, 255], [227, 100, 56, 255], [229, 102, 52, 255], [231, 104, 48, 255], [233, 106, 44, 255], [235, 108, 40, 255], [237, 110, 36, 255], [239, 112, 32, 255], [241, 114, 28, 255], [243, 116, 24, 255], [245, 118, 20, 255], [247, 120, 16, 255], [249, 122, 12, 255], [251, 124, 8, 255], [253, 126, 4, 255], [255, 128, 0, 255], [255, 130, 4, 255], [255, 132, 8, 255], [255, 134, 12, 255], [255, 136, 16, 255], [255, 138, 20, 255], [255, 140, 24, 255], [255, 142, 28, 255], [255, 144, 32, 255], [255, 146, 36, 255], [255, 148, 40, 255], [255, 150, 44, 255], [255, 152, 48, 255], [255, 154, 52, 255], [255, 156, 56, 255], [255, 158, 60, 255], [255, 160, 64, 255], [255, 162, 68, 255], [255, 164, 72, 255], [255, 166, 76, 255], [255, 168, 80, 255], [255, 170, 85, 255], [255, 172, 89, 255], [255, 174, 93, 255], [255, 176, 97, 255], [255, 178, 101, 255], [255, 180, 105, 255], [255, 182, 109, 255], [255, 184, 113, 255], [255, 186, 117, 255], [255, 188, 121, 255], [255, 190, 125, 255], [255, 192, 129, 255], [255, 194, 133, 255], [255, 196, 137, 255], [255, 198, 141, 255], [255, 200, 145, 255], [255, 202, 149, 255], [255, 204, 153, 255], [255, 206, 157, 255], [255, 208, 161, 255], [255, 210, 165, 255], [255, 212, 170, 255], [255, 214, 174, 255], [255, 216, 178, 255], [255, 218, 182, 255], [255, 220, 186, 255], [255, 222, 190, 255], [255, 224, 194, 255], [255, 226, 198, 255], [255, 228, 202, 255], [255, 230, 206, 255], [255, 232, 210, 255], [255, 234, 214, 255], [255, 236, 218, 255], [255, 238, 222, 255], [255, 240, 226, 255], [255, 242, 230, 255], [255, 244, 234, 255], [255, 246, 238, 255], [255, 248, 242, 255], [255, 250, 246, 255], [255, 252, 250, 255], [255, 255, 255, 255]]\n  },\n  hotMetalBlue: {\n    name: 'Hot Metal Blue',\n    numColors: 256,\n    colors: [[0, 0, 0, 255], [0, 0, 2, 255], [0, 0, 4, 255], [0, 0, 6, 255], [0, 0, 8, 255], [0, 0, 10, 255], [0, 0, 12, 255], [0, 0, 14, 255], [0, 0, 16, 255], [0, 0, 17, 255], [0, 0, 19, 255], [0, 0, 21, 255], [0, 0, 23, 255], [0, 0, 25, 255], [0, 0, 27, 255], [0, 0, 29, 255], [0, 0, 31, 255], [0, 0, 33, 255], [0, 0, 35, 255], [0, 0, 37, 255], [0, 0, 39, 255], [0, 0, 41, 255], [0, 0, 43, 255], [0, 0, 45, 255], [0, 0, 47, 255], [0, 0, 49, 255], [0, 0, 51, 255], [0, 0, 53, 255], [0, 0, 55, 255], [0, 0, 57, 255], [0, 0, 59, 255], [0, 0, 61, 255], [0, 0, 63, 255], [0, 0, 65, 255], [0, 0, 67, 255], [0, 0, 69, 255], [0, 0, 71, 255], [0, 0, 73, 255], [0, 0, 75, 255], [0, 0, 77, 255], [0, 0, 79, 255], [0, 0, 81, 255], [0, 0, 83, 255], [0, 0, 84, 255], [0, 0, 86, 255], [0, 0, 88, 255], [0, 0, 90, 255], [0, 0, 92, 255], [0, 0, 94, 255], [0, 0, 96, 255], [0, 0, 98, 255], [0, 0, 100, 255], [0, 0, 102, 255], [0, 0, 104, 255], [0, 0, 106, 255], [0, 0, 108, 255], [0, 0, 110, 255], [0, 0, 112, 255], [0, 0, 114, 255], [0, 0, 116, 255], [0, 0, 117, 255], [0, 0, 119, 255], [0, 0, 121, 255], [0, 0, 123, 255], [0, 0, 125, 255], [0, 0, 127, 255], [0, 0, 129, 255], [0, 0, 131, 255], [0, 0, 133, 255], [0, 0, 135, 255], [0, 0, 137, 255], [0, 0, 139, 255], [0, 0, 141, 255], [0, 0, 143, 255], [0, 0, 145, 255], [0, 0, 147, 255], [0, 0, 149, 255], [0, 0, 151, 255], [0, 0, 153, 255], [0, 0, 155, 255], [0, 0, 157, 255], [0, 0, 159, 255], [0, 0, 161, 255], [0, 0, 163, 255], [0, 0, 165, 255], [0, 0, 167, 255], [3, 0, 169, 255], [6, 0, 171, 255], [9, 0, 173, 255], [12, 0, 175, 255], [15, 0, 177, 255], [18, 0, 179, 255], [21, 0, 181, 255], [24, 0, 183, 255], [26, 0, 184, 255], [29, 0, 186, 255], [32, 0, 188, 255], [35, 0, 190, 255], [38, 0, 192, 255], [41, 0, 194, 255], [44, 0, 196, 255], [47, 0, 198, 255], [50, 0, 200, 255], [52, 0, 197, 255], [55, 0, 194, 255], [57, 0, 191, 255], [59, 0, 188, 255], [62, 0, 185, 255], [64, 0, 182, 255], [66, 0, 179, 255], [69, 0, 176, 255], [71, 0, 174, 255], [74, 0, 171, 255], [76, 0, 168, 255], [78, 0, 165, 255], [81, 0, 162, 255], [83, 0, 159, 255], [85, 0, 156, 255], [88, 0, 153, 255], [90, 0, 150, 255], [93, 2, 144, 255], [96, 4, 138, 255], [99, 6, 132, 255], [102, 8, 126, 255], [105, 9, 121, 255], [108, 11, 115, 255], [111, 13, 109, 255], [114, 15, 103, 255], [116, 17, 97, 255], [119, 19, 91, 255], [122, 21, 85, 255], [125, 23, 79, 255], [128, 24, 74, 255], [131, 26, 68, 255], [134, 28, 62, 255], [137, 30, 56, 255], [140, 32, 50, 255], [143, 34, 47, 255], [146, 36, 44, 255], [149, 38, 41, 255], [152, 40, 38, 255], [155, 41, 35, 255], [158, 43, 32, 255], [161, 45, 29, 255], [164, 47, 26, 255], [166, 49, 24, 255], [169, 51, 21, 255], [172, 53, 18, 255], [175, 55, 15, 255], [178, 56, 12, 255], [181, 58, 9, 255], [184, 60, 6, 255], [187, 62, 3, 255], [190, 64, 0, 255], [194, 66, 0, 255], [198, 68, 0, 255], [201, 70, 0, 255], [205, 72, 0, 255], [209, 73, 0, 255], [213, 75, 0, 255], [217, 77, 0, 255], [221, 79, 0, 255], [224, 81, 0, 255], [228, 83, 0, 255], [232, 85, 0, 255], [236, 87, 0, 255], [240, 88, 0, 255], [244, 90, 0, 255], [247, 92, 0, 255], [251, 94, 0, 255], [255, 96, 0, 255], [255, 98, 3, 255], [255, 100, 6, 255], [255, 102, 9, 255], [255, 104, 12, 255], [255, 105, 15, 255], [255, 107, 18, 255], [255, 109, 21, 255], [255, 111, 24, 255], [255, 113, 26, 255], [255, 115, 29, 255], [255, 117, 32, 255], [255, 119, 35, 255], [255, 120, 38, 255], [255, 122, 41, 255], [255, 124, 44, 255], [255, 126, 47, 255], [255, 128, 50, 255], [255, 130, 53, 255], [255, 132, 56, 255], [255, 134, 59, 255], [255, 136, 62, 255], [255, 137, 65, 255], [255, 139, 68, 255], [255, 141, 71, 255], [255, 143, 74, 255], [255, 145, 76, 255], [255, 147, 79, 255], [255, 149, 82, 255], [255, 151, 85, 255], [255, 152, 88, 255], [255, 154, 91, 255], [255, 156, 94, 255], [255, 158, 97, 255], [255, 160, 100, 255], [255, 162, 103, 255], [255, 164, 106, 255], [255, 166, 109, 255], [255, 168, 112, 255], [255, 169, 115, 255], [255, 171, 118, 255], [255, 173, 121, 255], [255, 175, 124, 255], [255, 177, 126, 255], [255, 179, 129, 255], [255, 181, 132, 255], [255, 183, 135, 255], [255, 184, 138, 255], [255, 186, 141, 255], [255, 188, 144, 255], [255, 190, 147, 255], [255, 192, 150, 255], [255, 194, 153, 255], [255, 196, 156, 255], [255, 198, 159, 255], [255, 200, 162, 255], [255, 201, 165, 255], [255, 203, 168, 255], [255, 205, 171, 255], [255, 207, 174, 255], [255, 209, 176, 255], [255, 211, 179, 255], [255, 213, 182, 255], [255, 215, 185, 255], [255, 216, 188, 255], [255, 218, 191, 255], [255, 220, 194, 255], [255, 222, 197, 255], [255, 224, 200, 255], [255, 226, 203, 255], [255, 228, 206, 255], [255, 229, 210, 255], [255, 231, 213, 255], [255, 233, 216, 255], [255, 235, 219, 255], [255, 237, 223, 255], [255, 239, 226, 255], [255, 240, 229, 255], [255, 242, 232, 255], [255, 244, 236, 255], [255, 246, 239, 255], [255, 248, 242, 255], [255, 250, 245, 255], [255, 251, 249, 255], [255, 253, 252, 255], [255, 255, 255, 255]]\n  },\n  pet20Step: {\n    name: 'PET 20 Step',\n    numColors: 256,\n    colors: [[0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255]]\n  },\n  gray: {\n    name: 'Gray',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 0, 0], [1, 1, 1]]\n    }\n  },\n  jet: {\n    name: 'Jet',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.35, 0, 0], [0.66, 1, 1], [0.89, 1, 1], [1, 0.5, 0.5]],\n      green: [[0, 0, 0], [0.125, 0, 0], [0.375, 1, 1], [0.64, 1, 1], [0.91, 0, 0], [1, 0, 0]],\n      blue: [[0, 0.5, 0.5], [0.11, 1, 1], [0.34, 1, 1], [0.65, 0, 0], [1, 0, 0]]\n    }\n  },\n  hsv: {\n    name: 'HSV',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 1, 1], [0.158730, 1, 1], [0.174603, 0.968750, 0.968750], [0.333333, 0.031250, 0.031250], [0.349206, 0, 0], [0.666667, 0, 0], [0.682540, 0.031250, 0.031250], [0.841270, 0.968750, 0.968750], [0.857143, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [0.158730, 0.937500, 0.937500], [0.174603, 1, 1], [0.507937, 1, 1], [0.666667, 0.062500, 0.062500], [0.682540, 0, 0], [1, 0, 0]],\n      blue: [[0, 0, 0], [0.333333, 0, 0], [0.349206, 0.062500, 0.062500], [0.507937, 1, 1], [0.841270, 1, 1], [0.857143, 0.937500, 0.937500], [1, 0.09375, 0.09375]]\n    }\n  },\n  hot: {\n    name: 'Hot',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0.0416, 0.0416], [0.365079, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [0.365079, 0, 0], [0.746032, 1, 1], [1, 1, 1]],\n      blue: [[0, 0, 0], [0.746032, 0, 0], [1, 1, 1]]\n    }\n  },\n  cool: {\n    name: 'Cool',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 1, 1]],\n      green: [[0, 1, 1], [1, 0, 0]],\n      blue: [[0, 1, 1], [1, 1, 1]]\n    }\n  },\n  spring: {\n    name: 'Spring',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 1, 1], [1, 0, 0]]\n    }\n  },\n  summer: {\n    name: 'Summer',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 1, 1]],\n      green: [[0, 0.5, 0.5], [1, 1, 1]],\n      blue: [[0, 0.4, 0.4], [1, 0.4, 0.4]]\n    }\n  },\n  autumn: {\n    name: 'Autumn',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 0, 0], [1, 0, 0]]\n    }\n  },\n  winter: {\n    name: 'Winter',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 0, 0]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 1, 1], [1, 0.5, 0.5]]\n    }\n  },\n  bone: {\n    name: 'Bone',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.746032, 0.652778, 0.652778], [1, 1, 1]],\n      green: [[0, 0, 0], [0.365079, 0.319444, 0.319444], [0.746032, 0.777778, 0.777778], [1, 1, 1]],\n      blue: [[0, 0, 0], [0.365079, 0.444444, 0.444444], [1, 1, 1]]\n    }\n  },\n  copper: {\n    name: 'Copper',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.809524, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 0.7812, 0.7812]],\n      blue: [[0, 0, 0], [1, 0.4975, 0.4975]]\n    }\n  },\n  spectral: {\n    name: 'Spectral',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.05, 0.4667, 0.4667], [0.10, 0.5333, 0.5333], [0.15, 0, 0], [0.20, 0, 0], [0.25, 0, 0], [0.30, 0, 0], [0.35, 0, 0], [0.40, 0, 0], [0.45, 0, 0], [0.50, 0, 0], [0.55, 0, 0], [0.60, 0, 0], [0.65, 0.7333, 0.7333], [0.70, 0.9333, 0.9333], [0.75, 1, 1], [0.80, 1, 1], [0.85, 1, 1], [0.90, 0.8667, 0.8667], [0.95, 0.80, 0.80], [1, 0.80, 0.80]],\n      green: [[0, 0, 0], [0.05, 0, 0], [0.10, 0, 0], [0.15, 0, 0], [0.20, 0, 0], [0.25, 0.4667, 0.4667], [0.30, 0.6000, 0.6000], [0.35, 0.6667, 0.6667], [0.40, 0.6667, 0.6667], [0.45, 0.6000, 0.6000], [0.50, 0.7333, 0.7333], [0.55, 0.8667, 0.8667], [0.60, 1, 1], [0.65, 1, 1], [0.70, 0.9333, 0.9333], [0.75, 0.8000, 0.8000], [0.80, 0.6000, 0.6000], [0.85, 0, 0], [0.90, 0, 0], [0.95, 0, 0], [1, 0.80, 0.80]],\n      blue: [[0, 0, 0], [0.05, 0.5333, 0.5333], [0.10, 0.6000, 0.6000], [0.15, 0.6667, 0.6667], [0.20, 0.8667, 0.8667], [0.25, 0.8667, 0.8667], [0.30, 0.8667, 0.8667], [0.35, 0.6667, 0.6667], [0.40, 0.5333, 0.5333], [0.45, 0, 0], [0.5, 0, 0], [0.55, 0, 0], [0.60, 0, 0], [0.65, 0, 0], [0.70, 0, 0], [0.75, 0, 0], [0.80, 0, 0], [0.85, 0, 0], [0.90, 0, 0], [0.95, 0, 0], [1, 0.80, 0.80]]\n    }\n  },\n  coolwarm: {\n    name: 'CoolWarm',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0.2298057, 0.2298057], [0.03125, 0.26623388, 0.26623388], [0.0625, 0.30386891, 0.30386891], [0.09375, 0.342804478, 0.342804478], [0.125, 0.38301334, 0.38301334], [0.15625, 0.424369608, 0.424369608], [0.1875, 0.46666708, 0.46666708], [0.21875, 0.509635204, 0.509635204], [0.25, 0.552953156, 0.552953156], [0.28125, 0.596262162, 0.596262162], [0.3125, 0.639176211, 0.639176211], [0.34375, 0.681291281, 0.681291281], [0.375, 0.722193294, 0.722193294], [0.40625, 0.761464949, 0.761464949], [0.4375, 0.798691636, 0.798691636], [0.46875, 0.833466556, 0.833466556], [0.5, 0.865395197, 0.865395197], [0.53125, 0.897787179, 0.897787179], [0.5625, 0.924127593, 0.924127593], [0.59375, 0.944468518, 0.944468518], [0.625, 0.958852946, 0.958852946], [0.65625, 0.96732803, 0.96732803], [0.6875, 0.969954137, 0.969954137], [0.71875, 0.966811177, 0.966811177], [0.75, 0.958003065, 0.958003065], [0.78125, 0.943660866, 0.943660866], [0.8125, 0.923944917, 0.923944917], [0.84375, 0.89904617, 0.89904617], [0.875, 0.869186849, 0.869186849], [0.90625, 0.834620542, 0.834620542], [0.9375, 0.795631745, 0.795631745], [0.96875, 0.752534934, 0.752534934], [1, 0.705673158, 0.705673158]],\n      green: [[0, 0.298717966, 0.298717966], [0.03125, 0.353094838, 0.353094838], [0.0625, 0.406535296, 0.406535296], [0.09375, 0.458757618, 0.458757618], [0.125, 0.50941904, 0.50941904], [0.15625, 0.558148092, 0.558148092], [0.1875, 0.604562568, 0.604562568], [0.21875, 0.648280772, 0.648280772], [0.25, 0.688929332, 0.688929332], [0.28125, 0.726149107, 0.726149107], [0.3125, 0.759599947, 0.759599947], [0.34375, 0.788964712, 0.788964712], [0.375, 0.813952739, 0.813952739], [0.40625, 0.834302879, 0.834302879], [0.4375, 0.849786142, 0.849786142], [0.46875, 0.860207984, 0.860207984], [0.5, 0.86541021, 0.86541021], [0.53125, 0.848937047, 0.848937047], [0.5625, 0.827384882, 0.827384882], [0.59375, 0.800927443, 0.800927443], [0.625, 0.769767752, 0.769767752], [0.65625, 0.734132809, 0.734132809], [0.6875, 0.694266682, 0.694266682], [0.71875, 0.650421156, 0.650421156], [0.75, 0.602842431, 0.602842431], [0.78125, 0.551750968, 0.551750968], [0.8125, 0.49730856, 0.49730856], [0.84375, 0.439559467, 0.439559467], [0.875, 0.378313092, 0.378313092], [0.90625, 0.312874446, 0.312874446], [0.9375, 0.24128379, 0.24128379], [0.96875, 0.157246067, 0.157246067], [1, 0.01555616, 0.01555616]],\n      blue: [[0, 0.753683153, 0.753683153], [0.03125, 0.801466763, 0.801466763], [0.0625, 0.84495867, 0.84495867], [0.09375, 0.883725899, 0.883725899], [0.125, 0.917387822, 0.917387822], [0.15625, 0.945619588, 0.945619588], [0.1875, 0.968154911, 0.968154911], [0.21875, 0.98478814, 0.98478814], [0.25, 0.995375608, 0.995375608], [0.28125, 0.999836203, 0.999836203], [0.3125, 0.998151185, 0.998151185], [0.34375, 0.990363227, 0.990363227], [0.375, 0.976574709, 0.976574709], [0.40625, 0.956945269, 0.956945269], [0.4375, 0.931688648, 0.931688648], [0.46875, 0.901068838, 0.901068838], [0.5, 0.865395561, 0.865395561], [0.53125, 0.820880546, 0.820880546], [0.5625, 0.774508472, 0.774508472], [0.59375, 0.726736146, 0.726736146], [0.625, 0.678007945, 0.678007945], [0.65625, 0.628751763, 0.628751763], [0.6875, 0.579375448, 0.579375448], [0.71875, 0.530263762, 0.530263762], [0.75, 0.481775914, 0.481775914], [0.78125, 0.434243684, 0.434243684], [0.8125, 0.387970225, 0.387970225], [0.84375, 0.343229596, 0.343229596], [0.875, 0.300267182, 0.300267182], [0.90625, 0.259301199, 0.259301199], [0.9375, 0.220525627, 0.220525627], [0.96875, 0.184115123, 0.184115123], [1, 0.150232812, 0.150232812]]\n    }\n  },\n  blues: {\n    name: 'Blues',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0.9686274528503418, 0.9686274528503418], [0.125, 0.87058824300765991, 0.87058824300765991], [0.25, 0.7764706015586853, 0.7764706015586853], [0.375, 0.61960786581039429, 0.61960786581039429], [0.5, 0.41960784792900085, 0.41960784792900085], [0.625, 0.25882354378700256, 0.25882354378700256], [0.75, 0.12941177189350128, 0.12941177189350128], [0.875, 0.031372550874948502, 0.031372550874948502], [1, 0.031372550874948502, 0.031372550874948502]],\n      green: [[0, 0.9843137264251709, 0.9843137264251709], [0.125, 0.92156863212585449, 0.92156863212585449], [0.25, 0.85882353782653809, 0.85882353782653809], [0.375, 0.7921568751335144, 0.7921568751335144], [0.5, 0.68235296010971069, 0.68235296010971069], [0.625, 0.57254904508590698, 0.57254904508590698], [0.75, 0.44313725829124451, 0.44313725829124451], [0.875, 0.31764706969261169, 0.31764706969261169], [1, 0.18823529779911041, 0.18823529779911041]],\n      blue: [[0, 1, 1], [0.125, 0.9686274528503418, 0.9686274528503418], [0.25, 0.93725490570068359, 0.93725490570068359], [0.375, 0.88235294818878174, 0.88235294818878174], [0.5, 0.83921569585800171, 0.83921569585800171], [0.625, 0.7764706015586853, 0.7764706015586853], [0.75, 0.70980393886566162, 0.70980393886566162], [0.875, 0.61176472902297974, 0.61176472902297974], [1, 0.41960784792900085, 0.41960784792900085]]\n    }\n  }\n};\n\n// Generate linearly spaced vectors\n// http://cens.ioc.ee/local/man/matlab/techdoc/ref/linspace.html\nfunction linspace(a, b, n) {\n  n = n === null ? 100 : n;\n\n  var increment = (b - a) / (n - 1);\n  var vector = [];\n\n  while (n-- > 0) {\n    vector.push(a);\n    a += increment;\n  }\n\n  // Make sure the last item will always be \"b\" because most of the\n  // Time we'll get numbers like 1.0000000000000002 instead of 1.\n  vector[vector.length - 1] = b;\n\n  return vector;\n}\n\n// Return the number of elements smaller than \"elem\" (binary search)\nfunction getRank(array, elem) {\n  var left = 0;\n  var right = array.length - 1;\n\n  while (left <= right) {\n    var mid = left + Math.floor((right - left) / 2);\n    var midElem = array[mid];\n\n    if (midElem === elem) {\n      return mid;\n    } else if (elem < midElem) {\n      right = mid - 1;\n    } else {\n      left = mid + 1;\n    }\n  }\n\n  return left;\n}\n\n// Find the indices into a sorted array a such that, if the corresponding elements\n// In v were inserted before the indices, the order of a would be preserved.\n// http://lagrange.univ-lyon1.fr/docs/numpy/1.11.0/reference/generated/numpy.searchsorted.html\nfunction searchSorted(inputArray, values) {\n  var i = void 0;\n  var indexes = [];\n  var len = values.length;\n\n  inputArray.sort(function (a, b) {\n    return a - b;\n  });\n\n  for (i = 0; i < len; i++) {\n    indexes[i] = getRank(inputArray, values[i]);\n  }\n\n  return indexes;\n}\n\n// Create an *N* -element 1-d lookup table\n//\n// *Data* represented by a list of x,y0,y1 mapping correspondences. Each element in this\n// List represents how a value between 0 and 1 (inclusive) represented by x is mapped to\n// A corresponding value between 0 and 1 (inclusive). The two values of y are to allow for\n// Discontinuous mapping functions (say as might be found in a sawtooth) where y0 represents\n// The value of y for values of x <= to that given, and y1 is the value to be used for x >\n// Than that given). The list must start with x=0, end with x=1, and all values of x must be\n// In increasing order. Values between the given mapping points are determined by simple linear\n// Interpolation.\n//\n// The function returns an array \"result\" where result[x*(N-1)] gives the closest value for\n// Values of x between 0 and 1.\nfunction makeMappingArray(N, data, gamma) {\n  var i = void 0;\n  var x = [];\n  var y0 = [];\n  var y1 = [];\n  var lut = [];\n\n  gamma = gamma === null ? 1 : gamma;\n\n  for (i = 0; i < data.length; i++) {\n    var element = data[i];\n\n    x.push((N - 1) * element[0]);\n    y0.push(element[1]);\n    y1.push(element[1]);\n  }\n\n  var xLinSpace = linspace(0, 1, N);\n\n  for (i = 0; i < N; i++) {\n    xLinSpace[i] = (N - 1) * Math.pow(xLinSpace[i], gamma);\n  }\n\n  var xLinSpaceIndexes = searchSorted(x, xLinSpace);\n\n  for (i = 1; i < N - 1; i++) {\n    var index = xLinSpaceIndexes[i];\n    var colorPercent = (xLinSpace[i] - x[index - 1]) / (x[index] - x[index - 1]);\n    var colorDelta = y0[index] - y1[index - 1];\n\n    lut[i] = colorPercent * colorDelta + y1[index - 1];\n  }\n\n  lut[0] = y1[0];\n  lut[N - 1] = y0[data.length - 1];\n\n  return lut;\n}\n\n// Colormap based on lookup tables using linear segments.\n//\n// The lookup table is generated using linear interpolation for each\n// Primary color, with the 0-1 domain divided into any number of\n// Segments.\n//\n// https://github.com/stefanv/matplotlib/blob/3f1a23755e86fef97d51e30e106195f34425c9e3/lib/matplotlib/colors.py#L663\nfunction createLinearSegmentedColormap(segmentedData, N, gamma) {\n  var i = void 0;\n  var lut = [];\n\n  N = N === null ? 256 : N;\n  gamma = gamma === null ? 1 : gamma;\n\n  var redLut = makeMappingArray(N, segmentedData.red, gamma);\n  var greenLut = makeMappingArray(N, segmentedData.green, gamma);\n  var blueLut = makeMappingArray(N, segmentedData.blue, gamma);\n\n  for (i = 0; i < N; i++) {\n    var red = Math.round(redLut[i] * 255);\n    var green = Math.round(greenLut[i] * 255);\n    var blue = Math.round(blueLut[i] * 255);\n    var rgba = [red, green, blue, 255];\n\n    lut.push(rgba);\n  }\n\n  return lut;\n}\n\n/*\n* Return all colormaps (id and name) available\n*/\nfunction getColormapsList() {\n  var colormaps = [];\n  var keys = Object.keys(colormapsData);\n\n  keys.forEach(function (key) {\n    if (colormapsData.hasOwnProperty(key)) {\n      var colormap = colormapsData[key];\n\n      colormaps.push({\n        id: key,\n        name: colormap.name\n      });\n    }\n  });\n\n  colormaps.sort(function (a, b) {\n    var aName = a.name.toLowerCase();\n    var bName = b.name.toLowerCase();\n\n    if (aName === bName) {\n      return 0;\n    }\n\n    return aName < bName ? -1 : 1;\n  });\n\n  return colormaps;\n}\n\n/**\n * Convert the image of a element to a false color image\n *\n * @param {string} id The ID of the colormap\n * @param {Object} colormapData - An object that can contain a name, numColors, gama, segmentedData and/or colors\n *\n * @returns {*} The Colormap Object\n */\nfunction getColormap(id, colormapData) {\n  var colormap = colormapsData[id];\n\n  if (!colormap) {\n    colormap = colormapsData[id] = colormapData || {\n      name: '',\n      colors: []\n    };\n  }\n\n  if (!colormap.colors && colormap.segmentedData) {\n    colormap.colors = createLinearSegmentedColormap(colormap.segmentedData, colormap.numColors, colormap.gamma);\n  }\n\n  return {\n    getId: function getId() {\n      return id;\n    },\n    getColorSchemeName: function getColorSchemeName() {\n      return colormap.name;\n    },\n    setColorSchemeName: function setColorSchemeName(name) {\n      colormap.name = name;\n    },\n    getNumberOfColors: function getNumberOfColors() {\n      return colormap.colors.length;\n    },\n    setNumberOfColors: function setNumberOfColors(numColors) {\n      while (colormap.colors.length < numColors) {\n        colormap.colors.push(COLOR_TRANSPARENT);\n      }\n\n      colormap.colors.length = numColors;\n    },\n    getColor: function getColor(index) {\n      if (this.isValidIndex(index)) {\n        return colormap.colors[index];\n      }\n\n      return COLOR_TRANSPARENT;\n    },\n    getColorRepeating: function getColorRepeating(index) {\n      var numColors = colormap.colors.length;\n\n      index = numColors ? index % numColors : 0;\n\n      return this.getColor(index);\n    },\n    setColor: function setColor(index, rgba) {\n      if (this.isValidIndex(index)) {\n        colormap.colors[index] = rgba;\n      }\n    },\n    addColor: function addColor(rgba) {\n      colormap.colors.push(rgba);\n    },\n    insertColor: function insertColor(index, rgba) {\n      if (this.isValidIndex(index)) {\n        colormap.colors.splice(index, 1, rgba);\n      }\n    },\n    removeColor: function removeColor(index) {\n      if (this.isValidIndex(index)) {\n        colormap.colors.splice(index, 1);\n      }\n    },\n    clearColors: function clearColors() {\n      colormap.colors = [];\n    },\n    buildLookupTable: function buildLookupTable(lut) {\n      if (!lut) {\n        return;\n      }\n\n      var numColors = colormap.colors.length;\n\n      lut.setNumberOfTableValues(numColors);\n\n      for (var i = 0; i < numColors; i++) {\n        lut.setTableValue(i, colormap.colors[i]);\n      }\n    },\n    createLookupTable: function createLookupTable() {\n      var lut = new _lookupTable2.default();\n\n      this.buildLookupTable(lut);\n\n      return lut;\n    },\n    isValidIndex: function isValidIndex(index) {\n      return index >= 0 && index < colormap.colors.length;\n    }\n  };\n}\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// This code was created based on vtkLookupTable\n// http://www.vtk.org/doc/release/5.0/html/a01697.html\n// https://github.com/Kitware/VTK/blob/master/Common/Core/vtkLookupTable.cxx\nvar BELOW_RANGE_COLOR_INDEX = 0;\nvar ABOVE_RANGE_COLOR_INDEX = 1;\nvar NAN_COLOR_INDEX = 2;\n\nfunction HSVToRGB(hue, sat, val) {\n  if (hue > 1) {\n    throw new Error('HSVToRGB expects hue < 1');\n  }\n\n  var rgb = [];\n\n  if (sat === 0) {\n    rgb[0] = val;\n    rgb[1] = val;\n    rgb[2] = val;\n\n    return rgb;\n  }\n\n  var hueCase = Math.floor(hue * 6);\n  var frac = 6 * hue - hueCase;\n  var lx = val * (1 - sat);\n  var ly = val * (1 - sat * frac);\n  var lz = val * (1 - sat * (1 - frac));\n\n  switch (hueCase) {\n\n    /* 0<hue<1/6 */\n    case 0:\n    case 6:\n      rgb[0] = val;\n      rgb[1] = lz;\n      rgb[2] = lx;\n      break;\n\n    /* 1/6<hue<2/6 */\n    case 1:\n      rgb[0] = ly;\n      rgb[1] = val;\n      rgb[2] = lx;\n      break;\n\n    /* 2/6<hue<3/6 */\n    case 2:\n      rgb[0] = lx;\n      rgb[1] = val;\n      rgb[2] = lz;\n      break;\n\n    /* 3/6<hue/4/6 */\n    case 3:\n      rgb[0] = lx;\n      rgb[1] = ly;\n      rgb[2] = val;\n      break;\n\n    /* 4/6<hue<5/6 */\n    case 4:\n      rgb[0] = lz;\n      rgb[1] = lx;\n      rgb[2] = val;\n      break;\n\n    /* 5/6<hue<1 */\n    case 5:\n      rgb[0] = val;\n      rgb[1] = lx;\n      rgb[2] = ly;\n      break;\n  }\n\n  return rgb;\n}\n\nfunction linearIndexLookupMain(v, p) {\n  var dIndex = void 0;\n\n  // NOTE: Added Math.floor since values were not integers? Check VTK source\n  if (v < p.Range[0]) {\n    dIndex = p.MaxIndex + BELOW_RANGE_COLOR_INDEX + 1.5;\n  } else if (v > p.Range[1]) {\n    dIndex = p.MaxIndex + ABOVE_RANGE_COLOR_INDEX + 1.5;\n  } else {\n    dIndex = (v + p.Shift) * p.Scale;\n  }\n\n  return Math.floor(dIndex);\n}\n\nvar LookupTable = function () {\n  function LookupTable() {\n    _classCallCheck(this, LookupTable);\n\n    this.NumberOfColors = 256;\n    this.Ramp = 'linear';\n    this.TableRange = [0, 255];\n    this.HueRange = [0, 0.66667];\n    this.SaturationRange = [1, 1];\n    this.ValueRange = [1, 1];\n    this.AlphaRange = [1, 1];\n    this.NaNColor = [128, 0, 0, 255];\n    this.BelowRangeColor = [0, 0, 0, 255];\n    this.UseBelowRangeColor = true;\n    this.AboveRangeColor = [255, 255, 255, 255];\n    this.UseAboveRangeColor = true;\n    this.InputRange = [0, 255];\n    this.Table = [];\n  }\n\n  _createClass(LookupTable, [{\n    key: 'setNumberOfTableValues',\n    value: function setNumberOfTableValues(number) {\n      this.NumberOfColors = number;\n    }\n  }, {\n    key: 'setRamp',\n    value: function setRamp(ramp) {\n      this.Ramp = ramp;\n    }\n  }, {\n    key: 'setTableRange',\n    value: function setTableRange(start, end) {\n      // Set/Get the minimum/maximum scalar values for scalar mapping.\n      // Scalar values less than minimum range value are clamped to minimum range value.\n      // Scalar values greater than maximum range value are clamped to maximum range value.\n      this.TableRange[0] = start;\n      this.TableRange[1] = end;\n    }\n  }, {\n    key: 'setHueRange',\n    value: function setHueRange(start, end) {\n      // Set the range in hue (using automatic generation). Hue ranges between [0,1].\n      this.HueRange[0] = start;\n      this.HueRange[1] = end;\n    }\n  }, {\n    key: 'setSaturationRange',\n    value: function setSaturationRange(start, end) {\n      // Set the range in saturation (using automatic generation). Saturation ranges between [0,1].\n      this.SaturationRange[0] = start;\n      this.SaturationRange[1] = end;\n    }\n  }, {\n    key: 'setValueRange',\n    value: function setValueRange(start, end) {\n      // Set the range in value (using automatic generation). Value ranges between [0,1].\n      this.ValueRange[0] = start;\n      this.ValueRange[1] = end;\n    }\n  }, {\n    key: 'setRange',\n    value: function setRange(start, end) {\n      this.InputRange[0] = start;\n      this.InputRange[1] = end;\n    }\n  }, {\n    key: 'setAlphaRange',\n    value: function setAlphaRange(start, end) {\n      // Set the range in alpha (using automatic generation). Alpha ranges from [0,1].\n      this.AlphaRange[0] = start;\n      this.AlphaRange[1] = end;\n    }\n  }, {\n    key: 'getColor',\n    value: function getColor(scalar) {\n      // Map one value through the lookup table and return the color as an\n      // RGB array of doubles between 0 and 1.\n      return this.mapValue(scalar);\n    }\n  }, {\n    key: 'build',\n    value: function build(force) {\n      if (this.Table.length > 1 && !force) {\n        return;\n      }\n\n      // Clear the table\n      this.Table = [];\n\n      var maxIndex = this.NumberOfColors - 1;\n\n      var hinc = void 0,\n          sinc = void 0,\n          vinc = void 0,\n          ainc = void 0;\n\n      if (maxIndex) {\n        hinc = (this.HueRange[1] - this.HueRange[0]) / maxIndex;\n        sinc = (this.SaturationRange[1] - this.SaturationRange[0]) / maxIndex;\n        vinc = (this.ValueRange[1] - this.ValueRange[0]) / maxIndex;\n        ainc = (this.AlphaRange[1] - this.AlphaRange[0]) / maxIndex;\n      } else {\n        hinc = sinc = vinc = ainc = 0.0;\n      }\n\n      for (var i = 0; i <= maxIndex; i++) {\n        var hue = this.HueRange[0] + i * hinc;\n        var sat = this.SaturationRange[0] + i * sinc;\n        var val = this.ValueRange[0] + i * vinc;\n        var alpha = this.AlphaRange[0] + i * ainc;\n\n        var rgb = HSVToRGB(hue, sat, val);\n        var c_rgba = [];\n\n        switch (this.Ramp) {\n          case 'scurve':\n            c_rgba[0] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[0]) * Math.PI)));\n            c_rgba[1] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[1]) * Math.PI)));\n            c_rgba[2] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[2]) * Math.PI)));\n            c_rgba[3] = Math.floor(alpha * 255);\n            break;\n          case 'linear':\n            c_rgba[0] = Math.floor(rgb[0] * 255 + 0.5);\n            c_rgba[1] = Math.floor(rgb[1] * 255 + 0.5);\n            c_rgba[2] = Math.floor(rgb[2] * 255 + 0.5);\n            c_rgba[3] = Math.floor(alpha * 255 + 0.5);\n            break;\n          case 'sqrt':\n            c_rgba[0] = Math.floor(Math.sqrt(rgb[0]) * 255 + 0.5);\n            c_rgba[1] = Math.floor(Math.sqrt(rgb[1]) * 255 + 0.5);\n            c_rgba[2] = Math.floor(Math.sqrt(rgb[2]) * 255 + 0.5);\n            c_rgba[3] = Math.floor(Math.sqrt(alpha) * 255 + 0.5);\n            break;\n          default:\n            throw new Error('Invalid Ramp value (' + this.Ramp + ')');\n        }\n\n        this.Table.push(c_rgba);\n      }\n\n      this.buildSpecialColors();\n    }\n  }, {\n    key: 'buildSpecialColors',\n    value: function buildSpecialColors() {\n      var numberOfColors = this.NumberOfColors;\n      var belowRangeColorIndex = numberOfColors + BELOW_RANGE_COLOR_INDEX;\n      var aboveRangeColorIndex = numberOfColors + ABOVE_RANGE_COLOR_INDEX;\n      var nanColorIndex = numberOfColors + NAN_COLOR_INDEX;\n\n      // Below range color\n      if (this.UseBelowRangeColor || numberOfColors === 0) {\n        this.Table[belowRangeColorIndex] = this.BelowRangeColor;\n      } else {\n        // Duplicate the first color in the table.\n        this.Table[belowRangeColorIndex] = this.Table[0];\n      }\n\n      // Above range color\n      if (this.UseAboveRangeColor || numberOfColors === 0) {\n        this.Table[aboveRangeColorIndex] = this.AboveRangeColor;\n      } else {\n        // Duplicate the last color in the table.\n        this.Table[aboveRangeColorIndex] = this.Table[numberOfColors - 1];\n      }\n\n      // Always use NanColor\n      this.Table[nanColorIndex] = this.NaNColor;\n    }\n\n    // Given a scalar value v, return an rgba color value from lookup table.\n\n  }, {\n    key: 'mapValue',\n    value: function mapValue(v) {\n      var index = this.getIndex(v);\n\n      if (index < 0) {\n        return this.NaNColor;\n      } else if (index === 0) {\n        if (this.UseBelowRangeColor && v < this.TableRange[0]) {\n          return this.BelowRangeColor;\n        }\n      } else if (index === this.NumberOfColors - 1) {\n        if (this.UseAboveRangeColor && v > this.TableRange[1]) {\n          return this.AboveRangeColor;\n        }\n      }\n\n      return this.Table[index];\n    }\n  }, {\n    key: 'getIndex',\n    value: function getIndex(v) {\n      var p = {};\n\n      p.Range = [];\n      p.MaxIndex = this.NumberOfColors - 1;\n\n      // This was LookupShiftAndScale\n      p.Shift = -this.TableRange[0];\n      if (this.TableRange[1] <= this.TableRange[0]) {\n        p.Scale = Number.MAX_VALUE;\n      } else {\n        p.Scale = p.MaxIndex / (this.TableRange[1] - this.TableRange[0]);\n      }\n\n      p.Range[0] = this.TableRange[0];\n      p.Range[1] = this.TableRange[1];\n\n      // First, check whether we have a number...\n      if (isNaN(v)) {\n        // For backwards compatibility\n        return -1;\n      }\n\n      // Map to an index:\n      var index = linearIndexLookupMain(v, p);\n\n      // For backwards compatibility, if the index indicates an\n      // Out-of-range value, truncate to index range for in-range colors.\n      if (index === this.NumberOfColors + BELOW_RANGE_COLOR_INDEX) {\n        index = 0;\n      } else if (index === this.NumberOfColors + ABOVE_RANGE_COLOR_INDEX) {\n        index = this.NumberOfColors - 1;\n      }\n\n      return index;\n    }\n  }, {\n    key: 'setTableValue',\n    value: function setTableValue(index, rgba) {\n      // Check if it index, red, green, blue and alpha were passed as parameter\n      if (arguments.length === 5) {\n        rgba = Array.prototype.slice.call(arguments, 1);\n      }\n\n      // Check the index to make sure it is valid\n      if (index < 0) {\n        throw new Error('Can\\'t set the table value for negative index (' + index + ')');\n      }\n\n      if (index >= this.NumberOfColors) {\n        new Error('Index ' + index + ' is greater than the number of colors ' + this.NumberOfColors);\n      }\n\n      this.Table[index] = rgba;\n\n      if (index === 0 || index === this.NumberOfColors - 1) {\n        // This is needed due to the way the special colors are stored in\n        // The internal table. If Above/BelowRangeColors are not used and\n        // The min/max colors are changed in the table with this member\n        // Function, then the colors used for values outside the range may\n        // Be incorrect. Calling this here ensures the out-of-range colors\n        // Are set correctly.\n        this.buildSpecialColors();\n      }\n    }\n  }]);\n\n  return LookupTable;\n}();\n\nexports.default = LookupTable;\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, lut, canvasImageDataData) {\n  var start = (0, _now2.default)();\n  var pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = (0, _now2.default)() - start;\n\n  var numPixels = pixelData.length;\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  var pixelValue = void 0;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n\n  // Added two paths (Int16Array, Uint16Array) to avoid polymorphic deoptimization in chrome.\n  start = (0, _now2.default)();\n  if (pixelData instanceof Int16Array) {\n    if (minPixelValue < 0) {\n      while (storedPixelDataIndex < numPixels) {\n        pixelValue = lut[pixelData[storedPixelDataIndex++] + -minPixelValue];\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n      }\n    } else {\n      while (storedPixelDataIndex < numPixels) {\n        pixelValue = lut[pixelData[storedPixelDataIndex++]];\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n      }\n    }\n  } else if (pixelData instanceof Uint16Array) {\n    while (storedPixelDataIndex < numPixels) {\n      pixelValue = lut[pixelData[storedPixelDataIndex++]];\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n    }\n  } else if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      pixelValue = lut[pixelData[storedPixelDataIndex++] + -minPixelValue];\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      pixelValue = lut[pixelData[storedPixelDataIndex++]];\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = (0, _now2.default)() - start;\n};\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// By Simon Sarris\n// Www.simonsarris.com\n// Sarris@acm.org\n//\n// Free to use and distribute at will\n// So long as you are nice to people, etc\n\n// Simple class for keeping track of the current transformation matrix\n\n// For instance:\n//    Var t = new Transform();\n//    T.rotate(5);\n//    Var m = t.m;\n//    Ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);\n\n// Is equivalent to:\n//    Ctx.rotate(5);\n\n// But now you can retrieve it :)\n\n\n// Remember that this does not account for any CSS transforms applied to the canvas\nvar Transform = exports.Transform = function () {\n  function Transform() {\n    _classCallCheck(this, Transform);\n\n    this.reset();\n  }\n\n  _createClass(Transform, [{\n    key: \"reset\",\n    value: function reset() {\n      this.m = [1, 0, 0, 1, 0, 0];\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      var transform = new Transform();\n\n      transform.m[0] = this.m[0];\n      transform.m[1] = this.m[1];\n      transform.m[2] = this.m[2];\n      transform.m[3] = this.m[3];\n      transform.m[4] = this.m[4];\n      transform.m[5] = this.m[5];\n\n      return transform;\n    }\n  }, {\n    key: \"multiply\",\n    value: function multiply(matrix) {\n      var m11 = this.m[0] * matrix.m[0] + this.m[2] * matrix.m[1];\n      var m12 = this.m[1] * matrix.m[0] + this.m[3] * matrix.m[1];\n\n      var m21 = this.m[0] * matrix.m[2] + this.m[2] * matrix.m[3];\n      var m22 = this.m[1] * matrix.m[2] + this.m[3] * matrix.m[3];\n\n      var dx = this.m[0] * matrix.m[4] + this.m[2] * matrix.m[5] + this.m[4];\n      var dy = this.m[1] * matrix.m[4] + this.m[3] * matrix.m[5] + this.m[5];\n\n      this.m[0] = m11;\n      this.m[1] = m12;\n      this.m[2] = m21;\n      this.m[3] = m22;\n      this.m[4] = dx;\n      this.m[5] = dy;\n    }\n  }, {\n    key: \"invert\",\n    value: function invert() {\n      var d = 1 / (this.m[0] * this.m[3] - this.m[1] * this.m[2]);\n      var m0 = this.m[3] * d;\n      var m1 = -this.m[1] * d;\n      var m2 = -this.m[2] * d;\n      var m3 = this.m[0] * d;\n      var m4 = d * (this.m[2] * this.m[5] - this.m[3] * this.m[4]);\n      var m5 = d * (this.m[1] * this.m[4] - this.m[0] * this.m[5]);\n\n      this.m[0] = m0;\n      this.m[1] = m1;\n      this.m[2] = m2;\n      this.m[3] = m3;\n      this.m[4] = m4;\n      this.m[5] = m5;\n    }\n  }, {\n    key: \"rotate\",\n    value: function rotate(rad) {\n      var c = Math.cos(rad);\n      var s = Math.sin(rad);\n      var m11 = this.m[0] * c + this.m[2] * s;\n      var m12 = this.m[1] * c + this.m[3] * s;\n      var m21 = this.m[0] * -s + this.m[2] * c;\n      var m22 = this.m[1] * -s + this.m[3] * c;\n\n      this.m[0] = m11;\n      this.m[1] = m12;\n      this.m[2] = m21;\n      this.m[3] = m22;\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(x, y) {\n      this.m[4] += this.m[0] * x + this.m[2] * y;\n      this.m[5] += this.m[1] * x + this.m[3] * y;\n    }\n  }, {\n    key: \"scale\",\n    value: function scale(sx, sy) {\n      this.m[0] *= sx;\n      this.m[1] *= sx;\n      this.m[2] *= sy;\n      this.m[3] *= sy;\n    }\n  }, {\n    key: \"transformPoint\",\n    value: function transformPoint(px, py) {\n      var x = px;\n      var y = py;\n\n      px = x * this.m[0] + y * this.m[2] + this.m[4];\n      py = x * this.m[1] + y * this.m[3] + this.m[5];\n\n      return {\n        x: px,\n        y: py\n      };\n    }\n  }]);\n\n  return Transform;\n}();\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, viewport, invalidated) {\n  // If we have a cached lut and it has the right values, return it immediately\n  if (image.cachedLut !== undefined && image.cachedLut.windowCenter === viewport.voi.windowCenter && image.cachedLut.windowWidth === viewport.voi.windowWidth && (0, _lutMatches2.default)(image.cachedLut.modalityLUT, viewport.modalityLUT) && (0, _lutMatches2.default)(image.cachedLut.voiLUT, viewport.voiLUT) && image.cachedLut.invert === viewport.invert && invalidated !== true) {\n    return image.cachedLut.lutArray;\n  }\n\n  // Lut is invalid or not present, regenerate it and cache it\n  (0, _generateLut2.default)(image, viewport);\n\n  image.cachedLut.windowWidth = viewport.voi.windowWidth;\n  image.cachedLut.windowCenter = viewport.voi.windowCenter;\n  image.cachedLut.invert = viewport.invert;\n  image.cachedLut.voiLUT = viewport.voiLUT;\n  image.cachedLut.modalityLUT = viewport.modalityLUT;\n\n  return image.cachedLut.lutArray;\n};\n\nvar _lutMatches = __webpack_require__(46);\n\nvar _lutMatches2 = _interopRequireDefault(_lutMatches);\n\nvar _generateLut = __webpack_require__(16);\n\nvar _generateLut2 = _interopRequireDefault(_generateLut);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _events = __webpack_require__(14);\n\nvar _events2 = _interopRequireDefault(_events);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * This module deals with caching image textures in VRAM for WebGL\r\n */\n\nvar imageCache = {};\n\nvar cachedImages = [];\n\nvar maximumSizeInBytes = 1024 * 1024 * 256; // 256 MB\nvar cacheSizeInBytes = 0;\n\nfunction getCacheInfo() {\n  return {\n    maximumSizeInBytes: maximumSizeInBytes,\n    cacheSizeInBytes: cacheSizeInBytes,\n    numberOfImagesCached: cachedImages.length\n  };\n}\n\nfunction purgeCacheIfNecessary() {\n  // If max cache size has not been exceeded, do nothing\n  if (cacheSizeInBytes <= maximumSizeInBytes) {\n    return;\n  }\n\n  // Cache size has been exceeded, create list of images sorted by timeStamp\n  // So we can purge the least recently used image\n  function compare(a, b) {\n    if (a.timeStamp > b.timeStamp) {\n      return -1;\n    }\n    if (a.timeStamp < b.timeStamp) {\n      return 1;\n    }\n\n    return 0;\n  }\n  cachedImages.sort(compare);\n\n  // Remove images as necessary\n  while (cacheSizeInBytes > maximumSizeInBytes) {\n    var lastCachedImage = cachedImages[cachedImages.length - 1];\n\n    cacheSizeInBytes -= lastCachedImage.sizeInBytes;\n    delete imageCache[lastCachedImage.imageId];\n    cachedImages.pop();\n\n    (0, _triggerEvent2.default)(_events2.default, 'cornerstonewebgltextureremoved', { imageId: lastCachedImage.imageId });\n  }\n\n  var cacheInfo = getCacheInfo();\n\n  (0, _triggerEvent2.default)(_events2.default, 'cornerstonewebgltexturecachefull', cacheInfo);\n}\n\nfunction setMaximumSizeBytes(numBytes) {\n  if (numBytes === undefined) {\n    throw new Error('setMaximumSizeBytes: parameter numBytes must not be undefined');\n  }\n  if (numBytes.toFixed === undefined) {\n    throw new Error('setMaximumSizeBytes: parameter numBytes must be a number');\n  }\n\n  maximumSizeInBytes = numBytes;\n  purgeCacheIfNecessary();\n}\n\nfunction putImageTexture(image, imageTexture) {\n  var imageId = image.imageId;\n\n  if (image === undefined) {\n    throw new Error('putImageTexture: image must not be undefined');\n  }\n\n  if (imageId === undefined) {\n    throw new Error('putImageTexture: imageId must not be undefined');\n  }\n\n  if (imageTexture === undefined) {\n    throw new Error('putImageTexture: imageTexture must not be undefined');\n  }\n\n  if (Object.prototype.hasOwnProperty.call(imageCache, imageId) === true) {\n    throw new Error('putImageTexture: imageId already in cache');\n  }\n\n  var cachedImage = {\n    imageId: imageId,\n    imageTexture: imageTexture,\n    timeStamp: new Date(),\n    sizeInBytes: imageTexture.sizeInBytes\n  };\n\n  imageCache[imageId] = cachedImage;\n  cachedImages.push(cachedImage);\n\n  if (imageTexture.sizeInBytes === undefined) {\n    throw new Error('putImageTexture: imageTexture.sizeInBytes must not be undefined');\n  }\n  if (imageTexture.sizeInBytes.toFixed === undefined) {\n    throw new Error('putImageTexture: imageTexture.sizeInBytes is not a number');\n  }\n  cacheSizeInBytes += cachedImage.sizeInBytes;\n  purgeCacheIfNecessary();\n}\n\nfunction getImageTexture(imageId) {\n  if (imageId === undefined) {\n    throw new Error('getImageTexture: imageId must not be undefined');\n  }\n  var cachedImage = imageCache[imageId];\n\n  if (cachedImage === undefined) {\n    return;\n  }\n\n  // Bump time stamp for cached image\n  cachedImage.timeStamp = new Date();\n\n  return cachedImage.imageTexture;\n}\n\nfunction removeImageTexture(imageId) {\n  if (imageId === undefined) {\n    throw new Error('removeImageTexture: imageId must not be undefined');\n  }\n  var cachedImage = imageCache[imageId];\n\n  if (cachedImage === undefined) {\n    throw new Error('removeImageTexture: imageId must not be undefined');\n  }\n  cachedImages.splice(cachedImages.indexOf(cachedImage), 1);\n  cacheSizeInBytes -= cachedImage.sizeInBytes;\n  delete imageCache[imageId];\n\n  return cachedImage.imageTexture;\n}\n\nfunction purgeCache() {\n  while (cachedImages.length > 0) {\n    var removedCachedImage = cachedImages.pop();\n\n    delete imageCache[removedCachedImage.imageId];\n  }\n  cacheSizeInBytes = 0;\n}\n\nexports.default = {\n  purgeCache: purgeCache,\n  getImageTexture: getImageTexture,\n  putImageTexture: putImageTexture,\n  removeImageTexture: removeImageTexture,\n  setMaximumSizeBytes: setMaximumSizeBytes\n};\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (gl, vertexShaderSrc, fragShaderSrc) {\n  var vertexShader = compileShader(gl, vertexShaderSrc, gl.VERTEX_SHADER);\n  var fragShader = compileShader(gl, fragShaderSrc, gl.FRAGMENT_SHADER);\n\n  return createProgram(gl, vertexShader, fragShader);\n};\n\n/**\n * Creates and compiles a shader.\n *\n * @param {!WebGLRenderingContext} gl The WebGL Context.\n * @param {string} shaderSource The GLSL source code for the shader.\n * @param {number} shaderType The type of shader, VERTEX_SHADER or FRAGMENT_SHADER.\n *\n * @return {!WebGLShader} The shader.\n */\nfunction compileShader(gl, shaderSource, shaderType) {\n\n  // Create the shader object\n  var shader = gl.createShader(shaderType);\n\n  // Set the shader source code.\n  gl.shaderSource(shader, shaderSource);\n\n  // Compile the shader\n  gl.compileShader(shader);\n\n  // Check if it compiled\n  var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n  if (!success && !gl.isContextLost()) {\n    // Something went wrong during compilation; get the error\n    var infoLog = gl.getShaderInfoLog(shader);\n\n    console.error(\"Could not compile shader:\\n\" + infoLog);\n  }\n\n  return shader;\n}\n\n/**\n * Creates a program from 2 shaders.\n *\n * @param {!WebGLRenderingContext} gl The WebGL context.\n * @param {!WebGLShader} vertexShader A vertex shader.\n * @param {!WebGLShader} fragmentShader A fragment shader.\n * @return {!WebGLProgram} A program.\n */\nfunction createProgram(gl, vertexShader, fragmentShader) {\n\n  // Create a program.\n  var program = gl.createProgram();\n\n  // Attach the shaders.\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  // Link the program.\n  gl.linkProgram(program);\n\n  // Check if it linked.\n  var success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n  if (!success && !gl.isContextLost()) {\n    // Something went wrong with the link\n    var infoLog = gl.getProgramInfoLog(program);\n\n    console.error(\"WebGL program filed to link:\\n\" + infoLog);\n  }\n\n  return program;\n}\n\n/**\n * Creates a program from 2 shaders source (Strings)\n * @param  {!WebGLRenderingContext} gl              The WebGL context.\n * @param  {!WebGLShader} vertexShaderSrc   Vertex shader string\n * @param  {!WebGLShader} fragShaderSrc Fragment shader string\n * @return {!WebGLProgram}                 A program\n */\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.renderWebImage = renderWebImage;\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nvar _setToPixelCoordinateSystem2 = _interopRequireDefault(_setToPixelCoordinateSystem);\n\nvar _renderColorImage = __webpack_require__(8);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * API function to draw a standard web image (PNG, JPG) to an enabledImage\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\n/**\n * This module is responsible for drawing an image to an enabled elements canvas element\n */\nfunction renderWebImage(enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('renderWebImage: enabledElement parameter must not be undefined');\n  }\n\n  var image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('renderWebImage: image must be loaded before it can be drawn');\n  }\n\n  // If the viewport ww/wc and invert all match the initial state of the image, we can draw the image\n  // Directly. If any of those are changed, we call renderColorImage() to apply the lut\n  if (enabledElement.viewport.voi.windowWidth === enabledElement.image.windowWidth && enabledElement.viewport.voi.windowCenter === enabledElement.image.windowCenter && enabledElement.viewport.invert === false) {\n\n    // Get the canvas context and reset the transform\n    var context = enabledElement.canvas.getContext('2d');\n\n    context.setTransform(1, 0, 0, 1, 0, 0);\n\n    // Clear the canvas\n    context.fillStyle = 'black';\n    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n    // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n    context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n    // Save the canvas context state and apply the viewport properties\n    (0, _setToPixelCoordinateSystem2.default)(enabledElement, context);\n\n    var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n    var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n    var width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n    var height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n    context.drawImage(image.getImage(), sx, sy, width, height, 0, 0, width, height);\n  } else {\n    (0, _renderColorImage.renderColorImage)(enabledElement, invalidated);\n  }\n}\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, fitViewportToWindow) {\n\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  setCanvasSize(element, enabledElement.canvas);\n\n  var eventData = {\n    element: element\n  };\n\n  (0, _triggerEvent2.default)(element, 'cornerstoneelementresized', eventData);\n\n  if (enabledElement.image === undefined) {\n    return;\n  }\n\n  if (fitViewportToWindow === true) {\n    (0, _fitToWindow2.default)(element);\n  } else {\n    (0, _updateImage2.default)(element);\n  }\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _fitToWindow = __webpack_require__(40);\n\nvar _fitToWindow2 = _interopRequireDefault(_fitToWindow);\n\nvar _updateImage = __webpack_require__(4);\n\nvar _updateImage2 = _interopRequireDefault(_updateImage);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n *\r\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\r\n * @param {HTMLElement} canvas The Canvas DOM element within the DOM element enabled for Cornerstone\r\n * @returns {void}\r\n */\nfunction setCanvasSize(element, canvas) {\n  // The device pixel ratio is 1.0 for normal displays and > 1.0\n  // For high DPI displays like Retina\n  /*\r\n      This functionality is disabled due to buggy behavior on systems with mixed DPI's.  If the canvas\r\n    is created on a display with high DPI (e.g. 2.0) and then the browser window is dragged to\r\n    a different display with a different DPI (e.g. 1.0), the canvas is not recreated so the pageToPixel\r\n    produces incorrect results.  I couldn't find any way to determine when the DPI changed other than\r\n    by polling which is not very clean.  If anyone has any ideas here, please let me know, but for now\r\n    we will disable this functionality.  We may want\r\n    to add a mechanism to optionally enable this functionality if we can determine it is safe to do\r\n    so (e.g. iPad or iPhone or perhaps enumerate the displays on the system.  I am choosing\r\n    to be cautious here since I would rather not have bug reports or safety issues related to this\r\n    scenario.\r\n      var devicePixelRatio = window.devicePixelRatio;\r\n    if(devicePixelRatio === undefined) {\r\n        devicePixelRatio = 1.0;\r\n    }\r\n    */\n\n  // Avoid setting the same value because it flashes the canvas with IE and Edge\n  if (canvas.width !== element.clientWidth) {\n    canvas.width = element.clientWidth;\n    canvas.style.width = element.clientWidth + 'px';\n  }\n  // Avoid setting the same value because it flashes the canvas with IE and Edge\n  if (canvas.height !== element.clientHeight) {\n    canvas.height = element.clientHeight;\n    canvas.style.height = element.clientHeight + 'px';\n  }\n}\n\n/**\r\n * Resizes an enabled element and optionally fits the image to window\r\n *\r\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\r\n * @param {Boolean} fitViewportToWindow true to refit, false to leave viewport parameters as they are\r\n * @returns {void}\r\n */\n\n/***/ }),\n/* 40 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var imageSize = getImageSize(enabledElement);\n\n  var verticalScale = enabledElement.canvas.height / imageSize.height;\n  var horizontalScale = enabledElement.canvas.width / imageSize.width;\n\n  // The new scale is the minimum of the horizontal and vertical scale values\n  enabledElement.viewport.scale = Math.min(horizontalScale, verticalScale);\n\n  enabledElement.viewport.translation.x = 0;\n  enabledElement.viewport.translation.y = 0;\n  (0, _updateImage2.default)(element);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _updateImage = __webpack_require__(4);\n\nvar _updateImage2 = _interopRequireDefault(_updateImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Retrieves the current image dimensions given an enabled element\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element\n * @return {{width, height}} The Image dimensions\n */\nfunction getImageSize(enabledElement) {\n  if (enabledElement.viewport.rotation === 0 || enabledElement.viewport.rotation === 180) {\n    return {\n      width: enabledElement.image.width,\n      height: enabledElement.image.height\n    };\n  }\n\n  return {\n    width: enabledElement.image.height,\n    height: enabledElement.image.width\n  };\n}\n\n/**\n * Adjusts an image's scale and translation so the image is centered and all pixels\n * in the image are viewable.\n *\n * @param {HTMLElement} element The Cornerstone element to update\n * @returns {void}\n */\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, x, y, width, height) {\n  if (element === undefined) {\n    throw new Error('getStoredPixels: parameter element must not be undefined');\n  }\n\n  x = Math.round(x);\n  y = Math.round(y);\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var storedPixels = [];\n  var index = 0;\n  var pixelData = enabledElement.image.getPixelData();\n\n  for (var row = 0; row < height; row++) {\n    for (var column = 0; column < width; column++) {\n      var spIndex = (row + y) * enabledElement.image.columns + (column + x);\n\n      storedPixels[index++] = pixelData[spIndex];\n    }\n  }\n\n  return storedPixels;\n};\n\nvar _enabledElements = __webpack_require__(0);\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.cachedImages = undefined;\nexports.setMaximumSizeBytes = setMaximumSizeBytes;\nexports.putImageLoadObject = putImageLoadObject;\nexports.getImageLoadObject = getImageLoadObject;\nexports.removeImageLoadObject = removeImageLoadObject;\nexports.getCacheInfo = getCacheInfo;\nexports.purgeCache = purgeCache;\nexports.changeImageIdCacheSize = changeImageIdCacheSize;\n\nvar _events = __webpack_require__(14);\n\nvar _events2 = _interopRequireDefault(_events);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * This module deals with caching images\n */\nvar maximumSizeInBytes = 1024 * 1024 * 1024; // 1 GB\nvar cacheSizeInBytes = 0;\n\n// Dictionary of imageId to cachedImage objects\nvar imageCacheDict = {};\n\n// Array of cachedImage objects\nvar cachedImages = exports.cachedImages = [];\n\nfunction setMaximumSizeBytes(numBytes) {\n  if (numBytes === undefined) {\n    throw new Error('setMaximumSizeBytes: parameter numBytes must not be undefined');\n  }\n  if (numBytes.toFixed === undefined) {\n    throw new Error('setMaximumSizeBytes: parameter numBytes must be a number');\n  }\n\n  maximumSizeInBytes = numBytes;\n\n  (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimagecachemaximumsizechanged');\n\n  purgeCacheIfNecessary();\n}\n\nfunction purgeCacheIfNecessary() {\n  // If max cache size has not been exceeded, do nothing\n  if (cacheSizeInBytes <= maximumSizeInBytes) {\n    return;\n  }\n\n  // Cache size has been exceeded, create list of images sorted by timeStamp\n  // So we can purge the least recently used image\n  function compare(a, b) {\n    if (a.timeStamp > b.timeStamp) {\n      return -1;\n    }\n    if (a.timeStamp < b.timeStamp) {\n      return 1;\n    }\n\n    return 0;\n  }\n  cachedImages.sort(compare);\n\n  // Remove images as necessary)\n  while (cacheSizeInBytes > maximumSizeInBytes) {\n    var lastCachedImage = cachedImages[cachedImages.length - 1];\n    var imageId = lastCachedImage.imageId;\n\n    removeImageLoadObject(imageId);\n\n    (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimagecachepromiseremoved', { imageId: imageId });\n  }\n\n  var cacheInfo = getCacheInfo();\n\n  (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimagecachefull', cacheInfo);\n}\n\nfunction putImageLoadObject(imageId, imageLoadObject) {\n  if (imageId === undefined) {\n    throw new Error('putImageLoadObject: imageId must not be undefined');\n  }\n  if (imageLoadObject.promise === undefined) {\n    throw new Error('putImageLoadObject: imageLoadObject.promise must not be undefined');\n  }\n  if (imageCacheDict.hasOwnProperty(imageId) === true) {\n    throw new Error('putImageLoadObject: imageId already in cache');\n  }\n  if (imageLoadObject.cancelFn && typeof imageLoadObject.cancelFn !== 'function') {\n    throw new Error('putImageLoadObject: imageLoadObject.cancelFn must be a function');\n  }\n\n  var cachedImage = {\n    loaded: false,\n    imageId: imageId,\n    sharedCacheKey: undefined, // The sharedCacheKey for this imageId.  undefined by default\n    imageLoadObject: imageLoadObject,\n    timeStamp: Date.now(),\n    sizeInBytes: 0\n  };\n\n  imageCacheDict[imageId] = cachedImage;\n  cachedImages.push(cachedImage);\n\n  imageLoadObject.promise.then(function (image) {\n    if (cachedImages.indexOf(cachedImage) === -1) {\n      // If the image has been purged before being loaded, we stop here.\n      return;\n    }\n\n    cachedImage.loaded = true;\n    cachedImage.image = image;\n\n    if (image.sizeInBytes === undefined) {\n      throw new Error('putImageLoadObject: image.sizeInBytes must not be undefined');\n    }\n    if (image.sizeInBytes.toFixed === undefined) {\n      throw new Error('putImageLoadObject: image.sizeInBytes is not a number');\n    }\n\n    cachedImage.sizeInBytes = image.sizeInBytes;\n    cacheSizeInBytes += cachedImage.sizeInBytes;\n\n    var eventDetails = {\n      action: 'addImage',\n      image: cachedImage\n    };\n\n    (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimagecachechanged', eventDetails);\n\n    cachedImage.sharedCacheKey = image.sharedCacheKey;\n\n    purgeCacheIfNecessary();\n  }, function () {\n    var cachedImage = imageCacheDict[imageId];\n\n    cachedImages.splice(cachedImages.indexOf(cachedImage), 1);\n    delete imageCacheDict[imageId];\n  });\n}\n\nfunction getImageLoadObject(imageId) {\n  if (imageId === undefined) {\n    throw new Error('getImageLoadObject: imageId must not be undefined');\n  }\n  var cachedImage = imageCacheDict[imageId];\n\n  if (cachedImage === undefined) {\n    return;\n  }\n\n  // Bump time stamp for cached image\n  cachedImage.timeStamp = Date.now();\n\n  return cachedImage.imageLoadObject;\n}\n\nfunction removeImageLoadObject(imageId) {\n  if (imageId === undefined) {\n    throw new Error('removeImageLoadObject: imageId must not be undefined');\n  }\n  var cachedImage = imageCacheDict[imageId];\n\n  if (cachedImage === undefined) {\n    throw new Error('removeImageLoadObject: imageId was not present in imageCache');\n  }\n\n  cachedImages.splice(cachedImages.indexOf(cachedImage), 1);\n  cacheSizeInBytes -= cachedImage.sizeInBytes;\n\n  var eventDetails = {\n    action: 'deleteImage',\n    image: cachedImage\n  };\n\n  (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimagecachechanged', eventDetails);\n  decache(cachedImage.imageLoadObject.promise);\n\n  delete imageCacheDict[imageId];\n}\n\nfunction getCacheInfo() {\n  return {\n    maximumSizeInBytes: maximumSizeInBytes,\n    cacheSizeInBytes: cacheSizeInBytes,\n    numberOfImagesCached: cachedImages.length\n  };\n}\n\n// This method should only be called by `removeImageLoadObject` because it's\n// The one that knows how to deal with shared cache keys and cache size.\nfunction decache(imagePromise) {\n  imagePromise.then(function (image) {\n    if (image.decache) {\n      image.decache();\n    }\n  });\n}\n\nfunction purgeCache() {\n  while (cachedImages.length > 0) {\n    var removedCachedImage = cachedImages[0];\n\n    removeImageLoadObject(removedCachedImage.imageId);\n  }\n}\n\nfunction changeImageIdCacheSize(imageId, newCacheSize) {\n  var cacheEntry = imageCacheDict[imageId];\n\n  if (cacheEntry) {\n    cacheEntry.imageLoadObject.promise.then(function (image) {\n      var cacheSizeDifference = newCacheSize - image.sizeInBytes;\n\n      image.sizeInBytes = newCacheSize;\n      cacheEntry.sizeInBytes = newCacheSize;\n      cacheSizeInBytes += cacheSizeDifference;\n\n      var eventDetails = {\n        action: 'changeImageSize',\n        image: image\n      };\n\n      (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimagecachechanged', eventDetails);\n    });\n  }\n}\n\nexports.default = {\n  imageCache: imageCacheDict,\n  cachedImages: cachedImages,\n  setMaximumSizeBytes: setMaximumSizeBytes,\n  putImageLoadObject: putImageLoadObject,\n  getImageLoadObject: getImageLoadObject,\n  removeImageLoadObject: removeImageLoadObject,\n  getCacheInfo: getCacheInfo,\n  purgeCache: purgeCache,\n  changeImageIdCacheSize: changeImageIdCacheSize\n};\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, lookupTable) {\n  if (image.color && !image.falseColor) {\n    throw new Error('Color transforms are not implemented yet');\n  }\n\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  var numPixels = image.width * image.height;\n  var origPixelData = image.origPixelData || image.getPixelData();\n  var storedColorPixelData = new Uint8Array(numPixels * 4);\n  var sp = void 0;\n  var mapped = void 0;\n\n  image.color = true;\n  image.falseColor = true;\n  image.origPixelData = origPixelData;\n\n  if (lookupTable instanceof _index2.default.LookupTable) {\n    lookupTable.build();\n\n    while (storedPixelDataIndex < numPixels) {\n      sp = origPixelData[storedPixelDataIndex++];\n      mapped = lookupTable.mapValue(sp);\n      storedColorPixelData[canvasImageDataIndex++] = mapped[0];\n      storedColorPixelData[canvasImageDataIndex++] = mapped[1];\n      storedColorPixelData[canvasImageDataIndex++] = mapped[2];\n      storedColorPixelData[canvasImageDataIndex++] = mapped[3];\n    }\n  } else if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      sp = origPixelData[storedPixelDataIndex++];\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][0]; // Red\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][1]; // Green\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][2]; // Blue\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][3]; // Alpha\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      sp = origPixelData[storedPixelDataIndex++];\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][0]; // Red\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][1]; // Green\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][2]; // Blue\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][3]; // Alpha\n    }\n  }\n\n  image.rgba = true;\n  image.cachedLut = undefined;\n  image.render = undefined;\n  image.slope = 1;\n  image.intercept = 0;\n  image.minPixelValue = 0;\n  image.maxPixelValue = 255;\n  image.windowWidth = 255;\n  image.windowCenter = 128;\n  image.getPixelData = function () {\n    return storedColorPixelData;\n  };\n};\n\nvar _index = __webpack_require__(7);\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _drawImage = __webpack_require__(5);\n\nObject.defineProperty(exports, 'drawImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_drawImage).default;\n  }\n});\n\nvar _generateLut = __webpack_require__(16);\n\nObject.defineProperty(exports, 'generateLut', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_generateLut).default;\n  }\n});\n\nvar _getDefaultViewport = __webpack_require__(6);\n\nObject.defineProperty(exports, 'getDefaultViewport', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getDefaultViewport).default;\n  }\n});\n\nvar _requestAnimationFrame = __webpack_require__(20);\n\nObject.defineProperty(exports, 'requestAnimationFrame', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_requestAnimationFrame).default;\n  }\n});\n\nvar _storedPixelDataToCanvasImageData = __webpack_require__(21);\n\nObject.defineProperty(exports, 'storedPixelDataToCanvasImageData', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_storedPixelDataToCanvasImageData).default;\n  }\n});\n\nvar _storedColorPixelDataToCanvasImageData = __webpack_require__(22);\n\nObject.defineProperty(exports, 'storedColorPixelDataToCanvasImageData', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_storedColorPixelDataToCanvasImageData).default;\n  }\n});\n\nvar _storedPixelDataToCanvasImageDataColorLUT = __webpack_require__(23);\n\nObject.defineProperty(exports, 'storedPixelDataToCanvasImageDataColorLUT', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_storedPixelDataToCanvasImageDataColorLUT).default;\n  }\n});\n\nvar _storedPixelDataToCanvasImageDataPseudocolorLUT = __webpack_require__(24);\n\nObject.defineProperty(exports, 'storedPixelDataToCanvasImageDataPseudocolorLUT', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_storedPixelDataToCanvasImageDataPseudocolorLUT).default;\n  }\n});\n\nvar _index = __webpack_require__(45);\n\nObject.defineProperty(exports, 'internal', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_index).default;\n  }\n});\n\nvar _renderLabelMapImage = __webpack_require__(26);\n\nObject.defineProperty(exports, 'renderLabelMapImage', {\n  enumerable: true,\n  get: function get() {\n    return _renderLabelMapImage.renderLabelMapImage;\n  }\n});\n\nvar _renderPseudoColorImage = __webpack_require__(27);\n\nObject.defineProperty(exports, 'renderPseudoColorImage', {\n  enumerable: true,\n  get: function get() {\n    return _renderPseudoColorImage.renderPseudoColorImage;\n  }\n});\n\nvar _renderColorImage = __webpack_require__(8);\n\nObject.defineProperty(exports, 'renderColorImage', {\n  enumerable: true,\n  get: function get() {\n    return _renderColorImage.renderColorImage;\n  }\n});\n\nvar _renderGrayscaleImage = __webpack_require__(15);\n\nObject.defineProperty(exports, 'renderGrayscaleImage', {\n  enumerable: true,\n  get: function get() {\n    return _renderGrayscaleImage.renderGrayscaleImage;\n  }\n});\n\nvar _renderWebImage = __webpack_require__(38);\n\nObject.defineProperty(exports, 'renderWebImage', {\n  enumerable: true,\n  get: function get() {\n    return _renderWebImage.renderWebImage;\n  }\n});\n\nvar _canvasToPixel = __webpack_require__(57);\n\nObject.defineProperty(exports, 'canvasToPixel', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_canvasToPixel).default;\n  }\n});\n\nvar _disable = __webpack_require__(58);\n\nObject.defineProperty(exports, 'disable', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_disable).default;\n  }\n});\n\nvar _displayImage = __webpack_require__(59);\n\nObject.defineProperty(exports, 'displayImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_displayImage).default;\n  }\n});\n\nvar _draw = __webpack_require__(61);\n\nObject.defineProperty(exports, 'draw', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_draw).default;\n  }\n});\n\nvar _drawInvalidated = __webpack_require__(62);\n\nObject.defineProperty(exports, 'drawInvalidated', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_drawInvalidated).default;\n  }\n});\n\nvar _enable = __webpack_require__(63);\n\nObject.defineProperty(exports, 'enable', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_enable).default;\n  }\n});\n\nvar _enabledElementData = __webpack_require__(66);\n\nObject.defineProperty(exports, 'getElementData', {\n  enumerable: true,\n  get: function get() {\n    return _enabledElementData.getElementData;\n  }\n});\nObject.defineProperty(exports, 'removeElementData', {\n  enumerable: true,\n  get: function get() {\n    return _enabledElementData.removeElementData;\n  }\n});\n\nvar _enabledElements = __webpack_require__(0);\n\nObject.defineProperty(exports, 'getEnabledElement', {\n  enumerable: true,\n  get: function get() {\n    return _enabledElements.getEnabledElement;\n  }\n});\nObject.defineProperty(exports, 'addEnabledElement', {\n  enumerable: true,\n  get: function get() {\n    return _enabledElements.addEnabledElement;\n  }\n});\nObject.defineProperty(exports, 'getEnabledElementsByImageId', {\n  enumerable: true,\n  get: function get() {\n    return _enabledElements.getEnabledElementsByImageId;\n  }\n});\nObject.defineProperty(exports, 'getEnabledElements', {\n  enumerable: true,\n  get: function get() {\n    return _enabledElements.getEnabledElements;\n  }\n});\n\nvar _layers = __webpack_require__(28);\n\nObject.defineProperty(exports, 'addLayer', {\n  enumerable: true,\n  get: function get() {\n    return _layers.addLayer;\n  }\n});\nObject.defineProperty(exports, 'removeLayer', {\n  enumerable: true,\n  get: function get() {\n    return _layers.removeLayer;\n  }\n});\nObject.defineProperty(exports, 'getLayer', {\n  enumerable: true,\n  get: function get() {\n    return _layers.getLayer;\n  }\n});\nObject.defineProperty(exports, 'getLayers', {\n  enumerable: true,\n  get: function get() {\n    return _layers.getLayers;\n  }\n});\nObject.defineProperty(exports, 'getVisibleLayers', {\n  enumerable: true,\n  get: function get() {\n    return _layers.getVisibleLayers;\n  }\n});\nObject.defineProperty(exports, 'setActiveLayer', {\n  enumerable: true,\n  get: function get() {\n    return _layers.setActiveLayer;\n  }\n});\nObject.defineProperty(exports, 'getActiveLayer', {\n  enumerable: true,\n  get: function get() {\n    return _layers.getActiveLayer;\n  }\n});\nObject.defineProperty(exports, 'setLayerImage', {\n  enumerable: true,\n  get: function get() {\n    return _layers.setLayerImage;\n  }\n});\n\nvar _fitToWindow = __webpack_require__(40);\n\nObject.defineProperty(exports, 'fitToWindow', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_fitToWindow).default;\n  }\n});\n\nvar _getDefaultViewportForImage = __webpack_require__(67);\n\nObject.defineProperty(exports, 'getDefaultViewportForImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getDefaultViewportForImage).default;\n  }\n});\n\nvar _getImage = __webpack_require__(68);\n\nObject.defineProperty(exports, 'getImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getImage).default;\n  }\n});\n\nvar _getPixels = __webpack_require__(69);\n\nObject.defineProperty(exports, 'getPixels', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getPixels).default;\n  }\n});\n\nvar _getStoredPixels = __webpack_require__(41);\n\nObject.defineProperty(exports, 'getStoredPixels', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getStoredPixels).default;\n  }\n});\n\nvar _getViewport = __webpack_require__(70);\n\nObject.defineProperty(exports, 'getViewport', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getViewport).default;\n  }\n});\n\nvar _imageLoader = __webpack_require__(71);\n\nObject.defineProperty(exports, 'loadImage', {\n  enumerable: true,\n  get: function get() {\n    return _imageLoader.loadImage;\n  }\n});\nObject.defineProperty(exports, 'loadAndCacheImage', {\n  enumerable: true,\n  get: function get() {\n    return _imageLoader.loadAndCacheImage;\n  }\n});\nObject.defineProperty(exports, 'registerImageLoader', {\n  enumerable: true,\n  get: function get() {\n    return _imageLoader.registerImageLoader;\n  }\n});\nObject.defineProperty(exports, 'registerUnknownImageLoader', {\n  enumerable: true,\n  get: function get() {\n    return _imageLoader.registerUnknownImageLoader;\n  }\n});\n\nvar _invalidate = __webpack_require__(72);\n\nObject.defineProperty(exports, 'invalidate', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_invalidate).default;\n  }\n});\n\nvar _invalidateImageId = __webpack_require__(73);\n\nObject.defineProperty(exports, 'invalidateImageId', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_invalidateImageId).default;\n  }\n});\n\nvar _pageToPixel = __webpack_require__(74);\n\nObject.defineProperty(exports, 'pageToPixel', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_pageToPixel).default;\n  }\n});\n\nvar _pixelToCanvas = __webpack_require__(75);\n\nObject.defineProperty(exports, 'pixelToCanvas', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_pixelToCanvas).default;\n  }\n});\n\nvar _reset = __webpack_require__(76);\n\nObject.defineProperty(exports, 'reset', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_reset).default;\n  }\n});\n\nvar _resize = __webpack_require__(39);\n\nObject.defineProperty(exports, 'resize', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_resize).default;\n  }\n});\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nObject.defineProperty(exports, 'setToPixelCoordinateSystem', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_setToPixelCoordinateSystem).default;\n  }\n});\n\nvar _setViewport = __webpack_require__(77);\n\nObject.defineProperty(exports, 'setViewport', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_setViewport).default;\n  }\n});\n\nvar _updateImage = __webpack_require__(4);\n\nObject.defineProperty(exports, 'updateImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_updateImage).default;\n  }\n});\n\nvar _pixelDataToFalseColorData = __webpack_require__(43);\n\nObject.defineProperty(exports, 'pixelDataToFalseColorData', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_pixelDataToFalseColorData).default;\n  }\n});\n\nvar _index2 = __webpack_require__(78);\n\nObject.defineProperty(exports, 'rendering', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_index2).default;\n  }\n});\n\nvar _imageCache = __webpack_require__(42);\n\nObject.defineProperty(exports, 'imageCache', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_imageCache).default;\n  }\n});\n\nvar _metaData = __webpack_require__(79);\n\nObject.defineProperty(exports, 'metaData', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_metaData).default;\n  }\n});\n\nvar _index3 = __webpack_require__(13);\n\nObject.defineProperty(exports, 'webGL', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_index3).default;\n  }\n});\n\nvar _index4 = __webpack_require__(7);\n\nObject.defineProperty(exports, 'colors', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_index4).default;\n  }\n});\n\nvar _falseColorMapping = __webpack_require__(80);\n\nObject.defineProperty(exports, 'convertImageToFalseColorImage', {\n  enumerable: true,\n  get: function get() {\n    return _falseColorMapping.convertImageToFalseColorImage;\n  }\n});\nObject.defineProperty(exports, 'convertToFalseColorImage', {\n  enumerable: true,\n  get: function get() {\n    return _falseColorMapping.convertToFalseColorImage;\n  }\n});\nObject.defineProperty(exports, 'restoreImage', {\n  enumerable: true,\n  get: function get() {\n    return _falseColorMapping.restoreImage;\n  }\n});\n\nvar _events = __webpack_require__(14);\n\nObject.defineProperty(exports, 'events', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_events).default;\n  }\n});\n\nvar _triggerEvent = __webpack_require__(2);\n\nObject.defineProperty(exports, 'triggerEvent', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_triggerEvent).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _drawImage = __webpack_require__(5);\n\nvar _drawImage2 = _interopRequireDefault(_drawImage);\n\nvar _generateLut = __webpack_require__(16);\n\nvar _generateLut2 = _interopRequireDefault(_generateLut);\n\nvar _getDefaultViewport = __webpack_require__(6);\n\nvar _getDefaultViewport2 = _interopRequireDefault(_getDefaultViewport);\n\nvar _requestAnimationFrame = __webpack_require__(20);\n\nvar _requestAnimationFrame2 = _interopRequireDefault(_requestAnimationFrame);\n\nvar _storedPixelDataToCanvasImageData = __webpack_require__(21);\n\nvar _storedPixelDataToCanvasImageData2 = _interopRequireDefault(_storedPixelDataToCanvasImageData);\n\nvar _storedPixelDataToCanvasImageDataRGBA = __webpack_require__(33);\n\nvar _storedPixelDataToCanvasImageDataRGBA2 = _interopRequireDefault(_storedPixelDataToCanvasImageDataRGBA);\n\nvar _storedColorPixelDataToCanvasImageData = __webpack_require__(22);\n\nvar _storedColorPixelDataToCanvasImageData2 = _interopRequireDefault(_storedColorPixelDataToCanvasImageData);\n\nvar _storedPixelDataToCanvasImageDataColorLUT = __webpack_require__(23);\n\nvar _storedPixelDataToCanvasImageDataColorLUT2 = _interopRequireDefault(_storedPixelDataToCanvasImageDataColorLUT);\n\nvar _storedPixelDataToCanvasImageDataPseudocolorLUT = __webpack_require__(24);\n\nvar _storedPixelDataToCanvasImageDataPseudocolorLUT2 = _interopRequireDefault(_storedPixelDataToCanvasImageDataPseudocolorLUT);\n\nvar _getTransform = __webpack_require__(9);\n\nvar _getTransform2 = _interopRequireDefault(_getTransform);\n\nvar _calculateTransform = __webpack_require__(25);\n\nvar _calculateTransform2 = _interopRequireDefault(_calculateTransform);\n\nvar _transform = __webpack_require__(34);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = {\n  drawImage: _drawImage2.default,\n  generateLut: _generateLut2.default,\n  getDefaultViewport: _getDefaultViewport2.default,\n  requestAnimationFrame: _requestAnimationFrame2.default,\n  storedPixelDataToCanvasImageData: _storedPixelDataToCanvasImageData2.default,\n  storedPixelDataToCanvasImageDataRGBA: _storedPixelDataToCanvasImageDataRGBA2.default,\n  storedPixelDataToCanvasImageDataColorLUT: _storedPixelDataToCanvasImageDataColorLUT2.default,\n  storedPixelDataToCanvasImageDataPseudocolorLUT: _storedPixelDataToCanvasImageDataPseudocolorLUT2.default,\n  storedColorPixelDataToCanvasImageData: _storedColorPixelDataToCanvasImageData2.default,\n  getTransform: _getTransform2.default,\n  calculateTransform: _calculateTransform2.default,\n  Transform: _transform.Transform\n};\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (a, b) {\n  // If undefined, they are equal\n  if (!a && !b) {\n    return true;\n  }\n  // If one is undefined, not equal\n  if (!a || !b) {\n    return false;\n  }\n\n  // Check the unique ids\n  return a.id === b.id;\n};\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, windowWidth, windowCenter, invert, voiLUT) {\n  var maxPixelValue = image.maxPixelValue;\n  var minPixelValue = image.minPixelValue;\n  var offset = Math.min(minPixelValue, 0);\n\n  if (image.cachedLut === undefined) {\n    var length = maxPixelValue - offset + 1;\n\n    image.cachedLut = {};\n    image.cachedLut.lutArray = new Uint8ClampedArray(length);\n  }\n\n  var lut = image.cachedLut.lutArray;\n  var vlutfn = (0, _getVOILut2.default)(windowWidth, windowCenter, voiLUT);\n\n  if (invert === true) {\n    for (var storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {\n      lut[storedValue + -offset] = 255 - vlutfn(storedValue);\n    }\n  } else {\n    for (var _storedValue = minPixelValue; _storedValue <= maxPixelValue; _storedValue++) {\n      lut[_storedValue + -offset] = vlutfn(_storedValue);\n    }\n  }\n\n  return lut;\n};\n\nvar _getVOILut = __webpack_require__(18);\n\nvar _getVOILut2 = _interopRequireDefault(_getVOILut);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (image, lut, canvasImageDataData) {\n\n  var start = (0, _now2.default)();\n  var pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = (0, _now2.default)() - start;\n\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  var numPixels = pixelData.length;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n  start = (0, _now2.default)();\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Green\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Blue\n      canvasImageDataData[canvasImageDataIndex++] = pixelData[storedPixelDataIndex++];\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Green\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Blue\n      canvasImageDataData[canvasImageDataIndex++] = pixelData[storedPixelDataIndex++];\n    }\n  }\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = (0, _now2.default)() - start;\n};\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isWebGLInitialized = undefined;\nexports.getRenderCanvas = getRenderCanvas;\nexports.initRenderer = initRenderer;\nexports.render = render;\nexports.isWebGLAvailable = isWebGLAvailable;\n\nvar _index = __webpack_require__(50);\n\nvar _vertexShader = __webpack_require__(56);\n\nvar _textureCache = __webpack_require__(36);\n\nvar _textureCache2 = _interopRequireDefault(_textureCache);\n\nvar _createProgramFromString = __webpack_require__(37);\n\nvar _createProgramFromString2 = _interopRequireDefault(_createProgramFromString);\n\nvar _autoWindow = __webpack_require__(29);\n\nvar _autoWindow2 = _interopRequireDefault(_autoWindow);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _getModalityLUT = __webpack_require__(17);\n\nvar _getModalityLUT2 = _interopRequireDefault(_getModalityLUT);\n\nvar _getVOILut = __webpack_require__(18);\n\nvar _getVOILut2 = _interopRequireDefault(_getVOILut);\n\nvar _getMinMax = __webpack_require__(30);\n\nvar _getMinMax2 = _interopRequireDefault(_getMinMax);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar renderCanvas = document.createElement('canvas'); /* eslint no-bitwise: 0 */\n\nvar gl = void 0;\nvar texCoordBuffer = void 0;\nvar positionBuffer = void 0;\nvar isWebGLInitialized = false;\n\nexports.isWebGLInitialized = isWebGLInitialized;\nfunction getRenderCanvas() {\n  return renderCanvas;\n}\n\nfunction initShaders() {\n  for (var id in _index.shaders) {\n    // Console.log(\"WEBGL: Loading shader\", id);\n    var shader = _index.shaders[id];\n\n    shader.attributes = {};\n    shader.uniforms = {};\n    shader.vert = _vertexShader.vertexShader;\n\n    shader.program = (0, _createProgramFromString2.default)(gl, shader.vert, shader.frag);\n\n    shader.attributes.texCoordLocation = gl.getAttribLocation(shader.program, 'a_texCoord');\n    gl.enableVertexAttribArray(shader.attributes.texCoordLocation);\n\n    shader.attributes.positionLocation = gl.getAttribLocation(shader.program, 'a_position');\n    gl.enableVertexAttribArray(shader.attributes.positionLocation);\n\n    shader.uniforms.resolutionLocation = gl.getUniformLocation(shader.program, 'u_resolution');\n  }\n}\n\nfunction initRenderer() {\n  if (isWebGLInitialized === true) {\n    // Console.log(\"WEBGL Renderer already initialized\");\n    return;\n  }\n\n  if (initWebGL(renderCanvas)) {\n    initBuffers();\n    initShaders();\n    // Console.log(\"WEBGL Renderer initialized!\");\n    exports.isWebGLInitialized = isWebGLInitialized = true;\n  }\n}\n\nfunction updateRectangle(gl, width, height) {\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([width, height, 0, height, width, 0, 0, 0]), gl.STATIC_DRAW);\n}\n\nfunction handleLostContext(event) {\n  event.preventDefault();\n  console.warn('WebGL Context Lost!');\n}\n\nfunction handleRestoredContext(event) {\n  event.preventDefault();\n  exports.isWebGLInitialized = isWebGLInitialized = false;\n  _textureCache2.default.purgeCache();\n  initRenderer();\n  // Console.log('WebGL Context Restored.');\n}\n\nfunction initWebGL(canvas) {\n\n  gl = null;\n  try {\n    // Try to grab the standard context. If it fails, fallback to experimental.\n    var options = {\n      preserveDrawingBuffer: true // Preserve buffer so we can copy to display canvas element\n    };\n\n    // ---------------- Testing purposes -------------\n    // If (debug === true && WebGLDebugUtils) {\n    //    RenderCanvas = WebGLDebugUtils.makeLostContextSimulatingCanvas(renderCanvas);\n    // }\n    // ---------------- Testing purposes -------------\n\n    gl = canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options);\n\n    // Set up event listeners for context lost / context restored\n    canvas.removeEventListener('webglcontextlost', handleLostContext, false);\n    canvas.addEventListener('webglcontextlost', handleLostContext, false);\n\n    canvas.removeEventListener('webglcontextrestored', handleRestoredContext, false);\n    canvas.addEventListener('webglcontextrestored', handleRestoredContext, false);\n  } catch (error) {\n    throw new Error('Error creating WebGL context');\n  }\n\n  // If we don't have a GL context, give up now\n  if (!gl) {\n    console.error('Unable to initialize WebGL. Your browser may not support it.');\n    gl = null;\n  }\n\n  return gl;\n}\n\nfunction getImageDataType(image, viewport) {\n  if (image.color) {\n    return 'rgb';\n  }\n\n  var minMax = viewport && viewport.voi && viewport.voi.minMax ? viewport.voi.minMax : { min: image.minPixelValue, max: image.maxPixelValue };\n  var datatype = 'int';\n\n  if (minMax.min >= 0) {\n    datatype = 'u' + datatype;\n  }\n\n  if (minMax.max > 255) {\n    datatype += '16';\n  } else {\n    datatype += '8';\n  }\n\n  return datatype;\n}\n\nfunction getShaderProgram(image, viewport) {\n\n  var datatype = getImageDataType(image, viewport);\n  // We need a mechanism for\n  // Choosing the shader based on the image datatype\n  // Console.log(\"Datatype: \" + datatype);\n\n  if (_index.shaders.hasOwnProperty(datatype)) {\n    return _index.shaders[datatype];\n  }\n\n  return _index.shaders.rgb;\n}\n\nfunction generateTexture(image, viewport, mlutfn, vlutfn) {\n  var TEXTURE_FORMAT = {\n    uint8: gl.LUMINANCE,\n    int8: gl.LUMINANCE_ALPHA,\n    uint16: gl.LUMINANCE_ALPHA,\n    int16: gl.RGB,\n    rgb: gl.RGB\n  };\n\n  var TEXTURE_BYTES = {\n    int8: 1, // Luminance\n    uint16: 2, // Luminance + Alpha\n    int16: 3, // RGB\n    rgb: 3 // RGB\n  };\n\n  var imageDataType = getImageDataType(image, viewport);\n  var format = TEXTURE_FORMAT[imageDataType];\n\n  // GL texture configuration\n  var texture = gl.createTexture();\n\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\n  var imageData = _index.dataUtilities[imageDataType].storedPixelDataToImageData(image, mlutfn, vlutfn);\n\n  gl.texImage2D(gl.TEXTURE_2D, 0, format, image.width, image.height, 0, format, gl.UNSIGNED_BYTE, imageData);\n\n  // Calculate the size in bytes of this image in memory\n  var sizeInBytes = image.width * image.height * TEXTURE_BYTES[imageDataType];\n\n  return {\n    texture: texture,\n    sizeInBytes: sizeInBytes\n  };\n}\n\nfunction getImageTexture(image, viewport, mlutfn, vlutfn) {\n  var imageTexture = _textureCache2.default.getImageTexture(image.imageId);\n\n  if (!imageTexture) {\n    // Console.log(\"Generating texture for imageid: \", image.imageId);\n    imageTexture = generateTexture(image, viewport, mlutfn, vlutfn);\n    _textureCache2.default.putImageTexture(image, imageTexture);\n  }\n\n  return imageTexture.texture;\n}\n\nfunction initBuffers() {\n  positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 1, 0, 1, 1, 0, 0, 0]), gl.STATIC_DRAW);\n\n  texCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0]), gl.STATIC_DRAW);\n}\n\nfunction renderQuad(shader, parameters, texture, width, height) {\n  gl.clearColor(1.0, 0.0, 0.0, 1.0);\n  gl.viewport(0, 0, width, height);\n\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  gl.useProgram(shader.program);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.vertexAttribPointer(shader.attributes.texCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.vertexAttribPointer(shader.attributes.positionLocation, 2, gl.FLOAT, false, 0, 0);\n\n  for (var key in parameters) {\n    var uniformLocation = gl.getUniformLocation(shader.program, key);\n\n    if (!uniformLocation) {\n      continue;\n\n      // Disabling this error for now since RGB requires minPixelValue\n      // but the other shaders do not.\n      // throw `Could not access location for uniform: ${key}`;\n    }\n\n    var uniform = parameters[key];\n\n    var type = uniform.type;\n    var value = uniform.value;\n\n    if (type === 'i') {\n      gl.uniform1i(uniformLocation, value);\n    } else if (type === 'f') {\n      gl.uniform1f(uniformLocation, value);\n    } else if (type === '2f') {\n      gl.uniform2f(uniformLocation, value[0], value[1]);\n    }\n  }\n\n  updateRectangle(gl, width, height);\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\n\nfunction getModalityLUTFunction(modalityLUT) {\n  var minMax = modalityLUT.minMax;\n  var minValue = minMax.min;\n  var maxValue = minMax.max;\n  var maxValueMapped = modalityLUT.firstValueMapped + modalityLUT.lut.length;\n\n  return function (storedPixelValue) {\n    if (storedPixelValue < modalityLUT.firstValueMapped) {\n      return minValue;\n    } else if (storedPixelValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return modalityLUT.lut[storedPixelValue];\n  };\n}\n\nfunction getVoiLUTFunction(voiLUT) {\n  var minMax = voiLUT.minMax;\n  var minValue = minMax.min;\n  var maxValue = minMax.max;\n  var maxValueMapped = voiLUT.firstValueMapped + voiLUT.lut.length - 1;\n\n  return function (modalityLutValue) {\n    if (modalityLutValue < voiLUT.firstValueMapped) {\n      return minValue;\n    } else if (modalityLutValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return voiLUT.lut[modalityLutValue];\n  };\n}\n\nfunction render(enabledElement) {\n  // Resize the canvas\n  var image = enabledElement.image;\n\n  renderCanvas.width = image.width;\n  renderCanvas.height = image.height;\n\n  var viewport = enabledElement.viewport;\n  (0, _autoWindow2.default)(image, viewport);\n\n  // Get the lut to use\n  var start = (0, _now2.default)();\n  var mlutfn = viewport.modalityLUT !== undefined && viewport.modalityLUT.lut !== undefined ? getModalityLUTFunction(viewport.modalityLUT) : undefined;\n  var vlutfn = viewport.voiLUT !== undefined && viewport.voiLUT.lut !== undefined ? getVoiLUTFunction(viewport.voiLUT) : undefined;\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = (0, _now2.default)() - start;\n\n  // Render the current image\n  var shader = getShaderProgram(image, viewport);\n  var texture = getImageTexture(image, viewport, mlutfn, vlutfn);\n\n  var parameters = {\n    u_resolution: { type: '2f',\n      value: [image.width, image.height] },\n    wc: { type: 'f',\n      value: viewport.voi.windowCenter },\n    ww: { type: 'f',\n      value: viewport.voi.windowWidth },\n    slope: { type: 'f',\n      value: image.slope },\n    intercept: { type: 'f',\n      value: image.intercept },\n    minPixelValue: { type: 'f',\n      value: image.minPixelValue },\n    invert: { type: 'i',\n      value: viewport.invert ? 1 : 0 }\n  };\n\n  renderQuad(shader, parameters, texture, image.width, image.height);\n\n  return renderCanvas;\n}\n\nfunction isWebGLAvailable() {\n  // Adapted from\n  // http://stackoverflow.com/questions/9899807/three-js-detect-webgl-support-and-fallback-to-regular-canvas\n\n  var options = {\n    failIfMajorPerformanceCaveat: true\n  };\n\n  try {\n    var canvas = document.createElement('canvas');\n\n    return Boolean(window.WebGLRenderingContext) && (canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options));\n  } catch (e) {\n    return false;\n  }\n}\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.dataUtilities = exports.shaders = undefined;\n\nvar _int = __webpack_require__(51);\n\nvar _int2 = __webpack_require__(52);\n\nvar _rgb = __webpack_require__(53);\n\nvar _uint = __webpack_require__(54);\n\nvar _uint2 = __webpack_require__(55);\n\nvar shaders = {\n  int16: _int.int16Shader,\n  int8: _int2.int8Shader,\n  rgb: _rgb.rgbShader,\n  uint16: _uint.uint16Shader,\n  uint8: _uint2.uint8Shader\n};\n\nvar dataUtilities = {\n  int16: _int.int16DataUtilities,\n  int8: _int2.int8DataUtilities,\n  rgb: _rgb.rgbDataUtilities,\n  uint16: _uint.uint16DataUtilities,\n  uint8: _uint2.uint8DataUtilities\n};\n\nexports.shaders = shaders;\nexports.dataUtilities = dataUtilities;\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.int16Shader = exports.int16DataUtilities = undefined;\n\nvar _getStoredValue = __webpack_require__(19);\n\nvar _getStoredValue2 = _interopRequireDefault(_getStoredValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar int16Shader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * Pack int16 into three uint8 channels (r, g, b)\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\n/* eslint no-bitwise: 0 */\nfunction storedPixelDataToImageData(image, mlutfn, vlutfn) {\n\n  // Transfer image data to alpha and luminance channels of WebGL texture\n  // Credit to @jpambrun and @fernandojsg\n\n  // Pack int16 into three uint8 channels (r, g, b)\n  var pixelData = image.getPixelData();\n  var numberOfChannels = 3;\n  var data = new Uint8Array(image.width * image.height * numberOfChannels);\n  var shouldShift = image.pixelRepresentation !== undefined && image.pixelRepresentation === 1;\n  var shift = shouldShift && image.bitsStored !== undefined ? 32 - image.bitsStored : undefined;\n  var offset = 0;\n\n  for (var i = 0; i < pixelData.length; i++) {\n    var sv = (0, _getStoredValue2.default)(i, pixelData, shift);\n\n    if (image.photometricInterpretation === \"MONOCHROME1\") {\n      sv = image.maxPixelValue - sv;\n    }\n\n    if (mlutfn) {\n      sv = mlutfn(sv);\n    }\n\n    if (vlutfn) {\n      sv = vlutfn(sv);\n    }\n\n    var val = Math.abs(sv);\n\n    data[offset++] = val & 0xFF;\n    data[offset++] = val >> 8;\n    data[offset++] = sv < 0 ? 0 : 1; // 0 For negative, 1 for positive\n  }\n\n  return data;\n}\n\nvar int16DataUtilities = exports.int16DataUtilities = {\n  storedPixelDataToImageData: storedPixelDataToImageData\n};\n\nint16Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' +\n// Get texture\n'vec4 color = texture2D(u_image, v_texCoord);' +\n\n// Calculate luminance from packed texture\n'float intensity = color.r*256.0 + color.g*65536.0;' + 'if (color.b == 0.0)' + 'intensity = -intensity;' +\n\n// Rescale based on slope and window settings\n'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' +\n\n// Clamp intensity\n'intensity = clamp(intensity, 0.0, 1.0);' +\n\n// RGBA output\n'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n// Apply any inversion necessary\n'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';\n\nexports.int16Shader = int16Shader;\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar int8Shader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * Store data in Uint8Array\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData(image, mlutfn, vlutfn) {\n  // Transfer image data to alpha channel of WebGL texture\n  // Store data in Uint8Array\n  var pixelData = image.getPixelData();\n  var numberOfChannels = 2;\n  var data = new Uint8Array(image.width * image.height * numberOfChannels);\n  var offset = 0;\n\n  for (var i = 0; i < pixelData.length; i++) {\n    var sv = pixelData[i];\n\n    if (image.photometricInterpretation === \"MONOCHROME1\") {\n      sv = image.maxPixelValue - sv;\n    }\n\n    if (mlutfn) {\n      sv = mlutfn(sv);\n    }\n\n    if (vlutfn) {\n      sv = vlutfn(sv);\n    }\n\n    data[offset++] = sv;\n    data[offset++] = sv < 0 ? 0 : 1; // 0 For negative, 1 for positive\n  }\n\n  return data;\n}\n\nvar int8DataUtilities = exports.int8DataUtilities = {\n  storedPixelDataToImageData: storedPixelDataToImageData\n};\n\nint8Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' +\n// Get texture\n'vec4 color = texture2D(u_image, v_texCoord);' +\n\n// Calculate luminance from packed texture\n'float intensity = color.r*256.;' + 'if (color.a == 0.0)' + 'intensity = -intensity;' +\n\n// Rescale based on slope and window settings\n'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' +\n\n// Clamp intensity\n'intensity = clamp(intensity, 0.0, 1.0);' +\n\n// RGBA output\n'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n// Apply any inversion necessary\n'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';\n\nexports.int8Shader = int8Shader;\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar rgbShader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * Pack RGB images into a 3-channel RGB texture\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData(image) {\n  var minPixelValue = image.minPixelValue;\n  var canvasImageDataIndex = 0;\n  var storedPixelDataIndex = 0;\n  // Only 3 channels, since we use WebGL's RGB texture format\n  var numStoredPixels = image.width * image.height * 4;\n  var numOutputPixels = image.width * image.height * 3;\n  var storedPixelData = image.getPixelData();\n  var data = new Uint8Array(numOutputPixels);\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numStoredPixels) {\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + -minPixelValue; // Red\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + -minPixelValue; // Green\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + -minPixelValue; // Blue\n      storedPixelDataIndex += 1; // The stored pixel data has 4 channels\n    }\n  } else {\n    while (storedPixelDataIndex < numStoredPixels) {\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Red\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Green\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Blue\n      storedPixelDataIndex += 1; // The stored pixel data has 4 channels\n    }\n  }\n\n  return data;\n}\n\nvar rgbDataUtilities = exports.rgbDataUtilities = {\n  storedPixelDataToImageData: storedPixelDataToImageData\n};\n\nrgbShader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform float minPixelValue;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' +\n\n// Get texture\n'vec3 color = texture2D(u_image, v_texCoord).xyz;' +\n\n// Rescale based on slope and intercept\n'color = color * 256.0 * slope + intercept;' +\n\n// Apply window settings\n'float center0 = wc - 0.5 - minPixelValue;' + 'float width0 = max(ww, 1.0);' + 'color = (color - center0) / width0 + 0.5;' +\n\n// RGBA output\n'gl_FragColor = vec4(color, 1);' +\n\n// Apply any inversion necessary\n'if (invert == 1)' + 'gl_FragColor.rgb = 1. - gl_FragColor.rgb;' + '}';\n\nexports.rgbShader = rgbShader;\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/* eslint no-bitwise: 0 */\n\nvar uint16Shader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * For uint16 pack uint16 into two uint8 channels (r and a).\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData(image, mlutfn, vlutfn) {\n\n  // Transfer image data to alpha and luminance channels of WebGL texture\n  // Credit to @jpambrun and @fernandojsg\n\n  // Pack uint16 into two uint8 channels (r and a)\n  var pixelData = image.getPixelData();\n  var numberOfChannels = 2;\n  var data = new Uint8Array(image.width * image.height * numberOfChannels);\n  var offset = 0;\n\n  for (var i = 0; i < pixelData.length; i++) {\n    var sv = pixelData[i];\n\n    if (image.photometricInterpretation === \"MONOCHROME1\") {\n      sv = image.maxPixelValue - sv;\n    }\n\n    if (mlutfn) {\n      sv = mlutfn(sv);\n    }\n\n    if (vlutfn) {\n      sv = vlutfn(sv);\n    }\n\n    data[offset++] = sv & 0xFF;\n    data[offset++] = sv >> 8;\n  }\n\n  return data;\n}\n\nvar uint16DataUtilities = exports.uint16DataUtilities = {\n  storedPixelDataToImageData: storedPixelDataToImageData\n};\n\nuint16Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' +\n// Get texture\n'vec4 color = texture2D(u_image, v_texCoord);' +\n\n// Calculate luminance from packed texture\n'float intensity = color.r*256.0 + color.a*65536.0;' +\n\n// Rescale based on slope and window settings\n'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' +\n\n// Clamp intensity\n'intensity = clamp(intensity, 0.0, 1.0);' +\n\n// RGBA output\n'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n// Apply any inversion necessary\n'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';\n\nexports.uint16Shader = uint16Shader;\n\n/***/ }),\n/* 55 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar uint8Shader = {};\n\n/**\n * Convert stored pixel data to image data. Here we will store\n * all data in the alpha channel.\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} lut Lookup table to apply to the image pixel data\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData(image, mlutfn, vlutfn) {\n  // Transfer image data to alpha channel of WebGL texture\n\n  if (mlutfn || vlutfn) {\n    var pixelData = image.getPixelData();\n    var data = new Uint8Array(pixelData.length);\n\n    for (var i = 0; i < pixelData.length; i++) {\n      var sv = pixelData[i];\n\n      if (image.photometricInterpretation === \"MONOCHROME1\") {\n        sv = image.maxPixelValue - sv;\n      }\n\n      if (mlutfn) {\n        sv = mlutfn(sv);\n      }\n\n      if (vlutfn) {\n        sv = vlutfn(sv);\n      }\n\n      data[i] = sv;\n    }\n\n    return data;\n  } else if (image.photometricInterpretation === \"MONOCHROME1\") {\n    image.getPixelData().map(function (sv) {\n      return image.maxPixelValue - sv;\n    });\n  }\n\n  return image.getPixelData();\n}\n\nvar uint8DataUtilities = exports.uint8DataUtilities = {\n  storedPixelDataToImageData: storedPixelDataToImageData\n};\n\nuint8Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' +\n// Get texture\n'vec4 color = texture2D(u_image, v_texCoord);' +\n\n// Calculate luminance from packed texture\n'float intensity = color.r*256.0;' +\n\n// Rescale based on slope and window settings\n'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' +\n\n// Clamp intensity\n'intensity = clamp(intensity, 0.0, 1.0);' +\n\n// RGBA output\n'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n// Apply any inversion necessary\n'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';\n\nexports.uint8Shader = uint8Shader;\n\n/***/ }),\n/* 56 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar vertexShader = exports.vertexShader = 'attribute vec2 a_position;' + 'attribute vec2 a_texCoord;' + 'uniform vec2 u_resolution;' + 'varying vec2 v_texCoord;' + 'void main() {' + 'vec2 zeroToOne = a_position / u_resolution;' + 'vec2 zeroToTwo = zeroToOne * 2.0;' + 'vec2 clipSpace = zeroToTwo - 1.0;' + 'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' + 'v_texCoord = a_texCoord;' + '}';\n\n/***/ }),\n/* 57 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, pt) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var transform = (0, _getTransform2.default)(enabledElement);\n\n  transform.invert();\n\n  return transform.transformPoint(pt.x, pt.y);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getTransform = __webpack_require__(9);\n\nvar _getTransform2 = _interopRequireDefault(_getTransform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 58 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  if (element === undefined) {\n    throw new Error('disable: element must not be undefined');\n  }\n\n  // Search for this element in this list of enabled elements\n  var enabledElements = (0, _enabledElements.getEnabledElements)();\n\n  for (var i = 0; i < enabledElements.length; i++) {\n    if (enabledElements[i].element === element) {\n      // We found it!\n\n      // Fire an event so dependencies can cleanup\n      var eventData = {\n        element: element\n      };\n\n      (0, _triggerEvent2.default)(element, 'cornerstoneelementdisabled', eventData);\n\n      // Remove the child DOM elements that we created (e.g.canvas)\n      enabledElements[i].element.removeChild(enabledElements[i].canvas);\n      enabledElements[i].canvas = undefined;\n\n      // Remove this element from the list of enabled elements\n      enabledElements.splice(i, 1);\n\n      break;\n    }\n  }\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 59 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, image, viewport) {\n  if (element === undefined) {\n    throw new Error('displayImage: parameter element must not be undefined');\n  }\n  if (image === undefined) {\n    throw new Error('displayImage: parameter image must not be undefined');\n  }\n\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var oldImage = enabledElement.image;\n\n  enabledElement.image = image;\n\n  if (enabledElement.layers && enabledElement.layers.length) {\n    (0, _layers.setLayerImage)(element, image);\n  }\n\n  if (enabledElement.viewport === undefined) {\n    enabledElement.viewport = (0, _getDefaultViewport2.default)(enabledElement.canvas, image);\n  }\n\n  // Merge viewport\n  if (viewport) {\n    for (var attrname in viewport) {\n      if (viewport[attrname] !== null) {\n        enabledElement.viewport[attrname] = viewport[attrname];\n      }\n    }\n  }\n\n  var frameRate = void 0;\n\n  if (enabledElement.lastImageTimeStamp !== undefined) {\n    var timeSinceLastImage = (0, _now2.default)() - enabledElement.lastImageTimeStamp;\n\n    frameRate = (1000 / timeSinceLastImage).toFixed();\n  }\n\n  enabledElement.lastImageTimeStamp = (0, _now2.default)();\n\n  var newImageEventData = {\n    viewport: enabledElement.viewport,\n    element: enabledElement.element,\n    image: enabledElement.image,\n    oldImage: oldImage,\n    enabledElement: enabledElement,\n    frameRate: frameRate\n  };\n\n  (0, _triggerEvent2.default)(enabledElement.element, 'cornerstonenewimage', newImageEventData);\n\n  (0, _updateImage2.default)(element);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getDefaultViewport = __webpack_require__(6);\n\nvar _getDefaultViewport2 = _interopRequireDefault(_getDefaultViewport);\n\nvar _updateImage = __webpack_require__(4);\n\nvar _updateImage2 = _interopRequireDefault(_updateImage);\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _layers = __webpack_require__(28);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 60 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  return s4() + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + s4() + s4();\n};\n\nfunction s4() {\n  return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n}\n\n/**\n * Generate a unique identifier\n *\n * @return {string} A unique identifier\n */\n\n/***/ }),\n/* 61 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  if (enabledElement.image === undefined) {\n    throw new Error('draw: image has not been loaded yet');\n  }\n\n  (0, _drawImage2.default)(enabledElement);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _drawImage = __webpack_require__(5);\n\nvar _drawImage2 = _interopRequireDefault(_drawImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 62 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var enabledElements = (0, _enabledElements.getEnabledElements)();\n\n  for (var i = 0; i < enabledElements.length; i++) {\n    var ee = enabledElements[i];\n\n    if (ee.invalid === true) {\n      (0, _drawImage2.default)(ee, true);\n    }\n  }\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _drawImage = __webpack_require__(5);\n\nvar _drawImage2 = _interopRequireDefault(_drawImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 63 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, options) {\n  if (element === undefined) {\n    throw new Error('enable: parameter element cannot be undefined');\n  }\n\n  // If this enabled element has the option set for WebGL, we should\n  // Check if this device actually supports it\n  if (options && options.renderer && options.renderer.toLowerCase() === 'webgl') {\n    if (_index2.default.renderer.isWebGLAvailable()) {\n      // If WebGL is available on the device, initialize the renderer\n      // And return the renderCanvas from the WebGL rendering path\n      _index2.default.renderer.initRenderer();\n      options.renderer = 'webgl';\n    } else {\n      // If WebGL is not available on this device, we will fall back\n      // To using the Canvas renderer\n      console.error('WebGL not available, falling back to Canvas renderer');\n      delete options.renderer;\n    }\n  }\n\n  var canvas = document.createElement('canvas');\n\n  element.appendChild(canvas);\n\n  var enabledElement = {\n    element: element,\n    canvas: canvas,\n    image: undefined, // Will be set once image is loaded\n    invalid: false, // True if image needs to be drawn, false if not\n    needsRedraw: true,\n    options: options,\n    layers: [],\n    data: {},\n    renderingTools: {}\n  };\n\n  (0, _enabledElements.addEnabledElement)(enabledElement);\n\n  (0, _resize2.default)(element, true);\n\n  /**\r\n   * Draw the image immediately\r\n   *\r\n   * @param {DOMHighResTimeStamp} timestamp The current time for when requestAnimationFrame starts to fire callbacks\r\n   * @returns {void}\r\n   */\n  function draw(timestamp) {\n    if (enabledElement.canvas === undefined) {\n      return;\n    }\n\n    var eventDetails = {\n      enabledElement: enabledElement,\n      timestamp: timestamp\n    };\n\n    (0, _triggerEvent2.default)(enabledElement.element, 'cornerstoneprerender', eventDetails);\n\n    if (enabledElement.needsRedraw && hasImageOrLayers(enabledElement)) {\n      (0, _drawImageSync2.default)(enabledElement, enabledElement.invalid);\n    }\n\n    (0, _requestAnimationFrame2.default)(draw);\n  }\n\n  draw();\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _resize = __webpack_require__(39);\n\nvar _resize2 = _interopRequireDefault(_resize);\n\nvar _drawImageSync = __webpack_require__(64);\n\nvar _drawImageSync2 = _interopRequireDefault(_drawImageSync);\n\nvar _requestAnimationFrame = __webpack_require__(20);\n\nvar _requestAnimationFrame2 = _interopRequireDefault(_requestAnimationFrame);\n\nvar _index = __webpack_require__(13);\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n */\n\nfunction hasImageOrLayers(enabledElement) {\n  return enabledElement.image !== undefined || enabledElement.layers.length;\n}\n\n/**\r\n * Enable an HTML Element for use in Cornerstone\r\n *\r\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\r\n * @param {Object} options Options for the enabledElement\r\n *\r\n * @return {void}\r\n */\n\n/***/ }),\n/* 64 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement, invalidated) {\n  var image = enabledElement.image;\n  var element = enabledElement.element;\n  var layers = enabledElement.layers || [];\n\n  // Check if enabledElement can be redrawn\n  if (!enabledElement.canvas || !(enabledElement.image || layers.length)) {\n    return;\n  }\n\n  // Start measuring the time needed to draw the image/layers\n  var start = (0, _now2.default)();\n\n  image.stats = {\n    lastGetPixelDataTime: -1.0,\n    lastStoredPixelDataToCanvasImageDataTime: -1.0,\n    lastPutImageDataTime: -1.0,\n    lastRenderTime: -1.0,\n    lastLutGenerateTime: -1.0\n  };\n\n  if (layers && layers.length) {\n    (0, _drawCompositeImage2.default)(enabledElement, invalidated);\n  } else if (image) {\n    var render = image.render;\n\n    if (!render) {\n      if (enabledElement.viewport.colormap && enabledElement.viewport.colormap !== '' && enabledElement.image.labelmap === true) {\n        render = _renderLabelMapImage.renderLabelMapImage;\n      } else if (enabledElement.viewport.colormap && enabledElement.viewport.colormap !== '') {\n        render = _renderPseudoColorImage.renderPseudoColorImage;\n      } else if (image.color) {\n        render = _renderColorImage.renderColorImage;\n      } else {\n        render = _renderGrayscaleImage.renderGrayscaleImage;\n      }\n    }\n\n    render(enabledElement, invalidated);\n  }\n\n  // Calculate how long it took to draw the image/layers\n  var renderTimeInMs = (0, _now2.default)() - start;\n\n  var eventData = {\n    viewport: enabledElement.viewport,\n    element: element,\n    image: image,\n    enabledElement: enabledElement,\n    canvasContext: enabledElement.canvas.getContext('2d'),\n    renderTimeInMs: renderTimeInMs\n  };\n\n  image.stats.lastRenderTime = renderTimeInMs;\n\n  enabledElement.invalid = false;\n  enabledElement.needsRedraw = false;\n\n  (0, _triggerEvent2.default)(element, 'cornerstoneimagerendered', eventData);\n};\n\nvar _now = __webpack_require__(1);\n\nvar _now2 = _interopRequireDefault(_now);\n\nvar _drawCompositeImage = __webpack_require__(65);\n\nvar _drawCompositeImage2 = _interopRequireDefault(_drawCompositeImage);\n\nvar _renderColorImage = __webpack_require__(8);\n\nvar _renderGrayscaleImage = __webpack_require__(15);\n\nvar _renderPseudoColorImage = __webpack_require__(27);\n\nvar _renderLabelMapImage = __webpack_require__(26);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 65 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (enabledElement, invalidated) {\n  var element = enabledElement.element;\n  var allLayers = (0, _layers.getLayers)(element);\n  var activeLayer = (0, _layers.getActiveLayer)(element);\n  var visibleLayers = (0, _layers.getVisibleLayers)(element);\n  var resynced = !enabledElement.lastSyncViewportsState && enabledElement.syncViewports;\n\n  // This state will help us to determine if the user has re-synced the\n  // layers allowing us to make a new copy of the viewports\n  enabledElement.lastSyncViewportsState = enabledElement.syncViewports;\n\n  // Stores a copy of all viewports if the user has just synced them then we can use the\n  // copies to calculate anything later (ratio, translation offset, rotation offset, etc)\n  if (resynced) {\n    allLayers.forEach(function (layer) {\n      if (layer.viewport) {\n        originalViewportScale[layer.layerId] = layer.viewport.scale;\n      }\n    });\n  }\n\n  // Sync all viewports in case it's activated\n  if (enabledElement.syncViewports === true) {\n    syncViewports(visibleLayers, activeLayer);\n  }\n\n  // Get the enabled element's canvas so we can draw to it\n  var context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Render all visible layers\n  renderLayers(context, visibleLayers, invalidated);\n};\n\nvar _layers = __webpack_require__(28);\n\nvar _renderGrayscaleImage = __webpack_require__(15);\n\nvar _renderColorImage = __webpack_require__(8);\n\nvar _renderPseudoColorImage = __webpack_require__(27);\n\nvar _renderLabelMapImage = __webpack_require__(26);\n\nvar _setToPixelCoordinateSystem = __webpack_require__(3);\n\nvar _setToPixelCoordinateSystem2 = _interopRequireDefault(_setToPixelCoordinateSystem);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// This is used to keep each of the layers' viewports in sync with the active layer\nvar originalViewportScale = {};\n\nfunction getViewportRatio(baseLayerId, targetLayerId) {\n  return originalViewportScale[targetLayerId] / originalViewportScale[baseLayerId];\n}\n\n// Sync all viewports based on active layer's viewport\nfunction syncViewports(layers, activeLayer) {\n  // If we intend to keep the viewport's scale, translation and rotation in sync,\n  // loop through the layers\n  layers.forEach(function (layer) {\n    // Don't do anything to the active layer\n    // Don't do anything if this layer has no viewport\n    if (layer === activeLayer || !layer.viewport || !activeLayer.viewport) {\n      return;\n    }\n\n    if (!originalViewportScale[layer.layerId]) {\n      originalViewportScale[layer.layerId] = layer.viewport.scale;\n    }\n\n    var viewportRatio = getViewportRatio(activeLayer.layerId, layer.layerId);\n\n    // Update the layer's translation and scale to keep them in sync with the first image\n    // based on the ratios between the images\n    layer.viewport.scale = activeLayer.viewport.scale * viewportRatio;\n    layer.viewport.rotation = activeLayer.viewport.rotation;\n    layer.viewport.translation = {\n      x: activeLayer.viewport.translation.x / viewportRatio,\n      y: activeLayer.viewport.translation.y / viewportRatio\n    };\n    layer.viewport.hflip = activeLayer.viewport.hflip;\n    layer.viewport.vflip = activeLayer.viewport.vflip;\n  });\n}\n\n/**\n * Internal function to render all layers for a Cornerstone enabled element\n *\n * @param {CanvasRenderingContext2D} context Canvas context to draw upon\n * @param {EnabledElementLayer[]} layers The array of all layers for this enabled element\n * @param {Boolean} invalidated A boolean whether or not this image has been invalidated and must be redrawn\n * @returns {void}\n */\nfunction renderLayers(context, layers, invalidated) {\n  // Loop through each layer and draw it to the canvas\n  layers.forEach(function (layer, index) {\n    if (!layer.image) {\n      return;\n    }\n\n    context.save();\n\n    // Set the layer's canvas to the pixel coordinate system\n    layer.canvas = context.canvas;\n    (0, _setToPixelCoordinateSystem2.default)(layer, context);\n\n    // Render into the layer's canvas\n    var colormap = layer.viewport.colormap || layer.options.colormap;\n    var labelmap = layer.viewport.labelmap;\n    var isInvalid = layer.invalid || invalidated;\n\n    if (colormap && colormap !== '' && labelmap === true) {\n      (0, _renderLabelMapImage.addLabelMapLayer)(layer, isInvalid);\n    } else if (colormap && colormap !== '') {\n      (0, _renderPseudoColorImage.addPseudoColorLayer)(layer, isInvalid);\n    } else if (layer.image.color === true) {\n      (0, _renderColorImage.addColorLayer)(layer, isInvalid);\n    } else {\n      // If this is the base layer, use the alpha channel for rendering of the grayscale image\n      var useAlphaChannel = index === 0;\n\n      (0, _renderGrayscaleImage.addGrayscaleLayer)(layer, isInvalid, useAlphaChannel);\n    }\n\n    // Apply any global opacity settings that have been defined for this layer\n    if (layer.options && layer.options.opacity) {\n      context.globalAlpha = layer.options.opacity;\n    } else {\n      context.globalAlpha = 1;\n    }\n\n    if (layer.options && layer.options.fillStyle) {\n      context.fillStyle = layer.options.fillStyle;\n    }\n\n    // Set the pixelReplication property before drawing from the layer into the\n    // composite canvas\n    context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n    // Draw from the current layer's canvas onto the enabled element's canvas\n    var sx = layer.viewport.displayedArea.tlhc.x - 1;\n    var sy = layer.viewport.displayedArea.tlhc.y - 1;\n    var width = layer.viewport.displayedArea.brhc.x - layer.viewport.displayedArea.tlhc.x;\n    var height = layer.viewport.displayedArea.brhc.y - layer.viewport.displayedArea.tlhc.y;\n\n    context.drawImage(layer.canvas, sx, sy, width, height, 0, 0, width, height);\n    context.restore();\n\n    layer.invalid = false;\n  });\n}\n\n/**\n * Internal API function to draw a composite image to a given enabled element\n *\n * @param {EnabledElement} enabledElement An enabled element to draw into\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\n\n/***/ }),\n/* 66 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getElementData = getElementData;\nexports.removeElementData = removeElementData;\n\nvar _enabledElements = __webpack_require__(0);\n\n/**\n * Retrieves any data for a Cornerstone enabledElement for a specific string\n * dataType\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {string} dataType A string name for an arbitrary set of data\n * @returns {*} Whatever data is stored for this enabled element\n */\nfunction getElementData(element, dataType) {\n  var ee = (0, _enabledElements.getEnabledElement)(element);\n\n  if (ee.data.hasOwnProperty(dataType) === false) {\n    ee.data[dataType] = {};\n  }\n\n  return ee.data[dataType];\n}\n\n/**\n * Clears any data for a Cornerstone enabledElement for a specific string\n * dataType\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {string} dataType A string name for an arbitrary set of data\n *\n * @returns {void}\n */\nfunction removeElementData(element, dataType) {\n  var ee = (0, _enabledElements.getEnabledElement)(element);\n\n  delete ee.data[dataType];\n}\n\n/***/ }),\n/* 67 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, image) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return (0, _getDefaultViewport2.default)(enabledElement.canvas, image);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getDefaultViewport = __webpack_require__(6);\n\nvar _getDefaultViewport2 = _interopRequireDefault(_getDefaultViewport);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 68 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return enabledElement.image;\n};\n\nvar _enabledElements = __webpack_require__(0);\n\n/***/ }),\n/* 69 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, x, y, width, height) {\n  var storedPixels = (0, _getStoredPixels2.default)(element, x, y, width, height);\n  var ee = (0, _enabledElements.getEnabledElement)(element);\n  var mlutfn = (0, _getModalityLUT2.default)(ee.image.slope, ee.image.intercept, ee.viewport.modalityLUT);\n\n  return storedPixels.map(mlutfn);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getStoredPixels = __webpack_require__(41);\n\nvar _getStoredPixels2 = _interopRequireDefault(_getStoredPixels);\n\nvar _getModalityLUT = __webpack_require__(17);\n\nvar _getModalityLUT2 = _interopRequireDefault(_getModalityLUT);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 70 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var viewport = enabledElement.viewport;\n\n  if (viewport === undefined) {\n    return;\n  }\n\n  // Return a copy of the viewport\n  return Object.assign({}, viewport);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\n/***/ }),\n/* 71 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.loadImage = loadImage;\nexports.loadAndCacheImage = loadAndCacheImage;\nexports.registerImageLoader = registerImageLoader;\nexports.registerUnknownImageLoader = registerUnknownImageLoader;\n\nvar _imageCache = __webpack_require__(42);\n\nvar _events = __webpack_require__(14);\n\nvar _events2 = _interopRequireDefault(_events);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * This module deals with ImageLoaders, loading images and caching images\r\n */\n\nvar imageLoaders = {};\n\nvar unknownImageLoader = void 0;\n\n/**\r\n * Load an image using a registered Cornerstone Image Loader.\r\n *\r\n * The image loader that is used will be\r\n * determined by the image loader scheme matching against the imageId.\r\n *\r\n * @param {String} imageId A Cornerstone Image Object's imageId\r\n * @param {Object} [options] Options to be passed to the Image Loader\r\n *\r\n * @returns {ImageLoadObject} An Object which can be used to act after an image is loaded or loading fails\r\n */\nfunction loadImageFromImageLoader(imageId, options) {\n  var colonIndex = imageId.indexOf(':');\n  var scheme = imageId.substring(0, colonIndex);\n  var loader = imageLoaders[scheme];\n\n  if (loader === undefined || loader === null) {\n    if (unknownImageLoader !== undefined) {\n      return unknownImageLoader(imageId);\n    }\n\n    throw new Error('loadImageFromImageLoader: no image loader for imageId');\n  }\n\n  var imageLoadObject = loader(imageId, options);\n\n  // Broadcast an image loaded event once the image is loaded\n  imageLoadObject.promise.then(function (image) {\n    (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimageloaded', { image: image });\n  }, function (error) {\n    var errorObject = {\n      imageId: imageId,\n      error: error\n    };\n\n    (0, _triggerEvent2.default)(_events2.default, 'cornerstoneimageloadfailed', errorObject);\n  });\n\n  return imageLoadObject;\n}\n\n/**\r\n * Loads an image given an imageId and optional priority and returns a promise which will resolve to\r\n * the loaded image object or fail if an error occurred.  The loaded image is not stored in the cache.\r\n *\r\n * @param {String} imageId A Cornerstone Image Object's imageId\r\n * @param {Object} [options] Options to be passed to the Image Loader\r\n *\r\n * @returns {ImageLoadObject} An Object which can be used to act after an image is loaded or loading fails\r\n */\nfunction loadImage(imageId, options) {\n  if (imageId === undefined) {\n    throw new Error('loadImage: parameter imageId must not be undefined');\n  }\n\n  var imageLoadObject = (0, _imageCache.getImageLoadObject)(imageId);\n\n  if (imageLoadObject !== undefined) {\n    return imageLoadObject.promise;\n  }\n\n  return loadImageFromImageLoader(imageId, options).promise;\n}\n\n//\n\n/**\r\n * Loads an image given an imageId and optional priority and returns a promise which will resolve to\r\n * the loaded image object or fail if an error occurred. The image is stored in the cache.\r\n *\r\n * @param {String} imageId A Cornerstone Image Object's imageId\r\n * @param {Object} [options] Options to be passed to the Image Loader\r\n *\r\n * @returns {Object} Image Loader Object (TODO: define a JSDoc type for this)\r\n */\nfunction loadAndCacheImage(imageId, options) {\n  if (imageId === undefined) {\n    throw new Error('loadAndCacheImage: parameter imageId must not be undefined');\n  }\n\n  var imageLoadObject = (0, _imageCache.getImageLoadObject)(imageId);\n\n  if (imageLoadObject !== undefined) {\n    return imageLoadObject.promise;\n  }\n\n  imageLoadObject = loadImageFromImageLoader(imageId, options);\n\n  (0, _imageCache.putImageLoadObject)(imageId, imageLoadObject);\n\n  return imageLoadObject.promise;\n}\n\n/**\r\n * Registers an imageLoader plugin with cornerstone for the specified scheme\r\n *\r\n * @param {String} scheme The scheme to use for this image loader (e.g. 'dicomweb', 'wadouri', 'http')\r\n * @param {Function} imageLoader A Cornerstone Image Loader function\r\n * @returns {void}\r\n */\nfunction registerImageLoader(scheme, imageLoader) {\n  imageLoaders[scheme] = imageLoader;\n}\n\n/**\r\n * Registers a new unknownImageLoader and returns the previous one\r\n *\r\n * @param {Function} imageLoader A Cornerstone Image Loader\r\n *\r\n * @returns {Function|Undefined} The previous Unknown Image Loader\r\n */\nfunction registerUnknownImageLoader(imageLoader) {\n  var oldImageLoader = unknownImageLoader;\n\n  unknownImageLoader = imageLoader;\n\n  return oldImageLoader;\n}\n\n/***/ }),\n/* 72 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  enabledElement.invalid = true;\n  enabledElement.needsRedraw = true;\n  var eventData = {\n    element: element\n  };\n\n  (0, _triggerEvent2.default)(element, 'cornerstoneinvalidated', eventData);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _triggerEvent = __webpack_require__(2);\n\nvar _triggerEvent2 = _interopRequireDefault(_triggerEvent);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 73 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageId) {\n\n  var enabledElements = (0, _enabledElements.getEnabledElementsByImageId)(imageId);\n\n  enabledElements.forEach(function (enabledElement) {\n    (0, _drawImage2.default)(enabledElement, true);\n  });\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _drawImage = __webpack_require__(5);\n\nvar _drawImage2 = _interopRequireDefault(_drawImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 74 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, pageX, pageY) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  if (enabledElement.image === undefined) {\n    throw new Error('image has not been loaded yet');\n  }\n\n  // Convert the pageX and pageY to the canvas client coordinates\n  var rect = element.getBoundingClientRect();\n  var clientX = pageX - rect.left - window.pageXOffset;\n  var clientY = pageY - rect.top - window.pageYOffset;\n\n  var pt = { x: clientX,\n    y: clientY };\n  var transform = (0, _getTransform2.default)(enabledElement);\n\n  transform.invert();\n\n  return transform.transformPoint(pt.x, pt.y);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getTransform = __webpack_require__(9);\n\nvar _getTransform2 = _interopRequireDefault(_getTransform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 75 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, pt) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n  var transform = (0, _getTransform2.default)(enabledElement);\n\n  return transform.transformPoint(pt.x, pt.y);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getTransform = __webpack_require__(9);\n\nvar _getTransform2 = _interopRequireDefault(_getTransform);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 76 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  enabledElement.viewport = (0, _getDefaultViewport2.default)(enabledElement.canvas, enabledElement.image);\n  (0, _updateImage2.default)(element);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _getDefaultViewport = __webpack_require__(6);\n\nvar _getDefaultViewport2 = _interopRequireDefault(_getDefaultViewport);\n\nvar _updateImage = __webpack_require__(4);\n\nvar _updateImage2 = _interopRequireDefault(_updateImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 77 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, viewport) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  enabledElement.viewport.translation.x = viewport.translation.x;\n  enabledElement.viewport.translation.y = viewport.translation.y;\n  enabledElement.viewport.voi.windowCenter = viewport.voi.windowCenter;\n  enabledElement.viewport.invert = viewport.invert;\n  enabledElement.viewport.pixelReplication = viewport.pixelReplication;\n  enabledElement.viewport.rotation = viewport.rotation;\n  enabledElement.viewport.hflip = viewport.hflip;\n  enabledElement.viewport.vflip = viewport.vflip;\n  enabledElement.viewport.modalityLUT = viewport.modalityLUT;\n  enabledElement.viewport.voiLUT = viewport.voiLUT;\n  enabledElement.viewport.colormap = viewport.colormap;\n  enabledElement.viewport.labelmap = viewport.labelmap;\n\n  // Prevent window width from being too small (note that values close to zero are valid and can occur with\n  // PET images in particular)\n  enabledElement.viewport.voi.windowWidth = Math.max(viewport.voi.windowWidth, MIN_WINDOW_WIDTH);\n\n  // Prevent scale from getting too small\n  enabledElement.viewport.scale = Math.max(viewport.scale, MIN_VIEWPORT_SCALE);\n\n  // Normalize the rotation value to a positive rotation in degrees\n  enabledElement.viewport.rotation %= 360;\n  if (enabledElement.viewport.rotation < 0) {\n    enabledElement.viewport.rotation += 360;\n  }\n\n  // Force the image to be updated since the viewport has been modified\n  (0, _updateImage2.default)(element);\n};\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _updateImage = __webpack_require__(4);\n\nvar _updateImage2 = _interopRequireDefault(_updateImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar MIN_WINDOW_WIDTH = 0.000001;\nvar MIN_VIEWPORT_SCALE = 0.0001;\n\n/**\n * Sets the viewport for an element and corrects invalid values\n *\n * @param {HTMLElement} element - DOM element of the enabled element\n * @param {Viewport} viewport - Object containing the viewport properties\n * @returns {void}\n */\n\n/***/ }),\n/* 78 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _renderColorImage = __webpack_require__(8);\n\nvar _renderGrayscaleImage = __webpack_require__(15);\n\nvar _renderWebImage = __webpack_require__(38);\n\nexports.default = {\n  colorImage: _renderColorImage.renderColorImage,\n  grayscaleImage: _renderGrayscaleImage.renderGrayscaleImage,\n  webImage: _renderWebImage.renderWebImage\n};\n\n/***/ }),\n/* 79 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addProvider = addProvider;\nexports.removeProvider = removeProvider;\n// This module defines a way to access various metadata about an imageId.  This layer of abstraction exists\n// So metadata can be provided in different ways (e.g. by parsing DICOM P10 or by a WADO-RS document)\n\nvar providers = [];\n\n/**\n * Adds a metadata provider with the specified priority\n * @param {Function} provider Metadata provider function\n * @param {Number} [priority=0] - 0 is default/normal, > 0 is high, < 0 is low\n *\n * @returns {void}\n */\nfunction addProvider(provider) {\n  var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  var i = void 0;\n\n  // Find the right spot to insert this provider based on priority\n  for (i = 0; i < providers.length; i++) {\n    if (providers[i].priority <= priority) {\n      break;\n    }\n  }\n\n  // Insert the decode task at position i\n  providers.splice(i, 0, {\n    priority: priority,\n    provider: provider\n  });\n}\n\n/**\n * Removes the specified provider\n *\n * @param {Function} provider Metadata provider function\n *\n * @returns {void}\n */\nfunction removeProvider(provider) {\n  for (var i = 0; i < providers.length; i++) {\n    if (providers[i].provider === provider) {\n      providers.splice(i, 1);\n\n      break;\n    }\n  }\n}\n\n/**\n * Gets metadata from the registered metadata providers.  Will call each one from highest priority to lowest\n * until one responds\n *\n * @param {String} type The type of metadata requested from the metadata store\n * @param {String} imageId The Cornerstone Image Object's imageId\n *\n * @returns {*} The metadata retrieved from the metadata store\n */\nfunction getMetaData(type, imageId) {\n  // Invoke each provider in priority order until one returns something\n  for (var i = 0; i < providers.length; i++) {\n    var result = providers[i].provider(type, imageId);\n\n    if (result !== undefined) {\n      return result;\n    }\n  }\n}\n\nexports.default = {\n  addProvider: addProvider,\n  removeProvider: removeProvider,\n  get: getMetaData\n};\n\n/***/ }),\n/* 80 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.restoreImage = exports.convertToFalseColorImage = exports.convertImageToFalseColorImage = undefined;\n\nvar _enabledElements = __webpack_require__(0);\n\nvar _pixelDataToFalseColorData = __webpack_require__(43);\n\nvar _pixelDataToFalseColorData2 = _interopRequireDefault(_pixelDataToFalseColorData);\n\nvar _colormap = __webpack_require__(31);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Retrieves the minimum and maximum pixel values from an Array of pixel data\n *\n * @param {Array} pixelData The input pixel data array\n *\n * @returns {{minPixelValue: Number, maxPixelValue: Number}} The minimum and maximum pixel values in the input Array\n */\nfunction getPixelValues(pixelData) {\n  var minPixelValue = Number.MAX_VALUE;\n  var maxPixelValue = Number.MIN_VALUE;\n  var len = pixelData.length;\n  var pixel = void 0;\n\n  for (var i = 0; i < len; i++) {\n    pixel = pixelData[i];\n    minPixelValue = minPixelValue < pixel ? minPixelValue : pixel;\n    maxPixelValue = maxPixelValue > pixel ? maxPixelValue : pixel;\n  }\n\n  return {\n    minPixelValue: minPixelValue,\n    maxPixelValue: maxPixelValue\n  };\n}\n\n/**\n * Retrieve a function that will allow an image object to be reset to its original form\n * after a false color mapping transformation\n *\n * @param {Image} image A Cornerstone Image Object\n *\n * @return {Function} A function for resetting an Image Object to its original form\n */\nfunction getRestoreImageMethod(image) {\n  if (image.restore) {\n    return image.restore;\n  }\n\n  var color = image.color;\n  var rgba = image.rgba;\n  var cachedLut = image.cachedLut;\n  var slope = image.slope;\n  var windowWidth = image.windowWidth;\n  var windowCenter = image.windowCenter;\n  var minPixelValue = image.minPixelValue;\n  var maxPixelValue = image.maxPixelValue;\n\n  return function () {\n    image.color = color;\n    image.rgba = rgba;\n    image.cachedLut = cachedLut;\n    image.slope = slope;\n    image.windowWidth = windowWidth;\n    image.windowCenter = windowCenter;\n    image.minPixelValue = minPixelValue;\n    image.maxPixelValue = maxPixelValue;\n\n    if (image.origPixelData) {\n      var pixelData = image.origPixelData;\n\n      image.getPixelData = function () {\n        return pixelData;\n      };\n    }\n\n    // Remove some attributes added by false color mapping\n    image.origPixelData = undefined;\n    image.colormapId = undefined;\n    image.falseColor = undefined;\n  };\n}\n\n//\n// Then we need to make sure it will be converted into a colormap object if it's as string.\n\n/**\n * User can pass a colormap or its id as string to some of these public functions.\n * Then we need to make sure it will be converted into a colormap object if it's a string.\n *\n * @param {*} colormap A colormap ID or Object\n * @return {*} The colormap\n */\nfunction ensuresColormap(colormap) {\n  if (colormap && typeof colormap === 'string') {\n    colormap = (0, _colormap.getColormap)(colormap);\n  }\n\n  return colormap;\n}\n\n/**\n * Restores a false color image to its original version\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Boolean} True if the image object had a valid restore function, which was run. Otherwise, false.\n */\nfunction restoreImage(image) {\n  if (image.restore && typeof image.restore === 'function') {\n    image.restore();\n\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Convert an image to a false color image\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {String|Object} colormap - it can be a colormap object or a colormap id (string)\n *\n * @returns {Boolean} - Whether or not the image has been converted to a false color image\n */\nfunction convertImageToFalseColorImage(image, colormap) {\n  if (image.color && !image.falseColor) {\n    throw new Error('Color transforms are not implemented yet');\n  }\n\n  // User can pass a colormap id or a colormap object\n  colormap = ensuresColormap(colormap);\n\n  var colormapId = colormap.getId();\n\n  // Doesn't do anything if colormapId hasn't changed\n  if (image.colormapId === colormapId) {\n    // It has already being converted into a false color image\n    // Using the colormapId passed as parameter\n    return false;\n  }\n\n  // Restore the image attributes updated when converting to a false color image\n  restoreImage(image);\n\n  // Convert the image to a false color image\n  if (colormapId) {\n    var minPixelValue = image.minPixelValue || 0;\n    var maxPixelValue = image.maxPixelValue || 255;\n\n    image.restore = getRestoreImageMethod(image);\n\n    var lookupTable = colormap.createLookupTable();\n\n    lookupTable.setTableRange(minPixelValue, maxPixelValue);\n\n    // Update the pixel data and render the new image\n    (0, _pixelDataToFalseColorData2.default)(image, lookupTable);\n\n    // Update min and max pixel values\n    var pixelValues = getPixelValues(image.getPixelData());\n\n    image.minPixelValue = pixelValues.minPixelValue;\n    image.maxPixelValue = pixelValues.maxPixelValue;\n\n    image.windowWidth = 255;\n    image.windowCenter = 128;\n\n    // Cache the last colormapId used for performance\n    // Then it doesn't need to be re-rendered on next\n    // Time if the user hasn't updated it\n    image.colormapId = colormapId;\n  }\n\n  // Return `true` to tell the caller that the image has got updated\n  return true;\n}\n\n/**\n * Convert the image of a element to a false color image\n *\n * @param {HTMLElement} element The Cornerstone element\n * @param {*} colormap - it can be a colormap object or a colormap id (string)\n *\n * @returns {void}\n */\nfunction convertToFalseColorImage(element, colormap) {\n  var enabledElement = (0, _enabledElements.getEnabledElement)(element);\n\n  return convertImageToFalseColorImage(enabledElement.image, colormap);\n}\n\nexports.convertImageToFalseColorImage = convertImageToFalseColorImage;\nexports.convertToFalseColorImage = convertToFalseColorImage;\nexports.restoreImage = restoreImage;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// cornerstone.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 44);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 76fd0302f31f151c9ae9","const enabledElements = [];\n\n/**\n * A two-dimensional vector\n *\n * @typedef {Object} vec2\n * @param {Number} x - The x distance\n * @param {Number} y - The y distance\n */\n\n/**\n * VOI\n *\n * @typedef {Object} VOI\n * @param {Number} windowWidth - Window Width for display\n * @param {Number} windowCenter - Window Center for display\n */\n\n/**\n * Lookup Table Array\n *\n * @typedef {Object} LUT\n * @property {Number} firstValueMapped\n * @property {Number} numBitsPerEntry\n * @property {Array} lut\n */\n\n/**\n * Image Statistics Object\n *\n * @typedef {Object} ImageStats\n *\n * @property {Number} [lastGetPixelDataTime] The time in ms taken to retrieve stored pixels required to draw the image\n * @property {Number} [lastStoredPixelDataToCanvasImageDataTime] The time in ms taken to map from stored pixel array to canvas pixel array\n * @property {Number} [lastPutImageDataTime] The time in ms taken for putImageData to put the canvas pixel data into the canvas context\n * @property {Number} [lastRenderTime] The total time in ms taken for the entire rendering function to run\n * @property {Number} [lastLutGenerateTime] The time in ms taken to generate the lookup table for the image\n */\n\n/**\n * An Image Object in Cornerstone\n *\n * @typedef {Object} Image\n *\n * @property {string} imageId - The imageId associated with this image object\n * @property {Number} minPixelValue - the minimum stored pixel value in the image\n * @property {Number} maxPixelValue - the maximum stored pixel value in the image\n * @property {Number} slope - the rescale slope to convert stored pixel values to modality pixel values or 1 if not specified\n * @property {Number} intercept - the rescale intercept used to convert stored pixel values to modality values or 0 if not specified\n * @property {Number} windowCenter - the default windowCenter to apply to the image\n * @property {Number} windowWidth - the default windowWidth to apply to the image\n * @property {function} getPixelData - a function that returns the underlying pixel data. An array of integers for grayscale and an array of RGBA for color\n * @property {function} getImageData - a function that returns a canvas imageData object for the image. This is only needed for color images\n * @property {function} getCanvas - a function that returns a canvas element with the image loaded into it. This is only needed for color images.\n * @property {function} getImage - a function that returns a JavaScript Image object with the image data. This is optional and typically used for images encoded in standard web JPEG and PNG formats\n * @property {Number} rows - number of rows in the image. This is the same as height but duplicated for convenience\n * @property {Number} columns - number of columns in the image. This is the same as width but duplicated for convenience\n * @property {Number} height - the height of the image. This is the same as rows but duplicated for convenience\n * @property {Number} width - the width of the image. This is the same as columns but duplicated for convenience\n * @property {Boolean} color - true if pixel data is RGB, false if grayscale\n * @property {Object} lut - The Lookup Table\n * @property {Boolean} rgba - Is the color pixel data stored in RGBA?\n * @property {Number} columnPixelSpacing - horizontal distance between the middle of each pixel (or width of each pixel) in mm or undefined if not known\n * @property {Number} rowPixelSpacing - vertical distance between the middle of each pixel (or heigh of each pixel) in mm or undefined if not known\n * @property {Boolean} invert - true if the the image should initially be displayed be inverted, false if not. This is here mainly to support DICOM images with a photometric interpretation of MONOCHROME1\n * @property {Number} sizeInBytes - the number of bytes used to store the pixels for this image.\n * @property {Boolean} [falseColor=false] - Whether or not the image has undergone false color mapping\n * @property {Array} [origPixelData] - Original pixel data for an image after it has undergone false color mapping\n * @property {ImageStats} [stats] - Statistics for the last redraw of the image\n * @property {Object} cachedLut - Cached Lookup Table for this image.\n * @property {String|Colormap} [colormap] - an optional colormap ID or colormap object (from colors/colormap.js). This will be applied during rendering to convert the image to pseudocolor\n * @property {Boolean} [labelmap=false] - whether or not to render this image as a label map (i.e. skip modality and VOI LUT pipelines and use only a color lookup table)\n */\n\n/**\n * A Viewport Settings Object Cornerstone\n *\n * @typedef {Object} Viewport\n *\n * @property {Number} [scale=1.0] - The scale applied to the image. A scale of 1.0 will display no zoom (one image pixel takes up one screen pixel). A scale of 2.0 will be double zoom and a scale of .5 will be zoomed out by 2x\n * @param {vec2} [translation] - An object with properties x and y which describe the translation to apply in the pixel coordinate system. Note that the image is initially displayed centered in the enabled element with a x and y translation of 0 and 0 respectively.\n * @param {VOI} [voi] - an object with properties windowWidth and windowCenter.\n * @property {boolean} [invert=false] - Whether or not the image is inverted.\n * @property {boolean} [pixelReplication=false] - true if the image smooth / interpolation should be used when zoomed in on the image or false if pixel replication should be used.\n * @property {boolean} [hflip=false] - true if the image is flipped horizontally. Default is false\n * @property {boolean} [vflip=false] - true if the image is flipped vertically. Default is false\n * @property {Number} [rotation=0] - the rotation of the image (90 degree increments). Default is 0\n * @property {LUT} [modalityLUT] - the modality LUT to apply or undefined if none\n * @property {LUT} [voiLUT] - the modality LUT to apply or undefined if none\n * @property {String|Colormap} [colormap] - an optional colormap ID or colormap object (from colors/colormap.js). This will be applied during rendering to convert the image to pseudocolor\n * @property {Boolean} [labelmap=false] - whether or not to render this image as a label map (i.e. skip modality and VOI LUT pipelines and use only a color lookup table)\n */\n\n/**\n * An Enabled Element in Cornerstone\n *\n * @typedef {Object} EnabledElement\n *\n * @property {HTMLElement} element - The DOM element which has been enabled for use by Cornerstone\n * @property {Image} [image] - The image currently displayed in the enabledElement\n * @property {Viewport} [viewport] - The current viewport settings of the enabledElement\n * @property {HTMLCanvasElement} [canvas] - The current canvas for this enabledElement\n * @property {Boolean} invalid - Whether or not the image pixel data underlying the enabledElement has been changed, necessitating a redraw\n * @property {Boolean} needsRedraw - A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid\n * @property {EnabledElementLayer[]} [layers] - The layers that have been added to the enabledElement\n * @property {Boolean} [syncViewports] - Whether or not to synchronize the viewport parameters\n * for each of the enabled element's layers\n * @property {Boolean} [lastSyncViewportsState] - The previous state for the sync viewport boolean\n */\n\n/**\n * An Enabled Element Layer in Cornerstone\n *\n * @typedef {Object} EnabledElementLayer\n *\n * @property {HTMLElement} element - The DOM element which has been enabled for use by Cornerstone\n * @property {Image} [image] - The image currently displayed in the enabledElement\n * @property {Viewport} [viewport] - The current viewport settings of the enabledElement\n * @property {HTMLCanvasElement} [canvas] - The current canvas for this enabledElement\n * @property {Object} [options] - Layer drawing options\n * @property {Boolean} invalid - Whether or not the image pixel data underlying the enabledElement has been changed, necessitating a redraw\n * @property {Boolean} needsRedraw - A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid\n */\n\n/**\n * An Image Load Object\n *\n * @typedef {Object} ImageLoadObject\n *\n * @property {Promise} promise - The Promise tracking the loading of this image\n * @property {Function|undefined} cancelFn - A function to cancel the image load request\n */\n\n/**\n * Retrieves a Cornerstone Enabled Element object\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n *\n * @returns {EnabledElement} A Cornerstone Enabled Element\n */\nexport function getEnabledElement (element) {\n  if (element === undefined) {\n    throw new Error('getEnabledElement: parameter element must not be undefined');\n  }\n  for (let i = 0; i < enabledElements.length; i++) {\n    if (enabledElements[i].element === element) {\n      return enabledElements[i];\n    }\n  }\n\n  throw new Error('element not enabled');\n}\n\n/**\n * Adds a Cornerstone Enabled Element object to the central store of enabledElements\n *\n * @param {EnabledElement} enabledElement A Cornerstone enabledElement Object\n * @returns {void}\n */\nexport function addEnabledElement (enabledElement) {\n  if (enabledElement === undefined) {\n    throw new Error('getEnabledElement: enabledElement element must not be undefined');\n  }\n\n  enabledElements.push(enabledElement);\n}\n\n/**\n * Adds a Cornerstone Enabled Element object to the central store of enabledElements\n *\n * @param {string} imageId A Cornerstone Image ID\n * @returns {EnabledElement[]} An Array of Cornerstone enabledElement Objects\n */\nexport function getEnabledElementsByImageId (imageId) {\n  const ees = [];\n\n  enabledElements.forEach(function (enabledElement) {\n    if (enabledElement.image && enabledElement.image.imageId === imageId) {\n      ees.push(enabledElement);\n    }\n  });\n\n  return ees;\n}\n\n/**\n * Retrieve all of the currently enabled Cornerstone elements\n *\n * @return {EnabledElement[]} An Array of Cornerstone enabledElement Objects\n */\nexport function getEnabledElements () {\n  return enabledElements;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./enabledElements.js","/**\n * Use the performance.now() method if possible, and if not, use Date.now()\n *\n * @return {number} Time elapsed since the time origin\n */\nexport default function () {\n  if (window.performance) {\n    return performance.now();\n  }\n\n  return Date.now();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/now.js","/**\n * Trigger a CustomEvent\n *\n * @param {EventTarget} el The element or EventTarget to trigger the event upon\n * @param {String} type The event type name\n * @param {Object|null} detail=null The event data to be sent\n * @returns {Boolean} The return value is false if at least one event listener called preventDefault(). Otherwise it returns true.\n */\nexport default function triggerEvent (el, type, detail = null) {\n  let event;\n\n  // This check is needed to polyfill CustomEvent on IE11-\n  if (typeof window.CustomEvent === 'function') {\n    event = new CustomEvent(type, {\n      detail,\n      cancelable: true\n    });\n  } else {\n    event = document.createEvent('CustomEvent');\n    event.initCustomEvent(type, true, true, detail);\n  }\n\n  return el.dispatchEvent(event);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./triggerEvent.js","/**\n * This module contains a function that will set the canvas context to the pixel coordinates system\n * making it easy to draw geometry on the image\n */\n\nimport calculateTransform from './internal/calculateTransform.js';\n\n/**\n * Sets the canvas context transformation matrix to the pixel coordinate system.  This allows\n * geometry to be driven using the canvas context using coordinates in the pixel coordinate system\n * @param {EnabledElement} enabledElement The\n * @param {CanvasRenderingContext2D} context The CanvasRenderingContext2D for the enabledElement's Canvas\n * @param {Number} [scale] Optional scale to apply\n * @returns {void}\n */\nexport default function (enabledElement, context, scale) {\n  if (enabledElement === undefined) {\n    throw new Error('setToPixelCoordinateSystem: parameter enabledElement must not be undefined');\n  }\n  if (context === undefined) {\n    throw new Error('setToPixelCoordinateSystem: parameter context must not be undefined');\n  }\n\n  const transform = calculateTransform(enabledElement, scale);\n\n  context.setTransform(transform.m[0], transform.m[1], transform.m[2], transform.m[3], transform.m[4], transform.m[5]);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./setToPixelCoordinateSystem.js","import { getEnabledElement } from './enabledElements.js';\nimport drawImage from './internal/drawImage.js';\n\n/**\n * Forces the image to be updated/redrawn for the specified enabled element\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {Boolean} [invalidated=false] Whether or not the image pixel data has been changed, necessitating a redraw\n *\n * @returns {void}\n */\nexport default function (element, invalidated = false) {\n  const enabledElement = getEnabledElement(element);\n\n  if (enabledElement.image === undefined && !enabledElement.layers.length) {\n    throw new Error('updateImage: image has not been loaded yet');\n  }\n\n  drawImage(enabledElement, invalidated);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./updateImage.js","/**\n * Internal API function to draw an image to a given enabled element\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} [invalidated] - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport default function (enabledElement, invalidated = false) {\n  enabledElement.needsRedraw = true;\n  if (invalidated) {\n    enabledElement.invalid = true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/drawImage.js","/**\n * Creates a new viewport object containing default values for the image and canvas\n *\n * @param {HTMLElement} canvas A Canvas DOM element\n * @param {Image} image A Cornerstone Image Object\n * @returns {Viewport} viewport object\n */\nexport default function (canvas, image) {\n  if (canvas === undefined) {\n    throw new Error('getDefaultViewport: parameter canvas must not be undefined');\n  }\n\n  if (image === undefined) {\n    return {\n      scale: 1,\n      translation: {\n        x: 0,\n        y: 0\n      },\n      voi: {\n        windowWidth: undefined,\n        windowCenter: undefined\n      },\n      invert: false,\n      pixelReplication: false,\n      rotation: 0,\n      hflip: false,\n      vflip: false,\n      modalityLUT: undefined,\n      voiLUT: undefined,\n      colormap: undefined,\n      labelmap: false,\n      displayedArea : {\n        tlhc : {\n          x : 1,\n          y : 1\n        },\n        brhc : {\n          x : 1,\n          y : 1\n        },\n        rowPixelSpacing : 1,\n        columnPixelSpacing : 1,\n        presentationSizeMode : 'SCALE TO FIT'\n      }\n    };\n  }\n\n  // Fit image to window\n  const verticalScale = canvas.height / image.rows;\n  const horizontalScale = canvas.width / image.columns;\n  const scale = Math.min(horizontalScale, verticalScale);\n\n  return {\n    scale,\n    translation: {\n      x: 0,\n      y: 0\n    },\n    voi: {\n      windowWidth: image.windowWidth,\n      windowCenter: image.windowCenter\n    },\n    invert: image.invert,\n    pixelReplication: false,\n    rotation: 0,\n    hflip: false,\n    vflip: false,\n    modalityLUT: image.modalityLUT,\n    voiLUT: image.voiLUT,\n    colormap: image.colormap,\n    labelmap: Boolean(image.labelmap),\n    displayedArea : {\n      tlhc : {\n        x : 1,\n        y : 1\n      },\n      brhc : {\n        x : image.columns + 1,\n        y : image.rows + 1\n      },\n      rowPixelSpacing : image.rowPixelSpacing !== undefined ? image.rowPixelSpacing : 1,\n      columnPixelSpacing : image.columnPixelSpacing !== undefined ? image.columnPixelSpacing : 1,\n      presentationSizeMode : 'SCALE TO FIT'\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/getDefaultViewport.js","import { getColormap, getColormapsList } from './colormap.js';\nimport LookupTable from './lookupTable.js';\n\nexport default {\n  getColormap,\n  getColormapsList,\n  LookupTable\n};\n\n\n\n// WEBPACK FOOTER //\n// ./colors/index.js","/**\n * This module is responsible for drawing an image to an enabled elements canvas element\n */\nimport now from '../internal/now.js';\nimport generateColorLut from '../internal/generateColorLut.js';\nimport storedColorPixelDataToCanvasImageData from '../internal/storedColorPixelDataToCanvasImageData.js';\nimport storedRGBAPixelDataToCanvasImageData from '../internal/storedRGBAPixelDataToCanvasImageData.js';\nimport setToPixelCoordinateSystem from '../setToPixelCoordinateSystem.js';\nimport webGL from '../webgl/index.js';\nimport doesImageNeedToBeRendered from './doesImageNeedToBeRendered.js';\nimport initializeRenderCanvas from './initializeRenderCanvas.js';\nimport saveLastRendered from './saveLastRendered.js';\n\nfunction getLut (image, viewport) {\n  // If we have a cached lut and it has the right values, return it immediately\n  if (image.cachedLut !== undefined &&\n        image.cachedLut.windowCenter === viewport.voi.windowCenter &&\n        image.cachedLut.windowWidth === viewport.voi.windowWidth &&\n        image.cachedLut.invert === viewport.invert) {\n    return image.cachedLut.lutArray;\n  }\n\n  // Lut is invalid or not present, regenerate it and cache it\n  generateColorLut(image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert);\n  image.cachedLut.windowWidth = viewport.voi.windowWidth;\n  image.cachedLut.windowCenter = viewport.voi.windowCenter;\n  image.cachedLut.invert = viewport.invert;\n\n  return image.cachedLut.lutArray;\n}\n\nfunction getRenderCanvas (enabledElement, image, invalidated) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  const renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // The ww/wc is identity and not inverted - get a canvas with the image rendered into it for\n  // Fast drawing\n  if (enabledElement.viewport.voi.windowWidth === 255 &&\n        enabledElement.viewport.voi.windowCenter === 128 &&\n        enabledElement.viewport.invert === false &&\n        image.getCanvas &&\n        image.getCanvas()\n  ) {\n    return image.getCanvas();\n  }\n\n  // Apply the lut to the stored pixel data onto the render canvas\n  if (doesImageNeedToBeRendered(enabledElement, image) === false && invalidated !== true) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    initializeRenderCanvas(enabledElement, image);\n  }\n\n  // Get the lut to use\n  let start = now();\n  const colorLut = getLut(image, enabledElement.viewport);\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = now() - start;\n\n  const renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  const renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  // The color image voi/invert has been modified - apply the lut to the underlying\n  // Pixel data and put it into the renderCanvas\n  if (image.rgba) {\n    storedRGBAPixelDataToCanvasImageData(image, colorLut, renderCanvasData.data);\n  } else {\n    storedColorPixelDataToCanvasImageData(image, colorLut, renderCanvasData.data);\n  }\n\n  start = now();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = now() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to render a color image to an enabled element\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function renderColorImage (enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('renderColorImage: enabledElement parameter must not be undefined');\n  }\n\n  const image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('renderColorImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  setToPixelCoordinateSystem(enabledElement, context);\n\n  let renderCanvas;\n\n  if (enabledElement.options && enabledElement.options.renderer &&\n    enabledElement.options.renderer.toLowerCase() === 'webgl') {\n    // If this enabled element has the option set for WebGL, we should\n    // User it as our renderer.\n    renderCanvas = webGL.renderer.render(enabledElement);\n  } else {\n    // If no options are set we will retrieve the renderCanvas through the\n    // Normal Canvas rendering path\n    renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n  }\n\n  const sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  const sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  const width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  const height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = saveLastRendered(enabledElement);\n}\n\nexport function addColorLayer (layer, invalidated) {\n  if (layer === undefined) {\n    throw new Error('addColorLayer: layer parameter must not be undefined');\n  }\n\n  const image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addColorLayer: image must be loaded before it can be drawn');\n  }\n\n  // All multi-layer images should include the alpha value\n  image.rgba = true;\n  layer.canvas = getRenderCanvas(layer, image, invalidated);\n\n  const context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = saveLastRendered(layer);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/renderColorImage.js","import calculateTransform from './calculateTransform.js';\n\nexport default function (enabledElement) {\n  // For now we will calculate it every time it is requested.\n  // In the future, we may want to cache it in the enabled element to speed things up.\n  return calculateTransform(enabledElement);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/getTransform.js","export default function (enabledElement, image) {\n  const renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // Resize the canvas\n  renderCanvas.width = image.width;\n  renderCanvas.height = image.height;\n\n  const canvasContext = renderCanvas.getContext('2d');\n\n  // NOTE - we need to fill the render canvas with white pixels since we\n  // control the luminance using the alpha channel to improve rendering performance.\n  canvasContext.fillStyle = 'white';\n  canvasContext.fillRect(0, 0, renderCanvas.width, renderCanvas.height);\n\n  const renderCanvasData = canvasContext.getImageData(0, 0, image.width, image.height);\n\n  enabledElement.renderingTools.renderCanvasContext = canvasContext;\n  enabledElement.renderingTools.renderCanvasData = renderCanvasData;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/initializeRenderCanvas.js","export default function (enabledElement) {\n  const imageId = enabledElement.image.imageId;\n  const viewport = enabledElement.viewport;\n\n  enabledElement.renderingTools.lastRenderedImageId = imageId;\n  enabledElement.renderingTools.lastRenderedViewport = {\n    windowCenter: viewport.voi.windowCenter,\n    windowWidth: viewport.voi.windowWidth,\n    invert: viewport.invert,\n    rotation: viewport.rotation,\n    hflip: viewport.hflip,\n    vflip: viewport.vflip,\n    modalityLUT: viewport.modalityLUT,\n    voiLUT: viewport.voiLUT,\n    colormap: viewport.colormap\n  };\n\n  return enabledElement.renderingTools;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/saveLastRendered.js","export default function (enabledElement, image) {\n  const lastRenderedImageId = enabledElement.renderingTools.lastRenderedImageId;\n  const lastRenderedViewport = enabledElement.renderingTools.lastRenderedViewport;\n\n  return (\n    image.imageId !== lastRenderedImageId ||\n    !lastRenderedViewport ||\n    lastRenderedViewport.windowCenter !== enabledElement.viewport.voi.windowCenter ||\n    lastRenderedViewport.windowWidth !== enabledElement.viewport.voi.windowWidth ||\n    lastRenderedViewport.invert !== enabledElement.viewport.invert ||\n    lastRenderedViewport.rotation !== enabledElement.viewport.rotation ||\n    lastRenderedViewport.hflip !== enabledElement.viewport.hflip ||\n    lastRenderedViewport.vflip !== enabledElement.viewport.vflip ||\n    lastRenderedViewport.modalityLUT !== enabledElement.viewport.modalityLUT ||\n    lastRenderedViewport.voiLUT !== enabledElement.viewport.voiLUT ||\n    lastRenderedViewport.colormap !== enabledElement.viewport.colormap\n  );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/doesImageNeedToBeRendered.js","import { render, initRenderer, getRenderCanvas, isWebGLAvailable, isWebGLInitialized } from './renderer.js';\nimport createProgramFromString from './createProgramFromString.js';\nimport textureCache from './textureCache.js';\n\nconst mod = {\n  createProgramFromString,\n  renderer: {\n    render,\n    initRenderer,\n    getRenderCanvas,\n    isWebGLAvailable\n  },\n  textureCache\n};\n\nObject.defineProperty(mod, 'isWebGLInitialized', {\n  enumerable: true,\n  configurable: false,\n  get: () => isWebGLInitialized\n});\n\nexport default mod;\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/index.js","class EventTarget {\n  constructor () {\n    this.listeners = {};\n  }\n\n  addEventListener (type, callback) {\n    if (!(type in this.listeners)) {\n      this.listeners[type] = [];\n    }\n\n    this.listeners[type].push(callback);\n  }\n\n  removeEventListener (type, callback) {\n    if (!(type in this.listeners)) {\n      return;\n    }\n\n    const stack = this.listeners[type];\n\n    for (let i = 0, l = stack.length; i < l; i++) {\n      if (stack[i] === callback) {\n        stack.splice(i, 1);\n\n        return;\n      }\n    }\n  }\n\n  dispatchEvent (event) {\n    if (!(event.type in this.listeners)) {\n      return true;\n    }\n\n    const stack = this.listeners[event.type];\n\n    for (let i = 0, l = stack.length; i < l; i++) {\n      stack[i].call(this, event);\n    }\n\n    return !event.defaultPrevented;\n  }\n}\n\n\nconst events = new EventTarget();\n\nexport default events;\n\n\n\n// WEBPACK FOOTER //\n// ./events.js","import storedPixelDataToCanvasImageData from '../internal/storedPixelDataToCanvasImageData.js';\nimport storedPixelDataToCanvasImageDataRGBA from '../internal/storedPixelDataToCanvasImageDataRGBA.js';\nimport setToPixelCoordinateSystem from '../setToPixelCoordinateSystem.js';\nimport now from '../internal/now.js';\nimport webGL from '../webgl/index.js';\nimport getLut from './getLut.js';\nimport doesImageNeedToBeRendered from './doesImageNeedToBeRendered.js';\nimport initializeRenderCanvas from './initializeRenderCanvas.js';\nimport saveLastRendered from './saveLastRendered.js';\n\nfunction getRenderCanvas (enabledElement, image, invalidated, useAlphaChannel = true) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  const renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  if (doesImageNeedToBeRendered(enabledElement, image) === false && invalidated !== true) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    initializeRenderCanvas(enabledElement, image);\n  }\n\n  // Get the lut to use\n  let start = now();\n  const lut = getLut(image, enabledElement.viewport, invalidated);\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = now() - start;\n\n  const renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  const renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  // Gray scale image - apply the lut and put the resulting image onto the render canvas\n  if (useAlphaChannel) {\n    storedPixelDataToCanvasImageData(image, lut, renderCanvasData.data);\n  } else {\n    storedPixelDataToCanvasImageDataRGBA(image, lut, renderCanvasData.data);\n  }\n\n  start = now();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = now() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to draw a grayscale image to a given enabledElement\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function renderGrayscaleImage (enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('drawImage: enabledElement parameter must not be undefined');\n  }\n\n  const image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('drawImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  setToPixelCoordinateSystem(enabledElement, context);\n\n  let renderCanvas;\n\n  if (enabledElement.options && enabledElement.options.renderer &&\n    enabledElement.options.renderer.toLowerCase() === 'webgl') {\n    // If this enabled element has the option set for WebGL, we should\n    // User it as our renderer.\n    renderCanvas = webGL.renderer.render(enabledElement);\n  } else {\n    // If no options are set we will retrieve the renderCanvas through the\n    // Normal Canvas rendering path\n    renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n  }\n\n  const sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  const sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  const width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  const height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = saveLastRendered(enabledElement);\n}\n\n/**\n * API function to draw a grayscale image to a given layer\n *\n * @param {EnabledElementLayer} layer The layer that the image will be added to\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @param {Boolean} [useAlphaChannel] - Whether or not to render the grayscale image using only the alpha channel.\n                                        This does not work if this layer is not the first layer in the enabledElement.\n * @returns {void}\n */\nexport function addGrayscaleLayer (layer, invalidated, useAlphaChannel = false) {\n  if (layer === undefined) {\n    throw new Error('addGrayscaleLayer: layer parameter must not be undefined');\n  }\n\n  const image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addGrayscaleLayer: image must be loaded before it can be drawn');\n  }\n\n  layer.canvas = getRenderCanvas(layer, image, invalidated, useAlphaChannel);\n\n  const context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = saveLastRendered(layer);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/renderGrayscaleImage.js","import getModalityLUT from './getModalityLUT.js';\r\nimport getVOILUT from './getVOILut.js';\r\nimport autoWindow from './autoWindow.js';\r\n\r\n/**\r\n * Creates a LUT used while rendering to convert stored pixel values to\r\n * display pixels\r\n *\r\n * @param {image} image A Cornerstone Image Object\r\n * @param {viewport} image A Cornerstone Viewport Object\r\n *\r\n * Properties that may be used:\r\n * @param {Number} windowWidth The Window Width\r\n * @param {Number} windowCenter The Window Center\r\n * @param {Boolean} invert A boolean describing whether or not the image has been inverted\r\n * @param {Array} [modalityLUT] A modality Lookup Table\r\n * @param {Array} [voiLUT] A Volume of Interest Lookup Table\r\n *\r\n * @returns {Uint8ClampedArray} A lookup table to apply to the image\r\n */\r\nexport default function (image, viewport) {\r\n  //Auto window\r\n  autoWindow(image, viewport);\r\n\r\n  const modalityLUT = viewport.modalityLUT;\r\n  const voiLUT = viewport.voiLUT;\r\n  const windowWidth = viewport.voi.windowWidth;\r\n  const windowCenter = viewport.voi.windowCenter;\r\n  const invert = viewport.invert || image.photometricInterpretation === 'MONOCHROME1';\r\n\r\n  const maxPixelValue = image.maxPixelValue;\r\n  const minPixelValue = image.minPixelValue;\r\n  const offset = Math.min(minPixelValue, 0);\r\n\r\n  if (image.cachedLut === undefined) {\r\n    const length = maxPixelValue - offset + 1;\r\n\r\n    image.cachedLut = {};\r\n    image.cachedLut.lutArray = new Uint8ClampedArray(length);\r\n  }\r\n\r\n  const lut = image.cachedLut.lutArray;\r\n  const mlutfn = getModalityLUT(image.slope, image.intercept, modalityLUT);\r\n  const vlutfn = getVOILUT(windowWidth, windowCenter, voiLUT);\r\n\r\n  if (invert === true) {\r\n    for (let storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {\r\n      lut[storedValue + (-offset)] = 255 - vlutfn(mlutfn(storedValue));\r\n    }\r\n  } else {\r\n    for (let storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {\r\n      lut[storedValue + (-offset)] = vlutfn(mlutfn(storedValue));\r\n    }\r\n  }\r\n\r\n  return lut;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./internal/generateLut.js","/**\n * Generates a linear modality transformation function\n *\n * See DICOM PS3.3 C.11.1 Modality LUT Module\n *\n * http://dicom.nema.org/medical/Dicom/current/output/chtml/part03/sect_C.11.html\n *\n * @param {Number} slope m in the equation specified by Rescale Intercept (0028,1052).\n * @param {Number} intercept The value b in relationship between stored values (SV) and the output units specified in Rescale Type (0028,1054).\n\n Output units = m*SV + b.\n * @return {function(*): *} A linear modality LUT function. Given a stored pixel it returns the modality pixel value\n */\nfunction generateLinearModalityLUT (slope, intercept) {\n  return (storedPixelValue) => storedPixelValue * slope + intercept;\n}\n\nfunction generateNonLinearModalityLUT (modalityLUT) {\n  const minValue = modalityLUT.lut[0];\n  const maxValue = modalityLUT.lut[modalityLUT.lut.length - 1];\n  const maxValueMapped = modalityLUT.firstValueMapped + modalityLUT.lut.length;\n\n  return (storedPixelValue) => {\n    if (storedPixelValue < modalityLUT.firstValueMapped) {\n      return minValue;\n    } else if (storedPixelValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return modalityLUT.lut[storedPixelValue];\n  };\n}\n\n/**\n * Get the appropriate Modality LUT for the current situation.\n *\n * @param {Number} [slope] m in the equation specified by Rescale Intercept (0028,1052).\n * @param {Number} [intercept] The value b in relationship between stored values (SV) and the output units specified in Rescale Type (0028,1054).\n * @param {Function} [modalityLUT] A modality LUT function. Given a stored pixel it returns the modality pixel value.\n *\n * @return {function(*): *} A modality LUT function. Given a stored pixel it returns the modality pixel value.\n */\nexport default function (slope, intercept, modalityLUT) {\n  if (modalityLUT) {\n    return generateNonLinearModalityLUT(modalityLUT);\n  }\n\n  return generateLinearModalityLUT(slope, intercept);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/getModalityLUT.js","/* eslint no-bitwise: 0 */\n\n/**\n * Volume of Interest Lookup Table Function\n *\n * @typedef {Function} VOILUTFunction\n *\n * @param {Number} modalityLutValue\n * @returns {Number} transformed value\n */\n\n/**\n *\n * @param {Number} windowWidth Window Width\n * @param {Number} windowCenter Window Center\n * @returns {VOILUTFunction} VOI LUT mapping function\n */\nfunction generateLinearVOILUT (windowWidth, windowCenter) {\n  return function (modalityLutValue) {\n    return ((modalityLutValue - windowCenter) / windowWidth + 0.5) * 255.0;\n  };\n}\n\n/**\n * Generate a non-linear volume of interest lookup table\n *\n * @param {LUT} voiLUT Volume of Interest Lookup Table Object\n *\n * @returns {VOILUTFunction} VOI LUT mapping function\n */\nfunction generateNonLinearVOILUT (voiLUT) {\n  // We don't trust the voiLUT.numBitsPerEntry, mainly thanks to Agfa!\n  const bitsPerEntry = Math.max(...voiLUT.lut).toString(2).length;\n  const shift = bitsPerEntry - 8;\n  const minValue = voiLUT.lut[0] >> shift;\n  const maxValue = voiLUT.lut[voiLUT.lut.length - 1] >> shift;\n  const maxValueMapped = voiLUT.firstValueMapped + voiLUT.lut.length - 1;\n\n  return function (modalityLutValue) {\n    if (modalityLutValue < voiLUT.firstValueMapped) {\n      return minValue;\n    } else if (modalityLutValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return voiLUT.lut[modalityLutValue - voiLUT.firstValueMapped] >> shift;\n  };\n}\n\n/**\n * Retrieve a VOI LUT mapping function given the current windowing settings\n * and the VOI LUT for the image\n *\n * @param {Number} windowWidth Window Width\n * @param {Number} windowCenter Window Center\n * @param {LUT} [voiLUT] Volume of Interest Lookup Table Object\n *\n * @return {VOILUTFunction} VOI LUT mapping function\n */\nexport default function (windowWidth, windowCenter, voiLUT) {\n  if (voiLUT) {\n    return generateNonLinearVOILUT(voiLUT);\n  }\n\n  return generateLinearVOILUT(windowWidth, windowCenter);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/getVOILut.js","/**\n * @return {number} Original or shifted value\n */\nexport default function (index, pixelData, shift) {\n  if (shift !== undefined) {\n    return (pixelData[index] << shift >> shift);\n  } else {\n    return pixelData[index];\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/getStoredValue.js","function requestFrame (callback) {\n  window.setTimeout(callback, 1000 / 60);\n}\n\n/**\n * Polyfills requestAnimationFrame for older browsers.\n *\n * @param {Function} callback A parameter specifying a function to call when it's time to update your animation for the next repaint. The callback has one single argument, a DOMHighResTimeStamp, which indicates the current time (the time returned from performance.now() ) for when requestAnimationFrame starts to fire callbacks.\n *\n * @return {Number} A long integer value, the request id, that uniquely identifies the entry in the callback list. This is a non-zero value, but you may not make any other assumptions about its value. You can pass this value to window.cancelAnimationFrame() to cancel the refresh callback request.\n */\nexport default function (callback) {\n  return window.requestAnimationFrame(callback) ||\n    window.webkitRequestAnimationFrame(callback) ||\n    window.mozRequestAnimationFrame(callback) ||\n    window.oRequestAnimationFrame(callback) ||\n    window.msRequestAnimationFrame(callback) ||\n    requestFrame(callback);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/requestAnimationFrame.js","import now from './now.js';\nimport getStoredValue from './getStoredValue.js';\n\n/**\n * This function transforms stored pixel values into a canvas image data buffer\n * by using a LUT.  This is the most performance sensitive code in cornerstone and\n * we use a special trick to make this go as fast as possible.  Specifically we\n * use the alpha channel only to control the luminance rather than the red, green and\n * blue channels which makes it over 3x faster. The canvasImageDataData buffer needs\n * to be previously filled with white pixels.\n *\n * NOTE: Attribution would be appreciated if you use this technique!\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} lut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nexport default function (image, lut, canvasImageDataData) {\n  let start = now();\n  const pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = now() - start;\n  const shouldShift = image.pixelRepresentation !== undefined && image.pixelRepresentation === 1;\n  const shift = (shouldShift && image.bitsStored !== undefined) ? (32 - image.bitsStored) : undefined;\n  const numPixels = pixelData.length;\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 3;\n  let storedPixelDataIndex = 0;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n\n  // Added two paths (Int16Array, Uint16Array) to avoid polymorphic deoptimization in chrome.\n  start = now();\n  if (pixelData instanceof Int16Array) {\n    if (minPixelValue < 0) {\n      while (storedPixelDataIndex < numPixels) {\n        canvasImageDataData[canvasImageDataIndex] = lut[getStoredValue(storedPixelDataIndex++, pixelData, shift) + (-minPixelValue)]; // Alpha\n        canvasImageDataIndex += 4;\n      }\n    } else {\n      while (storedPixelDataIndex < numPixels) {\n        canvasImageDataData[canvasImageDataIndex] = lut[getStoredValue(storedPixelDataIndex++, pixelData, shift)]; // Alpha\n        canvasImageDataIndex += 4;\n      }\n    }\n  } else if (pixelData instanceof Uint16Array) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex] = lut[getStoredValue(storedPixelDataIndex++, pixelData, shift)]; // Alpha\n      canvasImageDataIndex += 4;\n    }\n  } else if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex] = lut[getStoredValue(storedPixelDataIndex++, pixelData, shift) + (-minPixelValue)]; // Alpha\n      canvasImageDataIndex += 4;\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex] = lut[getStoredValue(storedPixelDataIndex++, pixelData, shift)]; // Alpha\n      canvasImageDataIndex += 4;\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = now() - start;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/storedPixelDataToCanvasImageData.js","import now from './now.js';\n\n/**\n * Converts stored color pixel values to display pixel values using a LUT.\n *\n * Note: Skips alpha value for any input image pixel data.\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} lut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nexport default function (image, lut, canvasImageDataData) {\n\n  let start = now();\n  const pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = now() - start;\n\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  const numPixels = pixelData.length;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n  start = now();\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)]; // Green\n      canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex] + (-minPixelValue)]; // Blue\n      storedPixelDataIndex += 2;\n      canvasImageDataIndex += 2;\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Green\n      canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex]]; // Blue\n      storedPixelDataIndex += 2;\n      canvasImageDataIndex += 2;\n    }\n  }\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = now() - start;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/storedColorPixelDataToCanvasImageData.js","import colors from '../colors/index.js';\nimport now from './now.js';\n\n/**\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {LookupTable|Array} colorLut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nfunction storedPixelDataToCanvasImageDataColorLUT (image, colorLut, canvasImageDataData) {\n  let start = now();\n  const pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = now() - start;\n\n  const numPixels = pixelData.length;\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  let rgba;\n  let clut;\n\n  start = now();\n\n  if (colorLut instanceof colors.LookupTable) {\n    clut = colorLut.Table;\n  } else {\n    clut = colorLut;\n  }\n\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      rgba = clut[pixelData[storedPixelDataIndex++] + (-minPixelValue)];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      rgba = clut[pixelData[storedPixelDataIndex++]];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = now() - start;\n}\n\nexport default storedPixelDataToCanvasImageDataColorLUT;\n\n\n\n// WEBPACK FOOTER //\n// ./internal/storedPixelDataToCanvasImageDataColorLUT.js","import colors from '../colors/index.js';\nimport now from './now.js';\n\n/**\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} grayscaleLut Lookup table array\n * @param {LookupTable|Array} colorLut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nfunction storedPixelDataToCanvasImageDataPseudocolorLUT (image, grayscaleLut, colorLut, canvasImageDataData) {\n  let start = now();\n  const pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = now() - start;\n\n  const numPixels = pixelData.length;\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  let grayscale;\n  let rgba;\n  let clut;\n\n  start = now();\n\n  if (colorLut instanceof colors.LookupTable) {\n    clut = colorLut.Table;\n  } else {\n    clut = colorLut;\n  }\n\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      grayscale = grayscaleLut[pixelData[storedPixelDataIndex++] + (-minPixelValue)];\n      rgba = clut[grayscale];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      grayscale = grayscaleLut[pixelData[storedPixelDataIndex++]];\n      rgba = clut[grayscale];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[0];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[1];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[2];\n      canvasImageDataData[canvasImageDataIndex++] = rgba[3];\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = now() - start;\n}\n\nexport default storedPixelDataToCanvasImageDataPseudocolorLUT;\n\n\n\n// WEBPACK FOOTER //\n// ./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js","import { Transform } from './transform.js';\n\n/**\n * Calculate the transform for a Cornerstone enabled element\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element\n * @param {Number} [scale] The viewport scale\n * @return {Transform} The current transform\n */\nexport default function (enabledElement, scale) {\n\n  const transform = new Transform();\n\n  //Move to center of canvas\n  transform.translate(enabledElement.canvas.width / 2, enabledElement.canvas.height / 2);\n\n  // Apply the rotation before scaling for non square pixels\n  const angle = enabledElement.viewport.rotation;\n\n  if (angle !== 0) {\n    transform.rotate(angle * Math.PI / 180);\n  }\n\n  // Apply the scale\n  let widthScale = enabledElement.viewport.scale;\n  let heightScale = enabledElement.viewport.scale;\n\n  if (enabledElement.viewport.displayedArea.rowPixelSpacing < enabledElement.viewport.displayedArea.columnPixelSpacing) {\n    widthScale *= (enabledElement.viewport.displayedArea.columnPixelSpacing / enabledElement.viewport.displayedArea.rowPixelSpacing);\n  } else if (enabledElement.viewport.displayedArea.columnPixelSpacing < enabledElement.viewport.displayedArea.rowPixelSpacing) {\n    heightScale *= (enabledElement.viewport.displayedArea.rowPixelSpacing / enabledElement.viewport.displayedArea.columnPixelSpacing);\n  }\n\n  transform.scale(widthScale, heightScale);\n\n  // Unrotate to so we can translate unrotated\n  if (angle !== 0) {\n    transform.rotate(-angle * Math.PI / 180);\n  }\n\n  // Apply the pan offset\n  transform.translate(enabledElement.viewport.translation.x, enabledElement.viewport.translation.y);\n\n  // Rotate again so we can apply general scale\n  if (angle !== 0) {\n    transform.rotate(angle * Math.PI / 180);\n  }\n\n  if (scale !== undefined) {\n    // Apply the font scale\n    transform.scale(scale, scale);\n  }\n\n  // Apply Flip if required\n  if (enabledElement.viewport.hflip) {\n    transform.scale(-1, 1);\n  }\n\n  if (enabledElement.viewport.vflip) {\n    transform.scale(1, -1);\n  }\n\n  //Move back from center of image\n  const width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  const height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n  transform.translate(-width / 2, -height / 2);\n\n  return transform;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/calculateTransform.js","import setToPixelCoordinateSystem from '../setToPixelCoordinateSystem.js';\nimport now from '../internal/now.js';\nimport initializeRenderCanvas from './initializeRenderCanvas.js';\nimport saveLastRendered from './saveLastRendered.js';\nimport doesImageNeedToBeRendered from './doesImageNeedToBeRendered.js';\nimport storedPixelDataToCanvasImageDataColorLUT from '../internal/storedPixelDataToCanvasImageDataColorLUT.js';\nimport colors from '../colors/index.js';\n\nfunction getRenderCanvas (enabledElement, image, invalidated) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  const renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // TODO: Deprecate enabledElement.options.colormap\n  let colormap = enabledElement.viewport.colormap || enabledElement.options.colormap;\n\n  if (colormap && (typeof colormap === 'string')) {\n    colormap = colors.getColormap(colormap);\n  }\n\n  if (!colormap) {\n    throw new Error('renderLabelMapImage: colormap not found.');\n  }\n\n  const colormapId = colormap.getId();\n\n  if (doesImageNeedToBeRendered(enabledElement, image) === false && invalidated !== true &&\n    enabledElement.renderingTools.colormapId === colormapId) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    initializeRenderCanvas(enabledElement, image);\n  }\n\n  // Get the lut to use\n  let start = now();\n\n  if (!enabledElement.renderingTools.colorLut || invalidated ||\n    enabledElement.renderingTools.colormapId !== colormapId) {\n    enabledElement.renderingTools.colorLut = colormap.createLookupTable();\n    enabledElement.renderingTools.colormapId = colormapId;\n  }\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = now() - start;\n\n  const colorLut = enabledElement.renderingTools.colorLut;\n  const renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  const renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  storedPixelDataToCanvasImageDataColorLUT(image, colorLut, renderCanvasData.data);\n\n  start = now();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = now() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to draw a label map image to a given enabledElement\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function renderLabelMapImage (enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('renderLabelMapImage: enabledElement parameter must not be undefined');\n  }\n\n  const image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('renderLabelMapImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  setToPixelCoordinateSystem(enabledElement, context);\n\n  // If no options are set we will retrieve the renderCanvas through the\n  // Normal Canvas rendering path\n  // TODO: Add WebGL support for label map pipeline\n  const renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n\n  const sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  const sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  const width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  const height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = saveLastRendered(enabledElement);\n}\n\n/**\n * API function to draw a pseudo-color image to a given layer\n *\n * @param {EnabledElementLayer} layer The layer that the image will be added to\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function addLabelMapLayer (layer, invalidated) {\n  if (layer === undefined) {\n    throw new Error('addLabelMapLayer: layer parameter must not be undefined');\n  }\n\n  const image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addLabelMapLayer: image must be loaded before it can be drawn');\n  }\n\n  layer.canvas = getRenderCanvas(layer, image, invalidated);\n\n  const context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = saveLastRendered(layer);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/renderLabelMapImage.js","import setToPixelCoordinateSystem from '../setToPixelCoordinateSystem.js';\nimport now from '../internal/now.js';\nimport initializeRenderCanvas from './initializeRenderCanvas.js';\nimport getLut from './getLut.js';\nimport saveLastRendered from './saveLastRendered.js';\nimport doesImageNeedToBeRendered from './doesImageNeedToBeRendered.js';\nimport storedPixelDataToCanvasImageDataPseudocolorLUT from '../internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js';\nimport colors from '../colors/index.js';\n\nfunction getRenderCanvas (enabledElement, image, invalidated) {\n  if (!enabledElement.renderingTools.renderCanvas) {\n    enabledElement.renderingTools.renderCanvas = document.createElement('canvas');\n  }\n\n  const renderCanvas = enabledElement.renderingTools.renderCanvas;\n\n  // TODO: Deprecate enabledElement.options.colormap\n  let colormap = enabledElement.viewport.colormap || enabledElement.options.colormap;\n\n  if (colormap && (typeof colormap === 'string')) {\n    colormap = colors.getColormap(colormap);\n  }\n\n  if (!colormap) {\n    throw new Error('renderPseudoColorImage: colormap not found.');\n  }\n\n  const colormapId = colormap.getId();\n\n  if (doesImageNeedToBeRendered(enabledElement, image) === false && invalidated !== true &&\n    enabledElement.renderingTools.colormapId === colormapId) {\n    return renderCanvas;\n  }\n\n  // If our render canvas does not match the size of this image reset it\n  // NOTE: This might be inefficient if we are updating multiple images of different\n  // Sizes frequently.\n  if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {\n    initializeRenderCanvas(enabledElement, image);\n  }\n\n  // Get the lut to use\n  let start = now();\n\n  if (!enabledElement.renderingTools.colorLut || invalidated ||\n       enabledElement.renderingTools.colormapId !== colormapId) {\n    colormap.setNumberOfColors(256);\n    enabledElement.renderingTools.colorLut = colormap.createLookupTable();\n    enabledElement.renderingTools.colormapId = colormapId;\n  }\n\n  const lut = getLut(image, enabledElement.viewport, invalidated);\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = now() - start;\n\n  const colorLut = enabledElement.renderingTools.colorLut;\n  const renderCanvasData = enabledElement.renderingTools.renderCanvasData;\n  const renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;\n\n  storedPixelDataToCanvasImageDataPseudocolorLUT(image, lut, colorLut, renderCanvasData.data);\n\n  start = now();\n  renderCanvasContext.putImageData(renderCanvasData, 0, 0);\n  image.stats.lastPutImageDataTime = now() - start;\n\n  return renderCanvas;\n}\n\n/**\n * API function to draw a pseudo-color image to a given enabledElement\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function renderPseudoColorImage (enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('drawImage: enabledElement parameter must not be undefined');\n  }\n\n  const image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('drawImage: image must be loaded before it can be drawn');\n  }\n\n  // Get the canvas context and reset the transform\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  // Save the canvas context state and apply the viewport properties\n  setToPixelCoordinateSystem(enabledElement, context);\n\n\n  // If no options are set we will retrieve the renderCanvas through the\n  // Normal Canvas rendering path\n  // TODO: Add WebGL support for pseudocolor pipeline\n  const renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\n\n  const sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n  const sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n  const width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n  const height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n  context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);\n\n  enabledElement.renderingTools = saveLastRendered(enabledElement);\n}\n\n/**\n * API function to draw a pseudo-color image to a given layer\n *\n * @param {EnabledElementLayer} layer The layer that the image will be added to\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function addPseudoColorLayer (layer, invalidated) {\n  if (layer === undefined) {\n    throw new Error('addPseudoColorLayer: layer parameter must not be undefined');\n  }\n\n  const image = layer.image;\n\n  if (image === undefined) {\n    throw new Error('addPseudoColorLayer: image must be loaded before it can be drawn');\n  }\n\n  layer.canvas = getRenderCanvas(layer, image, invalidated);\n\n  const context = layer.canvas.getContext('2d');\n\n  // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n  context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n  context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n  layer.renderingTools = saveLastRendered(layer);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/renderPseudoColorImage.js","import guid from './internal/guid.js';\nimport { getEnabledElement } from './enabledElements.js';\nimport getDefaultViewport from './internal/getDefaultViewport.js';\nimport updateImage from './updateImage.js';\nimport triggerCustomEvent from './triggerEvent.js';\n\n/**\n * Helper function to trigger an event on a Cornerstone element with\n * a specific layerId\n *\n * @param {String} eventName The event name (e.g. CornerstoneLayerAdded)\n * @param {EnabledElement} enabledElement The Cornerstone enabled element\n * @param {String} layerId The layer's unique identifier\n * @returns {void}\n */\nfunction triggerEvent (eventName, enabledElement, layerId) {\n  const element = enabledElement.element;\n  const eventData = {\n    viewport: enabledElement.viewport,\n    element: enabledElement.element,\n    image: enabledElement.image,\n    enabledElement,\n    layerId\n  };\n\n  triggerCustomEvent(element, eventName, eventData);\n}\n\n/**\n * Rescale the target layer to the base layer based on the\n * relative size of each image and their pixel dimensions.\n *\n * This function will update the Viewport parameters of the\n * target layer to a new scale.\n *\n * @param {EnabledElementLayer} baseLayer The base layer\n * @param {EnabledElementLayer} targetLayer The target layer to rescale\n * @returns {void}\n */\nexport function rescaleImage (baseLayer, targetLayer) {\n  if (baseLayer.layerId === targetLayer.layerId) {\n    throw new Error('rescaleImage: both arguments represent the same layer');\n  }\n\n  const baseImage = baseLayer.image;\n  const targetImage = targetLayer.image;\n\n  // Return if these images don't have an imageId (e.g. for dynamic images)\n  if (!baseImage.imageId || !targetImage.imageId) {\n    return;\n  }\n\n  // Column pixel spacing need to be considered when calculating the\n  // ratio between the layer added and base layer images\n  const colRelative = (targetLayer.viewport.displayedArea.columnPixelSpacing * targetImage.width) /\n                      (baseLayer.viewport.displayedArea.columnPixelSpacing * baseImage.width);\n  const viewportRatio = targetLayer.viewport.scale / baseLayer.viewport.scale * colRelative;\n\n  targetLayer.viewport.scale = baseLayer.viewport.scale * viewportRatio;\n}\n\n/**\n * Add a layer to a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Image} image A Cornerstone Image object to add as a new layer\n * @param {Object} options Options for the layer\n *\n * @returns {String} layerId The new layer's unique identifier\n */\nexport function addLayer (element, image, options) {\n  const layerId = guid();\n  const enabledElement = getEnabledElement(element);\n  const layers = enabledElement.layers;\n  let viewport;\n\n  if (image) {\n    viewport = getDefaultViewport(enabledElement.canvas, image);\n\n    // Override the defaults if any optional viewport settings\n    // have been specified\n    if (options && options.viewport) {\n      viewport = Object.assign(viewport, options.viewport);\n    }\n  }\n\n  // Set syncViewports to true by default when a new layer is added\n  if (enabledElement.syncViewports !== false) {\n    enabledElement.syncViewports = true;\n  }\n\n  const newLayer = {\n    image,\n    layerId,\n    viewport,\n    options: options || {},\n    renderingTools: {}\n  };\n\n  // Rescale the new layer based on the base layer to make sure\n  // they will have a proportional size (pixel spacing)\n  if (layers.length && image) {\n    rescaleImage(layers[0], newLayer);\n  }\n\n  layers.push(newLayer);\n\n  triggerEvent('cornerstonelayeradded', enabledElement, layerId);\n\n  // Set the layer as active if it's the first layer added\n  if (layers.length === 1 && image) {\n    setActiveLayer(element, layerId);\n  }\n\n  return layerId;\n}\n\n/**\n * Remove a layer from a Cornerstone element given a layer ID\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {String} layerId The unique identifier for the layer\n * @returns {void}\n */\nexport function removeLayer (element, layerId) {\n  const enabledElement = getEnabledElement(element);\n  const layers = enabledElement.layers;\n  const index = enabledElement.layers.findIndex((layer) => layer.layerId === layerId);\n\n  if (index !== -1) {\n    layers.splice(index, 1);\n\n    // If the current layer is active, and we have other layers,\n    // switch to the first layer that remains in the array\n    if (layerId === enabledElement.activeLayerId && layers.length) {\n      setActiveLayer(element, layers[0].layerId);\n    }\n\n    triggerEvent('cornerstonelayerremoved', enabledElement, layerId);\n  }\n}\n\n/**\n * Retrieve a layer from a Cornerstone element given a layer ID\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {String} layerId The unique identifier for the layer\n * @return {EnabledElementLayer} The layer\n */\nexport function getLayer (element, layerId) {\n  const enabledElement = getEnabledElement(element);\n\n\n  return enabledElement.layers.find((layer) => layer.layerId === layerId);\n}\n\n/**\n * Retrieve all layers for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n *\n * @return {EnabledElementLayer[]} An array of layers\n */\nexport function getLayers (element) {\n  const enabledElement = getEnabledElement(element);\n\n\n  return enabledElement.layers;\n}\n\n/**\n * Retrieve all visible layers for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n *\n * @return {EnabledElementLayer[]} An array of layers\n */\nexport function getVisibleLayers (element) {\n  const enabledElement = getEnabledElement(element);\n\n  return enabledElement.layers.filter((layer) => layer.options &&\n               layer.options.visible !== false &&\n               layer.options.opacity !== 0);\n}\n\n/**\n * Set the active layer for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {String} layerId The unique identifier for the layer\n * @returns {void}\n */\nexport function setActiveLayer (element, layerId) {\n  const enabledElement = getEnabledElement(element);\n\n  // Stop here if this layer is already active\n  if (enabledElement.activeLayerId === layerId) {\n    return;\n  }\n\n  const index = enabledElement.layers.findIndex((layer) => layer.layerId === layerId);\n\n  if (index === -1) {\n    throw new Error('setActiveLayer: layer not found in layers array');\n  }\n\n  const layer = enabledElement.layers[index];\n\n  if (!layer.image) {\n    throw new Error('setActiveLayer: layer with undefined image cannot be set as active.');\n  }\n\n  enabledElement.activeLayerId = layerId;\n  enabledElement.image = layer.image;\n  enabledElement.viewport = layer.viewport;\n\n  updateImage(element);\n  triggerEvent('cornerstoneactivelayerchanged', enabledElement, layerId);\n}\n\n/**\n * Set a new image for a specific layerId\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Image} image The image to be displayed in this layer\n * @param {String} [layerId] The unique identifier for the layer\n * @returns {void}\n */\nexport function setLayerImage (element, image, layerId) {\n  const enabledElement = getEnabledElement(element);\n  const baseLayer = enabledElement.layers[0];\n\n  let layer;\n\n  if (layerId) {\n    layer = getLayer(element, layerId);\n  } else {\n    layer = getActiveLayer(element);\n  }\n\n  if (!layer) {\n    throw new Error('setLayerImage: Layer not found');\n  }\n\n  layer.image = image;\n\n  if (!image) {\n    layer.viewport = undefined;\n\n    return;\n  }\n\n  if (!layer.viewport) {\n    const defaultViewport = getDefaultViewport(enabledElement.canvas, image);\n\n    // Override the defaults if any optional viewport settings\n    // have been specified\n    if (layer.options && layer.options.viewport) {\n      layer.viewport = Object.assign(defaultViewport, layer.options.viewport);\n    }\n\n    if (baseLayer.layerId !== layerId) {\n      rescaleImage(baseLayer, layer);\n    }\n  }\n}\n\n/**\n * Retrieve the currently active layer for a Cornerstone element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @return {EnabledElementLayer} The currently active layer\n */\nexport function getActiveLayer (element) {\n  const enabledElement = getEnabledElement(element);\n\n\n  return enabledElement.layers.find((layer) => layer.layerId === enabledElement.activeLayerId);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./layers.js","import getMinMax from './getMinMax.js';\nimport getStoredValue from './getStoredValue.js';\n\nfunction hasModalityLUT (viewport) {\n  return viewport.modalityLUT && viewport.modalityLUT.lut && viewport.modalityLUT.lut.length > 0;\n}\n\nfunction hasVoiLUT (viewport) {\n  return viewport.voiLUT && viewport.voiLUT.lut && viewport.voiLUT.lut.length > 0;\n}\n\n/**\n * Calculate the min & max pixel values for an image and setup windows\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Viewport} image A Cornerstone Viewport Object\n */\nexport default function (image, viewport) {\n  if (image.minPixelValue === undefined || image.maxPixelValue === undefined) {\n    const shouldShift = image.pixelRepresentation !== undefined && image.pixelRepresentation === 1;\n    const shift = (shouldShift && image.bitsStored !== undefined) ? (32 - image.bitsStored) : undefined;\n    let minMax;\n\n    if (shouldShift && shift !== undefined) {\n      const pixelData = image.getPixelData();\n      minMax = getMinMax(pixelData.map(function(sv, i) { return getStoredValue(i, pixelData, shift); }));\n    } else {\n      minMax = getMinMax(image.getPixelData());\n    }\n\n    image.minPixelValue = minMax.min;\n    image.maxPixelValue = minMax.max;\n  }\n\n  //Setup min max of the VOI since these output values can change what WebGL shader is required\n  if (hasVoiLUT(viewport)) {\n    const minMax = getMinMax(viewport.voiLUT.lut);\n    viewport.voi.minMax = minMax;\n    viewport.voiLUT.minMax = minMax;\n  } else if (hasModalityLUT(viewport)) {\n    const minMax = getMinMax(viewport.modalityLUT.lut);\n    viewport.modalityLUT.minMax = minMax;\n    viewport.voi.minMax = minMax;\n  }\n\n  if (viewport.voi.windowWidth === undefined || viewport.voi.windowCenter === undefined) {\n    var min = image.minPixelValue;\n    var max = image.maxPixelValue;\n\n    if (viewport.voiLUT) {\n      min = viewport.voiLUT.minMax.min;\n      max = viewport.voiLUT.minMax.max;\n    } else if (viewport.modalityLUT) {\n      min = viewport.modalityLUT.minMax.min;\n      max = viewport.modalityLUT.minMax.max;\n    }\n\n    viewport.voi.windowCenter = (min + max + 1) / 2 * image.slope + image.intercept;\n    viewport.voi.windowWidth = Math.abs((min + 1 - max) * image.slope);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/autoWindow.js","/**\n * @return {Object} with min and max value from passed in data\n */\nexport default function (pixelData) {\n  let min = pixelData[0];\n  let max = pixelData[0];\n  let pixel;\n  const numPixels = pixelData.length;\n\n  for (let index = 0; index < numPixels; index++) {\n    pixel = pixelData[index];\n    min = Math.min(min, pixel);\n    max = Math.max(max, pixel);\n  }\n\n  return {\n    min,\n    max\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/getMinMax.js","import LookupTable from './lookupTable.js';\n\nconst COLOR_TRANSPARENT = [0, 0, 0, 0];\n\n// Colormaps\n//\n// Hot Iron, PET, Hot Metal Blue and PET 20 Step are color palattes\n// Defined by the DICOM standard\n// http://dicom.nema.org/dicom/2013/output/chtml/part06/chapter_B.html\n//\n// All Linear Segmented Colormaps were copied from matplotlib\n// https://github.com/stefanv/matplotlib/blob/master/lib/matplotlib/_cm.py\n\nconst colormapsData = {\n  hotIron: {\n    name: 'Hot Iron',\n    numOfColors: 256,\n    colors: [\n      [0, 0, 0, 255], [2, 0, 0, 255], [4, 0, 0, 255], [6, 0, 0, 255], [8, 0, 0, 255],\n      [10, 0, 0, 255], [12, 0, 0, 255], [14, 0, 0, 255], [16, 0, 0, 255], [18, 0, 0, 255],\n      [20, 0, 0, 255], [22, 0, 0, 255], [24, 0, 0, 255], [26, 0, 0, 255], [28, 0, 0, 255],\n      [30, 0, 0, 255], [32, 0, 0, 255], [34, 0, 0, 255], [36, 0, 0, 255], [38, 0, 0, 255],\n      [40, 0, 0, 255], [42, 0, 0, 255], [44, 0, 0, 255], [46, 0, 0, 255], [48, 0, 0, 255],\n      [50, 0, 0, 255], [52, 0, 0, 255], [54, 0, 0, 255], [56, 0, 0, 255], [58, 0, 0, 255],\n      [60, 0, 0, 255], [62, 0, 0, 255], [64, 0, 0, 255], [66, 0, 0, 255], [68, 0, 0, 255],\n      [70, 0, 0, 255], [72, 0, 0, 255], [74, 0, 0, 255], [76, 0, 0, 255], [78, 0, 0, 255],\n      [80, 0, 0, 255], [82, 0, 0, 255], [84, 0, 0, 255], [86, 0, 0, 255], [88, 0, 0, 255],\n      [90, 0, 0, 255], [92, 0, 0, 255], [94, 0, 0, 255], [96, 0, 0, 255], [98, 0, 0, 255],\n      [100, 0, 0, 255], [102, 0, 0, 255], [104, 0, 0, 255], [106, 0, 0, 255], [108, 0, 0, 255],\n      [110, 0, 0, 255], [112, 0, 0, 255], [114, 0, 0, 255], [116, 0, 0, 255], [118, 0, 0, 255],\n      [120, 0, 0, 255], [122, 0, 0, 255], [124, 0, 0, 255], [126, 0, 0, 255], [128, 0, 0, 255],\n      [130, 0, 0, 255], [132, 0, 0, 255], [134, 0, 0, 255], [136, 0, 0, 255], [138, 0, 0, 255],\n      [140, 0, 0, 255], [142, 0, 0, 255], [144, 0, 0, 255], [146, 0, 0, 255], [148, 0, 0, 255],\n      [150, 0, 0, 255], [152, 0, 0, 255], [154, 0, 0, 255], [156, 0, 0, 255], [158, 0, 0, 255],\n      [160, 0, 0, 255], [162, 0, 0, 255], [164, 0, 0, 255], [166, 0, 0, 255], [168, 0, 0, 255],\n      [170, 0, 0, 255], [172, 0, 0, 255], [174, 0, 0, 255], [176, 0, 0, 255], [178, 0, 0, 255],\n      [180, 0, 0, 255], [182, 0, 0, 255], [184, 0, 0, 255], [186, 0, 0, 255], [188, 0, 0, 255],\n      [190, 0, 0, 255], [192, 0, 0, 255], [194, 0, 0, 255], [196, 0, 0, 255], [198, 0, 0, 255],\n      [200, 0, 0, 255], [202, 0, 0, 255], [204, 0, 0, 255], [206, 0, 0, 255], [208, 0, 0, 255],\n      [210, 0, 0, 255], [212, 0, 0, 255], [214, 0, 0, 255], [216, 0, 0, 255], [218, 0, 0, 255],\n      [220, 0, 0, 255], [222, 0, 0, 255], [224, 0, 0, 255], [226, 0, 0, 255], [228, 0, 0, 255],\n      [230, 0, 0, 255], [232, 0, 0, 255], [234, 0, 0, 255], [236, 0, 0, 255], [238, 0, 0, 255],\n      [240, 0, 0, 255], [242, 0, 0, 255], [244, 0, 0, 255], [246, 0, 0, 255], [248, 0, 0, 255],\n      [250, 0, 0, 255], [252, 0, 0, 255], [254, 0, 0, 255], [255, 0, 0, 255], [255, 2, 0, 255],\n      [255, 4, 0, 255], [255, 6, 0, 255], [255, 8, 0, 255], [255, 10, 0, 255], [255, 12, 0, 255],\n      [255, 14, 0, 255], [255, 16, 0, 255], [255, 18, 0, 255], [255, 20, 0, 255], [255, 22, 0, 255],\n      [255, 24, 0, 255], [255, 26, 0, 255], [255, 28, 0, 255], [255, 30, 0, 255], [255, 32, 0, 255],\n      [255, 34, 0, 255], [255, 36, 0, 255], [255, 38, 0, 255], [255, 40, 0, 255], [255, 42, 0, 255],\n      [255, 44, 0, 255], [255, 46, 0, 255], [255, 48, 0, 255], [255, 50, 0, 255], [255, 52, 0, 255],\n      [255, 54, 0, 255], [255, 56, 0, 255], [255, 58, 0, 255], [255, 60, 0, 255], [255, 62, 0, 255],\n      [255, 64, 0, 255], [255, 66, 0, 255], [255, 68, 0, 255], [255, 70, 0, 255], [255, 72, 0, 255],\n      [255, 74, 0, 255], [255, 76, 0, 255], [255, 78, 0, 255], [255, 80, 0, 255], [255, 82, 0, 255],\n      [255, 84, 0, 255], [255, 86, 0, 255], [255, 88, 0, 255], [255, 90, 0, 255], [255, 92, 0, 255],\n      [255, 94, 0, 255], [255, 96, 0, 255], [255, 98, 0, 255], [255, 100, 0, 255], [255, 102, 0, 255],\n      [255, 104, 0, 255], [255, 106, 0, 255], [255, 108, 0, 255], [255, 110, 0, 255], [255, 112, 0, 255],\n      [255, 114, 0, 255], [255, 116, 0, 255], [255, 118, 0, 255], [255, 120, 0, 255], [255, 122, 0, 255],\n      [255, 124, 0, 255], [255, 126, 0, 255], [255, 128, 4, 255], [255, 130, 8, 255], [255, 132, 12, 255],\n      [255, 134, 16, 255], [255, 136, 20, 255], [255, 138, 24, 255], [255, 140, 28, 255], [255, 142, 32, 255],\n      [255, 144, 36, 255], [255, 146, 40, 255], [255, 148, 44, 255], [255, 150, 48, 255], [255, 152, 52, 255],\n      [255, 154, 56, 255], [255, 156, 60, 255], [255, 158, 64, 255], [255, 160, 68, 255], [255, 162, 72, 255],\n      [255, 164, 76, 255], [255, 166, 80, 255], [255, 168, 84, 255], [255, 170, 88, 255], [255, 172, 92, 255],\n      [255, 174, 96, 255], [255, 176, 100, 255], [255, 178, 104, 255], [255, 180, 108, 255], [255, 182, 112, 255],\n      [255, 184, 116, 255], [255, 186, 120, 255], [255, 188, 124, 255], [255, 190, 128, 255], [255, 192, 132, 255],\n      [255, 194, 136, 255], [255, 196, 140, 255], [255, 198, 144, 255], [255, 200, 148, 255], [255, 202, 152, 255],\n      [255, 204, 156, 255], [255, 206, 160, 255], [255, 208, 164, 255], [255, 210, 168, 255], [255, 212, 172, 255],\n      [255, 214, 176, 255], [255, 216, 180, 255], [255, 218, 184, 255], [255, 220, 188, 255], [255, 222, 192, 255],\n      [255, 224, 196, 255], [255, 226, 200, 255], [255, 228, 204, 255], [255, 230, 208, 255], [255, 232, 212, 255],\n      [255, 234, 216, 255], [255, 236, 220, 255], [255, 238, 224, 255], [255, 240, 228, 255], [255, 242, 232, 255],\n      [255, 244, 236, 255], [255, 246, 240, 255], [255, 248, 244, 255], [255, 250, 248, 255], [255, 252, 252, 255],\n      [255, 255, 255, 255]\n    ]\n  },\n  pet: {\n    name: 'PET',\n    numColors: 256,\n    colors: [\n      [0, 0, 0, 255], [0, 2, 1, 255], [0, 4, 3, 255], [0, 6, 5, 255], [0, 8, 7, 255],\n      [0, 10, 9, 255], [0, 12, 11, 255], [0, 14, 13, 255], [0, 16, 15, 255], [0, 18, 17, 255],\n      [0, 20, 19, 255], [0, 22, 21, 255], [0, 24, 23, 255], [0, 26, 25, 255], [0, 28, 27, 255],\n      [0, 30, 29, 255], [0, 32, 31, 255], [0, 34, 33, 255], [0, 36, 35, 255], [0, 38, 37, 255],\n      [0, 40, 39, 255], [0, 42, 41, 255], [0, 44, 43, 255], [0, 46, 45, 255], [0, 48, 47, 255],\n      [0, 50, 49, 255], [0, 52, 51, 255], [0, 54, 53, 255], [0, 56, 55, 255], [0, 58, 57, 255],\n      [0, 60, 59, 255], [0, 62, 61, 255], [0, 65, 63, 255], [0, 67, 65, 255], [0, 69, 67, 255],\n      [0, 71, 69, 255], [0, 73, 71, 255], [0, 75, 73, 255], [0, 77, 75, 255], [0, 79, 77, 255],\n      [0, 81, 79, 255], [0, 83, 81, 255], [0, 85, 83, 255], [0, 87, 85, 255], [0, 89, 87, 255],\n      [0, 91, 89, 255], [0, 93, 91, 255], [0, 95, 93, 255], [0, 97, 95, 255], [0, 99, 97, 255],\n      [0, 101, 99, 255], [0, 103, 101, 255], [0, 105, 103, 255], [0, 107, 105, 255], [0, 109, 107, 255],\n      [0, 111, 109, 255], [0, 113, 111, 255], [0, 115, 113, 255], [0, 117, 115, 255], [0, 119, 117, 255],\n      [0, 121, 119, 255], [0, 123, 121, 255], [0, 125, 123, 255], [0, 128, 125, 255], [1, 126, 127, 255],\n      [3, 124, 129, 255], [5, 122, 131, 255], [7, 120, 133, 255], [9, 118, 135, 255], [11, 116, 137, 255],\n      [13, 114, 139, 255], [15, 112, 141, 255], [17, 110, 143, 255], [19, 108, 145, 255], [21, 106, 147, 255],\n      [23, 104, 149, 255], [25, 102, 151, 255], [27, 100, 153, 255], [29, 98, 155, 255], [31, 96, 157, 255],\n      [33, 94, 159, 255], [35, 92, 161, 255], [37, 90, 163, 255], [39, 88, 165, 255], [41, 86, 167, 255],\n      [43, 84, 169, 255], [45, 82, 171, 255], [47, 80, 173, 255], [49, 78, 175, 255], [51, 76, 177, 255],\n      [53, 74, 179, 255], [55, 72, 181, 255], [57, 70, 183, 255], [59, 68, 185, 255], [61, 66, 187, 255],\n      [63, 64, 189, 255], [65, 63, 191, 255], [67, 61, 193, 255], [69, 59, 195, 255], [71, 57, 197, 255],\n      [73, 55, 199, 255], [75, 53, 201, 255], [77, 51, 203, 255], [79, 49, 205, 255], [81, 47, 207, 255],\n      [83, 45, 209, 255], [85, 43, 211, 255], [86, 41, 213, 255], [88, 39, 215, 255], [90, 37, 217, 255],\n      [92, 35, 219, 255], [94, 33, 221, 255], [96, 31, 223, 255], [98, 29, 225, 255], [100, 27, 227, 255],\n      [102, 25, 229, 255], [104, 23, 231, 255], [106, 21, 233, 255], [108, 19, 235, 255], [110, 17, 237, 255],\n      [112, 15, 239, 255], [114, 13, 241, 255], [116, 11, 243, 255], [118, 9, 245, 255], [120, 7, 247, 255],\n      [122, 5, 249, 255], [124, 3, 251, 255], [126, 1, 253, 255], [128, 0, 255, 255], [130, 2, 252, 255],\n      [132, 4, 248, 255], [134, 6, 244, 255], [136, 8, 240, 255], [138, 10, 236, 255], [140, 12, 232, 255],\n      [142, 14, 228, 255], [144, 16, 224, 255], [146, 18, 220, 255], [148, 20, 216, 255], [150, 22, 212, 255],\n      [152, 24, 208, 255], [154, 26, 204, 255], [156, 28, 200, 255], [158, 30, 196, 255], [160, 32, 192, 255],\n      [162, 34, 188, 255], [164, 36, 184, 255], [166, 38, 180, 255], [168, 40, 176, 255], [170, 42, 172, 255],\n      [171, 44, 168, 255], [173, 46, 164, 255], [175, 48, 160, 255], [177, 50, 156, 255], [179, 52, 152, 255],\n      [181, 54, 148, 255], [183, 56, 144, 255], [185, 58, 140, 255], [187, 60, 136, 255], [189, 62, 132, 255],\n      [191, 64, 128, 255], [193, 66, 124, 255], [195, 68, 120, 255], [197, 70, 116, 255], [199, 72, 112, 255],\n      [201, 74, 108, 255], [203, 76, 104, 255], [205, 78, 100, 255], [207, 80, 96, 255], [209, 82, 92, 255],\n      [211, 84, 88, 255], [213, 86, 84, 255], [215, 88, 80, 255], [217, 90, 76, 255], [219, 92, 72, 255],\n      [221, 94, 68, 255], [223, 96, 64, 255], [225, 98, 60, 255], [227, 100, 56, 255], [229, 102, 52, 255],\n      [231, 104, 48, 255], [233, 106, 44, 255], [235, 108, 40, 255], [237, 110, 36, 255], [239, 112, 32, 255],\n      [241, 114, 28, 255], [243, 116, 24, 255], [245, 118, 20, 255], [247, 120, 16, 255], [249, 122, 12, 255],\n      [251, 124, 8, 255], [253, 126, 4, 255], [255, 128, 0, 255], [255, 130, 4, 255], [255, 132, 8, 255],\n      [255, 134, 12, 255], [255, 136, 16, 255], [255, 138, 20, 255], [255, 140, 24, 255], [255, 142, 28, 255],\n      [255, 144, 32, 255], [255, 146, 36, 255], [255, 148, 40, 255], [255, 150, 44, 255], [255, 152, 48, 255],\n      [255, 154, 52, 255], [255, 156, 56, 255], [255, 158, 60, 255], [255, 160, 64, 255], [255, 162, 68, 255],\n      [255, 164, 72, 255], [255, 166, 76, 255], [255, 168, 80, 255], [255, 170, 85, 255], [255, 172, 89, 255],\n      [255, 174, 93, 255], [255, 176, 97, 255], [255, 178, 101, 255], [255, 180, 105, 255], [255, 182, 109, 255],\n      [255, 184, 113, 255], [255, 186, 117, 255], [255, 188, 121, 255], [255, 190, 125, 255], [255, 192, 129, 255],\n      [255, 194, 133, 255], [255, 196, 137, 255], [255, 198, 141, 255], [255, 200, 145, 255], [255, 202, 149, 255],\n      [255, 204, 153, 255], [255, 206, 157, 255], [255, 208, 161, 255], [255, 210, 165, 255], [255, 212, 170, 255],\n      [255, 214, 174, 255], [255, 216, 178, 255], [255, 218, 182, 255], [255, 220, 186, 255], [255, 222, 190, 255],\n      [255, 224, 194, 255], [255, 226, 198, 255], [255, 228, 202, 255], [255, 230, 206, 255], [255, 232, 210, 255],\n      [255, 234, 214, 255], [255, 236, 218, 255], [255, 238, 222, 255], [255, 240, 226, 255], [255, 242, 230, 255],\n      [255, 244, 234, 255], [255, 246, 238, 255], [255, 248, 242, 255], [255, 250, 246, 255], [255, 252, 250, 255],\n      [255, 255, 255, 255]\n    ]\n  },\n  hotMetalBlue: {\n    name: 'Hot Metal Blue',\n    numColors: 256,\n    colors: [\n      [0, 0, 0, 255], [0, 0, 2, 255], [0, 0, 4, 255], [0, 0, 6, 255], [0, 0, 8, 255],\n      [0, 0, 10, 255], [0, 0, 12, 255], [0, 0, 14, 255], [0, 0, 16, 255], [0, 0, 17, 255],\n      [0, 0, 19, 255], [0, 0, 21, 255], [0, 0, 23, 255], [0, 0, 25, 255], [0, 0, 27, 255],\n      [0, 0, 29, 255], [0, 0, 31, 255], [0, 0, 33, 255], [0, 0, 35, 255], [0, 0, 37, 255],\n      [0, 0, 39, 255], [0, 0, 41, 255], [0, 0, 43, 255], [0, 0, 45, 255], [0, 0, 47, 255],\n      [0, 0, 49, 255], [0, 0, 51, 255], [0, 0, 53, 255], [0, 0, 55, 255], [0, 0, 57, 255],\n      [0, 0, 59, 255], [0, 0, 61, 255], [0, 0, 63, 255], [0, 0, 65, 255], [0, 0, 67, 255],\n      [0, 0, 69, 255], [0, 0, 71, 255], [0, 0, 73, 255], [0, 0, 75, 255], [0, 0, 77, 255],\n      [0, 0, 79, 255], [0, 0, 81, 255], [0, 0, 83, 255], [0, 0, 84, 255], [0, 0, 86, 255],\n      [0, 0, 88, 255], [0, 0, 90, 255], [0, 0, 92, 255], [0, 0, 94, 255], [0, 0, 96, 255],\n      [0, 0, 98, 255], [0, 0, 100, 255], [0, 0, 102, 255], [0, 0, 104, 255], [0, 0, 106, 255],\n      [0, 0, 108, 255], [0, 0, 110, 255], [0, 0, 112, 255], [0, 0, 114, 255], [0, 0, 116, 255],\n      [0, 0, 117, 255], [0, 0, 119, 255], [0, 0, 121, 255], [0, 0, 123, 255], [0, 0, 125, 255],\n      [0, 0, 127, 255], [0, 0, 129, 255], [0, 0, 131, 255], [0, 0, 133, 255], [0, 0, 135, 255],\n      [0, 0, 137, 255], [0, 0, 139, 255], [0, 0, 141, 255], [0, 0, 143, 255], [0, 0, 145, 255],\n      [0, 0, 147, 255], [0, 0, 149, 255], [0, 0, 151, 255], [0, 0, 153, 255], [0, 0, 155, 255],\n      [0, 0, 157, 255], [0, 0, 159, 255], [0, 0, 161, 255], [0, 0, 163, 255], [0, 0, 165, 255],\n      [0, 0, 167, 255], [3, 0, 169, 255], [6, 0, 171, 255], [9, 0, 173, 255], [12, 0, 175, 255],\n      [15, 0, 177, 255], [18, 0, 179, 255], [21, 0, 181, 255], [24, 0, 183, 255], [26, 0, 184, 255],\n      [29, 0, 186, 255], [32, 0, 188, 255], [35, 0, 190, 255], [38, 0, 192, 255], [41, 0, 194, 255],\n      [44, 0, 196, 255], [47, 0, 198, 255], [50, 0, 200, 255], [52, 0, 197, 255], [55, 0, 194, 255],\n      [57, 0, 191, 255], [59, 0, 188, 255], [62, 0, 185, 255], [64, 0, 182, 255], [66, 0, 179, 255],\n      [69, 0, 176, 255], [71, 0, 174, 255], [74, 0, 171, 255], [76, 0, 168, 255], [78, 0, 165, 255],\n      [81, 0, 162, 255], [83, 0, 159, 255], [85, 0, 156, 255], [88, 0, 153, 255], [90, 0, 150, 255],\n      [93, 2, 144, 255], [96, 4, 138, 255], [99, 6, 132, 255], [102, 8, 126, 255], [105, 9, 121, 255],\n      [108, 11, 115, 255], [111, 13, 109, 255], [114, 15, 103, 255], [116, 17, 97, 255], [119, 19, 91, 255],\n      [122, 21, 85, 255], [125, 23, 79, 255], [128, 24, 74, 255], [131, 26, 68, 255], [134, 28, 62, 255],\n      [137, 30, 56, 255], [140, 32, 50, 255], [143, 34, 47, 255], [146, 36, 44, 255], [149, 38, 41, 255],\n      [152, 40, 38, 255], [155, 41, 35, 255], [158, 43, 32, 255], [161, 45, 29, 255], [164, 47, 26, 255],\n      [166, 49, 24, 255], [169, 51, 21, 255], [172, 53, 18, 255], [175, 55, 15, 255], [178, 56, 12, 255],\n      [181, 58, 9, 255], [184, 60, 6, 255], [187, 62, 3, 255], [190, 64, 0, 255], [194, 66, 0, 255],\n      [198, 68, 0, 255], [201, 70, 0, 255], [205, 72, 0, 255], [209, 73, 0, 255], [213, 75, 0, 255],\n      [217, 77, 0, 255], [221, 79, 0, 255], [224, 81, 0, 255], [228, 83, 0, 255], [232, 85, 0, 255],\n      [236, 87, 0, 255], [240, 88, 0, 255], [244, 90, 0, 255], [247, 92, 0, 255], [251, 94, 0, 255],\n      [255, 96, 0, 255], [255, 98, 3, 255], [255, 100, 6, 255], [255, 102, 9, 255], [255, 104, 12, 255],\n      [255, 105, 15, 255], [255, 107, 18, 255], [255, 109, 21, 255], [255, 111, 24, 255], [255, 113, 26, 255],\n      [255, 115, 29, 255], [255, 117, 32, 255], [255, 119, 35, 255], [255, 120, 38, 255], [255, 122, 41, 255],\n      [255, 124, 44, 255], [255, 126, 47, 255], [255, 128, 50, 255], [255, 130, 53, 255], [255, 132, 56, 255],\n      [255, 134, 59, 255], [255, 136, 62, 255], [255, 137, 65, 255], [255, 139, 68, 255], [255, 141, 71, 255],\n      [255, 143, 74, 255], [255, 145, 76, 255], [255, 147, 79, 255], [255, 149, 82, 255], [255, 151, 85, 255],\n      [255, 152, 88, 255], [255, 154, 91, 255], [255, 156, 94, 255], [255, 158, 97, 255], [255, 160, 100, 255],\n      [255, 162, 103, 255], [255, 164, 106, 255], [255, 166, 109, 255], [255, 168, 112, 255], [255, 169, 115, 255],\n      [255, 171, 118, 255], [255, 173, 121, 255], [255, 175, 124, 255], [255, 177, 126, 255], [255, 179, 129, 255],\n      [255, 181, 132, 255], [255, 183, 135, 255], [255, 184, 138, 255], [255, 186, 141, 255], [255, 188, 144, 255],\n      [255, 190, 147, 255], [255, 192, 150, 255], [255, 194, 153, 255], [255, 196, 156, 255], [255, 198, 159, 255],\n      [255, 200, 162, 255], [255, 201, 165, 255], [255, 203, 168, 255], [255, 205, 171, 255], [255, 207, 174, 255],\n      [255, 209, 176, 255], [255, 211, 179, 255], [255, 213, 182, 255], [255, 215, 185, 255], [255, 216, 188, 255],\n      [255, 218, 191, 255], [255, 220, 194, 255], [255, 222, 197, 255], [255, 224, 200, 255], [255, 226, 203, 255],\n      [255, 228, 206, 255], [255, 229, 210, 255], [255, 231, 213, 255], [255, 233, 216, 255], [255, 235, 219, 255],\n      [255, 237, 223, 255], [255, 239, 226, 255], [255, 240, 229, 255], [255, 242, 232, 255], [255, 244, 236, 255],\n      [255, 246, 239, 255], [255, 248, 242, 255], [255, 250, 245, 255], [255, 251, 249, 255], [255, 253, 252, 255],\n      [255, 255, 255, 255]\n    ]\n  },\n  pet20Step: {\n    name: 'PET 20 Step',\n    numColors: 256,\n    colors: [\n      [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255],\n      [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255],\n      [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [96, 0, 80, 255], [96, 0, 80, 255],\n      [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255],\n      [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255],\n      [96, 0, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255],\n      [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255],\n      [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 112, 255],\n      [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255],\n      [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255],\n      [48, 48, 112, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255],\n      [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255],\n      [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [96, 96, 176, 255],\n      [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255],\n      [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255],\n      [96, 96, 176, 255], [96, 96, 176, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255],\n      [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255],\n      [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255],\n      [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255],\n      [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255],\n      [128, 128, 224, 255], [128, 128, 224, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255],\n      [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255],\n      [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255],\n      [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255],\n      [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255],\n      [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [80, 192, 80, 255], [80, 192, 80, 255],\n      [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255],\n      [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255],\n      [80, 192, 80, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255],\n      [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255],\n      [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [224, 224, 80, 255], [224, 224, 80, 255],\n      [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255],\n      [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255],\n      [224, 224, 80, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255],\n      [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255],\n      [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 176, 64, 255],\n      [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255],\n      [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255],\n      [208, 176, 64, 255], [208, 176, 64, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255],\n      [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255],\n      [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [192, 96, 0, 255],\n      [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255],\n      [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255],\n      [192, 96, 0, 255], [192, 96, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255],\n      [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255],\n      [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255],\n      [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255],\n      [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255],\n      [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 255, 255, 255], [255, 255, 255, 255],\n      [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255],\n      [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255],\n      [255, 255, 255, 255]\n    ]\n  },\n  gray: {\n    name: 'Gray',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 0, 0], [1, 1, 1]]\n    }\n  },\n  jet: {\n    name: 'Jet',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.35, 0, 0], [0.66, 1, 1], [0.89, 1, 1], [1, 0.5, 0.5]],\n      green: [[0, 0, 0], [0.125, 0, 0], [0.375, 1, 1], [0.64, 1, 1], [0.91, 0, 0], [1, 0, 0]],\n      blue: [[0, 0.5, 0.5], [0.11, 1, 1], [0.34, 1, 1], [0.65, 0, 0], [1, 0, 0]]\n    }\n  },\n  hsv: {\n    name: 'HSV',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 1, 1], [0.158730, 1, 1], [0.174603, 0.968750, 0.968750],\n        [0.333333, 0.031250, 0.031250], [0.349206, 0, 0], [0.666667, 0, 0],\n        [0.682540, 0.031250, 0.031250], [0.841270, 0.968750, 0.968750],\n        [0.857143, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [0.158730, 0.937500, 0.937500], [0.174603, 1, 1],\n        [0.507937, 1, 1], [0.666667, 0.062500, 0.062500],\n        [0.682540, 0, 0], [1, 0, 0]],\n      blue: [[0, 0, 0], [0.333333, 0, 0], [0.349206, 0.062500, 0.062500],\n        [0.507937, 1, 1], [0.841270, 1, 1], [0.857143, 0.937500, 0.937500],\n        [1, 0.09375, 0.09375]]\n    }\n  },\n  hot: {\n    name: 'Hot',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0.0416, 0.0416], [0.365079, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [0.365079, 0, 0], [0.746032, 1, 1], [1, 1, 1]],\n      blue: [[0, 0, 0], [0.746032, 0, 0], [1, 1, 1]]\n    }\n  },\n  cool: {\n    name: 'Cool',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 1, 1]],\n      green: [[0, 1, 1], [1, 0, 0]],\n      blue: [[0, 1, 1], [1, 1, 1]]\n    }\n  },\n  spring: {\n    name: 'Spring',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 1, 1], [1, 0, 0]]\n    }\n  },\n  summer: {\n    name: 'Summer',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 1, 1]],\n      green: [[0, 0.5, 0.5], [1, 1, 1]],\n      blue: [[0, 0.4, 0.4], [1, 0.4, 0.4]]\n    }\n  },\n  autumn: {\n    name: 'Autumn',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 0, 0], [1, 0, 0]]\n    }\n  },\n  winter: {\n    name: 'Winter',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [1, 0, 0]],\n      green: [[0, 0, 0], [1, 1, 1]],\n      blue: [[0, 1, 1], [1, 0.5, 0.5]]\n    }\n  },\n  bone: {\n    name: 'Bone',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.746032, 0.652778, 0.652778], [1, 1, 1]],\n      green: [[0, 0, 0], [0.365079, 0.319444, 0.319444], [0.746032, 0.777778, 0.777778], [1, 1, 1]],\n      blue: [[0, 0, 0], [0.365079, 0.444444, 0.444444], [1, 1, 1]]\n    }\n  },\n  copper: {\n    name: 'Copper',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.809524, 1, 1], [1, 1, 1]],\n      green: [[0, 0, 0], [1, 0.7812, 0.7812]],\n      blue: [[0, 0, 0], [1, 0.4975, 0.4975]]\n    }\n  },\n  spectral: {\n    name: 'Spectral',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0, 0], [0.05, 0.4667, 0.4667], [0.10, 0.5333, 0.5333], [0.15, 0, 0],\n        [0.20, 0, 0], [0.25, 0, 0], [0.30, 0, 0], [0.35, 0, 0],\n        [0.40, 0, 0], [0.45, 0, 0], [0.50, 0, 0], [0.55, 0, 0],\n        [0.60, 0, 0], [0.65, 0.7333, 0.7333], [0.70, 0.9333, 0.9333], [0.75, 1, 1],\n        [0.80, 1, 1], [0.85, 1, 1], [0.90, 0.8667, 0.8667], [0.95, 0.80, 0.80],\n        [1, 0.80, 0.80]],\n      green: [[0, 0, 0], [0.05, 0, 0], [0.10, 0, 0], [0.15, 0, 0],\n        [0.20, 0, 0], [0.25, 0.4667, 0.4667], [0.30, 0.6000, 0.6000],\n        [0.35, 0.6667, 0.6667], [0.40, 0.6667, 0.6667], [0.45, 0.6000, 0.6000],\n        [0.50, 0.7333, 0.7333], [0.55, 0.8667, 0.8667], [0.60, 1, 1], [0.65, 1, 1],\n        [0.70, 0.9333, 0.9333], [0.75, 0.8000, 0.8000],\n        [0.80, 0.6000, 0.6000], [0.85, 0, 0],\n        [0.90, 0, 0], [0.95, 0, 0], [1, 0.80, 0.80]],\n      blue: [[0, 0, 0], [0.05, 0.5333, 0.5333], [0.10, 0.6000, 0.6000], [0.15, 0.6667, 0.6667],\n        [0.20, 0.8667, 0.8667], [0.25, 0.8667, 0.8667], [0.30, 0.8667, 0.8667],\n        [0.35, 0.6667, 0.6667], [0.40, 0.5333, 0.5333], [0.45, 0, 0],\n        [0.5, 0, 0], [0.55, 0, 0], [0.60, 0, 0], [0.65, 0, 0], [0.70, 0, 0], [0.75, 0, 0],\n        [0.80, 0, 0], [0.85, 0, 0], [0.90, 0, 0], [0.95, 0, 0], [1, 0.80, 0.80]]\n    }\n  },\n  coolwarm: {\n    name: 'CoolWarm',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0.2298057, 0.2298057], [0.03125, 0.26623388, 0.26623388],\n        [0.0625, 0.30386891, 0.30386891], [0.09375, 0.342804478, 0.342804478],\n        [0.125, 0.38301334, 0.38301334], [0.15625, 0.424369608, 0.424369608],\n        [0.1875, 0.46666708, 0.46666708], [0.21875, 0.509635204, 0.509635204],\n        [0.25, 0.552953156, 0.552953156], [0.28125, 0.596262162, 0.596262162],\n        [0.3125, 0.639176211, 0.639176211], [0.34375, 0.681291281, 0.681291281],\n        [0.375, 0.722193294, 0.722193294], [0.40625, 0.761464949, 0.761464949],\n        [0.4375, 0.798691636, 0.798691636], [0.46875, 0.833466556, 0.833466556],\n        [0.5, 0.865395197, 0.865395197], [0.53125, 0.897787179, 0.897787179],\n        [0.5625, 0.924127593, 0.924127593], [0.59375, 0.944468518, 0.944468518],\n        [0.625, 0.958852946, 0.958852946], [0.65625, 0.96732803, 0.96732803],\n        [0.6875, 0.969954137, 0.969954137], [0.71875, 0.966811177, 0.966811177],\n        [0.75, 0.958003065, 0.958003065], [0.78125, 0.943660866, 0.943660866],\n        [0.8125, 0.923944917, 0.923944917], [0.84375, 0.89904617, 0.89904617],\n        [0.875, 0.869186849, 0.869186849], [0.90625, 0.834620542, 0.834620542],\n        [0.9375, 0.795631745, 0.795631745], [0.96875, 0.752534934, 0.752534934],\n        [1, 0.705673158, 0.705673158]],\n      green: [[0, 0.298717966, 0.298717966], [0.03125, 0.353094838, 0.353094838],\n        [0.0625, 0.406535296, 0.406535296], [0.09375, 0.458757618, 0.458757618],\n        [0.125, 0.50941904, 0.50941904], [0.15625, 0.558148092, 0.558148092],\n        [0.1875, 0.604562568, 0.604562568], [0.21875, 0.648280772, 0.648280772],\n        [0.25, 0.688929332, 0.688929332], [0.28125, 0.726149107, 0.726149107],\n        [0.3125, 0.759599947, 0.759599947], [0.34375, 0.788964712, 0.788964712],\n        [0.375, 0.813952739, 0.813952739], [0.40625, 0.834302879, 0.834302879],\n        [0.4375, 0.849786142, 0.849786142], [0.46875, 0.860207984, 0.860207984],\n        [0.5, 0.86541021, 0.86541021], [0.53125, 0.848937047, 0.848937047],\n        [0.5625, 0.827384882, 0.827384882], [0.59375, 0.800927443, 0.800927443],\n        [0.625, 0.769767752, 0.769767752], [0.65625, 0.734132809, 0.734132809],\n        [0.6875, 0.694266682, 0.694266682], [0.71875, 0.650421156, 0.650421156],\n        [0.75, 0.602842431, 0.602842431], [0.78125, 0.551750968, 0.551750968],\n        [0.8125, 0.49730856, 0.49730856], [0.84375, 0.439559467, 0.439559467],\n        [0.875, 0.378313092, 0.378313092], [0.90625, 0.312874446, 0.312874446],\n        [0.9375, 0.24128379, 0.24128379], [0.96875, 0.157246067, 0.157246067],\n        [1, 0.01555616, 0.01555616]],\n      blue: [[0, 0.753683153, 0.753683153], [0.03125, 0.801466763, 0.801466763],\n        [0.0625, 0.84495867, 0.84495867], [0.09375, 0.883725899, 0.883725899],\n        [0.125, 0.917387822, 0.917387822], [0.15625, 0.945619588, 0.945619588],\n        [0.1875, 0.968154911, 0.968154911], [0.21875, 0.98478814, 0.98478814],\n        [0.25, 0.995375608, 0.995375608], [0.28125, 0.999836203, 0.999836203],\n        [0.3125, 0.998151185, 0.998151185], [0.34375, 0.990363227, 0.990363227],\n        [0.375, 0.976574709, 0.976574709], [0.40625, 0.956945269, 0.956945269],\n        [0.4375, 0.931688648, 0.931688648], [0.46875, 0.901068838, 0.901068838],\n        [0.5, 0.865395561, 0.865395561], [0.53125, 0.820880546, 0.820880546],\n        [0.5625, 0.774508472, 0.774508472], [0.59375, 0.726736146, 0.726736146],\n        [0.625, 0.678007945, 0.678007945], [0.65625, 0.628751763, 0.628751763],\n        [0.6875, 0.579375448, 0.579375448], [0.71875, 0.530263762, 0.530263762],\n        [0.75, 0.481775914, 0.481775914], [0.78125, 0.434243684, 0.434243684],\n        [0.8125, 0.387970225, 0.387970225], [0.84375, 0.343229596, 0.343229596],\n        [0.875, 0.300267182, 0.300267182], [0.90625, 0.259301199, 0.259301199],\n        [0.9375, 0.220525627, 0.220525627], [0.96875, 0.184115123, 0.184115123],\n        [1, 0.150232812, 0.150232812]]\n    }\n  },\n  blues: {\n    name: 'Blues',\n    numColors: 256,\n    gamma: 1,\n    segmentedData: {\n      red: [[0, 0.9686274528503418, 0.9686274528503418], [0.125, 0.87058824300765991, 0.87058824300765991],\n        [0.25, 0.7764706015586853, 0.7764706015586853], [0.375, 0.61960786581039429, 0.61960786581039429],\n        [0.5, 0.41960784792900085, 0.41960784792900085], [0.625, 0.25882354378700256, 0.25882354378700256],\n        [0.75, 0.12941177189350128, 0.12941177189350128], [0.875, 0.031372550874948502, 0.031372550874948502],\n        [1, 0.031372550874948502, 0.031372550874948502]],\n      green: [[0, 0.9843137264251709, 0.9843137264251709], [0.125, 0.92156863212585449, 0.92156863212585449],\n        [0.25, 0.85882353782653809, 0.85882353782653809], [0.375, 0.7921568751335144, 0.7921568751335144],\n        [0.5, 0.68235296010971069, 0.68235296010971069], [0.625, 0.57254904508590698, 0.57254904508590698],\n        [0.75, 0.44313725829124451, 0.44313725829124451], [0.875, 0.31764706969261169, 0.31764706969261169],\n        [1, 0.18823529779911041, 0.18823529779911041]],\n      blue: [[0, 1, 1], [0.125, 0.9686274528503418, 0.9686274528503418], [0.25, 0.93725490570068359, 0.93725490570068359],\n        [0.375, 0.88235294818878174, 0.88235294818878174], [0.5, 0.83921569585800171, 0.83921569585800171],\n        [0.625, 0.7764706015586853, 0.7764706015586853], [0.75, 0.70980393886566162, 0.70980393886566162],\n        [0.875, 0.61176472902297974, 0.61176472902297974], [1, 0.41960784792900085, 0.41960784792900085]]\n    }\n  }\n};\n\n// Generate linearly spaced vectors\n// http://cens.ioc.ee/local/man/matlab/techdoc/ref/linspace.html\nfunction linspace (a, b, n) {\n  n = n === null ? 100 : n;\n\n  const increment = (b - a) / (n - 1);\n  const vector = [];\n\n  while (n-- > 0) {\n    vector.push(a);\n    a += increment;\n  }\n\n  // Make sure the last item will always be \"b\" because most of the\n  // Time we'll get numbers like 1.0000000000000002 instead of 1.\n  vector[vector.length - 1] = b;\n\n  return vector;\n}\n\n// Return the number of elements smaller than \"elem\" (binary search)\nfunction getRank (array, elem) {\n  let left = 0;\n  let right = array.length - 1;\n\n  while (left <= right) {\n    const mid = left + Math.floor((right - left) / 2);\n    const midElem = array[mid];\n\n    if (midElem === elem) {\n      return mid;\n    } else if (elem < midElem) {\n      right = mid - 1;\n    } else {\n      left = mid + 1;\n    }\n  }\n\n  return left;\n}\n\n// Find the indices into a sorted array a such that, if the corresponding elements\n// In v were inserted before the indices, the order of a would be preserved.\n// http://lagrange.univ-lyon1.fr/docs/numpy/1.11.0/reference/generated/numpy.searchsorted.html\nfunction searchSorted (inputArray, values) {\n  let i;\n  const indexes = [];\n  const len = values.length;\n\n  inputArray.sort(function (a, b) {\n    return a - b;\n  });\n\n  for (i = 0; i < len; i++) {\n    indexes[i] = getRank(inputArray, values[i]);\n  }\n\n  return indexes;\n}\n\n// Create an *N* -element 1-d lookup table\n//\n// *Data* represented by a list of x,y0,y1 mapping correspondences. Each element in this\n// List represents how a value between 0 and 1 (inclusive) represented by x is mapped to\n// A corresponding value between 0 and 1 (inclusive). The two values of y are to allow for\n// Discontinuous mapping functions (say as might be found in a sawtooth) where y0 represents\n// The value of y for values of x <= to that given, and y1 is the value to be used for x >\n// Than that given). The list must start with x=0, end with x=1, and all values of x must be\n// In increasing order. Values between the given mapping points are determined by simple linear\n// Interpolation.\n//\n// The function returns an array \"result\" where result[x*(N-1)] gives the closest value for\n// Values of x between 0 and 1.\nfunction makeMappingArray (N, data, gamma) {\n  let i;\n  const x = [];\n  const y0 = [];\n  const y1 = [];\n  const lut = [];\n\n  gamma = gamma === null ? 1 : gamma;\n\n  for (i = 0; i < data.length; i++) {\n    const element = data[i];\n\n    x.push((N - 1) * element[0]);\n    y0.push(element[1]);\n    y1.push(element[1]);\n  }\n\n  const xLinSpace = linspace(0, 1, N);\n\n  for (i = 0; i < N; i++) {\n    xLinSpace[i] = (N - 1) * Math.pow(xLinSpace[i], gamma);\n  }\n\n  const xLinSpaceIndexes = searchSorted(x, xLinSpace);\n\n  for (i = 1; i < N - 1; i++) {\n    const index = xLinSpaceIndexes[i];\n    const colorPercent = ((xLinSpace[i] - x[index - 1]) / (x[index] - x[index - 1]));\n    const colorDelta = (y0[index] - y1[index - 1]);\n\n    lut[i] = colorPercent * colorDelta + y1[index - 1];\n  }\n\n  lut[0] = y1[0];\n  lut[N - 1] = y0[data.length - 1];\n\n  return lut;\n}\n\n// Colormap based on lookup tables using linear segments.\n//\n// The lookup table is generated using linear interpolation for each\n// Primary color, with the 0-1 domain divided into any number of\n// Segments.\n//\n// https://github.com/stefanv/matplotlib/blob/3f1a23755e86fef97d51e30e106195f34425c9e3/lib/matplotlib/colors.py#L663\nfunction createLinearSegmentedColormap (segmentedData, N, gamma) {\n  let i;\n  const lut = [];\n\n  N = N === null ? 256 : N;\n  gamma = gamma === null ? 1 : gamma;\n\n  const redLut = makeMappingArray(N, segmentedData.red, gamma);\n  const greenLut = makeMappingArray(N, segmentedData.green, gamma);\n  const blueLut = makeMappingArray(N, segmentedData.blue, gamma);\n\n  for (i = 0; i < N; i++) {\n    const red = Math.round(redLut[i] * 255);\n    const green = Math.round(greenLut[i] * 255);\n    const blue = Math.round(blueLut[i] * 255);\n    const rgba = [red, green, blue, 255];\n\n    lut.push(rgba);\n  }\n\n  return lut;\n}\n\n/*\n* Return all colormaps (id and name) available\n*/\nexport function getColormapsList () {\n  const colormaps = [];\n  const keys = Object.keys(colormapsData);\n\n  keys.forEach(function (key) {\n    if (colormapsData.hasOwnProperty(key)) {\n      const colormap = colormapsData[key];\n\n      colormaps.push({\n        id: key,\n        name: colormap.name\n      });\n    }\n  });\n\n  colormaps.sort(function (a, b) {\n    const aName = a.name.toLowerCase();\n    const bName = b.name.toLowerCase();\n\n    if (aName === bName) {\n      return 0;\n    }\n\n    return aName < bName ? -1 : 1;\n  });\n\n  return colormaps;\n}\n\n/**\n * Convert the image of a element to a false color image\n *\n * @param {string} id The ID of the colormap\n * @param {Object} colormapData - An object that can contain a name, numColors, gama, segmentedData and/or colors\n *\n * @returns {*} The Colormap Object\n */\nexport function getColormap (id, colormapData) {\n  let colormap = colormapsData[id];\n\n  if (!colormap) {\n    colormap = colormapsData[id] = colormapData || {\n      name: '',\n      colors: []\n    };\n  }\n\n  if (!colormap.colors && colormap.segmentedData) {\n    colormap.colors = createLinearSegmentedColormap(colormap.segmentedData, colormap.numColors, colormap.gamma);\n  }\n\n  return {\n    getId () {\n      return id;\n    },\n\n    getColorSchemeName () {\n      return colormap.name;\n    },\n\n    setColorSchemeName (name) {\n      colormap.name = name;\n    },\n\n    getNumberOfColors () {\n      return colormap.colors.length;\n    },\n\n    setNumberOfColors (numColors) {\n      while (colormap.colors.length < numColors) {\n        colormap.colors.push(COLOR_TRANSPARENT);\n      }\n\n      colormap.colors.length = numColors;\n    },\n\n    getColor (index) {\n      if (this.isValidIndex(index)) {\n        return colormap.colors[index];\n      }\n\n      return COLOR_TRANSPARENT;\n    },\n\n    getColorRepeating (index) {\n      const numColors = colormap.colors.length;\n\n      index = numColors ? index % numColors : 0;\n\n      return this.getColor(index);\n    },\n\n    setColor (index, rgba) {\n      if (this.isValidIndex(index)) {\n        colormap.colors[index] = rgba;\n      }\n    },\n\n    addColor (rgba) {\n      colormap.colors.push(rgba);\n    },\n\n    insertColor (index, rgba) {\n      if (this.isValidIndex(index)) {\n        colormap.colors.splice(index, 1, rgba);\n      }\n    },\n\n    removeColor (index) {\n      if (this.isValidIndex(index)) {\n        colormap.colors.splice(index, 1);\n      }\n    },\n\n    clearColors () {\n      colormap.colors = [];\n    },\n\n    buildLookupTable (lut) {\n      if (!lut) {\n        return;\n      }\n\n      const numColors = colormap.colors.length;\n\n      lut.setNumberOfTableValues(numColors);\n\n      for (let i = 0; i < numColors; i++) {\n        lut.setTableValue(i, colormap.colors[i]);\n      }\n    },\n\n    createLookupTable () {\n      const lut = new LookupTable();\n\n      this.buildLookupTable(lut);\n\n      return lut;\n    },\n\n    isValidIndex (index) {\n      return (index >= 0) && (index < colormap.colors.length);\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./colors/colormap.js","// This code was created based on vtkLookupTable\n// http://www.vtk.org/doc/release/5.0/html/a01697.html\n// https://github.com/Kitware/VTK/blob/master/Common/Core/vtkLookupTable.cxx\nconst BELOW_RANGE_COLOR_INDEX = 0;\nconst ABOVE_RANGE_COLOR_INDEX = 1;\nconst NAN_COLOR_INDEX = 2;\n\nfunction HSVToRGB (hue, sat, val) {\n  if (hue > 1) {\n    throw new Error('HSVToRGB expects hue < 1');\n  }\n\n  const rgb = [];\n\n  if (sat === 0) {\n    rgb[0] = val;\n    rgb[1] = val;\n    rgb[2] = val;\n\n    return rgb;\n  }\n\n  const hueCase = Math.floor(hue * 6);\n  const frac = 6 * hue - hueCase;\n  const lx = val * (1 - sat);\n  const ly = val * (1 - sat * frac);\n  const lz = val * (1 - sat * (1 - frac));\n\n  switch (hueCase) {\n\n  /* 0<hue<1/6 */\n  case 0:\n  case 6:\n    rgb[0] = val;\n    rgb[1] = lz;\n    rgb[2] = lx;\n    break;\n\n    /* 1/6<hue<2/6 */\n  case 1:\n    rgb[0] = ly;\n    rgb[1] = val;\n    rgb[2] = lx;\n    break;\n\n    /* 2/6<hue<3/6 */\n  case 2:\n    rgb[0] = lx;\n    rgb[1] = val;\n    rgb[2] = lz;\n    break;\n\n    /* 3/6<hue/4/6 */\n  case 3:\n    rgb[0] = lx;\n    rgb[1] = ly;\n    rgb[2] = val;\n    break;\n\n    /* 4/6<hue<5/6 */\n  case 4:\n    rgb[0] = lz;\n    rgb[1] = lx;\n    rgb[2] = val;\n    break;\n\n    /* 5/6<hue<1 */\n  case 5:\n    rgb[0] = val;\n    rgb[1] = lx;\n    rgb[2] = ly;\n    break;\n  }\n\n  return rgb;\n}\n\nfunction linearIndexLookupMain (v, p) {\n  let dIndex;\n\n  // NOTE: Added Math.floor since values were not integers? Check VTK source\n  if (v < p.Range[0]) {\n    dIndex = p.MaxIndex + BELOW_RANGE_COLOR_INDEX + 1.5;\n  } else if (v > p.Range[1]) {\n    dIndex = p.MaxIndex + ABOVE_RANGE_COLOR_INDEX + 1.5;\n  } else {\n    dIndex = (v + p.Shift) * p.Scale;\n  }\n\n  return Math.floor(dIndex);\n}\n\nclass LookupTable {\n  constructor () {\n    this.NumberOfColors = 256;\n    this.Ramp = 'linear';\n    this.TableRange = [0, 255];\n    this.HueRange = [0, 0.66667];\n    this.SaturationRange = [1, 1];\n    this.ValueRange = [1, 1];\n    this.AlphaRange = [1, 1];\n    this.NaNColor = [128, 0, 0, 255];\n    this.BelowRangeColor = [0, 0, 0, 255];\n    this.UseBelowRangeColor = true;\n    this.AboveRangeColor = [255, 255, 255, 255];\n    this.UseAboveRangeColor = true;\n    this.InputRange = [0, 255];\n    this.Table = [];\n  }\n\n  setNumberOfTableValues (number) {\n    this.NumberOfColors = number;\n  }\n\n  setRamp (ramp) {\n    this.Ramp = ramp;\n  }\n\n  setTableRange (start, end) {\n    // Set/Get the minimum/maximum scalar values for scalar mapping.\n    // Scalar values less than minimum range value are clamped to minimum range value.\n    // Scalar values greater than maximum range value are clamped to maximum range value.\n    this.TableRange[0] = start;\n    this.TableRange[1] = end;\n  }\n\n  setHueRange (start, end) {\n    // Set the range in hue (using automatic generation). Hue ranges between [0,1].\n    this.HueRange[0] = start;\n    this.HueRange[1] = end;\n  }\n\n  setSaturationRange (start, end) {\n    // Set the range in saturation (using automatic generation). Saturation ranges between [0,1].\n    this.SaturationRange[0] = start;\n    this.SaturationRange[1] = end;\n  }\n\n  setValueRange (start, end) {\n    // Set the range in value (using automatic generation). Value ranges between [0,1].\n    this.ValueRange[0] = start;\n    this.ValueRange[1] = end;\n  }\n\n  setRange (start, end) {\n    this.InputRange[0] = start;\n    this.InputRange[1] = end;\n  }\n\n  setAlphaRange (start, end) {\n    // Set the range in alpha (using automatic generation). Alpha ranges from [0,1].\n    this.AlphaRange[0] = start;\n    this.AlphaRange[1] = end;\n  }\n\n  getColor (scalar) {\n    // Map one value through the lookup table and return the color as an\n    // RGB array of doubles between 0 and 1.\n    return this.mapValue(scalar);\n  }\n\n  build (force) {\n    if (this.Table.length > 1 && !force) {\n      return;\n    }\n\n    // Clear the table\n    this.Table = [];\n\n    const maxIndex = this.NumberOfColors - 1;\n\n    let hinc, sinc, vinc, ainc;\n\n    if (maxIndex) {\n      hinc = (this.HueRange[1] - this.HueRange[0]) / maxIndex;\n      sinc = (this.SaturationRange[1] - this.SaturationRange[0]) / maxIndex;\n      vinc = (this.ValueRange[1] - this.ValueRange[0]) / maxIndex;\n      ainc = (this.AlphaRange[1] - this.AlphaRange[0]) / maxIndex;\n    } else {\n      hinc = sinc = vinc = ainc = 0.0;\n    }\n\n    for (let i = 0; i <= maxIndex; i++) {\n      const hue = this.HueRange[0] + i * hinc;\n      const sat = this.SaturationRange[0] + i * sinc;\n      const val = this.ValueRange[0] + i * vinc;\n      const alpha = this.AlphaRange[0] + i * ainc;\n\n      const rgb = HSVToRGB(hue, sat, val);\n      const c_rgba = [];\n\n      switch (this.Ramp) {\n      case 'scurve':\n        c_rgba[0] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[0]) * Math.PI)));\n        c_rgba[1] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[1]) * Math.PI)));\n        c_rgba[2] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[2]) * Math.PI)));\n        c_rgba[3] = Math.floor(alpha * 255);\n        break;\n      case 'linear':\n        c_rgba[0] = Math.floor(rgb[0] * 255 + 0.5);\n        c_rgba[1] = Math.floor(rgb[1] * 255 + 0.5);\n        c_rgba[2] = Math.floor(rgb[2] * 255 + 0.5);\n        c_rgba[3] = Math.floor(alpha * 255 + 0.5);\n        break;\n      case 'sqrt':\n        c_rgba[0] = Math.floor(Math.sqrt(rgb[0]) * 255 + 0.5);\n        c_rgba[1] = Math.floor(Math.sqrt(rgb[1]) * 255 + 0.5);\n        c_rgba[2] = Math.floor(Math.sqrt(rgb[2]) * 255 + 0.5);\n        c_rgba[3] = Math.floor(Math.sqrt(alpha) * 255 + 0.5);\n        break;\n      default:\n        throw new Error(`Invalid Ramp value (${this.Ramp})`);\n      }\n\n      this.Table.push(c_rgba);\n    }\n\n    this.buildSpecialColors();\n  }\n\n  buildSpecialColors () {\n    const numberOfColors = this.NumberOfColors;\n    const belowRangeColorIndex = numberOfColors + BELOW_RANGE_COLOR_INDEX;\n    const aboveRangeColorIndex = numberOfColors + ABOVE_RANGE_COLOR_INDEX;\n    const nanColorIndex = numberOfColors + NAN_COLOR_INDEX;\n\n    // Below range color\n    if (this.UseBelowRangeColor || numberOfColors === 0) {\n      this.Table[belowRangeColorIndex] = this.BelowRangeColor;\n    } else {\n      // Duplicate the first color in the table.\n      this.Table[belowRangeColorIndex] = this.Table[0];\n    }\n\n    // Above range color\n    if (this.UseAboveRangeColor || numberOfColors === 0) {\n      this.Table[aboveRangeColorIndex] = this.AboveRangeColor;\n    } else {\n      // Duplicate the last color in the table.\n      this.Table[aboveRangeColorIndex] = this.Table[numberOfColors - 1];\n    }\n\n    // Always use NanColor\n    this.Table[nanColorIndex] = this.NaNColor;\n  }\n\n  // Given a scalar value v, return an rgba color value from lookup table.\n  mapValue (v) {\n    const index = this.getIndex(v);\n\n    if (index < 0) {\n      return this.NaNColor;\n    } else if (index === 0) {\n      if (this.UseBelowRangeColor && v < this.TableRange[0]) {\n        return this.BelowRangeColor;\n      }\n    } else if (index === this.NumberOfColors - 1) {\n      if (this.UseAboveRangeColor && v > this.TableRange[1]) {\n        return this.AboveRangeColor;\n      }\n    }\n\n    return this.Table[index];\n  }\n\n  getIndex (v) {\n    const p = {};\n\n    p.Range = [];\n    p.MaxIndex = this.NumberOfColors - 1;\n\n    // This was LookupShiftAndScale\n    p.Shift = -this.TableRange[0];\n    if (this.TableRange[1] <= this.TableRange[0]) {\n      p.Scale = Number.MAX_VALUE;\n    } else {\n      p.Scale = p.MaxIndex / (this.TableRange[1] - this.TableRange[0]);\n    }\n\n    p.Range[0] = this.TableRange[0];\n    p.Range[1] = this.TableRange[1];\n\n    // First, check whether we have a number...\n    if (isNaN(v)) {\n      // For backwards compatibility\n      return -1;\n    }\n\n    // Map to an index:\n    let index = linearIndexLookupMain(v, p);\n\n    // For backwards compatibility, if the index indicates an\n    // Out-of-range value, truncate to index range for in-range colors.\n    if (index === this.NumberOfColors + BELOW_RANGE_COLOR_INDEX) {\n      index = 0;\n    } else if (index === this.NumberOfColors + ABOVE_RANGE_COLOR_INDEX) {\n      index = this.NumberOfColors - 1;\n    }\n\n    return index;\n  }\n\n  setTableValue (index, rgba) {\n    // Check if it index, red, green, blue and alpha were passed as parameter\n    if (arguments.length === 5) {\n      rgba = Array.prototype.slice.call(arguments, 1);\n    }\n\n    // Check the index to make sure it is valid\n    if (index < 0) {\n      throw new Error(`Can't set the table value for negative index (${index})`);\n    }\n\n    if (index >= this.NumberOfColors) {\n      new Error(`Index ${index} is greater than the number of colors ${this.NumberOfColors}`);\n    }\n\n    this.Table[index] = rgba;\n\n    if ((index === 0) || (index === this.NumberOfColors - 1)) {\n      // This is needed due to the way the special colors are stored in\n      // The internal table. If Above/BelowRangeColors are not used and\n      // The min/max colors are changed in the table with this member\n      // Function, then the colors used for values outside the range may\n      // Be incorrect. Calling this here ensures the out-of-range colors\n      // Are set correctly.\n      this.buildSpecialColors();\n    }\n  }\n}\n\nexport default LookupTable;\n\n\n\n// WEBPACK FOOTER //\n// ./colors/lookupTable.js","import now from './now.js';\n\n/**\n * This function transforms stored pixel values into a canvas image data buffer\n * by using a LUT.\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} lut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nexport default function (image, lut, canvasImageDataData) {\n  let start = now();\n  const pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = now() - start;\n\n  const numPixels = pixelData.length;\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  let pixelValue;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n\n  // Added two paths (Int16Array, Uint16Array) to avoid polymorphic deoptimization in chrome.\n  start = now();\n  if (pixelData instanceof Int16Array) {\n    if (minPixelValue < 0) {\n      while (storedPixelDataIndex < numPixels) {\n        pixelValue = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)];\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n      }\n    } else {\n      while (storedPixelDataIndex < numPixels) {\n        pixelValue = lut[pixelData[storedPixelDataIndex++]];\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n      }\n    }\n  } else if (pixelData instanceof Uint16Array) {\n    while (storedPixelDataIndex < numPixels) {\n      pixelValue = lut[pixelData[storedPixelDataIndex++]];\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n    }\n  } else if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      pixelValue = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)];\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      pixelValue = lut[pixelData[storedPixelDataIndex++]];\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = pixelValue;\n      canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha\n    }\n  }\n\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = now() - start;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/storedPixelDataToCanvasImageDataRGBA.js","// By Simon Sarris\n// Www.simonsarris.com\n// Sarris@acm.org\n//\n// Free to use and distribute at will\n// So long as you are nice to people, etc\n\n// Simple class for keeping track of the current transformation matrix\n\n// For instance:\n//    Var t = new Transform();\n//    T.rotate(5);\n//    Var m = t.m;\n//    Ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);\n\n// Is equivalent to:\n//    Ctx.rotate(5);\n\n// But now you can retrieve it :)\n\n\n// Remember that this does not account for any CSS transforms applied to the canvas\nexport class Transform {\n  constructor () {\n    this.reset();\n  }\n\n  reset () {\n    this.m = [1, 0, 0, 1, 0, 0];\n  }\n\n  clone () {\n    const transform = new Transform();\n\n    transform.m[0] = this.m[0];\n    transform.m[1] = this.m[1];\n    transform.m[2] = this.m[2];\n    transform.m[3] = this.m[3];\n    transform.m[4] = this.m[4];\n    transform.m[5] = this.m[5];\n\n    return transform;\n  }\n\n  multiply (matrix) {\n    const m11 = this.m[0] * matrix.m[0] + this.m[2] * matrix.m[1];\n    const m12 = this.m[1] * matrix.m[0] + this.m[3] * matrix.m[1];\n\n    const m21 = this.m[0] * matrix.m[2] + this.m[2] * matrix.m[3];\n    const m22 = this.m[1] * matrix.m[2] + this.m[3] * matrix.m[3];\n\n    const dx = this.m[0] * matrix.m[4] + this.m[2] * matrix.m[5] + this.m[4];\n    const dy = this.m[1] * matrix.m[4] + this.m[3] * matrix.m[5] + this.m[5];\n\n    this.m[0] = m11;\n    this.m[1] = m12;\n    this.m[2] = m21;\n    this.m[3] = m22;\n    this.m[4] = dx;\n    this.m[5] = dy;\n  }\n\n  invert () {\n    const d = 1 / (this.m[0] * this.m[3] - this.m[1] * this.m[2]);\n    const m0 = this.m[3] * d;\n    const m1 = -this.m[1] * d;\n    const m2 = -this.m[2] * d;\n    const m3 = this.m[0] * d;\n    const m4 = d * (this.m[2] * this.m[5] - this.m[3] * this.m[4]);\n    const m5 = d * (this.m[1] * this.m[4] - this.m[0] * this.m[5]);\n\n    this.m[0] = m0;\n    this.m[1] = m1;\n    this.m[2] = m2;\n    this.m[3] = m3;\n    this.m[4] = m4;\n    this.m[5] = m5;\n  }\n\n  rotate (rad) {\n    const c = Math.cos(rad);\n    const s = Math.sin(rad);\n    const m11 = this.m[0] * c + this.m[2] * s;\n    const m12 = this.m[1] * c + this.m[3] * s;\n    const m21 = this.m[0] * -s + this.m[2] * c;\n    const m22 = this.m[1] * -s + this.m[3] * c;\n\n    this.m[0] = m11;\n    this.m[1] = m12;\n    this.m[2] = m21;\n    this.m[3] = m22;\n  }\n\n  translate (x, y) {\n    this.m[4] += this.m[0] * x + this.m[2] * y;\n    this.m[5] += this.m[1] * x + this.m[3] * y;\n  }\n\n  scale (sx, sy) {\n    this.m[0] *= sx;\n    this.m[1] *= sx;\n    this.m[2] *= sy;\n    this.m[3] *= sy;\n  }\n\n  transformPoint (px, py) {\n    const x = px;\n    const y = py;\n\n    px = x * this.m[0] + y * this.m[2] + this.m[4];\n    py = x * this.m[1] + y * this.m[3] + this.m[5];\n\n    return {\n      x: px,\n      y: py\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/transform.js","import lutMatches from './lutMatches.js';\nimport generateLut from '../internal/generateLut.js';\n\nexport default function (image, viewport, invalidated) {\n  // If we have a cached lut and it has the right values, return it immediately\n  if (image.cachedLut !== undefined &&\n    image.cachedLut.windowCenter === viewport.voi.windowCenter &&\n    image.cachedLut.windowWidth === viewport.voi.windowWidth &&\n    lutMatches(image.cachedLut.modalityLUT, viewport.modalityLUT) &&\n    lutMatches(image.cachedLut.voiLUT, viewport.voiLUT) &&\n    image.cachedLut.invert === viewport.invert &&\n    invalidated !== true) {\n    return image.cachedLut.lutArray;\n  }\n\n  // Lut is invalid or not present, regenerate it and cache it\n  generateLut(image, viewport);\n\n  image.cachedLut.windowWidth = viewport.voi.windowWidth;\n  image.cachedLut.windowCenter = viewport.voi.windowCenter;\n  image.cachedLut.invert = viewport.invert;\n  image.cachedLut.voiLUT = viewport.voiLUT;\n  image.cachedLut.modalityLUT = viewport.modalityLUT;\n\n  return image.cachedLut.lutArray;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/getLut.js","import events from '../events.js';\r\nimport triggerEvent from '../triggerEvent.js';\r\n\r\n/**\r\n * This module deals with caching image textures in VRAM for WebGL\r\n */\r\n\r\nconst imageCache = {};\r\n\r\nconst cachedImages = [];\r\n\r\nlet maximumSizeInBytes = 1024 * 1024 * 256; // 256 MB\r\nlet cacheSizeInBytes = 0;\r\n\r\nfunction getCacheInfo () {\r\n  return {\r\n    maximumSizeInBytes,\r\n    cacheSizeInBytes,\r\n    numberOfImagesCached: cachedImages.length\r\n  };\r\n}\r\n\r\nfunction purgeCacheIfNecessary () {\r\n  // If max cache size has not been exceeded, do nothing\r\n  if (cacheSizeInBytes <= maximumSizeInBytes) {\r\n    return;\r\n  }\r\n\r\n  // Cache size has been exceeded, create list of images sorted by timeStamp\r\n  // So we can purge the least recently used image\r\n  function compare (a, b) {\r\n    if (a.timeStamp > b.timeStamp) {\r\n      return -1;\r\n    }\r\n    if (a.timeStamp < b.timeStamp) {\r\n      return 1;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n  cachedImages.sort(compare);\r\n\r\n  // Remove images as necessary\r\n  while (cacheSizeInBytes > maximumSizeInBytes) {\r\n    const lastCachedImage = cachedImages[cachedImages.length - 1];\r\n\r\n    cacheSizeInBytes -= lastCachedImage.sizeInBytes;\r\n    delete imageCache[lastCachedImage.imageId];\r\n    cachedImages.pop();\r\n\r\n    triggerEvent(events, 'cornerstonewebgltextureremoved', { imageId: lastCachedImage.imageId });\r\n  }\r\n\r\n  const cacheInfo = getCacheInfo();\r\n\r\n  triggerEvent(events, 'cornerstonewebgltexturecachefull', cacheInfo);\r\n}\r\n\r\nfunction setMaximumSizeBytes (numBytes) {\r\n  if (numBytes === undefined) {\r\n    throw new Error('setMaximumSizeBytes: parameter numBytes must not be undefined');\r\n  }\r\n  if (numBytes.toFixed === undefined) {\r\n    throw new Error('setMaximumSizeBytes: parameter numBytes must be a number');\r\n  }\r\n\r\n  maximumSizeInBytes = numBytes;\r\n  purgeCacheIfNecessary();\r\n}\r\n\r\nfunction putImageTexture (image, imageTexture) {\r\n  const imageId = image.imageId;\r\n\r\n  if (image === undefined) {\r\n    throw new Error('putImageTexture: image must not be undefined');\r\n  }\r\n\r\n  if (imageId === undefined) {\r\n    throw new Error('putImageTexture: imageId must not be undefined');\r\n  }\r\n\r\n  if (imageTexture === undefined) {\r\n    throw new Error('putImageTexture: imageTexture must not be undefined');\r\n  }\r\n\r\n  if (Object.prototype.hasOwnProperty.call(imageCache, imageId) === true) {\r\n    throw new Error('putImageTexture: imageId already in cache');\r\n  }\r\n\r\n  const cachedImage = {\r\n    imageId,\r\n    imageTexture,\r\n    timeStamp: new Date(),\r\n    sizeInBytes: imageTexture.sizeInBytes\r\n  };\r\n\r\n  imageCache[imageId] = cachedImage;\r\n  cachedImages.push(cachedImage);\r\n\r\n  if (imageTexture.sizeInBytes === undefined) {\r\n    throw new Error('putImageTexture: imageTexture.sizeInBytes must not be undefined');\r\n  }\r\n  if (imageTexture.sizeInBytes.toFixed === undefined) {\r\n    throw new Error('putImageTexture: imageTexture.sizeInBytes is not a number');\r\n  }\r\n  cacheSizeInBytes += cachedImage.sizeInBytes;\r\n  purgeCacheIfNecessary();\r\n}\r\n\r\nfunction getImageTexture (imageId) {\r\n  if (imageId === undefined) {\r\n    throw new Error('getImageTexture: imageId must not be undefined');\r\n  }\r\n  const cachedImage = imageCache[imageId];\r\n\r\n  if (cachedImage === undefined) {\r\n    return;\r\n  }\r\n\r\n  // Bump time stamp for cached image\r\n  cachedImage.timeStamp = new Date();\r\n\r\n  return cachedImage.imageTexture;\r\n}\r\n\r\nfunction removeImageTexture (imageId) {\r\n  if (imageId === undefined) {\r\n    throw new Error('removeImageTexture: imageId must not be undefined');\r\n  }\r\n  const cachedImage = imageCache[imageId];\r\n\r\n  if (cachedImage === undefined) {\r\n    throw new Error('removeImageTexture: imageId must not be undefined');\r\n  }\r\n  cachedImages.splice(cachedImages.indexOf(cachedImage), 1);\r\n  cacheSizeInBytes -= cachedImage.sizeInBytes;\r\n  delete imageCache[imageId];\r\n\r\n  return cachedImage.imageTexture;\r\n}\r\n\r\nfunction purgeCache () {\r\n  while (cachedImages.length > 0) {\r\n    const removedCachedImage = cachedImages.pop();\r\n\r\n    delete imageCache[removedCachedImage.imageId];\r\n  }\r\n  cacheSizeInBytes = 0;\r\n}\r\n\r\nexport default {\r\n  purgeCache,\r\n  getImageTexture,\r\n  putImageTexture,\r\n  removeImageTexture,\r\n  setMaximumSizeBytes\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/textureCache.js","/**\n * Creates and compiles a shader.\n *\n * @param {!WebGLRenderingContext} gl The WebGL Context.\n * @param {string} shaderSource The GLSL source code for the shader.\n * @param {number} shaderType The type of shader, VERTEX_SHADER or FRAGMENT_SHADER.\n *\n * @return {!WebGLShader} The shader.\n */\nfunction compileShader (gl, shaderSource, shaderType) {\n\n  // Create the shader object\n  const shader = gl.createShader(shaderType);\n\n  // Set the shader source code.\n  gl.shaderSource(shader, shaderSource);\n\n  // Compile the shader\n  gl.compileShader(shader);\n\n  // Check if it compiled\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n  if (!success && !gl.isContextLost()) {\n    // Something went wrong during compilation; get the error\n    const infoLog = gl.getShaderInfoLog(shader);\n\n    console.error(`Could not compile shader:\\n${infoLog}`);\n  }\n\n  return shader;\n}\n\n/**\n * Creates a program from 2 shaders.\n *\n * @param {!WebGLRenderingContext} gl The WebGL context.\n * @param {!WebGLShader} vertexShader A vertex shader.\n * @param {!WebGLShader} fragmentShader A fragment shader.\n * @return {!WebGLProgram} A program.\n */\nfunction createProgram (gl, vertexShader, fragmentShader) {\n\n  // Create a program.\n  const program = gl.createProgram();\n\n  // Attach the shaders.\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  // Link the program.\n  gl.linkProgram(program);\n\n  // Check if it linked.\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n  if (!success && !gl.isContextLost()) {\n    // Something went wrong with the link\n    const infoLog = gl.getProgramInfoLog(program);\n\n    console.error(`WebGL program filed to link:\\n${infoLog}`);\n  }\n\n  return program;\n}\n\n/**\n * Creates a program from 2 shaders source (Strings)\n * @param  {!WebGLRenderingContext} gl              The WebGL context.\n * @param  {!WebGLShader} vertexShaderSrc   Vertex shader string\n * @param  {!WebGLShader} fragShaderSrc Fragment shader string\n * @return {!WebGLProgram}                 A program\n */\nexport default function (gl, vertexShaderSrc, fragShaderSrc) {\n  const vertexShader = compileShader(gl, vertexShaderSrc, gl.VERTEX_SHADER);\n  const fragShader = compileShader(gl, fragShaderSrc, gl.FRAGMENT_SHADER);\n\n\n  return createProgram(gl, vertexShader, fragShader);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/createProgramFromString.js","/**\n * This module is responsible for drawing an image to an enabled elements canvas element\n */\nimport setToPixelCoordinateSystem from '../setToPixelCoordinateSystem.js';\nimport { renderColorImage } from './renderColorImage.js';\n\n/**\n * API function to draw a standard web image (PNG, JPG) to an enabledImage\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport function renderWebImage (enabledElement, invalidated) {\n  if (enabledElement === undefined) {\n    throw new Error('renderWebImage: enabledElement parameter must not be undefined');\n  }\n\n  const image = enabledElement.image;\n\n  if (image === undefined) {\n    throw new Error('renderWebImage: image must be loaded before it can be drawn');\n  }\n\n  // If the viewport ww/wc and invert all match the initial state of the image, we can draw the image\n  // Directly. If any of those are changed, we call renderColorImage() to apply the lut\n  if (enabledElement.viewport.voi.windowWidth === enabledElement.image.windowWidth &&\n        enabledElement.viewport.voi.windowCenter === enabledElement.image.windowCenter &&\n        enabledElement.viewport.invert === false) {\n\n    // Get the canvas context and reset the transform\n    const context = enabledElement.canvas.getContext('2d');\n\n    context.setTransform(1, 0, 0, 1, 0, 0);\n\n    // Clear the canvas\n    context.fillStyle = 'black';\n    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n    // Turn off image smooth/interpolation if pixelReplication is set in the viewport\n    context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;\n    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n    // Save the canvas context state and apply the viewport properties\n    setToPixelCoordinateSystem(enabledElement, context);\n\n    const sx = enabledElement.viewport.displayedArea.tlhc.x - 1;\n    const sy = enabledElement.viewport.displayedArea.tlhc.y - 1;\n    const width = enabledElement.viewport.displayedArea.brhc.x - enabledElement.viewport.displayedArea.tlhc.x;\n    const height = enabledElement.viewport.displayedArea.brhc.y - enabledElement.viewport.displayedArea.tlhc.y;\n\n    context.drawImage(image.getImage(), sx, sy, width, height, 0, 0, width, height);\n  } else {\n    renderColorImage(enabledElement, invalidated);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/renderWebImage.js","import { getEnabledElement } from './enabledElements.js';\r\nimport fitToWindow from './fitToWindow.js';\r\nimport updateImage from './updateImage.js';\r\nimport triggerEvent from './triggerEvent.js';\r\n\r\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n *\r\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\r\n * @param {HTMLElement} canvas The Canvas DOM element within the DOM element enabled for Cornerstone\r\n * @returns {void}\r\n */\r\nfunction setCanvasSize (element, canvas) {\r\n  // The device pixel ratio is 1.0 for normal displays and > 1.0\r\n  // For high DPI displays like Retina\r\n  /*\r\n\r\n    This functionality is disabled due to buggy behavior on systems with mixed DPI's.  If the canvas\r\n    is created on a display with high DPI (e.g. 2.0) and then the browser window is dragged to\r\n    a different display with a different DPI (e.g. 1.0), the canvas is not recreated so the pageToPixel\r\n    produces incorrect results.  I couldn't find any way to determine when the DPI changed other than\r\n    by polling which is not very clean.  If anyone has any ideas here, please let me know, but for now\r\n    we will disable this functionality.  We may want\r\n    to add a mechanism to optionally enable this functionality if we can determine it is safe to do\r\n    so (e.g. iPad or iPhone or perhaps enumerate the displays on the system.  I am choosing\r\n    to be cautious here since I would rather not have bug reports or safety issues related to this\r\n    scenario.\r\n\r\n    var devicePixelRatio = window.devicePixelRatio;\r\n    if(devicePixelRatio === undefined) {\r\n        devicePixelRatio = 1.0;\r\n    }\r\n    */\r\n\r\n  // Avoid setting the same value because it flashes the canvas with IE and Edge\r\n  if (canvas.width !== element.clientWidth) {\r\n    canvas.width = element.clientWidth;\r\n    canvas.style.width = `${element.clientWidth}px`;\r\n  }\r\n  // Avoid setting the same value because it flashes the canvas with IE and Edge\r\n  if (canvas.height !== element.clientHeight) {\r\n    canvas.height = element.clientHeight;\r\n    canvas.style.height = `${element.clientHeight}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Resizes an enabled element and optionally fits the image to window\r\n *\r\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\r\n * @param {Boolean} fitViewportToWindow true to refit, false to leave viewport parameters as they are\r\n * @returns {void}\r\n */\r\nexport default function (element, fitViewportToWindow) {\r\n\r\n  const enabledElement = getEnabledElement(element);\r\n\r\n  setCanvasSize(element, enabledElement.canvas);\r\n\r\n  const eventData = {\r\n    element\r\n  };\r\n\r\n  triggerEvent(element, 'cornerstoneelementresized', eventData);\r\n\r\n  if (enabledElement.image === undefined) {\r\n    return;\r\n  }\r\n\r\n  if (fitViewportToWindow === true) {\r\n    fitToWindow(element);\r\n  } else {\r\n    updateImage(element);\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./resize.js","import { getEnabledElement } from './enabledElements.js';\nimport updateImage from './updateImage.js';\n\n/**\n * Retrieves the current image dimensions given an enabled element\n *\n * @param {EnabledElement} enabledElement The Cornerstone Enabled Element\n * @return {{width, height}} The Image dimensions\n */\nfunction getImageSize (enabledElement) {\n  if (enabledElement.viewport.rotation === 0 || enabledElement.viewport.rotation === 180) {\n    return {\n      width: enabledElement.image.width,\n      height: enabledElement.image.height\n    };\n  }\n\n  return {\n    width: enabledElement.image.height,\n    height: enabledElement.image.width\n  };\n\n}\n\n/**\n * Adjusts an image's scale and translation so the image is centered and all pixels\n * in the image are viewable.\n *\n * @param {HTMLElement} element The Cornerstone element to update\n * @returns {void}\n */\nexport default function (element) {\n  const enabledElement = getEnabledElement(element);\n  const imageSize = getImageSize(enabledElement);\n\n  const verticalScale = enabledElement.canvas.height / imageSize.height;\n  const horizontalScale = enabledElement.canvas.width / imageSize.width;\n\n  // The new scale is the minimum of the horizontal and vertical scale values\n  enabledElement.viewport.scale = Math.min(horizontalScale, verticalScale);\n\n  enabledElement.viewport.translation.x = 0;\n  enabledElement.viewport.translation.y = 0;\n  updateImage(element);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./fitToWindow.js","import { getEnabledElement } from './enabledElements.js';\n\n/**\n * Retrieves an array of stored pixel values from a rectangular region of an image\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Number} x The x coordinate of the top left corner of the sampling rectangle in image coordinates\n * @param {Number} y The y coordinate of the top left corner of the sampling rectangle in image coordinates\n * @param {Number} width The width of the of the sampling rectangle in image coordinates\n * @param {Number} height The height of the of the sampling rectangle in image coordinates\n * @returns {Array} The stored pixel value of the pixels in the sampling rectangle\n */\nexport default function (element, x, y, width, height) {\n  if (element === undefined) {\n    throw new Error('getStoredPixels: parameter element must not be undefined');\n  }\n\n  x = Math.round(x);\n  y = Math.round(y);\n  const enabledElement = getEnabledElement(element);\n  const storedPixels = [];\n  let index = 0;\n  const pixelData = enabledElement.image.getPixelData();\n\n  for (let row = 0; row < height; row++) {\n    for (let column = 0; column < width; column++) {\n      const spIndex = ((row + y) * enabledElement.image.columns) + (column + x);\n\n      storedPixels[index++] = pixelData[spIndex];\n    }\n  }\n\n  return storedPixels;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./getStoredPixels.js","import events from './events.js';\nimport triggerEvent from './triggerEvent.js';\n\n/**\n * This module deals with caching images\n */\nlet maximumSizeInBytes = 1024 * 1024 * 1024; // 1 GB\nlet cacheSizeInBytes = 0;\n\n// Dictionary of imageId to cachedImage objects\nconst imageCacheDict = {};\n\n// Array of cachedImage objects\nexport const cachedImages = [];\n\nexport function setMaximumSizeBytes (numBytes) {\n  if (numBytes === undefined) {\n    throw new Error('setMaximumSizeBytes: parameter numBytes must not be undefined');\n  }\n  if (numBytes.toFixed === undefined) {\n    throw new Error('setMaximumSizeBytes: parameter numBytes must be a number');\n  }\n\n  maximumSizeInBytes = numBytes;\n\n  triggerEvent(events, 'cornerstoneimagecachemaximumsizechanged');\n\n  purgeCacheIfNecessary();\n}\n\nfunction purgeCacheIfNecessary () {\n  // If max cache size has not been exceeded, do nothing\n  if (cacheSizeInBytes <= maximumSizeInBytes) {\n    return;\n  }\n\n  // Cache size has been exceeded, create list of images sorted by timeStamp\n  // So we can purge the least recently used image\n  function compare (a, b) {\n    if (a.timeStamp > b.timeStamp) {\n      return -1;\n    }\n    if (a.timeStamp < b.timeStamp) {\n      return 1;\n    }\n\n    return 0;\n  }\n  cachedImages.sort(compare);\n\n  // Remove images as necessary)\n  while (cacheSizeInBytes > maximumSizeInBytes) {\n    const lastCachedImage = cachedImages[cachedImages.length - 1];\n    const imageId = lastCachedImage.imageId;\n\n    removeImageLoadObject(imageId);\n\n    triggerEvent(events, 'cornerstoneimagecachepromiseremoved', { imageId });\n  }\n\n  const cacheInfo = getCacheInfo();\n\n  triggerEvent(events, 'cornerstoneimagecachefull', cacheInfo);\n}\n\nexport function putImageLoadObject (imageId, imageLoadObject) {\n  if (imageId === undefined) {\n    throw new Error('putImageLoadObject: imageId must not be undefined');\n  }\n  if (imageLoadObject.promise === undefined) {\n    throw new Error('putImageLoadObject: imageLoadObject.promise must not be undefined');\n  }\n  if (imageCacheDict.hasOwnProperty(imageId) === true) {\n    throw new Error('putImageLoadObject: imageId already in cache');\n  }\n  if (imageLoadObject.cancelFn && typeof imageLoadObject.cancelFn !== 'function') {\n    throw new Error('putImageLoadObject: imageLoadObject.cancelFn must be a function');\n  }\n\n  const cachedImage = {\n    loaded: false,\n    imageId,\n    sharedCacheKey: undefined, // The sharedCacheKey for this imageId.  undefined by default\n    imageLoadObject,\n    timeStamp: Date.now(),\n    sizeInBytes: 0\n  };\n\n  imageCacheDict[imageId] = cachedImage;\n  cachedImages.push(cachedImage);\n\n  imageLoadObject.promise.then(function (image) {\n    if (cachedImages.indexOf(cachedImage) === -1) {\n      // If the image has been purged before being loaded, we stop here.\n      return;\n    }\n\n    cachedImage.loaded = true;\n    cachedImage.image = image;\n\n    if (image.sizeInBytes === undefined) {\n      throw new Error('putImageLoadObject: image.sizeInBytes must not be undefined');\n    }\n    if (image.sizeInBytes.toFixed === undefined) {\n      throw new Error('putImageLoadObject: image.sizeInBytes is not a number');\n    }\n\n    cachedImage.sizeInBytes = image.sizeInBytes;\n    cacheSizeInBytes += cachedImage.sizeInBytes;\n\n    const eventDetails = {\n      action: 'addImage',\n      image: cachedImage\n    };\n\n    triggerEvent(events, 'cornerstoneimagecachechanged', eventDetails);\n\n    cachedImage.sharedCacheKey = image.sharedCacheKey;\n\n    purgeCacheIfNecessary();\n  }, () => {\n    const cachedImage = imageCacheDict[imageId];\n\n    cachedImages.splice(cachedImages.indexOf(cachedImage), 1);\n    delete imageCacheDict[imageId];\n  });\n}\n\nexport function getImageLoadObject (imageId) {\n  if (imageId === undefined) {\n    throw new Error('getImageLoadObject: imageId must not be undefined');\n  }\n  const cachedImage = imageCacheDict[imageId];\n\n  if (cachedImage === undefined) {\n    return;\n  }\n\n  // Bump time stamp for cached image\n  cachedImage.timeStamp = Date.now();\n\n  return cachedImage.imageLoadObject;\n}\n\nexport function removeImageLoadObject (imageId) {\n  if (imageId === undefined) {\n    throw new Error('removeImageLoadObject: imageId must not be undefined');\n  }\n  const cachedImage = imageCacheDict[imageId];\n\n  if (cachedImage === undefined) {\n    throw new Error('removeImageLoadObject: imageId was not present in imageCache');\n  }\n\n  cachedImages.splice(cachedImages.indexOf(cachedImage), 1);\n  cacheSizeInBytes -= cachedImage.sizeInBytes;\n\n  const eventDetails = {\n    action: 'deleteImage',\n    image: cachedImage\n  };\n\n  triggerEvent(events, 'cornerstoneimagecachechanged', eventDetails);\n  decache(cachedImage.imageLoadObject.promise);\n\n  delete imageCacheDict[imageId];\n}\n\nexport function getCacheInfo () {\n  return {\n    maximumSizeInBytes,\n    cacheSizeInBytes,\n    numberOfImagesCached: cachedImages.length\n  };\n}\n\n// This method should only be called by `removeImageLoadObject` because it's\n// The one that knows how to deal with shared cache keys and cache size.\nfunction decache (imagePromise) {\n  imagePromise.then(function (image) {\n    if (image.decache) {\n      image.decache();\n    }\n  });\n}\n\nexport function purgeCache () {\n  while (cachedImages.length > 0) {\n    const removedCachedImage = cachedImages[0];\n\n    removeImageLoadObject(removedCachedImage.imageId);\n  }\n}\n\nexport function changeImageIdCacheSize (imageId, newCacheSize) {\n  const cacheEntry = imageCacheDict[imageId];\n\n  if (cacheEntry) {\n    cacheEntry.imageLoadObject.promise.then(function (image) {\n      const cacheSizeDifference = newCacheSize - image.sizeInBytes;\n\n      image.sizeInBytes = newCacheSize;\n      cacheEntry.sizeInBytes = newCacheSize;\n      cacheSizeInBytes += cacheSizeDifference;\n\n      const eventDetails = {\n        action: 'changeImageSize',\n        image\n      };\n\n      triggerEvent(events, 'cornerstoneimagecachechanged', eventDetails);\n    });\n  }\n}\n\nexport default {\n  imageCache: imageCacheDict,\n  cachedImages,\n  setMaximumSizeBytes,\n  putImageLoadObject,\n  getImageLoadObject,\n  removeImageLoadObject,\n  getCacheInfo,\n  purgeCache,\n  changeImageIdCacheSize\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageCache.js","import colors from './colors/index.js';\n\n/**\n * Converts the image pixel data into a false color data\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Object} lookupTable A lookup table Object\n *\n * @returns {void}\n */\nexport default function (image, lookupTable) {\n  if (image.color && !image.falseColor) {\n    throw new Error('Color transforms are not implemented yet');\n  }\n\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  const numPixels = image.width * image.height;\n  const origPixelData = image.origPixelData || image.getPixelData();\n  const storedColorPixelData = new Uint8Array(numPixels * 4);\n  let sp;\n  let mapped;\n\n  image.color = true;\n  image.falseColor = true;\n  image.origPixelData = origPixelData;\n\n  if (lookupTable instanceof colors.LookupTable) {\n    lookupTable.build();\n\n    while (storedPixelDataIndex < numPixels) {\n      sp = origPixelData[storedPixelDataIndex++];\n      mapped = lookupTable.mapValue(sp);\n      storedColorPixelData[canvasImageDataIndex++] = mapped[0];\n      storedColorPixelData[canvasImageDataIndex++] = mapped[1];\n      storedColorPixelData[canvasImageDataIndex++] = mapped[2];\n      storedColorPixelData[canvasImageDataIndex++] = mapped[3];\n    }\n  } else if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      sp = origPixelData[storedPixelDataIndex++];\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + (-minPixelValue)][0]; // Red\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + (-minPixelValue)][1]; // Green\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + (-minPixelValue)][2]; // Blue\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + (-minPixelValue)][3]; // Alpha\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      sp = origPixelData[storedPixelDataIndex++];\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][0]; // Red\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][1]; // Green\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][2]; // Blue\n      storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][3]; // Alpha\n    }\n  }\n\n  image.rgba = true;\n  image.cachedLut = undefined;\n  image.render = undefined;\n  image.slope = 1;\n  image.intercept = 0;\n  image.minPixelValue = 0;\n  image.maxPixelValue = 255;\n  image.windowWidth = 255;\n  image.windowCenter = 128;\n  image.getPixelData = () => storedColorPixelData;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./pixelDataToFalseColorData.js","// Internal (some of these are from old internal/legacy expose)\nexport { default as drawImage } from './internal/drawImage.js';\nexport { default as generateLut } from './internal/generateLut.js';\nexport { default as getDefaultViewport } from './internal/getDefaultViewport.js';\nexport { default as requestAnimationFrame } from './internal/requestAnimationFrame.js';\nexport { default as storedPixelDataToCanvasImageData } from './internal/storedPixelDataToCanvasImageData.js';\nexport { default as storedColorPixelDataToCanvasImageData } from './internal/storedColorPixelDataToCanvasImageData.js';\nexport { default as storedPixelDataToCanvasImageDataColorLUT } from './internal/storedPixelDataToCanvasImageDataColorLUT.js';\nexport { default as storedPixelDataToCanvasImageDataPseudocolorLUT } from './internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js';\n\nexport { default as internal } from './internal/index.js';\n\n// Rendering\nexport { renderLabelMapImage } from './rendering/renderLabelMapImage.js';\nexport { renderPseudoColorImage } from './rendering/renderPseudoColorImage.js';\nexport { renderColorImage } from './rendering/renderColorImage.js';\nexport { renderGrayscaleImage } from './rendering/renderGrayscaleImage.js';\nexport { renderWebImage } from './rendering/renderWebImage.js';\n\nexport { default as canvasToPixel } from './canvasToPixel.js';\nexport { default as disable } from './disable.js';\nexport { default as displayImage } from './displayImage.js';\nexport { default as draw } from './draw.js';\nexport { default as drawInvalidated } from './drawInvalidated.js';\nexport { default as enable } from './enable.js';\nexport { getElementData, removeElementData } from './enabledElementData.js';\nexport {\n  getEnabledElement,\n  addEnabledElement,\n  getEnabledElementsByImageId,\n  getEnabledElements\n} from './enabledElements.js';\n\nexport {\n  addLayer,\n  removeLayer,\n  getLayer,\n  getLayers,\n  getVisibleLayers,\n  setActiveLayer,\n  getActiveLayer,\n  setLayerImage\n} from './layers.js';\n\nexport { default as fitToWindow } from './fitToWindow.js';\nexport { default as getDefaultViewportForImage } from './getDefaultViewportForImage.js';\nexport { default as getImage } from './getImage.js';\nexport { default as getPixels } from './getPixels.js';\nexport { default as getStoredPixels } from './getStoredPixels.js';\nexport { default as getViewport } from './getViewport.js';\nexport {\n  loadImage,\n  loadAndCacheImage,\n  registerImageLoader,\n  registerUnknownImageLoader\n} from './imageLoader.js';\n\nexport { default as invalidate } from './invalidate.js';\nexport { default as invalidateImageId } from './invalidateImageId.js';\nexport { default as pageToPixel } from './pageToPixel.js';\nexport { default as pixelToCanvas } from './pixelToCanvas.js';\nexport { default as reset } from './reset.js';\nexport { default as resize } from './resize.js';\nexport { default as setToPixelCoordinateSystem } from './setToPixelCoordinateSystem.js';\nexport { default as setViewport } from './setViewport.js';\nexport { default as updateImage } from './updateImage.js';\nexport { default as pixelDataToFalseColorData } from './pixelDataToFalseColorData.js';\n\nexport { default as rendering } from './rendering/index.js';\nexport { default as imageCache } from './imageCache.js';\nexport { default as metaData } from './metaData.js';\nexport { default as webGL } from './webgl/index.js';\nexport { default as colors } from './colors/index.js';\n\nexport { convertImageToFalseColorImage,\n  convertToFalseColorImage,\n  restoreImage } from './falseColorMapping.js';\n\nexport { default as events } from './events.js';\nexport { default as triggerEvent } from './triggerEvent.js';\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","import drawImage from './drawImage.js';\r\nimport generateLut from './generateLut.js';\r\nimport getDefaultViewport from './getDefaultViewport.js';\r\nimport requestAnimationFrame from './requestAnimationFrame.js';\r\nimport storedPixelDataToCanvasImageData from './storedPixelDataToCanvasImageData.js';\r\nimport storedPixelDataToCanvasImageDataRGBA from './storedPixelDataToCanvasImageDataRGBA.js';\r\nimport storedColorPixelDataToCanvasImageData from './storedColorPixelDataToCanvasImageData.js';\r\nimport storedPixelDataToCanvasImageDataColorLUT from './storedPixelDataToCanvasImageDataColorLUT.js';\r\nimport storedPixelDataToCanvasImageDataPseudocolorLUT from './storedPixelDataToCanvasImageDataPseudocolorLUT.js';\r\nimport getTransform from './getTransform.js';\r\nimport calculateTransform from './calculateTransform.js';\r\nimport { Transform } from './transform.js';\r\n\r\nexport default {\r\n  drawImage,\r\n  generateLut,\r\n  getDefaultViewport,\r\n  requestAnimationFrame,\r\n  storedPixelDataToCanvasImageData,\r\n  storedPixelDataToCanvasImageDataRGBA,\r\n  storedPixelDataToCanvasImageDataColorLUT,\r\n  storedPixelDataToCanvasImageDataPseudocolorLUT,\r\n  storedColorPixelDataToCanvasImageData,\r\n  getTransform,\r\n  calculateTransform,\r\n  Transform\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./internal/index.js","/**\n * Check if two lookup tables match\n *\n * @param {LUT} a A lookup table function\n * @param {LUT} b Another lookup table function\n * @return {boolean} Whether or not they match\n */\nexport default function (a, b) {\n  // If undefined, they are equal\n  if (!a && !b) {\n    return true;\n  }\n  // If one is undefined, not equal\n  if (!a || !b) {\n    return false;\n  }\n\n  // Check the unique ids\n  return (a.id === b.id);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/lutMatches.js","import getVOILUT from './getVOILut.js';\n\n/**\n * Creates a LUT used while rendering to convert stored pixel values to\n * display pixels\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Number} windowWidth The Window Width\n * @param {Number} windowCenter The Window Center\n * @param {Boolean} invert A boolean describing whether or not the image has been inverted\n * @param {Array} [voiLUT] A Volume of Interest Lookup Table\n *\n * @returns {Uint8ClampedArray} A lookup table to apply to the image\n */\nexport default function (image, windowWidth, windowCenter, invert, voiLUT) {\n  const maxPixelValue = image.maxPixelValue;\n  const minPixelValue = image.minPixelValue;\n  const offset = Math.min(minPixelValue, 0);\n\n  if (image.cachedLut === undefined) {\n    const length = maxPixelValue - offset + 1;\n\n    image.cachedLut = {};\n    image.cachedLut.lutArray = new Uint8ClampedArray(length);\n  }\n\n  const lut = image.cachedLut.lutArray;\n  const vlutfn = getVOILUT(windowWidth, windowCenter, voiLUT);\n\n  if (invert === true) {\n    for (let storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {\n      lut[storedValue + (-offset)] = 255 - vlutfn(storedValue);\n    }\n  } else {\n    for (let storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {\n      lut[storedValue + (-offset)] = vlutfn(storedValue);\n    }\n  }\n\n  return lut;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/generateColorLut.js","import now from './now.js';\n\n/**\n * Converts stored RGBA color pixel values to display pixel values using a LUT.\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} lut Lookup table array\n * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels\n *\n * @returns {void}\n */\nexport default function (image, lut, canvasImageDataData) {\n\n  let start = now();\n  const pixelData = image.getPixelData();\n\n  image.stats.lastGetPixelDataTime = now() - start;\n\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  const numPixels = pixelData.length;\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n  start = now();\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)]; // Green\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + (-minPixelValue)]; // Blue\n      canvasImageDataData[canvasImageDataIndex++] = pixelData[storedPixelDataIndex++];\n    }\n  } else {\n    while (storedPixelDataIndex < numPixels) {\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Red\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Green\n      canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Blue\n      canvasImageDataData[canvasImageDataIndex++] = pixelData[storedPixelDataIndex++];\n    }\n  }\n  image.stats.lastStoredPixelDataToCanvasImageDataTime = now() - start;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/storedRGBAPixelDataToCanvasImageData.js","/* eslint no-bitwise: 0 */\n\nimport { shaders, dataUtilities } from './shaders/index.js';\nimport { vertexShader } from './vertexShader.js';\nimport textureCache from './textureCache.js';\nimport createProgramFromString from './createProgramFromString.js';\nimport autoWindow from '../internal/autoWindow.js';\nimport now from '../internal/now.js';\nimport getModalityLUT from '../internal/getModalityLUT.js';\nimport getVOILUT from '../internal/getVOILut.js';\nimport getMinMax from '../internal/getMinMax.js';\n\nconst renderCanvas = document.createElement('canvas');\nlet gl;\nlet texCoordBuffer;\nlet positionBuffer;\nlet isWebGLInitialized = false;\n\nexport { isWebGLInitialized };\n\nexport function getRenderCanvas () {\n  return renderCanvas;\n}\n\nfunction initShaders () {\n  for (const id in shaders) {\n    // Console.log(\"WEBGL: Loading shader\", id);\n    const shader = shaders[id];\n\n    shader.attributes = {};\n    shader.uniforms = {};\n    shader.vert = vertexShader;\n\n    shader.program = createProgramFromString(gl, shader.vert, shader.frag);\n\n    shader.attributes.texCoordLocation = gl.getAttribLocation(shader.program, 'a_texCoord');\n    gl.enableVertexAttribArray(shader.attributes.texCoordLocation);\n\n    shader.attributes.positionLocation = gl.getAttribLocation(shader.program, 'a_position');\n    gl.enableVertexAttribArray(shader.attributes.positionLocation);\n\n    shader.uniforms.resolutionLocation = gl.getUniformLocation(shader.program, 'u_resolution');\n  }\n}\n\nexport function initRenderer () {\n  if (isWebGLInitialized === true) {\n    // Console.log(\"WEBGL Renderer already initialized\");\n    return;\n  }\n\n  if (initWebGL(renderCanvas)) {\n    initBuffers();\n    initShaders();\n    // Console.log(\"WEBGL Renderer initialized!\");\n    isWebGLInitialized = true;\n  }\n}\n\nfunction updateRectangle (gl, width, height) {\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n    width, height,\n    0, height,\n    width, 0,\n    0, 0]), gl.STATIC_DRAW);\n}\n\nfunction handleLostContext (event) {\n  event.preventDefault();\n  console.warn('WebGL Context Lost!');\n}\n\nfunction handleRestoredContext (event) {\n  event.preventDefault();\n  isWebGLInitialized = false;\n  textureCache.purgeCache();\n  initRenderer();\n  // Console.log('WebGL Context Restored.');\n}\n\nfunction initWebGL (canvas) {\n\n  gl = null;\n  try {\n    // Try to grab the standard context. If it fails, fallback to experimental.\n    const options = {\n      preserveDrawingBuffer: true // Preserve buffer so we can copy to display canvas element\n    };\n\n    // ---------------- Testing purposes -------------\n    // If (debug === true && WebGLDebugUtils) {\n    //    RenderCanvas = WebGLDebugUtils.makeLostContextSimulatingCanvas(renderCanvas);\n    // }\n    // ---------------- Testing purposes -------------\n\n    gl = canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options);\n\n    // Set up event listeners for context lost / context restored\n    canvas.removeEventListener('webglcontextlost', handleLostContext, false);\n    canvas.addEventListener('webglcontextlost', handleLostContext, false);\n\n    canvas.removeEventListener('webglcontextrestored', handleRestoredContext, false);\n    canvas.addEventListener('webglcontextrestored', handleRestoredContext, false);\n\n  } catch (error) {\n    throw new Error('Error creating WebGL context');\n  }\n\n  // If we don't have a GL context, give up now\n  if (!gl) {\n    console.error('Unable to initialize WebGL. Your browser may not support it.');\n    gl = null;\n  }\n\n  return gl;\n}\n\nfunction getImageDataType (image, viewport) {\n  if (image.color) {\n    return 'rgb';\n  }\n\n  const minMax = (viewport && viewport.voi && viewport.voi.minMax) ? viewport.voi.minMax : { min : image.minPixelValue, max : image.maxPixelValue };\n  let datatype = 'int';\n\n  if (minMax.min >= 0) {\n    datatype = `u${datatype}`;\n  }\n\n  if (minMax.max > 255) {\n    datatype += '16';\n  } else {\n    datatype += '8';\n  }\n\n  return datatype;\n}\n\nfunction getShaderProgram (image, viewport) {\n\n  const datatype = getImageDataType(image, viewport);\n  // We need a mechanism for\n  // Choosing the shader based on the image datatype\n  // Console.log(\"Datatype: \" + datatype);\n\n  if (shaders.hasOwnProperty(datatype)) {\n    return shaders[datatype];\n  }\n\n  return shaders.rgb;\n}\n\nfunction generateTexture (image, viewport, mlutfn, vlutfn) {\n  const TEXTURE_FORMAT = {\n    uint8: gl.LUMINANCE,\n    int8: gl.LUMINANCE_ALPHA,\n    uint16: gl.LUMINANCE_ALPHA,\n    int16: gl.RGB,\n    rgb: gl.RGB\n  };\n\n  const TEXTURE_BYTES = {\n    int8: 1, // Luminance\n    uint16: 2, // Luminance + Alpha\n    int16: 3, // RGB\n    rgb: 3 // RGB\n  };\n\n  const imageDataType = getImageDataType(image, viewport);\n  const format = TEXTURE_FORMAT[imageDataType];\n\n  // GL texture configuration\n  const texture = gl.createTexture();\n\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\n  const imageData = dataUtilities[imageDataType].storedPixelDataToImageData(image, mlutfn, vlutfn);\n\n  gl.texImage2D(gl.TEXTURE_2D, 0, format, image.width, image.height, 0, format, gl.UNSIGNED_BYTE, imageData);\n\n  // Calculate the size in bytes of this image in memory\n  const sizeInBytes = image.width * image.height * TEXTURE_BYTES[imageDataType];\n\n  return {\n    texture,\n    sizeInBytes\n  };\n}\n\nfunction getImageTexture (image, viewport, mlutfn, vlutfn) {\n  let imageTexture = textureCache.getImageTexture(image.imageId);\n\n  if (!imageTexture) {\n    // Console.log(\"Generating texture for imageid: \", image.imageId);\n    imageTexture = generateTexture(image, viewport, mlutfn, vlutfn);\n    textureCache.putImageTexture(image, imageTexture);\n  }\n\n  return imageTexture.texture;\n}\n\nfunction initBuffers () {\n  positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n    1, 1,\n    0, 1,\n    1, 0,\n    0, 0\n  ]), gl.STATIC_DRAW);\n\n\n  texCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n    1.0, 1.0,\n    0.0, 1.0,\n    1.0, 0.0,\n    0.0, 0.0\n  ]), gl.STATIC_DRAW);\n}\n\nfunction renderQuad (shader, parameters, texture, width, height) {\n  gl.clearColor(1.0, 0.0, 0.0, 1.0);\n  gl.viewport(0, 0, width, height);\n\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  gl.useProgram(shader.program);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.vertexAttribPointer(shader.attributes.texCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.vertexAttribPointer(shader.attributes.positionLocation, 2, gl.FLOAT, false, 0, 0);\n\n  for (const key in parameters) {\n    const uniformLocation = gl.getUniformLocation(shader.program, key);\n\n    if (!uniformLocation) {\n      continue;\n\n      // Disabling this error for now since RGB requires minPixelValue\n      // but the other shaders do not.\n      // throw `Could not access location for uniform: ${key}`;\n    }\n\n    const uniform = parameters[key];\n\n    const type = uniform.type;\n    const value = uniform.value;\n\n    if (type === 'i') {\n      gl.uniform1i(uniformLocation, value);\n    } else if (type === 'f') {\n      gl.uniform1f(uniformLocation, value);\n    } else if (type === '2f') {\n      gl.uniform2f(uniformLocation, value[0], value[1]);\n    }\n  }\n\n  updateRectangle(gl, width, height);\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n}\n\nfunction getModalityLUTFunction (modalityLUT) {\n  const minMax = modalityLUT.minMax;\n  const minValue = minMax.min;\n  const maxValue = minMax.max;\n  const maxValueMapped = modalityLUT.firstValueMapped + modalityLUT.lut.length;\n\n  return (storedPixelValue) => {\n    if (storedPixelValue < modalityLUT.firstValueMapped) {\n      return minValue;\n    } else if (storedPixelValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return modalityLUT.lut[storedPixelValue];\n  };\n}\n\nfunction getVoiLUTFunction (voiLUT) {\n  const minMax = voiLUT.minMax;\n  const minValue = minMax.min;\n  const maxValue = minMax.max;\n  const maxValueMapped = voiLUT.firstValueMapped + voiLUT.lut.length - 1;\n\n  return function (modalityLutValue) {\n    if (modalityLutValue < voiLUT.firstValueMapped) {\n      return minValue;\n    } else if (modalityLutValue >= maxValueMapped) {\n      return maxValue;\n    }\n\n    return voiLUT.lut[modalityLutValue];\n  };\n}\n\nexport function render (enabledElement) {\n  // Resize the canvas\n  const image = enabledElement.image;\n\n  renderCanvas.width = image.width;\n  renderCanvas.height = image.height;\n\n  const viewport = enabledElement.viewport;\n  autoWindow(image, viewport);\n\n  // Get the lut to use\n  let start = now();\n  const mlutfn = (viewport.modalityLUT !== undefined && viewport.modalityLUT.lut !== undefined) ? getModalityLUTFunction(viewport.modalityLUT) : undefined;\n  const vlutfn = (viewport.voiLUT !== undefined && viewport.voiLUT.lut !== undefined) ? getVoiLUTFunction(viewport.voiLUT) : undefined;\n\n  image.stats = image.stats || {};\n  image.stats.lastLutGenerateTime = now() - start;\n\n  // Render the current image\n  const shader = getShaderProgram(image, viewport);\n  const texture = getImageTexture(image, viewport, mlutfn, vlutfn);\n\n  const parameters = {\n    u_resolution: { type: '2f',\n      value: [image.width, image.height] },\n    wc: { type: 'f',\n      value: viewport.voi.windowCenter },\n    ww: { type: 'f',\n      value: viewport.voi.windowWidth },\n    slope: { type: 'f',\n      value: image.slope },\n    intercept: { type: 'f',\n      value: image.intercept },\n    minPixelValue: { type: 'f',\n      value: image.minPixelValue },\n    invert: { type: 'i',\n      value: viewport.invert ? 1 : 0 }\n  };\n\n  renderQuad(shader, parameters, texture, image.width, image.height);\n\n  return renderCanvas;\n}\n\nexport function isWebGLAvailable () {\n  // Adapted from\n  // http://stackoverflow.com/questions/9899807/three-js-detect-webgl-support-and-fallback-to-regular-canvas\n\n  const options = {\n    failIfMajorPerformanceCaveat: true\n  };\n\n  try {\n    const canvas = document.createElement('canvas');\n\n\n    return Boolean(window.WebGLRenderingContext) &&\n            (canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options));\n  } catch (e) {\n    return false;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/renderer.js","import { int16Shader, int16DataUtilities } from './int16.js';\nimport { int8Shader, int8DataUtilities } from './int8.js';\nimport { rgbShader, rgbDataUtilities } from './rgb.js';\nimport { uint16Shader, uint16DataUtilities } from './uint16.js';\nimport { uint8Shader, uint8DataUtilities } from './uint8.js';\n\nconst shaders = {\n  int16: int16Shader,\n  int8: int8Shader,\n  rgb: rgbShader,\n  uint16: uint16Shader,\n  uint8: uint8Shader\n};\n\nconst dataUtilities = {\n  int16: int16DataUtilities,\n  int8: int8DataUtilities,\n  rgb: rgbDataUtilities,\n  uint16: uint16DataUtilities,\n  uint8: uint8DataUtilities\n};\n\nexport { shaders, dataUtilities };\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/shaders/index.js","/* eslint no-bitwise: 0 */\nimport getStoredValue from '../../internal/getStoredValue.js';\n\nconst int16Shader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * Pack int16 into three uint8 channels (r, g, b)\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData (image, mlutfn, vlutfn) {\n\n  // Transfer image data to alpha and luminance channels of WebGL texture\n  // Credit to @jpambrun and @fernandojsg\n\n  // Pack int16 into three uint8 channels (r, g, b)\n  const pixelData = image.getPixelData();\n  const numberOfChannels = 3;\n  const data = new Uint8Array(image.width * image.height * numberOfChannels);\n  const shouldShift = image.pixelRepresentation !== undefined && image.pixelRepresentation === 1;\n  const shift = (shouldShift && image.bitsStored !== undefined) ? (32 - image.bitsStored) : undefined;\n  let offset = 0;\n\n  for (let i = 0; i < pixelData.length; i++) {\n    var sv = getStoredValue(i, pixelData, shift);\n\n    if (image.photometricInterpretation === \"MONOCHROME1\") {\n      sv = image.maxPixelValue - sv;\n    }\n\n    if (mlutfn) {\n      sv = mlutfn(sv);\n    }\n\n    if (vlutfn) {\n      sv = vlutfn(sv);\n    }\n\n    const val = Math.abs(sv);\n\n    data[offset++] = val & 0xFF;\n    data[offset++] = val >> 8;\n    data[offset++] = sv < 0 ? 0 : 1; // 0 For negative, 1 for positive\n  }\n\n  return data;\n}\n\nexport const int16DataUtilities = {\n  storedPixelDataToImageData\n};\n\nint16Shader.frag = 'precision mediump float;' +\n    'uniform sampler2D u_image;' +\n    'uniform float ww;' +\n    'uniform float wc;' +\n    'uniform float slope;' +\n    'uniform float intercept;' +\n    'uniform int invert;' +\n    'varying vec2 v_texCoord;' +\n\n    'void main() {' +\n        // Get texture\n        'vec4 color = texture2D(u_image, v_texCoord);' +\n\n        // Calculate luminance from packed texture\n        'float intensity = color.r*256.0 + color.g*65536.0;' +\n\n        'if (color.b == 0.0)' +\n            'intensity = -intensity;' +\n\n        // Rescale based on slope and window settings\n        'intensity = intensity * slope + intercept;' +\n        'float center0 = wc - 0.5;' +\n        'float width0 = max(ww, 1.0);' +\n        'intensity = (intensity - center0) / width0 + 0.5;' +\n\n        // Clamp intensity\n        'intensity = clamp(intensity, 0.0, 1.0);' +\n\n        // RGBA output\n        'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n        // Apply any inversion necessary\n        'if (invert == 1)' +\n            'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' +\n    '}';\n\nexport { int16Shader };\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/shaders/int16.js","const int8Shader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * Store data in Uint8Array\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData (image, mlutfn, vlutfn) {\n  // Transfer image data to alpha channel of WebGL texture\n  // Store data in Uint8Array\n  const pixelData = image.getPixelData();\n  const numberOfChannels = 2;\n  const data = new Uint8Array(image.width * image.height * numberOfChannels);\n  let offset = 0;\n\n  for (let i = 0; i < pixelData.length; i++) {\n    var sv  = pixelData[i];\n\n    if (image.photometricInterpretation === \"MONOCHROME1\") {\n      sv = image.maxPixelValue - sv;\n    }\n\n    if (mlutfn) {\n      sv = mlutfn(sv);\n    }\n\n    if (vlutfn) {\n      sv = vlutfn(sv);\n    }\n\n    data[offset++] = sv;\n    data[offset++] = sv < 0 ? 0 : 1; // 0 For negative, 1 for positive\n  }\n\n  return data;\n}\n\nexport const int8DataUtilities = {\n  storedPixelDataToImageData\n};\n\nint8Shader.frag = 'precision mediump float;' +\n    'uniform sampler2D u_image;' +\n    'uniform float ww;' +\n    'uniform float wc;' +\n    'uniform float slope;' +\n    'uniform float intercept;' +\n    'uniform int invert;' +\n    'varying vec2 v_texCoord;' +\n\n    'void main() {' +\n        // Get texture\n        'vec4 color = texture2D(u_image, v_texCoord);' +\n\n        // Calculate luminance from packed texture\n        'float intensity = color.r*256.;' +\n\n        'if (color.a == 0.0)' +\n            'intensity = -intensity;' +\n\n        // Rescale based on slope and window settings\n        'intensity = intensity * slope + intercept;' +\n        'float center0 = wc - 0.5;' +\n        'float width0 = max(ww, 1.0);' +\n        'intensity = (intensity - center0) / width0 + 0.5;' +\n\n        // Clamp intensity\n        'intensity = clamp(intensity, 0.0, 1.0);' +\n\n        // RGBA output\n        'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n        // Apply any inversion necessary\n        'if (invert == 1)' +\n            'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' +\n    '}';\n\nexport { int8Shader };\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/shaders/int8.js","const rgbShader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * Pack RGB images into a 3-channel RGB texture\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData (image) {\n  const minPixelValue = image.minPixelValue;\n  let canvasImageDataIndex = 0;\n  let storedPixelDataIndex = 0;\n  // Only 3 channels, since we use WebGL's RGB texture format\n  const numStoredPixels = image.width * image.height * 4;\n  const numOutputPixels = image.width * image.height * 3;\n  const storedPixelData = image.getPixelData();\n  const data = new Uint8Array(numOutputPixels);\n\n  // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\n  // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\n  if (minPixelValue < 0) {\n    while (storedPixelDataIndex < numStoredPixels) {\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + (-minPixelValue); // Red\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + (-minPixelValue); // Green\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + (-minPixelValue); // Blue\n      storedPixelDataIndex += 1; // The stored pixel data has 4 channels\n    }\n  } else {\n    while (storedPixelDataIndex < numStoredPixels) {\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Red\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Green\n      data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Blue\n      storedPixelDataIndex += 1; // The stored pixel data has 4 channels\n    }\n  }\n\n  return data;\n}\n\nexport const rgbDataUtilities = {\n  storedPixelDataToImageData\n};\n\nrgbShader.frag = 'precision mediump float;' +\n    'uniform sampler2D u_image;' +\n    'uniform float ww;' +\n    'uniform float wc;' +\n    'uniform float slope;' +\n    'uniform float intercept;' +\n    'uniform float minPixelValue;' +\n    'uniform int invert;' +\n    'varying vec2 v_texCoord;' +\n\n    'void main() {' +\n\n        // Get texture\n        'vec3 color = texture2D(u_image, v_texCoord).xyz;' +\n\n        // Rescale based on slope and intercept\n        'color = color * 256.0 * slope + intercept;' +\n\n        // Apply window settings\n        'float center0 = wc - 0.5 - minPixelValue;' +\n        'float width0 = max(ww, 1.0);' +\n        'color = (color - center0) / width0 + 0.5;' +\n\n        // RGBA output\n        'gl_FragColor = vec4(color, 1);' +\n\n        // Apply any inversion necessary\n        'if (invert == 1)' +\n            'gl_FragColor.rgb = 1. - gl_FragColor.rgb;' +\n    '}';\n\nexport { rgbShader };\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/shaders/rgb.js","/* eslint no-bitwise: 0 */\n\nconst uint16Shader = {};\n\n/**\n * Convert stored pixel data to image data.\n *\n * For uint16 pack uint16 into two uint8 channels (r and a).\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData (image, mlutfn, vlutfn) {\n\n  // Transfer image data to alpha and luminance channels of WebGL texture\n  // Credit to @jpambrun and @fernandojsg\n\n  // Pack uint16 into two uint8 channels (r and a)\n  const pixelData = image.getPixelData();\n  const numberOfChannels = 2;\n  const data = new Uint8Array(image.width * image.height * numberOfChannels);\n  let offset = 0;\n\n  for (let i = 0; i < pixelData.length; i++) {\n    var sv = pixelData[i];\n\n    if (image.photometricInterpretation === \"MONOCHROME1\") {\n      sv = image.maxPixelValue - sv;\n    }\n\n    if (mlutfn) {\n      sv = mlutfn(sv);\n    }\n\n    if (vlutfn) {\n      sv = vlutfn(sv);\n    }\n\n    data[offset++] = sv & 0xFF;\n    data[offset++] = sv >> 8;\n  }\n\n  return data;\n}\n\nexport const uint16DataUtilities = {\n  storedPixelDataToImageData\n};\n\nuint16Shader.frag = 'precision mediump float;' +\n    'uniform sampler2D u_image;' +\n    'uniform float ww;' +\n    'uniform float wc;' +\n    'uniform float slope;' +\n    'uniform float intercept;' +\n    'uniform int invert;' +\n    'varying vec2 v_texCoord;' +\n\n    'void main() {' +\n        // Get texture\n        'vec4 color = texture2D(u_image, v_texCoord);' +\n\n        // Calculate luminance from packed texture\n        'float intensity = color.r*256.0 + color.a*65536.0;' +\n\n        // Rescale based on slope and window settings\n        'intensity = intensity * slope + intercept;' +\n        'float center0 = wc - 0.5;' +\n        'float width0 = max(ww, 1.0);' +\n        'intensity = (intensity - center0) / width0 + 0.5;' +\n\n        // Clamp intensity\n        'intensity = clamp(intensity, 0.0, 1.0);' +\n\n        // RGBA output\n        'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n        // Apply any inversion necessary\n        'if (invert == 1)' +\n            'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' +\n    '}';\n\nexport { uint16Shader };\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/shaders/uint16.js","const uint8Shader = {};\n\n/**\n * Convert stored pixel data to image data. Here we will store\n * all data in the alpha channel.\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {Array} lut Lookup table to apply to the image pixel data\n * @returns {Uint8Array} The image data for use by the WebGL shader\n */\nfunction storedPixelDataToImageData (image, mlutfn, vlutfn) {\n  // Transfer image data to alpha channel of WebGL texture\n\n  if (mlutfn || vlutfn) {\n    const pixelData = image.getPixelData();\n    const data = new Uint8Array(pixelData.length);\n\n    for (let i = 0; i < pixelData.length; i++) {\n      var sv = pixelData[i];\n\n      if (image.photometricInterpretation === \"MONOCHROME1\") {\n        sv = image.maxPixelValue - sv;\n      }\n\n      if (mlutfn) {\n        sv = mlutfn(sv);\n      }\n\n      if (vlutfn) {\n        sv = vlutfn(sv);\n      }\n\n      data[i] = sv;\n    }\n\n    return data;\n  } else if (image.photometricInterpretation === \"MONOCHROME1\") {\n    image.getPixelData().map(function(sv) { return image.maxPixelValue - sv; });\n  }\n\n  return image.getPixelData();\n}\n\nexport const uint8DataUtilities = {\n  storedPixelDataToImageData\n};\n\nuint8Shader.frag = 'precision mediump float;' +\n    'uniform sampler2D u_image;' +\n    'uniform float ww;' +\n    'uniform float wc;' +\n    'uniform float slope;' +\n    'uniform float intercept;' +\n    'uniform int invert;' +\n    'varying vec2 v_texCoord;' +\n\n    'void main() {' +\n        // Get texture\n        'vec4 color = texture2D(u_image, v_texCoord);' +\n\n        // Calculate luminance from packed texture\n        'float intensity = color.r*256.0;' +\n\n        // Rescale based on slope and window settings\n        'intensity = intensity * slope + intercept;' +\n        'float center0 = wc - 0.5;' +\n        'float width0 = max(ww, 1.0);' +\n        'intensity = (intensity - center0) / width0 + 0.5;' +\n\n        // Clamp intensity\n        'intensity = clamp(intensity, 0.0, 1.0);' +\n\n        // RGBA output\n        'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' +\n\n        // Apply any inversion necessary\n        'if (invert == 1)' +\n            'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' +\n    '}';\n\nexport { uint8Shader };\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/shaders/uint8.js","export const vertexShader = 'attribute vec2 a_position;' +\n    'attribute vec2 a_texCoord;' +\n    'uniform vec2 u_resolution;' +\n    'varying vec2 v_texCoord;' +\n    'void main() {' +\n        'vec2 zeroToOne = a_position / u_resolution;' +\n        'vec2 zeroToTwo = zeroToOne * 2.0;' +\n        'vec2 clipSpace = zeroToTwo - 1.0;' +\n        'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\n        'v_texCoord = a_texCoord;' +\n    '}';\n\n\n\n// WEBPACK FOOTER //\n// ./webgl/vertexShader.js","import { getEnabledElement } from './enabledElements.js';\nimport getTransform from './internal/getTransform.js';\n\n/**\n * Converts a point in the canvas coordinate system to the pixel coordinate system\n * system.  This can be used to reset tools' image coordinates after modifications\n * have been made in canvas space (e.g. moving a tool by a few cm, independent of\n * image resolution).\n *\n * @param {HTMLElement} element The Cornerstone element within which the input point lies\n * @param {{x: Number, y: Number}} pt The input point in the canvas coordinate system\n *\n * @returns {{x: Number, y: Number}} The transformed point in the pixel coordinate system\n */\nexport default function (element, pt) {\n  const enabledElement = getEnabledElement(element);\n  const transform = getTransform(enabledElement);\n\n  transform.invert();\n\n  return transform.transformPoint(pt.x, pt.y);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./canvasToPixel.js","import { getEnabledElements } from './enabledElements.js';\r\nimport triggerEvent from './triggerEvent.js';\r\n\r\n\r\n/**\r\n *  Disable an HTML element for further use in Cornerstone\r\n *\r\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\r\n * @returns {void}\r\n */\r\nexport default function (element) {\r\n  if (element === undefined) {\r\n    throw new Error('disable: element must not be undefined');\r\n  }\r\n\r\n  // Search for this element in this list of enabled elements\r\n  const enabledElements = getEnabledElements();\r\n\r\n  for (let i = 0; i < enabledElements.length; i++) {\r\n    if (enabledElements[i].element === element) {\r\n      // We found it!\r\n\r\n      // Fire an event so dependencies can cleanup\r\n      const eventData = {\r\n        element\r\n      };\r\n\r\n      triggerEvent(element, 'cornerstoneelementdisabled', eventData);\r\n\r\n      // Remove the child DOM elements that we created (e.g.canvas)\r\n      enabledElements[i].element.removeChild(enabledElements[i].canvas);\r\n      enabledElements[i].canvas = undefined;\r\n\r\n      // Remove this element from the list of enabled elements\r\n      enabledElements.splice(i, 1);\r\n\r\n      break;\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./disable.js","import { getEnabledElement } from './enabledElements.js';\nimport getDefaultViewport from './internal/getDefaultViewport.js';\nimport updateImage from './updateImage.js';\nimport now from './internal/now.js';\nimport { setLayerImage } from './layers.js';\nimport triggerEvent from './triggerEvent.js';\n\n/**\n * Sets a new image object for a given element.\n *\n * Will also apply an optional viewport setting.\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {Object} image An Image loaded by a Cornerstone Image Loader\n * @param {Object} [viewport] A set of Cornerstone viewport parameters\n * @returns {void}\n */\nexport default function (element, image, viewport) {\n  if (element === undefined) {\n    throw new Error('displayImage: parameter element must not be undefined');\n  }\n  if (image === undefined) {\n    throw new Error('displayImage: parameter image must not be undefined');\n  }\n\n  const enabledElement = getEnabledElement(element);\n  const oldImage = enabledElement.image;\n\n  enabledElement.image = image;\n\n  if (enabledElement.layers && enabledElement.layers.length) {\n    setLayerImage(element, image);\n  }\n\n  if (enabledElement.viewport === undefined) {\n    enabledElement.viewport = getDefaultViewport(enabledElement.canvas, image);\n  }\n\n  // Merge viewport\n  if (viewport) {\n    for (const attrname in viewport) {\n      if (viewport[attrname] !== null) {\n        enabledElement.viewport[attrname] = viewport[attrname];\n      }\n    }\n  }\n\n  let frameRate;\n\n  if (enabledElement.lastImageTimeStamp !== undefined) {\n    const timeSinceLastImage = now() - enabledElement.lastImageTimeStamp;\n\n    frameRate = (1000 / timeSinceLastImage).toFixed();\n  }\n\n  enabledElement.lastImageTimeStamp = now();\n\n  const newImageEventData = {\n    viewport: enabledElement.viewport,\n    element: enabledElement.element,\n    image: enabledElement.image,\n    oldImage,\n    enabledElement,\n    frameRate\n  };\n\n  triggerEvent(enabledElement.element, 'cornerstonenewimage', newImageEventData);\n\n  updateImage(element);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./displayImage.js","function s4 () {\n  return Math.floor((1 + Math.random()) * 0x10000).toString(16).\n    substring(1);\n}\n\n/**\n * Generate a unique identifier\n *\n * @return {string} A unique identifier\n */\nexport default function () {\n  return `${s4() + s4()}-${s4()}-${s4()}-${\n    s4()}-${s4()}${s4()}${s4()}`;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/guid.js","/**\n * This module is responsible for immediately drawing an enabled element\n */\n\nimport { getEnabledElement } from './enabledElements.js';\nimport drawImage from './internal/drawImage.js';\n\n/**\n * Immediately draws the enabled element\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @returns {void}\n */\nexport default function (element) {\n  const enabledElement = getEnabledElement(element);\n\n  if (enabledElement.image === undefined) {\n    throw new Error('draw: image has not been loaded yet');\n  }\n\n  drawImage(enabledElement);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./draw.js","/**\n * This module is responsible for drawing invalidated enabled elements\n */\n\nimport { getEnabledElements } from './enabledElements.js';\nimport drawImage from './internal/drawImage.js';\n\n/**\n * Draws all invalidated enabled elements and clears the invalid flag after drawing it\n *\n * @returns {void}\n */\nexport default function () {\n  const enabledElements = getEnabledElements();\n\n  for (let i = 0; i < enabledElements.length; i++) {\n    const ee = enabledElements[i];\n\n    if (ee.invalid === true) {\n      drawImage(ee, true);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./drawInvalidated.js","import { addEnabledElement } from './enabledElements.js';\r\nimport resize from './resize.js';\r\nimport drawImageSync from './internal/drawImageSync.js';\r\nimport requestAnimationFrame from './internal/requestAnimationFrame.js';\r\nimport webGL from './webgl/index.js';\r\nimport triggerEvent from './triggerEvent.js';\r\n\r\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n */\r\n\r\nfunction hasImageOrLayers (enabledElement) {\r\n  return enabledElement.image !== undefined || enabledElement.layers.length;\r\n}\r\n\r\n\r\n/**\r\n * Enable an HTML Element for use in Cornerstone\r\n *\r\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\r\n * @param {Object} options Options for the enabledElement\r\n *\r\n * @return {void}\r\n */\r\nexport default function (element, options) {\r\n  if (element === undefined) {\r\n    throw new Error('enable: parameter element cannot be undefined');\r\n  }\r\n\r\n  // If this enabled element has the option set for WebGL, we should\r\n  // Check if this device actually supports it\r\n  if (options && options.renderer && options.renderer.toLowerCase() === 'webgl') {\r\n    if (webGL.renderer.isWebGLAvailable()) {\r\n      // If WebGL is available on the device, initialize the renderer\r\n      // And return the renderCanvas from the WebGL rendering path\r\n      webGL.renderer.initRenderer();\r\n      options.renderer = 'webgl';\r\n    } else {\r\n      // If WebGL is not available on this device, we will fall back\r\n      // To using the Canvas renderer\r\n      console.error('WebGL not available, falling back to Canvas renderer');\r\n      delete options.renderer;\r\n    }\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n\r\n  element.appendChild(canvas);\r\n\r\n  const enabledElement = {\r\n    element,\r\n    canvas,\r\n    image: undefined, // Will be set once image is loaded\r\n    invalid: false, // True if image needs to be drawn, false if not\r\n    needsRedraw: true,\r\n    options,\r\n    layers: [],\r\n    data: {},\r\n    renderingTools: {}\r\n  };\r\n\r\n  addEnabledElement(enabledElement);\r\n\r\n  resize(element, true);\r\n\r\n  /**\r\n   * Draw the image immediately\r\n   *\r\n   * @param {DOMHighResTimeStamp} timestamp The current time for when requestAnimationFrame starts to fire callbacks\r\n   * @returns {void}\r\n   */\r\n  function draw (timestamp) {\r\n    if (enabledElement.canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    const eventDetails = {\r\n      enabledElement,\r\n      timestamp\r\n    };\r\n\r\n    triggerEvent(enabledElement.element, 'cornerstoneprerender', eventDetails);\r\n\r\n    if (enabledElement.needsRedraw && hasImageOrLayers(enabledElement)) {\r\n      drawImageSync(enabledElement, enabledElement.invalid);\r\n    }\r\n\r\n    requestAnimationFrame(draw);\r\n  }\r\n\r\n  draw();\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./enable.js","import now from './now.js';\r\nimport drawCompositeImage from './drawCompositeImage.js';\r\nimport { renderColorImage } from '../rendering/renderColorImage.js';\r\nimport { renderGrayscaleImage } from '../rendering/renderGrayscaleImage.js';\r\nimport { renderPseudoColorImage } from '../rendering/renderPseudoColorImage.js';\r\nimport { renderLabelMapImage } from '../rendering/renderLabelMapImage.js';\r\nimport triggerEvent from '../triggerEvent.js';\r\n\r\n/**\r\n * Draw an image to a given enabled element synchronously\r\n *\r\n * @param {EnabledElement} enabledElement An enabled element to draw into\r\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\r\n * @returns {void}\r\n */\r\nexport default function (enabledElement, invalidated) {\r\n  const image = enabledElement.image;\r\n  const element = enabledElement.element;\r\n  const layers = enabledElement.layers || [];\r\n\r\n  // Check if enabledElement can be redrawn\r\n  if (!enabledElement.canvas || !(enabledElement.image || layers.length)) {\r\n    return;\r\n  }\r\n\r\n  // Start measuring the time needed to draw the image/layers\r\n  const start = now();\r\n\r\n  image.stats = {\r\n    lastGetPixelDataTime: -1.0,\r\n    lastStoredPixelDataToCanvasImageDataTime: -1.0,\r\n    lastPutImageDataTime: -1.0,\r\n    lastRenderTime: -1.0,\r\n    lastLutGenerateTime: -1.0\r\n  };\r\n\r\n  if (layers && layers.length) {\r\n    drawCompositeImage(enabledElement, invalidated);\r\n  } else if (image) {\r\n    let render = image.render;\r\n\r\n    if (!render) {\r\n      if (enabledElement.viewport.colormap &&\r\n          enabledElement.viewport.colormap !== '' &&\r\n          enabledElement.image.labelmap === true) {\r\n        render = renderLabelMapImage;\r\n      } else if (enabledElement.viewport.colormap && enabledElement.viewport.colormap !== '') {\r\n        render = renderPseudoColorImage;\r\n      } else if (image.color) {\r\n        render = renderColorImage;\r\n      } else {\r\n        render = renderGrayscaleImage;\r\n      }\r\n    }\r\n\r\n    render(enabledElement, invalidated);\r\n  }\r\n\r\n  // Calculate how long it took to draw the image/layers\r\n  const renderTimeInMs = now() - start;\r\n\r\n  const eventData = {\r\n    viewport: enabledElement.viewport,\r\n    element,\r\n    image,\r\n    enabledElement,\r\n    canvasContext: enabledElement.canvas.getContext('2d'),\r\n    renderTimeInMs\r\n  };\r\n\r\n  image.stats.lastRenderTime = renderTimeInMs;\r\n\r\n  enabledElement.invalid = false;\r\n  enabledElement.needsRedraw = false;\r\n\r\n  triggerEvent(element, 'cornerstoneimagerendered', eventData);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./internal/drawImageSync.js","import { getLayers, getActiveLayer, getVisibleLayers } from '../layers.js';\nimport { addGrayscaleLayer } from '../rendering/renderGrayscaleImage.js';\nimport { addColorLayer } from '../rendering/renderColorImage.js';\nimport { addPseudoColorLayer } from '../rendering/renderPseudoColorImage.js';\nimport { addLabelMapLayer } from '../rendering/renderLabelMapImage.js';\nimport setToPixelCoordinateSystem from '../setToPixelCoordinateSystem.js';\n\n// This is used to keep each of the layers' viewports in sync with the active layer\nconst originalViewportScale = {};\n\nfunction getViewportRatio (baseLayerId, targetLayerId) {\n  return originalViewportScale[targetLayerId] / originalViewportScale[baseLayerId];\n}\n\n// Sync all viewports based on active layer's viewport\nfunction syncViewports (layers, activeLayer) {\n  // If we intend to keep the viewport's scale, translation and rotation in sync,\n  // loop through the layers\n  layers.forEach((layer) => {\n    // Don't do anything to the active layer\n    // Don't do anything if this layer has no viewport\n    if (layer === activeLayer ||\n        !layer.viewport ||\n        !activeLayer.viewport) {\n      return;\n    }\n\n    if (!originalViewportScale[layer.layerId]) {\n      originalViewportScale[layer.layerId] = layer.viewport.scale;\n    }\n\n    const viewportRatio = getViewportRatio(activeLayer.layerId, layer.layerId);\n\n    // Update the layer's translation and scale to keep them in sync with the first image\n    // based on the ratios between the images\n    layer.viewport.scale = activeLayer.viewport.scale * viewportRatio;\n    layer.viewport.rotation = activeLayer.viewport.rotation;\n    layer.viewport.translation = {\n      x: (activeLayer.viewport.translation.x / viewportRatio),\n      y: (activeLayer.viewport.translation.y / viewportRatio)\n    };\n    layer.viewport.hflip = activeLayer.viewport.hflip;\n    layer.viewport.vflip = activeLayer.viewport.vflip;\n  });\n}\n\n/**\n * Internal function to render all layers for a Cornerstone enabled element\n *\n * @param {CanvasRenderingContext2D} context Canvas context to draw upon\n * @param {EnabledElementLayer[]} layers The array of all layers for this enabled element\n * @param {Boolean} invalidated A boolean whether or not this image has been invalidated and must be redrawn\n * @returns {void}\n */\nfunction renderLayers (context, layers, invalidated) {\n  // Loop through each layer and draw it to the canvas\n  layers.forEach((layer, index) => {\n    if (!layer.image) {\n      return;\n    }\n\n    context.save();\n\n    // Set the layer's canvas to the pixel coordinate system\n    layer.canvas = context.canvas;\n    setToPixelCoordinateSystem(layer, context);\n\n    // Render into the layer's canvas\n    const colormap = layer.viewport.colormap || layer.options.colormap;\n    const labelmap = layer.viewport.labelmap;\n    const isInvalid = layer.invalid || invalidated;\n\n    if (colormap && colormap !== '' && labelmap === true) {\n      addLabelMapLayer(layer, isInvalid);\n    } else if (colormap && colormap !== '') {\n      addPseudoColorLayer(layer, isInvalid);\n    } else if (layer.image.color === true) {\n      addColorLayer(layer, isInvalid);\n    } else {\n      // If this is the base layer, use the alpha channel for rendering of the grayscale image\n      const useAlphaChannel = (index === 0);\n\n      addGrayscaleLayer(layer, isInvalid, useAlphaChannel);\n    }\n\n    // Apply any global opacity settings that have been defined for this layer\n    if (layer.options && layer.options.opacity) {\n      context.globalAlpha = layer.options.opacity;\n    } else {\n      context.globalAlpha = 1;\n    }\n\n    if (layer.options && layer.options.fillStyle) {\n      context.fillStyle = layer.options.fillStyle;\n    }\n\n    // Set the pixelReplication property before drawing from the layer into the\n    // composite canvas\n    context.imageSmoothingEnabled = !layer.viewport.pixelReplication;\n    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;\n\n    // Draw from the current layer's canvas onto the enabled element's canvas\n    const sx = layer.viewport.displayedArea.tlhc.x - 1;\n    const sy = layer.viewport.displayedArea.tlhc.y - 1;\n    const width = layer.viewport.displayedArea.brhc.x - layer.viewport.displayedArea.tlhc.x;\n    const height = layer.viewport.displayedArea.brhc.y - layer.viewport.displayedArea.tlhc.y;\n\n    context.drawImage(layer.canvas, sx, sy, width, height, 0, 0, width, height);\n    context.restore();\n\n    layer.invalid = false;\n  });\n}\n\n/**\n * Internal API function to draw a composite image to a given enabled element\n *\n * @param {EnabledElement} enabledElement An enabled element to draw into\n * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used\n * @returns {void}\n */\nexport default function (enabledElement, invalidated) {\n  const element = enabledElement.element;\n  const allLayers = getLayers(element);\n  const activeLayer = getActiveLayer(element);\n  const visibleLayers = getVisibleLayers(element);\n  const resynced = !enabledElement.lastSyncViewportsState && enabledElement.syncViewports;\n\n  // This state will help us to determine if the user has re-synced the\n  // layers allowing us to make a new copy of the viewports\n  enabledElement.lastSyncViewportsState = enabledElement.syncViewports;\n\n  // Stores a copy of all viewports if the user has just synced them then we can use the\n  // copies to calculate anything later (ratio, translation offset, rotation offset, etc)\n  if (resynced) {\n    allLayers.forEach(function (layer) {\n      if (layer.viewport) {\n        originalViewportScale[layer.layerId] = layer.viewport.scale;\n      }\n    });\n  }\n\n  // Sync all viewports in case it's activated\n  if (enabledElement.syncViewports === true) {\n    syncViewports(visibleLayers, activeLayer);\n  }\n\n  // Get the enabled element's canvas so we can draw to it\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Clear the canvas\n  context.fillStyle = 'black';\n  context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height);\n\n  // Render all visible layers\n  renderLayers(context, visibleLayers, invalidated);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./internal/drawCompositeImage.js","import { getEnabledElement } from './enabledElements.js';\n\n/**\n * Retrieves any data for a Cornerstone enabledElement for a specific string\n * dataType\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {string} dataType A string name for an arbitrary set of data\n * @returns {*} Whatever data is stored for this enabled element\n */\nexport function getElementData (element, dataType) {\n  const ee = getEnabledElement(element);\n\n  if (ee.data.hasOwnProperty(dataType) === false) {\n    ee.data[dataType] = {};\n  }\n\n  return ee.data[dataType];\n}\n\n/**\n * Clears any data for a Cornerstone enabledElement for a specific string\n * dataType\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {string} dataType A string name for an arbitrary set of data\n *\n * @returns {void}\n */\nexport function removeElementData (element, dataType) {\n  const ee = getEnabledElement(element);\n\n  delete ee.data[dataType];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./enabledElementData.js","import { getEnabledElement } from './enabledElements.js';\nimport getDefaultViewport from './internal/getDefaultViewport.js';\n\n/**\n * Returns a default viewport for display the specified image on the specified\n * enabled element.  The default viewport is fit to window\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Image} image A Cornerstone Image Object\n *\n * @returns {Viewport} The default viewport for the image\n */\nexport default function (element, image) {\n  const enabledElement = getEnabledElement(element);\n\n  return getDefaultViewport(enabledElement.canvas, image);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./getDefaultViewportForImage.js","import { getEnabledElement } from './enabledElements.js';\n\n/**\n * Returns the currently displayed image for an element or undefined if no image has\n * been displayed yet\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @returns {Image} The Cornerstone Image Object displayed in this element\n */\nexport default function (element) {\n  const enabledElement = getEnabledElement(element);\n\n  return enabledElement.image;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./getImage.js","import { getEnabledElement } from './enabledElements.js';\nimport getStoredPixels from './getStoredPixels.js';\nimport getModalityLUT from './internal/getModalityLUT.js';\n\n/**\n * Retrieves an array of pixels from a rectangular region with modality LUT transformation applied\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @param {Number} x The x coordinate of the top left corner of the sampling rectangle in image coordinates\n * @param {Number} y The y coordinate of the top left corner of the sampling rectangle in image coordinates\n * @param {Number} width The width of the of the sampling rectangle in image coordinates\n * @param {Number} height The height of the of the sampling rectangle in image coordinates\n * @returns {Array} The modality pixel value of the pixels in the sampling rectangle\n */\nexport default function (element, x, y, width, height) {\n  const storedPixels = getStoredPixels(element, x, y, width, height);\n  const ee = getEnabledElement(element);\n  const mlutfn = getModalityLUT(ee.image.slope, ee.image.intercept, ee.viewport.modalityLUT);\n\n  return storedPixels.map(mlutfn);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./getPixels.js","import { getEnabledElement } from './enabledElements.js';\n\n/**\n * Retrieves the viewport for the specified enabled element\n *\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\n * @returns {Viewport|undefined} The Cornerstone Viewport settings for this element, if they exist. Otherwise, undefined\n */\nexport default function (element) {\n  const enabledElement = getEnabledElement(element);\n  const viewport = enabledElement.viewport;\n\n  if (viewport === undefined) {\n    return;\n  }\n\n  // Return a copy of the viewport\n  return Object.assign({}, viewport);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./getViewport.js","import { getImageLoadObject, putImageLoadObject } from './imageCache.js';\r\nimport events from './events.js';\r\nimport triggerEvent from './triggerEvent.js';\r\n\r\n/**\r\n * This module deals with ImageLoaders, loading images and caching images\r\n */\r\n\r\n\r\nconst imageLoaders = {};\r\n\r\nlet unknownImageLoader;\r\n\r\n/**\r\n * Load an image using a registered Cornerstone Image Loader.\r\n *\r\n * The image loader that is used will be\r\n * determined by the image loader scheme matching against the imageId.\r\n *\r\n * @param {String} imageId A Cornerstone Image Object's imageId\r\n * @param {Object} [options] Options to be passed to the Image Loader\r\n *\r\n * @returns {ImageLoadObject} An Object which can be used to act after an image is loaded or loading fails\r\n */\r\nfunction loadImageFromImageLoader (imageId, options) {\r\n  const colonIndex = imageId.indexOf(':');\r\n  const scheme = imageId.substring(0, colonIndex);\r\n  const loader = imageLoaders[scheme];\r\n\r\n  if (loader === undefined || loader === null) {\r\n    if (unknownImageLoader !== undefined) {\r\n      return unknownImageLoader(imageId);\r\n    }\r\n\r\n    throw new Error('loadImageFromImageLoader: no image loader for imageId');\r\n  }\r\n\r\n  const imageLoadObject = loader(imageId, options);\r\n\r\n  // Broadcast an image loaded event once the image is loaded\r\n  imageLoadObject.promise.then(function (image) {\r\n    triggerEvent(events, 'cornerstoneimageloaded', { image });\r\n  }, function (error) {\r\n    const errorObject = {\r\n      imageId,\r\n      error\r\n    };\r\n\r\n    triggerEvent(events, 'cornerstoneimageloadfailed', errorObject);\r\n  });\r\n\r\n  return imageLoadObject;\r\n}\r\n\r\n/**\r\n * Loads an image given an imageId and optional priority and returns a promise which will resolve to\r\n * the loaded image object or fail if an error occurred.  The loaded image is not stored in the cache.\r\n *\r\n * @param {String} imageId A Cornerstone Image Object's imageId\r\n * @param {Object} [options] Options to be passed to the Image Loader\r\n *\r\n * @returns {ImageLoadObject} An Object which can be used to act after an image is loaded or loading fails\r\n */\r\nexport function loadImage (imageId, options) {\r\n  if (imageId === undefined) {\r\n    throw new Error('loadImage: parameter imageId must not be undefined');\r\n  }\r\n\r\n  const imageLoadObject = getImageLoadObject(imageId);\r\n\r\n  if (imageLoadObject !== undefined) {\r\n    return imageLoadObject.promise;\r\n  }\r\n\r\n  return loadImageFromImageLoader(imageId, options).promise;\r\n}\r\n\r\n//\r\n\r\n/**\r\n * Loads an image given an imageId and optional priority and returns a promise which will resolve to\r\n * the loaded image object or fail if an error occurred. The image is stored in the cache.\r\n *\r\n * @param {String} imageId A Cornerstone Image Object's imageId\r\n * @param {Object} [options] Options to be passed to the Image Loader\r\n *\r\n * @returns {Object} Image Loader Object (TODO: define a JSDoc type for this)\r\n */\r\nexport function loadAndCacheImage (imageId, options) {\r\n  if (imageId === undefined) {\r\n    throw new Error('loadAndCacheImage: parameter imageId must not be undefined');\r\n  }\r\n\r\n  let imageLoadObject = getImageLoadObject(imageId);\r\n\r\n  if (imageLoadObject !== undefined) {\r\n    return imageLoadObject.promise;\r\n  }\r\n\r\n  imageLoadObject = loadImageFromImageLoader(imageId, options);\r\n\r\n  putImageLoadObject(imageId, imageLoadObject);\r\n\r\n  return imageLoadObject.promise;\r\n}\r\n\r\n/**\r\n * Registers an imageLoader plugin with cornerstone for the specified scheme\r\n *\r\n * @param {String} scheme The scheme to use for this image loader (e.g. 'dicomweb', 'wadouri', 'http')\r\n * @param {Function} imageLoader A Cornerstone Image Loader function\r\n * @returns {void}\r\n */\r\nexport function registerImageLoader (scheme, imageLoader) {\r\n  imageLoaders[scheme] = imageLoader;\r\n}\r\n\r\n/**\r\n * Registers a new unknownImageLoader and returns the previous one\r\n *\r\n * @param {Function} imageLoader A Cornerstone Image Loader\r\n *\r\n * @returns {Function|Undefined} The previous Unknown Image Loader\r\n */\r\nexport function registerUnknownImageLoader (imageLoader) {\r\n  const oldImageLoader = unknownImageLoader;\r\n\r\n  unknownImageLoader = imageLoader;\r\n\r\n  return oldImageLoader;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader.js","import { getEnabledElement } from './enabledElements.js';\r\nimport triggerEvent from './triggerEvent.js';\r\n\r\n/**\r\n * This module contains a function to make an image is invalid\r\n */\r\n\r\n/**\r\n * Sets the invalid flag on the enabled element and fire an event\r\n * @param {HTMLElement} element The DOM element enabled for Cornerstone\r\n * @returns {void}\r\n */\r\nexport default function (element) {\r\n  const enabledElement = getEnabledElement(element);\r\n\r\n  enabledElement.invalid = true;\r\n  enabledElement.needsRedraw = true;\r\n  const eventData = {\r\n    element\r\n  };\r\n\r\n  triggerEvent(element, 'cornerstoneinvalidated', eventData);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./invalidate.js","/**\n * This module contains a function to immediately invalidate an image\n */\n\nimport { getEnabledElementsByImageId } from './enabledElements.js';\nimport drawImage from './internal/drawImage.js';\n\n/**\n * Forces the image to be updated/redrawn for the all enabled elements\n * displaying the specified imageId\n *\n * @param {string} imageId The imageId of the Cornerstone Image Object to redraw\n * @returns {void}\n */\nexport default function (imageId) {\n\n  const enabledElements = getEnabledElementsByImageId(imageId);\n\n  enabledElements.forEach(function (enabledElement) {\n    drawImage(enabledElement, true);\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./invalidateImageId.js","import { getEnabledElement } from './enabledElements.js';\nimport getTransform from './internal/getTransform.js';\n\n/**\n * Converts a point in the page coordinate system to the pixel coordinate\n * system\n *\n * @param {HTMLElement} element The Cornerstone element within which the input point lies\n * @param {Number} pageX The x value in the page coordinate system\n * @param {Number} pageY The y value in the page coordinate system\n *\n * @returns {{x: Number, y: Number}} The transformed point in the pixel coordinate system\n */\nexport default function (element, pageX, pageY) {\n  const enabledElement = getEnabledElement(element);\n\n  if (enabledElement.image === undefined) {\n    throw new Error('image has not been loaded yet');\n  }\n\n  // Convert the pageX and pageY to the canvas client coordinates\n  const rect = element.getBoundingClientRect();\n  const clientX = pageX - rect.left - window.pageXOffset;\n  const clientY = pageY - rect.top - window.pageYOffset;\n\n  const pt = { x: clientX,\n    y: clientY };\n  const transform = getTransform(enabledElement);\n\n  transform.invert();\n\n  return transform.transformPoint(pt.x, pt.y);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./pageToPixel.js","import { getEnabledElement } from './enabledElements.js';\nimport getTransform from './internal/getTransform.js';\n\n/**\n * Converts a point in the pixel coordinate system to the canvas coordinate system\n * system.  This can be used to render using canvas context without having the weird\n * side effects that come from scaling and non square pixels\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @param {{x: Number, y: Number}} pt The transformed point in the pixel coordinate system\n *\n * @returns {{x: Number, y: Number}} The input point in the canvas coordinate system\n */\nexport default function (element, pt) {\n  const enabledElement = getEnabledElement(element);\n  const transform = getTransform(enabledElement);\n\n\n  return transform.transformPoint(pt.x, pt.y);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./pixelToCanvas.js","import { getEnabledElement } from './enabledElements.js';\nimport getDefaultViewport from './internal/getDefaultViewport.js';\nimport updateImage from './updateImage.js';\n\n/**\n * Resets the viewport to the default settings\n *\n * @param {HTMLElement} element An HTML Element enabled for Cornerstone\n * @returns {void}\n */\nexport default function (element) {\n  const enabledElement = getEnabledElement(element);\n\n  enabledElement.viewport = getDefaultViewport(enabledElement.canvas, enabledElement.image);\n  updateImage(element);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./reset.js","import { getEnabledElement } from './enabledElements.js';\nimport updateImage from './updateImage.js';\n\nconst MIN_WINDOW_WIDTH = 0.000001;\nconst MIN_VIEWPORT_SCALE = 0.0001;\n\n/**\n * Sets the viewport for an element and corrects invalid values\n *\n * @param {HTMLElement} element - DOM element of the enabled element\n * @param {Viewport} viewport - Object containing the viewport properties\n * @returns {void}\n */\nexport default function (element, viewport) {\n  const enabledElement = getEnabledElement(element);\n\n  enabledElement.viewport.translation.x = viewport.translation.x;\n  enabledElement.viewport.translation.y = viewport.translation.y;\n  enabledElement.viewport.voi.windowCenter = viewport.voi.windowCenter;\n  enabledElement.viewport.invert = viewport.invert;\n  enabledElement.viewport.pixelReplication = viewport.pixelReplication;\n  enabledElement.viewport.rotation = viewport.rotation;\n  enabledElement.viewport.hflip = viewport.hflip;\n  enabledElement.viewport.vflip = viewport.vflip;\n  enabledElement.viewport.modalityLUT = viewport.modalityLUT;\n  enabledElement.viewport.voiLUT = viewport.voiLUT;\n  enabledElement.viewport.colormap = viewport.colormap;\n  enabledElement.viewport.labelmap = viewport.labelmap;\n\n  // Prevent window width from being too small (note that values close to zero are valid and can occur with\n  // PET images in particular)\n  enabledElement.viewport.voi.windowWidth = Math.max(viewport.voi.windowWidth, MIN_WINDOW_WIDTH);\n\n  // Prevent scale from getting too small\n  enabledElement.viewport.scale = Math.max(viewport.scale, MIN_VIEWPORT_SCALE);\n\n  // Normalize the rotation value to a positive rotation in degrees\n  enabledElement.viewport.rotation %= 360;\n  if (enabledElement.viewport.rotation < 0) {\n    enabledElement.viewport.rotation += 360;\n  }\n\n  // Force the image to be updated since the viewport has been modified\n  updateImage(element);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./setViewport.js","import { renderColorImage } from './renderColorImage.js';\nimport { renderGrayscaleImage } from './renderGrayscaleImage.js';\nimport { renderWebImage } from './renderWebImage.js';\n\nexport default {\n  colorImage: renderColorImage,\n  grayscaleImage: renderGrayscaleImage,\n  webImage: renderWebImage\n};\n\n\n\n// WEBPACK FOOTER //\n// ./rendering/index.js","// This module defines a way to access various metadata about an imageId.  This layer of abstraction exists\n// So metadata can be provided in different ways (e.g. by parsing DICOM P10 or by a WADO-RS document)\n\nconst providers = [];\n\n/**\n * Adds a metadata provider with the specified priority\n * @param {Function} provider Metadata provider function\n * @param {Number} [priority=0] - 0 is default/normal, > 0 is high, < 0 is low\n *\n * @returns {void}\n */\nexport function addProvider (provider, priority = 0) {\n  let i;\n\n  // Find the right spot to insert this provider based on priority\n  for (i = 0; i < providers.length; i++) {\n    if (providers[i].priority <= priority) {\n      break;\n    }\n  }\n\n  // Insert the decode task at position i\n  providers.splice(i, 0, {\n    priority,\n    provider\n  });\n}\n\n/**\n * Removes the specified provider\n *\n * @param {Function} provider Metadata provider function\n *\n * @returns {void}\n */\nexport function removeProvider (provider) {\n  for (let i = 0; i < providers.length; i++) {\n    if (providers[i].provider === provider) {\n      providers.splice(i, 1);\n\n      break;\n    }\n  }\n}\n\n/**\n * Gets metadata from the registered metadata providers.  Will call each one from highest priority to lowest\n * until one responds\n *\n * @param {String} type The type of metadata requested from the metadata store\n * @param {String} imageId The Cornerstone Image Object's imageId\n *\n * @returns {*} The metadata retrieved from the metadata store\n */\nfunction getMetaData (type, imageId) {\n  // Invoke each provider in priority order until one returns something\n  for (let i = 0; i < providers.length; i++) {\n    const result = providers[i].provider(type, imageId);\n\n    if (result !== undefined) {\n      return result;\n    }\n  }\n}\n\nexport default {\n  addProvider,\n  removeProvider,\n  get: getMetaData\n};\n\n\n\n// WEBPACK FOOTER //\n// ./metaData.js","import { getEnabledElement } from './enabledElements.js';\nimport pixelDataToFalseColorData from './pixelDataToFalseColorData.js';\nimport { getColormap } from './colors/colormap.js';\n\n/**\n * Retrieves the minimum and maximum pixel values from an Array of pixel data\n *\n * @param {Array} pixelData The input pixel data array\n *\n * @returns {{minPixelValue: Number, maxPixelValue: Number}} The minimum and maximum pixel values in the input Array\n */\nfunction getPixelValues (pixelData) {\n  let minPixelValue = Number.MAX_VALUE;\n  let maxPixelValue = Number.MIN_VALUE;\n  const len = pixelData.length;\n  let pixel;\n\n  for (let i = 0; i < len; i++) {\n    pixel = pixelData[i];\n    minPixelValue = minPixelValue < pixel ? minPixelValue : pixel;\n    maxPixelValue = maxPixelValue > pixel ? maxPixelValue : pixel;\n  }\n\n  return {\n    minPixelValue,\n    maxPixelValue\n  };\n}\n\n/**\n * Retrieve a function that will allow an image object to be reset to its original form\n * after a false color mapping transformation\n *\n * @param {Image} image A Cornerstone Image Object\n *\n * @return {Function} A function for resetting an Image Object to its original form\n */\nfunction getRestoreImageMethod (image) {\n  if (image.restore) {\n    return image.restore;\n  }\n\n  const color = image.color;\n  const rgba = image.rgba;\n  const cachedLut = image.cachedLut;\n  const slope = image.slope;\n  const windowWidth = image.windowWidth;\n  const windowCenter = image.windowCenter;\n  const minPixelValue = image.minPixelValue;\n  const maxPixelValue = image.maxPixelValue;\n\n  return function () {\n    image.color = color;\n    image.rgba = rgba;\n    image.cachedLut = cachedLut;\n    image.slope = slope;\n    image.windowWidth = windowWidth;\n    image.windowCenter = windowCenter;\n    image.minPixelValue = minPixelValue;\n    image.maxPixelValue = maxPixelValue;\n\n    if (image.origPixelData) {\n      const pixelData = image.origPixelData;\n\n      image.getPixelData = () => pixelData;\n    }\n\n    // Remove some attributes added by false color mapping\n    image.origPixelData = undefined;\n    image.colormapId = undefined;\n    image.falseColor = undefined;\n  };\n}\n\n//\n// Then we need to make sure it will be converted into a colormap object if it's as string.\n\n/**\n * User can pass a colormap or its id as string to some of these public functions.\n * Then we need to make sure it will be converted into a colormap object if it's a string.\n *\n * @param {*} colormap A colormap ID or Object\n * @return {*} The colormap\n */\nfunction ensuresColormap (colormap) {\n  if (colormap && (typeof colormap === 'string')) {\n    colormap = getColormap(colormap);\n  }\n\n  return colormap;\n}\n\n/**\n * Restores a false color image to its original version\n *\n * @param {Image} image A Cornerstone Image Object\n * @returns {Boolean} True if the image object had a valid restore function, which was run. Otherwise, false.\n */\nfunction restoreImage (image) {\n  if (image.restore && (typeof image.restore === 'function')) {\n    image.restore();\n\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Convert an image to a false color image\n *\n * @param {Image} image A Cornerstone Image Object\n * @param {String|Object} colormap - it can be a colormap object or a colormap id (string)\n *\n * @returns {Boolean} - Whether or not the image has been converted to a false color image\n */\nfunction convertImageToFalseColorImage (image, colormap) {\n  if (image.color && !image.falseColor) {\n    throw new Error('Color transforms are not implemented yet');\n  }\n\n  // User can pass a colormap id or a colormap object\n  colormap = ensuresColormap(colormap);\n\n  const colormapId = colormap.getId();\n\n  // Doesn't do anything if colormapId hasn't changed\n  if (image.colormapId === colormapId) {\n    // It has already being converted into a false color image\n    // Using the colormapId passed as parameter\n    return false;\n  }\n\n  // Restore the image attributes updated when converting to a false color image\n  restoreImage(image);\n\n  // Convert the image to a false color image\n  if (colormapId) {\n    const minPixelValue = image.minPixelValue || 0;\n    const maxPixelValue = image.maxPixelValue || 255;\n\n    image.restore = getRestoreImageMethod(image);\n\n    const lookupTable = colormap.createLookupTable();\n\n    lookupTable.setTableRange(minPixelValue, maxPixelValue);\n\n    // Update the pixel data and render the new image\n    pixelDataToFalseColorData(image, lookupTable);\n\n    // Update min and max pixel values\n    const pixelValues = getPixelValues(image.getPixelData());\n\n    image.minPixelValue = pixelValues.minPixelValue;\n    image.maxPixelValue = pixelValues.maxPixelValue;\n\n    image.windowWidth = 255;\n    image.windowCenter = 128;\n\n    // Cache the last colormapId used for performance\n    // Then it doesn't need to be re-rendered on next\n    // Time if the user hasn't updated it\n    image.colormapId = colormapId;\n  }\n\n  // Return `true` to tell the caller that the image has got updated\n  return true;\n}\n\n/**\n * Convert the image of a element to a false color image\n *\n * @param {HTMLElement} element The Cornerstone element\n * @param {*} colormap - it can be a colormap object or a colormap id (string)\n *\n * @returns {void}\n */\nfunction convertToFalseColorImage (element, colormap) {\n  const enabledElement = getEnabledElement(element);\n\n\n  return convertImageToFalseColorImage(enabledElement.image, colormap);\n}\n\nexport { convertImageToFalseColorImage,\n  convertToFalseColorImage,\n  restoreImage };\n\n\n\n// WEBPACK FOOTER //\n// ./falseColorMapping.js"],"sourceRoot":""}